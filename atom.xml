<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>研友</title>
  
  <subtitle>做个有梦想的人！</subtitle>
  <link href="https://blog.cilicili.xyz/atom.xml" rel="self"/>
  
  <link href="https://blog.cilicili.xyz/"/>
  <updated>2022-09-27T13:24:04.086Z</updated>
  <id>https://blog.cilicili.xyz/</id>
  
  <author>
    <name>研友</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【前端】Pinia快速入门🍍</title>
    <link href="https://blog.cilicili.xyz/posts/fc6e512f.html"/>
    <id>https://blog.cilicili.xyz/posts/fc6e512f.html</id>
    <published>2022-09-27T11:53:05.000Z</published>
    <updated>2022-09-27T13:24:04.086Z</updated>
    
    <content type="html"><![CDATA[<h1>Pinia快速入门</h1><h2 id="Pinia简介">Pinia简介</h2><p><a href="https://pinia.vuejs.org/">官方网站</a></p><blockquote><p><strong>Pinia</strong>是Vue生态里Vuex的代替者，<strong>一个全新Vue的状态管理库</strong>。</p></blockquote><h3 id="优点">优点</h3><ul><li><code>Vue2</code>和<code>Vue3</code>都支持，这让我们同时使用<code>Vue2</code>和<code>Vue3</code>的小伙伴都能很快上手</li><li>和 Vuex 对比，取消了<code>Mutations</code>操作，只有 <code>state</code> <code>getters</code> <code>actions</code> 简化状态库管理</li><li>完全支持 <code>TypeScript</code></li><li>无需再创建各个模块嵌套了，<code>Vuex</code>中如果数据过多，通常分模块来进行管理，稍显麻烦，而<code>pinia</code>中每个<code>store</code>都是独立的，互相不影响</li><li>体积非常小，只有<code>1KB</code>左右。</li><li><code>pinia</code>支持插件来扩展自身功能。</li><li>支持服务端渲染</li></ul><h2 id="Pinia基础使用">Pinia基础使用</h2><h3 id="安装Pinia">安装Pinia</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure><p>安装完成后我们需要将<code>pinia</code>挂载到<code>Vue</code>应用中，也就是我们需要创建一个根存储传递给应用程序，简单来说就是创建一个存储数据的数据桶，放到应用程序中去。</p><p>修改<code>main.js</code>，引入<code>pinia</code>提供的<code>createPinia</code>方法，创建根存储。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="创建Store">创建Store</h3><p>Store就是数据仓库的意思，也可以理解为公共组件。只不过该公共组件只存放数据，这些数据我们其它所有的组件都能够访问且可以修改。</p><p><strong>方法</strong>：</p><ol><li><p>在项目<code>src</code>目录下新建<code>store</code>文件夹，用来存放所有<code>store</code>。例如在该目录下新建<code>user.ts</code>文件，用来存放与<code>user</code>相关的<code>store</code>。</p></li><li><p>使用<code>pinia</code>提供的<code>defineStore()</code>方法来创建一个<code>store</code>，该<code>store</code>用来存放我们需要全局使用的数据。</p></li></ol><p><strong>代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// /src/store/user.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是应用程序 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsersStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// 其它配置项</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>创建<code>store</code>很简单，调用<code>pinia</code>中的<code>defineStore</code>函数即可，该函数接收两个参数：</p><ul><li><code>name</code>：一个字符串，必传项，该<code>store</code>的唯一<code>id</code>。</li><li><code>options</code>：一个对象，<code>store</code>的配置项，比如配置<code>store</code>内的数据，修改数据的方法等等。</li></ul><p>我们可以定义任意数量的<code>store</code>，因为<code>store</code>就是一个函数。</p></blockquote><h3 id="使用Store">使用Store</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /src/App.vue</span></span><br><span class="line"><span class="comment">// 直接引入声明的useUserStore方法</span></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useUsersStore &#125; <span class="keyword">from</span> <span class="string">&quot;../src/store/user&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useUsersStore</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(store);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>输出</strong>：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/ecf518b330b54bea862fd57439f980da~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p><h3 id="添加State">添加State</h3><p>将我们需要存放的数据放在options对象中的state属性内。</p><p><strong>代码</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsersStore = <span class="title function_">defineStore</span>(<span class="string">&quot;users&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;小猪课堂&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>注意，<code>state</code>接收的是一个箭头函数返回的值，它不能直接接收一个对象</p></blockquote><h3 id="操作State">操作State</h3><h4 id="读取State数据">读取State数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;Vue logo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./assets/logo.png&quot;</span> /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;&#123; sex &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; useUsersStore &#125; from &quot;../src/store/user&quot;;</span><br><span class="line">    </span><br><span class="line">const store = useUsersStore();</span><br><span class="line">    </span><br><span class="line">const name = ref&lt;string&gt;(store.name);</span><br><span class="line">const age = ref&lt;number&gt;(store.age);</span><br><span class="line">const sex = ref&lt;string&gt;(store.sex);</span><br><span class="line">// 或者 使用结构方法</span><br><span class="line">const &#123; name, age, sex &#125; = store;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="多个组件使用State">多个组件使用State</h4><p>和单组件使用State方式一样</p><h4 id="修改State数据">修改State数据</h4><p>如果我们想要修改<code>Store</code>中的数据，就引入<code>pinia</code>提供的<code>storeToRefs</code>函数，将数据变为<code>响应式</code>，然后直接赋值就可以实现。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;Vue logo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./assets/logo.png&quot;</span> /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;&#123; sex &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>更改姓名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> child <span class="keyword">from</span> <span class="string">&#x27;./child.vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useUsersStore &#125; <span class="keyword">from</span> <span class="string">&quot;../src/store/user&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;  <span class="comment">// 新添加</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> store = <span class="title function_">useUsersStore</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> &#123; name, age, sex &#125; = <span class="title function_">storeToRefs</span>(store); <span class="comment">// 新添加</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">changeName</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.<span class="property">name</span> = <span class="string">&quot;张三&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(store);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="重置State">重置State</h4><p>直接调用<code>Store</code>的<code>$reset()</code>方法即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=<span class="string">&quot;reset&quot;</span>&gt;重置store&lt;/button&gt;</span><br><span class="line"><span class="comment">// 重置store</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  store.$reset();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>当我们点击重置按钮时，<code>store</code>中的数据会变为初始状态，页面也会更新。</p><h4 id="批量更改State中的数据">批量更改State中的数据</h4><p>使用<code>store</code>的<code>$patch</code>方法，添加一个批量更改部分数据的方法。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=<span class="string">&quot;patchStore&quot;</span>&gt;批量修改数据&lt;/button&gt;</span><br><span class="line"><span class="comment">// 批量修改数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">patchStore</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  store.$patch(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">sex</span>: <span class="string">&quot;女&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>原理</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">store.$patch(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  state.<span class="property">items</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;shoes&#x27;</span>, <span class="attr">quantity</span>: <span class="number">1</span> &#125;)</span><br><span class="line">  state.<span class="property">hasChanged</span> = <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="直接替换整个State">直接替换整个State</h4><p><code>pinia</code>提供了方法让我们直接替换整个<code>state</code>对象，使用<code>store</code>的<code>$state</code>方法。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="property">$state</span> = &#123; <span class="attr">counter</span>: <span class="number">666</span>, <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><p>这会将我们提前声明的<code>state</code>替换为新的对象，可能这种场景用得比较少。</p><h3 id="getters属性">getters属性</h3><p><code>getters</code>是<code>defineStore</code>参数配置项里面的另一个属性。</p><p><code>getter</code>属性值是一个对象，该对象里面有各种方法。我们可以把<code>getter</code>想象成<code>Vue</code>中的计算属性，它的作用就是返回一个新的结果，既然它和<code>Vue</code>中的计算属性类似，那么它肯定也是会被缓存的，就和<code>computed</code>一样。</p><p>当然我们这里的<code>getter</code>就是处理<code>state</code>数据。</p><h4 id="添加getter"><strong>添加getter</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsersStore = <span class="title function_">defineStore</span>(<span class="string">&quot;users&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;小猪课堂&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">getAddAge</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123; </span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">age</span> + <span class="number">100</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>我们在配置项参数中添加了<code>getter</code>属性，该属性对象中定义了一个<code>getAddAge</code>方法，该方法会默认接收一个<code>state</code>参数，也就是<code>state</code>对象，然后该方法返回的是一个新的数据。</p><h4 id="使用getter">使用getter</h4><p>接下来我们看一下组件中如何使用<code>getter</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>新年龄：&#123;&#123; store.getAddAge &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="comment">/* 新添加 */</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;patchStore&quot;</span>&gt;</span>批量修改数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useUsersStore &#125; <span class="keyword">from</span> <span class="string">&quot;../src/store/user&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> store = <span class="title function_">useUsersStore</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 批量修改数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">patchStore</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.$patch(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">age</span>: <span class="number">100</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">sex</span>: <span class="string">&quot;女&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>代码中我们直接在标签上使用了<code>store.gettAddAge</code>方法，这样可以保证响应式。</p><p>其实我们<code>state</code>中的<code>name</code>等属性也可以以此种方式直接在标签上使用，也可以保持响应式。</p><h4 id="getter中调用其它getter">getter中调用其它getter</h4><p>前面我们的<code>getAddAge</code>方法只是简单的使用了<code>state</code>方法，但是有时候我们需要在这一个<code>getter</code>方法中调用其它<code>getter</code>方法，这个时候如何调用呢？</p><ul><li>其实很简单，我们可以直接在<code>getter</code>方法中调用<code>this</code>，<code>this</code>指向的便是<code>store</code>实例，所以理所当然的能够调用到其它<code>getter</code>。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsersStore = <span class="title function_">defineStore</span>(<span class="string">&quot;users&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;小猪课堂&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">getAddAge</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">age</span> + <span class="number">100</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 新添加方法 </span></span><br><span class="line">    <span class="title function_">getNameAndAge</span>(): string &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="variable language_">this</span>.<span class="property">getAddAge</span>; <span class="comment">// 调用其它getter</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>细心的小伙伴可能会发现我们这里没有使用箭头函数的形式，这是因为我们在函数内部使用了<code>this</code>，箭头函数的<code>this</code>指向问题相信大家都知道吧！所以这里我们没有采用箭头函数的形式。</p><p>那么在组件中调用的形式没什么变化，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>调用其它getter：&#123;&#123; store.getNameAndAge &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="getter传参">getter传参</h4><p>既然<code>getter</code>函数做了一些计算或者处理，那么我们很可能会需要传递参数给<code>getter</code>函数，但是我们前面说<code>getter</code>函数就相当于<code>store</code>的计算属性，和<code>vue</code>的计算属性差不多，那么我们都知道<code>Vue</code>中计算属性是不能直接传递参数的，所以我们这里的<code>getter</code>函数如果要接受参数的话，也是需要做处理的。</p><p><strong>示例代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsersStore = <span class="title function_">defineStore</span>(<span class="string">&quot;users&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;小猪课堂&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">getAddAge</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">num: number</span>) =&gt;</span> state.<span class="property">age</span> + num;  <span class="comment">// 传参</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getNameAndAge</span>(): string &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="variable language_">this</span>.<span class="property">getAddAge</span>; <span class="comment">// 调用其它getter</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上段代码中我们<code>getter</code>函数<code>getAddAge</code>接收了一个参数<code>num</code>，这种写法其实有点闭包的概念在里面了，相当于我们整体返回了一个新的函数，并且将<code>state</code>传入了新的函数。</p><p>接下来我们在组件中使用，方式很简单，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>新年龄：&#123;&#123; store.getAddAge(1100) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="actions属性">actions属性</h3><p>前面我们提到的<code>state</code>和<code>getters</code>属性都主要是数据层面的，并没有具体的业务逻辑代码，它们两个就和我们组件代码中的<code>data</code>数据和<code>computed</code>计算属性一样。</p><p>那么，如果我们有业务代码的话，最好就是写在<code>actions</code>属性里面，该属性就和我们组件代码中的<code>methods</code>相似，用来放置一些处理业务逻辑的方法。</p><p><code>actions</code>属性值同样是一个对象，该对象里面也是存储的各种各样的方法，包括<strong>同步方法</strong>和<strong>异步方法</strong>。</p><h4 id="添加actions">添加actions</h4><p>我们可以尝试着添加一个<code>actions</code>方法，修改<code>user.ts</code>。</p><p><strong>代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsersStore = <span class="title function_">defineStore</span>(<span class="string">&quot;users&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;小猪课堂&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">getAddAge</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">num: number</span>) =&gt;</span> state.<span class="property">age</span> + num;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getNameAndAge</span>(): string &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="variable language_">this</span>.<span class="property">getAddAge</span>; <span class="comment">// 调用其它getter</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">saveName</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上段代码中我们定义了一个非常简单的<code>actions</code>方法，在实际场景中，该方法可以是任何逻辑，比如发送请求、存储<code>token</code>等等。大家把<code>actions</code>方法当作一个普通的方法即可，特殊之处在于该方法内部的<code>this</code>指向的是当前<code>store</code>。</p><h4 id="使用actions">使用actions</h4><p>使用<code>actions</code>中的方法也非常简单，比如我们在<code>App.vue</code>中想要调用该方法。</p><p><strong>代码如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">saveName</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  store.<span class="title function_">saveName</span>(<span class="string">&quot;我是小猪&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我们点击按钮，直接调用<code>store</code>中的<code>actions</code>方法即可。</p><h2 id="总结示例代码">总结示例代码</h2><p><strong>main.ts代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>user.ts代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUsersStore = <span class="title function_">defineStore</span>(<span class="string">&quot;users&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;小猪课堂&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">getAddAge</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">num: number</span>) =&gt;</span> state.<span class="property">age</span> + num;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getNameAndAge</span>(): string &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="variable language_">this</span>.<span class="property">getAddAge</span>; <span class="comment">// 调用其它getter</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">saveName</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>App.vue代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;Vue logo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./assets/logo.png&quot;</span> /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;&#123; sex &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>新年龄：&#123;&#123; store.getAddAge(1100) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>调用其它getter：&#123;&#123; store.getNameAndAge &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>更改姓名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;reset&quot;</span>&gt;</span>重置store<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;patchStore&quot;</span>&gt;</span>批量修改数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;saveName&quot;</span>&gt;</span>调用aciton<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- 子组件 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">child</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> child <span class="keyword">from</span> <span class="string">&quot;./child.vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useUsersStore &#125; <span class="keyword">from</span> <span class="string">&quot;../src/store/user&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> store = <span class="title function_">useUsersStore</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> &#123; name, age, sex &#125; = <span class="title function_">storeToRefs</span>(store);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">changeName</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.<span class="property">name</span> = <span class="string">&quot;张三&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(store);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 重置store</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.$reset();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 批量修改数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">patchStore</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.$patch(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">age</span>: <span class="number">100</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">sex</span>: <span class="string">&quot;女&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 调用actions方法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">saveName</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.<span class="title function_">saveName</span>(<span class="string">&quot;我是小猪&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>child.vue代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是child组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;&#123; sex &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>更改姓名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useUsersStore &#125; <span class="keyword">from</span> <span class="string">&quot;../src/store/user&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> store = <span class="title function_">useUsersStore</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> &#123; name, age, sex &#125; = <span class="title function_">storeToRefs</span>(store);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">changeName</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.<span class="property">name</span> = <span class="string">&quot;小猪课堂&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="总结">总结</h2><p><code>pinia</code>的知识点很少，如果你有<code>Vuex</code>基础，那么学起来更是易如反掌。其实我们更应该关注的是它的函数思想，大家有没有发现我们在<code>Vue3</code>中的所有东西似乎都可以用一个函数来表示，<code>pinia</code>也是延续了这种思想。</p><p>所以，大家理解这种组合式编程的思想更重要，<code>pinia</code>无非就是以下3个大点：</p><ul><li><code>state</code></li><li><code>getters</code></li><li><code>actions</code></li></ul><p>当然，本篇文章只是讲解了基础使用部分，但是在实际工作中也能满足大部分需求了。</p><hr><blockquote><p>参考文章：</p><p><a href="https://juejin.cn/post/7112691686085492767">小猪课堂：大菠萝！这一次彻底搞懂Pinia！（保姆级教程）</a></p><p><a href="https://juejin.cn/post/7121209657678364685">东方小月：一文解析Pinia和Vuex，带你全面理解这两个Vue状态管理模式</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Pinia快速入门&lt;/h1&gt;
&lt;h2 id=&quot;Pinia简介&quot;&gt;Pinia简介&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://pinia.vuejs.org/&quot;&gt;官方网站&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Pinia&lt;/strong&gt;是V</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="Vue" scheme="https://blog.cilicili.xyz/tags/Vue/"/>
    
    <category term="Pinia" scheme="https://blog.cilicili.xyz/tags/Pinia/"/>
    
  </entry>
  
  <entry>
    <title>【前端】Vue3.2实现后台管理系统（二）</title>
    <link href="https://blog.cilicili.xyz/posts/a8d8a047.html"/>
    <id>https://blog.cilicili.xyz/posts/a8d8a047.html</id>
    <published>2022-09-21T01:33:07.107Z</published>
    <updated>2022-09-21T01:33:07.110Z</updated>
    
    <content type="html"><![CDATA[<h3 id="退出登录功能">退出登录功能</h3><p>1.在<code>index.vue</code>中定义一个<code>&lt;el-button&gt;</code>按钮，并且绑定一个点击事件<code>@click=&quot;handlelogout&quot;</code>事件，、</p><p>2.然后在下方定义一个<code>handlelogout()</code>函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handlelogout</span> () &#123;</span><br><span class="line">  <span class="title function_">showModel</span>(<span class="string">&quot;是否要退出登录？&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;退出登录&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.在<code>util.js</code>中封装一个<code>提示框</code>方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessageBox</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">showModel</span> (content = <span class="string">&quot;提示内容&quot;</span>, type = <span class="string">&quot;warning&quot;</span>, title = <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(</span><br><span class="line">      content,</span><br><span class="line">      title,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确认&#x27;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">        type,</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.<code>manager.js</code>中调用<code>logout</code>接口</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">post</span>(<span class="string">&quot;/admin/logout&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.在<code>index.vue</code>文件夹中引入<code>showModel</code>（弹出框）以及<code>toast</code>（提示成功）方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; showModel, toast &#125; <span class="keyword">from</span> <span class="string">&#x27;~/composables/util&#x27;</span></span><br></pre></td></tr></table></figure><p>6.添加<code>.finally</code>方法，不管用户怎样都清除缓存</p><p>①移除cookie里的token ②清除当前用户状态 Vuex</p><p>将方法写到<code>/store/index.js</code>中的<code>actions</code>中，和登录功能一样首先定义<code>logout</code>方法，然后在里面去调用auth.js中定义的<code>removeToken</code>方法，然后要将<code>vuex</code>中<code>state</code>里的<code>user</code>清空（在使用<code>mutation</code>时，要先解构一下参数里的<code>&#123;commit&#125;</code>，整体代码如下所示：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 退出登录</span></span><br><span class="line">   logout (&#123; commit &#125;) &#123;</span><br><span class="line">    <span class="comment">// 移除cookie里的token</span></span><br><span class="line">    <span class="title function_">removeToken</span>()</span><br><span class="line">    <span class="comment">// 清除当前用户状态 Vuex</span></span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&quot;SET_USERINFO&quot;</span>,&#123;&#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>③跳转回登录页</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转回登录页</span></span><br><span class="line">router.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>)</span><br></pre></td></tr></table></figure><p>④提示退出登录成功</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提示退出登录成功</span></span><br><span class="line"><span class="title function_">toast</span>(<span class="string">&quot;退出登录成功&quot;</span>)</span><br></pre></td></tr></table></figure><p>⑤在<code>index.vue</code>中引入<code>vuex</code>的<code>useStore</code>方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"></span><br><span class="line">store.<span class="title function_">dispatch</span>(<span class="string">&quot;logout&quot;</span>)</span><br></pre></td></tr></table></figure><p>完整代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handlelogout</span> () &#123;</span><br><span class="line">  <span class="title function_">showModel</span>(<span class="string">&quot;是否要退出登录？&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">logout</span>()</span><br><span class="line">      .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 移除cookie里的token 清除当前用户状态 Vuex</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(<span class="string">&quot;logout&quot;</span>)</span><br><span class="line">        <span class="comment">// 跳转回登录页</span></span><br><span class="line">        router.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        <span class="comment">// 提示退出登录成功</span></span><br><span class="line">        <span class="title function_">toast</span>(<span class="string">&quot;退出登录成功&quot;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="全局loading进度条实现">全局loading进度条实现</h3><p>安装<code>npm i nprogress</code></p><p>1.在<code>composables</code>中的<code>util.js</code>进行封装</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ngrogress <span class="keyword">from</span> <span class="string">&#x27;ngrogress&#x27;</span></span><br><span class="line"><span class="comment">// 显示全屏loading</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">showFullLoading</span>(<span class="params"></span>)&#123;</span><br><span class="line">ngrogress.<span class="title function_">start</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 隐藏全屏loading</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">hideFullLoading</span>(<span class="params"></span>)&#123;</span><br><span class="line">ngrogress.<span class="title function_">done</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.由于全局都需要用到，因此到<code>permission.js</code>里进行调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  showFullLoading,</span><br><span class="line">  hideFullLoading</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;~/composables/util&quot;</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 显示全屏loading</span></span><br><span class="line">    <span class="title function_">showFullLoading</span>()</span><br></pre></td></tr></table></figure><p>3.最后在下方添加<code>全局后置守卫</code>（让它在页面加载完后消失）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局后置守卫</span></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> <span class="title function_">hideFullLoading</span>())</span><br></pre></td></tr></table></figure><h3 id="动态页面标题实现">动态页面标题实现</h3><p>1.首先在<code>/router/index.js</code>下每一个<code>routes</code>增加<code>meta</code>，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Index</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; </span><br><span class="line">      <span class="attr">title</span>:<span class="string">&quot;后台首页&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>2.在全局<code>permission.js</code>中设置页面动态标题</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置页面标题</span></span><br><span class="line"><span class="keyword">let</span> title = (to.<span class="property">meta</span>.<span class="property">title</span> ? to.<span class="property">meta</span>.<span class="property">title</span> : <span class="string">&quot;&quot;</span>) + <span class="string">&quot;-中国碳生产率后台&quot;</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">title</span> = title</span><br></pre></td></tr></table></figure><h3 id="后台主布局的实现">后台主布局的实现</h3><p>1.新建<code>src/layouts/admin.vue</code>主布局和<code>/layouts/components/FHeader.vue</code>头部 and <code>FMenu.vue</code>侧边 and <code>FTagList.vue</code>标签导航并初始化，再在<code>admin.vue</code>中进行引入，<code>admin.vue</code>代码如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line">    &lt;el-header&gt;</span><br><span class="line">      &lt;f-header&gt;&lt;/f-header&gt;</span><br><span class="line">    &lt;/el-header&gt;</span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">      &lt;el-aside&gt;</span><br><span class="line">        &lt;f-menu&gt;&lt;/f-menu&gt;</span><br><span class="line">      &lt;/el-aside&gt;</span><br><span class="line">      &lt;el-main&gt;</span><br><span class="line">        &lt;f-tag-list&gt;&lt;/f-tag-list&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">      &lt;/el-main&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import FHeader from &#x27;./components/FHeader.vue.js&#x27;;</span><br><span class="line">import FMenu from &#x27;./components/FMenu.vue.js&#x27;;</span><br><span class="line">import FTagList from &#x27;./components/FTagList.vue.js&#x27;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>2.在<code>router/index.js</code>中引入<code>Admin</code>，后台首页更改：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> <span class="title class_">Admin</span> <span class="keyword">from</span> <span class="string">&quot;~/layouts/admin.vue&quot;</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Admin</span>,</span><br><span class="line">    <span class="attr">children</span>: [&#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">Index</span>,</span><br><span class="line">        <span class="attr">meta</span>: &#123; </span><br><span class="line">          <span class="attr">title</span>:<span class="string">&quot;后台首页&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h4 id="公共头部开发—样式布局">公共头部开发—样式布局</h4><p><code>FHeader.vue</code></p><p>样式布局</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;f-header&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;logo&quot;&gt;</span><br><span class="line">      &lt;el-icon class=&quot;mr-1&quot;&gt;</span><br><span class="line">        &lt;eleme-filled /&gt;</span><br><span class="line">      &lt;/el-icon&gt;</span><br><span class="line">      碳生产率</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">    &lt;el-icon class=&quot;icon-btn&quot;&gt;</span><br><span class="line">      &lt;fold /&gt;</span><br><span class="line">    &lt;/el-icon&gt;</span><br><span class="line">    &lt;el-icon class=&quot;icon-btn&quot;&gt;</span><br><span class="line">      &lt;refresh /&gt;</span><br><span class="line">    &lt;/el-icon&gt;</span><br><span class="line">    &lt;div class=&quot;ml-auto flex items-center&quot;&gt;</span><br><span class="line">      &lt;el-icon class=&quot;icon-btn&quot;&gt;</span><br><span class="line">        &lt;full-screen /&gt;</span><br><span class="line">      &lt;/el-icon&gt;</span><br><span class="line">      &lt;el-dropdown class=&quot;dropdown&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;flex items-center text-light-50&quot;&gt;</span><br><span class="line">          &lt;el-avatar class=&quot;mr-2&quot; :size=&quot;25&quot; :src=&quot;$store.state.user.avatar&quot; /&gt;</span><br><span class="line">          &#123;&#123; $store.state.user.username &#125;&#125;</span><br><span class="line">          &lt;el-icon class=&quot;el-icon--right&quot;&gt;</span><br><span class="line">            &lt;arrow-down /&gt;</span><br><span class="line">          &lt;/el-icon&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;template #dropdown&gt;</span><br><span class="line">          &lt;el-dropdown-menu&gt;</span><br><span class="line">            &lt;el-dropdown-item&gt;修改密码&lt;/el-dropdown-item&gt;</span><br><span class="line">            &lt;el-dropdown-item&gt;退出登录&lt;/el-dropdown-item&gt;</span><br><span class="line">          &lt;/el-dropdown-menu&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-dropdown&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.f-header &#123;</span><br><span class="line">  @apply flex items-center bg-indigo-700 text-light-50 fixed top-0 left-0 right-0;</span><br><span class="line">  height: 64px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.logo &#123;</span><br><span class="line">  width: 250px;</span><br><span class="line">  @apply flex justify-center items-center text-xl font-thin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.icon-btn &#123;</span><br><span class="line">  @apply flex justify-center items-center;</span><br><span class="line">  width: 42px;</span><br><span class="line">  height: 64px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.icon-btn:hover &#123;</span><br><span class="line">  @apply bg-indigo-600;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.f-header .dropdown &#123;</span><br><span class="line">  height: 64px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  @apply flex justify-center items-center mx-5;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>刷新和全屏(课时26和可视27)</p><h3 id="通用弹框表单组件封装（一）">通用弹框表单组件封装（一）</h3><p>在<code>/src/components</code>下新建</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-drawer v-model=&quot;showDrawer&quot; title=&quot;修改密码&quot; size=&quot;45%&quot; :close-on-click-modal=&quot;false&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;formDrawer&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/el-drawer&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">const showDrawer = ref(false)</span><br><span class="line">// 打开</span><br><span class="line">const open = () =&gt; showDrawer.value = true</span><br><span class="line"></span><br><span class="line">// 关闭</span><br><span class="line">const close = () =&gt; showDrawer.value = false</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>未完待续…</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;退出登录功能&quot;&gt;退出登录功能&lt;/h3&gt;
&lt;p&gt;1.在&lt;code&gt;index.vue&lt;/code&gt;中定义一个&lt;code&gt;&amp;lt;el-button&amp;gt;&lt;/code&gt;按钮，并且绑定一个点击事件&lt;code&gt;@click=&amp;quot;handlelogout&amp;quot</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="Vue" scheme="https://blog.cilicili.xyz/tags/Vue/"/>
    
    <category term="系统设计" scheme="https://blog.cilicili.xyz/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>【前端】Vue3.2实现后台管理系统（三）</title>
    <link href="https://blog.cilicili.xyz/posts/551f4be.html"/>
    <id>https://blog.cilicili.xyz/posts/551f4be.html</id>
    <published>2022-09-21T01:32:11.000Z</published>
    <updated>2022-09-27T11:56:29.497Z</updated>
    
    <content type="html"><![CDATA[<h2 id="统计面板组件开发">统计面板组件开发</h2><h3 id="骨架屏优化体验">骨架屏优化体验</h3><p>使用<code>element-plus</code>中的骨架屏组件</p><h3 id="数字滚动动画实现">数字滚动动画实现</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i gsap</span><br></pre></td></tr></table></figure><p>为了方便使用，封装至<code>/components/CountTo.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &#123;&#123; d.num &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; reactive &#125; from &quot;vue&quot;</span><br><span class="line">import gsap from &quot;gsap&quot;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;   // 父亲组件传过来的值</span><br><span class="line">    value: &#123;   // 希望滚动到的终点</span><br><span class="line">        type: Number,</span><br><span class="line">        default:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const d = reactive(&#123;</span><br><span class="line">    num: 0</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">function AnimateToValue () &#123;</span><br><span class="line">    gsap.to(d, &#123;</span><br><span class="line">        duration: 0.5,</span><br><span class="line">        num: props.value</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AnimateToValue()</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>为了防止<code>set up</code>执行完后才修改<code>value</code>的值，我们可以使用<code>watch</code>监听</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch(()=&gt;props.value,()=&gt;AnimateToValue())</span><br></pre></td></tr></table></figure><p>然后在父亲组件需要使用的位置</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text-3xl font-bold text-gray-500&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CountTo</span> <span class="attr">:value</span>=<span class="string">&quot;item.value&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="echarts图表组件开发">echarts图表组件开发</h3><ol><li><pre><code class="language-bash">npm i echarts<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```html</span><br><span class="line">    &lt;div ref=&quot;el&quot; id=&quot;chart&quot; style=&quot;width: 100%;height: 300px;&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code class="language-js">import * as echarts from 'echarts';// 引入echartsimport &#123; onMounted, onBeforeUnmount &#125; from 'vue';  // 引入生命周期获得DOM元素import &#123;    getStatistics3&#125; from &quot;~/api/index.js&quot;  // 调用方法获取接口数据var myChart = nullonMounted(() =&gt; &#123;   // 页面渲染完成后，再获得ODM，进行init    var chartDom = document.getElementById('chart');    if (chartDom) &#123;        myChart = echarts.init(chartDom);        getData() // 4中定义的获取数据方法    &#125;&#125;)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. ```js</span><br><span class="line">   function getData () &#123;</span><br><span class="line">       let option = &#123;</span><br><span class="line">           xAxis: &#123;</span><br><span class="line">               type: &#x27;category&#x27;,</span><br><span class="line">               data: []  // 数据去掉</span><br><span class="line">           &#125;,</span><br><span class="line">           yAxis: &#123;</span><br><span class="line">               type: &#x27;value&#x27;</span><br><span class="line">           &#125;,</span><br><span class="line">           series: [</span><br><span class="line">               &#123;</span><br><span class="line">                   data: [],  // 数据去掉</span><br><span class="line">                   type: &#x27;bar&#x27;,</span><br><span class="line">                   showBackground: true,</span><br><span class="line">                   backgroundStyle: &#123;</span><br><span class="line">                       color: &#x27;rgba(180, 180, 180, 0.2)&#x27;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           ]</span><br><span class="line">       &#125;;</span><br><span class="line">       </span><br><span class="line">   myChart.showLoading()  // 开启加载动画</span><br><span class="line">   getStatistics3(current.value).then(res =&gt; &#123;   // 请求接口数据</span><br><span class="line">       option.xAxis.data = res.x  // 赋值</span><br><span class="line">       option.series[0].data = res.y  // 赋值</span><br><span class="line">   </span><br><span class="line">       myChart.setOption(option)  // 开启渲染</span><br><span class="line">   &#125;).finally(() =&gt; &#123;</span><br><span class="line">       myChart.hideLoading()  // 关闭加载动画</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure></code></pre></li><li><p>为了避免出现白屏情况</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onBeforeUnmount &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (myChart) echarts.<span class="title function_">dispose</span>(myChart)  <span class="comment">// 销毁ehcarts实例</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>图表跟随页面视图进行等比例缩放，使用<code>VueUse</code>提供的<a href="https://vueuse.org/core/useresizeobserver/#useresizeobserver">useResizeObserver</a>方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ref=<span class="string">&quot;el&quot;</span> id=<span class="string">&quot;chart&quot;</span> style=<span class="string">&quot;width: 100%;height: 300px;&quot;</span>&gt;&lt;<span class="regexp">/div&gt; /</span><span class="regexp">/ 绑定ref</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const el = ref(null)</span></span><br><span class="line"><span class="regexp">useResizeObserver(el, (entries) =&gt; myChart.resize())  /</span><span class="regexp">/ 再调用echarts提供的resize方法</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="v-permission指令按钮级权限控制（一）">v-permission指令按钮级权限控制（一）</h3><ol><li><p>只有数组里的接口和<code>vuex</code>中存储的<code>ruleNames</code>中存在此接口，才可以使用该组件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;IndexChart v-permission=&quot;[&#x27;getStatistics3,GET&#x27;]&quot; /&gt;</span><br></pre></td></tr></table></figure></li><li><p>新建<code>/directives/permission.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;~/store&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hasPermission</span>(<span class="params">value,el = <span class="literal">false</span></span>)&#123;   <span class="comment">// 判断ruleNames中是否有该接口</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`需要配置权限，例如 v-permission=&quot;[&#x27;getStatistics3,GET&#x27;]&quot;`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hasAuth = value.<span class="title function_">findIndex</span>(<span class="function"><span class="params">v</span>=&gt;</span>store.<span class="property">state</span>.<span class="property">ruleNames</span>.<span class="title function_">includes</span>(v)) != -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(el &amp;&amp; !hasAuth)&#123;</span><br><span class="line">        el.<span class="property">parentNode</span> &amp;&amp; el.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(el)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hasAuth</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;   <span class="comment">// 自定义</span></span><br><span class="line">    <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">        app.<span class="title function_">directive</span>(<span class="string">&quot;permission&quot;</span>,&#123;</span><br><span class="line">            <span class="title function_">mounted</span>(<span class="params">el,binding</span>)&#123;   <span class="comment">// el为当前节点</span></span><br><span class="line">                <span class="title function_">hasPermission</span>(binding.<span class="property">value</span>,el)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在main.js中引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> permission <span class="keyword">from</span> <span class="string">&#x27;./directives/permission.js&#x27;</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(permission)</span><br></pre></td></tr></table></figure></li></ol><h2 id="图库模块开发">图库模块开发</h2><h3 id="布局实现">布局实现</h3><ol><li><p>使用element-plus提供的comtainer容器</p></li><li><p>为了让图库部分占满剩余部分的空间</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浏览器的高度 = 浏览器可视部分高度 || dom的height+padding，不包括滚动条</span></span><br><span class="line"><span class="keyword">const</span> windowHeight = <span class="variable language_">window</span>.<span class="property">innerHeight</span> || <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span></span><br><span class="line"><span class="keyword">const</span> h = windowHeight - <span class="number">64</span> - <span class="number">44</span> - <span class="number">40</span>  <span class="comment">// 40为padding</span></span><br></pre></td></tr></table></figure></li><li><p>在<code>el-container</code>中绑定动态<code>style</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-container</span> <span class="attr">class</span>=<span class="string">&quot;bg-white rounded&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123; height: (h + &#x27;px&#x27;) &#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>局部滚动</strong></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;统计面板组件开发&quot;&gt;统计面板组件开发&lt;/h2&gt;
&lt;h3 id=&quot;骨架屏优化体验&quot;&gt;骨架屏优化体验&lt;/h3&gt;
&lt;p&gt;使用&lt;code&gt;element-plus&lt;/code&gt;中的骨架屏组件&lt;/p&gt;
&lt;h3 id=&quot;数字滚动动画实现&quot;&gt;数字滚动动画实现&lt;/h3&gt;
&lt;fig</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="Vue" scheme="https://blog.cilicili.xyz/tags/Vue/"/>
    
    <category term="系统设计" scheme="https://blog.cilicili.xyz/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>【面试】易混淆知识点记录</title>
    <link href="https://blog.cilicili.xyz/posts/814fd644.html"/>
    <id>https://blog.cilicili.xyz/posts/814fd644.html</id>
    <published>2022-09-19T14:09:12.000Z</published>
    <updated>2022-09-23T10:56:16.357Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JS-检测数据类型的-4-种方式"><strong>JS 检测数据类型的 4 种方式</strong></h2><ul><li>typeof</li><li>instanceof</li><li>constructor</li><li>Object.prototype.toString.call()</li></ul><h3 id="混淆点"><strong>混淆点</strong></h3><ol><li><p><code>typeof</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">//&#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;; <span class="comment">//&#x27;function&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Symbol</span>(); <span class="comment">//&#x27;symbol&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>typeof 的返回值类型为字符串类型</li><li>typeof 判断基本数据类型时，除了 null 的输出结果为’object’ 其它类型都能正确判断</li><li>typeof 判断引用数据类型时，除了判断函数会输出’function’ 其它都输出’object’</li></ul><p><strong>注意点</strong>：</p><p>null 的数据类型是 object （null 是对一个空对象的引用，是一个占位符）</p><ul><li>typeof 并不能区分引用数据类型（Array 数组、Date 时间）等</li><li>所以我们可以使用 instanceof 来判断引用数据类型</li></ul><p>symbol()的注意点：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> symbol1 = <span class="title class_">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> symbol2 = <span class="title class_">Symbol</span>(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">const</span> symbol3 = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> symbol1);</span><br><span class="line"><span class="comment">// expected output: &quot;symbol&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(symbol2 === <span class="number">42</span>);</span><br><span class="line"><span class="comment">// expected output: false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(symbol3.<span class="title function_">toString</span>());</span><br><span class="line"><span class="comment">// expected output: &quot;Symbol(foo)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>));</span><br><span class="line"><span class="comment">// expected output: false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a === a);</span><br><span class="line"><span class="comment">// expected output: true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>) === <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>));</span><br><span class="line"><span class="comment">// expected output: false</span></span><br></pre></td></tr></table></figure></li><li><p>instanceof</p><p><strong>基本语法</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj1 <span class="keyword">instanceof</span> obj2; <span class="comment">// 判断obj1是否为obj2的实例</span></span><br></pre></td></tr></table></figure><ul><li>instanceof 用来判断两个对象是否属于实例关系，通过这种关系来判断对象是否属于某一类型。（但不能判断对象具体属于哪种类型）。</li><li>instanceof 可以准确判断引用数据类型，<strong>原理</strong>：检测构造函数的 prototype 属性是否在某个实例对象的原型链上。</li><li>instanceof 返回值为布尔值</li></ul></li><li><p>constructor</p><p><strong>基本语法</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.<span class="property">constructor</span> === <span class="title class_">String</span>; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line">num.<span class="property">constructor</span> === <span class="title class_">Number</span>; <span class="comment">// true</span></span><br><span class="line"><span class="literal">true</span>.<span class="property">constructor</span> === <span class="title class_">Boolean</span>; <span class="comment">// true</span></span><br><span class="line">[].<span class="property">constructor</span> === <span class="title class_">Array</span>; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.<span class="property">constructor</span> === <span class="title class_">Object</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>当一个函数 F 被定义时，JS 引擎会为 F 添加 prototype 原型，然后在 prototype 上添加了一个 constructor 属性，并让其指向 F 的引用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> f = <span class="keyword">new</span> <span class="title function_">F</span>(); <span class="comment">// 实例</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(F.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>); <span class="comment">// function F()&#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(F.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === F); <span class="comment">// 构造器指向F</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(f.<span class="property">constructor</span> === F);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当执行 const f = new F() 时，F 被当成了构造函数，f 是 F 的实例对象，此时 F 原型上的 constructor 传递到了 f 上，因此<code>f.__proto__.constructor===F</code>简写成<code>f.constructor === F</code></p><p>从上面的整个过程来看，构造函数 F 就是新对象 f（实例）的类型。所以如果某个实例的 constructor 指向某个构造函数，那这个构造函数就是这个实例的类型。</p><p><strong>注意</strong>：</p><blockquote><ul><li>constructor 是不稳定的，因为开发者可以重写 prototype,重写后，原有的 constructor 引用会丢失，需要我们重新指定 constructor 的引用</li><li>在没有重新指定时，constructor 会默认为 Object</li></ul></blockquote><p><strong>为什么重写 prototype 后，constructor 的默认值会为 Object 呢？</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">  F.<span class="property"><span class="keyword">prototype</span></span> = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(F.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 结果为 Object() &#123; [native code] &#125;</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当 <code>F.prototype=&#123; &#125;</code>时，<code>&#123; &#125;</code>是 <code>new Object</code> 的字面量（Object 的实例），所以 Object 原型上的 constructor 会被传递给{ }，Object 的 constructor 指向的就是 Object 本身。</p></li><li><p>Object.prototype.toString.call()</p><p>详细解读</p><p><code>toString()</code>是 Object 的原型方法，调用该方法，默认返回当前对象的 <code>[object type]</code>。其中 type 就是对象的类型。</p><ul><li><code>Object</code>对象，直接调用<code>toString()</code> 就能返回 [object Object]</li><li>其他对象，则需要通过 call / apply 来调用才能返回正确的类型信息</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="string">&quot;&quot;</span>); <span class="comment">// [object String]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="number">1</span>); <span class="comment">// [object Number]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">true</span>); <span class="comment">// [object Boolean]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="title class_">Symbol</span>()); <span class="comment">// [object Symbol]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">undefined</span>); <span class="comment">// [object Undefined]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Function</span>()); <span class="comment">// [object Function]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">// [object Date]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>([]); <span class="comment">// [object Array]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(&#123;&#125;); <span class="comment">// [object Object]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="variable language_">document</span>); <span class="comment">// [object HTMLDocument]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="variable language_">window</span>); <span class="comment">// [object Window]</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="null-和-undefined-的区别-？">null 和 undefined 的区别 ？</h3><ul><li><p><strong>undefined（未定义）</strong>：当一个变量被定义（声明）但并没有赋值时，他的初始值就是 undefined。</p></li><li><p><strong>null（空）</strong></p><p>：表示对一个空对象的引用。</p><ul><li>当一个变量定好之后，未来是用来保存对象的引用时，我们可以给他赋初始值为 null。</li><li>当一个对象使用完，需要对其进行释放内存时，可以将其值设置 null （js 会自动垃圾回收）</li></ul></li></ul><p><strong>相同点</strong>：</p><ul><li>undefined 和 null 都是基本数据类型，保存栈中。</li><li>undefined 和 null 转换为 boolean 布尔值都为 false</li></ul><p><strong>不同点</strong>:</p><p>两者转换为数字类型时，其值不一样</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Number</span>(<span class="literal">undefined</span>); <span class="comment">//NaN</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="literal">null</span>); <span class="comment">//0</span></span><br></pre></td></tr></table></figure><p><strong>特殊点</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">undefined</span> == <span class="literal">null</span>; <span class="comment">//true</span></span><br></pre></td></tr></table></figure><h3 id="基本数据类型和引用数据类型的区别？">基本数据类型和引用数据类型的区别？</h3><table><thead><tr><th style="text-align:left">比较</th><th style="text-align:left">基本数据类型</th><th style="text-align:left">引用数据类型</th></tr></thead><tbody><tr><td style="text-align:left">数据存放位置</td><td style="text-align:left">基本数据类型存放在<strong>栈</strong>中，数据大小确定，内存空间大小可以分配</td><td style="text-align:left">引用数据类型存放在<strong>堆</strong>中，每个空间大小不一样，要根据情况进行特定的配置</td></tr><tr><td style="text-align:left">变量存储内容</td><td style="text-align:left">变量中存储的是<strong>值本身</strong></td><td style="text-align:left">变量存储的是<strong>地址</strong></td></tr><tr><td style="text-align:left">变量用来赋值时</td><td style="text-align:left">把变量的<strong>值</strong>复制一份去赋值</td><td style="text-align:left">把变量的<strong>内存地址</strong>复制一份去赋值</td></tr><tr><td style="text-align:left">存储内容大小</td><td style="text-align:left">存储<strong>值较小</strong></td><td style="text-align:left">存储<strong>值较大</strong></td></tr></tbody></table><h3 id="typeof-NaN-返回结果？">typeof(NaN)返回结果？</h3><ul><li>NaN 不是数字的数字类型，所以 <code>typeof(NaN)</code> 返回结果就是 number</li><li>NaN === NaN 结果为 false，他自己和他自己都不相等</li><li>如何判断一个变量的值是 NaN ?</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;我&quot;</span> - <span class="string">&quot;你&quot;</span>;</span><br><span class="line"><span class="built_in">isNaN</span>(a) &amp;&amp; <span class="keyword">typeof</span> a === <span class="string">&quot;number&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="以下两种方式的区别？及-typeof-得到的结果">以下两种方式的区别？及 typeof 得到的结果</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str1 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> str2 = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>str1 是基本数据类型</strong></p><ul><li>存储在在栈内存中，用 typeof 检测的结果为 string。</li><li>当我们把 str1 赋值给别一个变量时，是把 str1 中的值复制一份来赋值。</li></ul><p><strong>str2 是引用数据类型</strong></p><ul><li>存储在堆内存中，不过变量 str2 中存的是指向堆内存中的地址，用 typeof 检测 str2 结果为 Object。</li><li>当我们把 str2 赋值给另一个变量时，是把 str2 中存入的地址复制一分给到了变量。</li></ul><h3 id="typeof-能判断那些类型-？">typeof 能判断那些类型 ？</h3><p>typeof 能判断的类型有：string、number、boolean、undefined、symbol、function</p><ul><li>typeof 判断基本数据类型时，除了 null 的输出结果为’object’ 其它类型都能正确判断</li><li>typeof 判断引用数据类型时，除了判断函数会输出’function’ 其它都输出’object’</li></ul><h3 id="typeof-null-为什么返回的是’object’">typeof(null) 为什么返回的是’object’ ?</h3><ul><li><code>typeof(null) = object</code> 是 JS 在诞生设计之初留下的历史遗留 BUG 问题</li><li>在 JS 中进行数据底层存储的时候是用二进制存储的，这是一定的，而且它的前三位是代表存储的数据类型，而 000 是代表 object 类型也就是引用类型的数据。</li><li>而 null 正好全是 0，所以它巧妙的符合 object 类型的存储格式，所以在 typeof 检测的时候，它才会输出 object。</li></ul><h3 id="和-的区别-？">== 和 === 的区别 ？</h3><p>== 在比较类型不同的变量时，如果两侧的数据类型不同，则会按以下规则进行相应的隐式类型类型转换</p><ul><li>对象 --&gt; 字符串 --&gt; 数值</li><li>布尔值 --&gt; 数值</li></ul><blockquote><p>转换后，再比较两边的值是否相等，值相等返回 true，不等返回 false;</p></blockquote><p>=== 在比较时，会比较值和类型两个。只要两边值的类型不相等就返回 false</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> y = <span class="string">&quot;2&quot;</span>;</span><br><span class="line">(x == y)(</span><br><span class="line">  <span class="comment">// 返回 true，因为 x 和 y 的值相同</span></span><br><span class="line">  x === y</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 返回 false，因为 x 的类型是“数字”，y 的类型是“字符串”</span></span><br></pre></td></tr></table></figure><p><strong>不过要注意以下几个特殊情况的比较</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NaN</span> === <span class="title class_">NaN</span>; <span class="comment">// false NaN和任何数据都不相等，包括自身</span></span><br><span class="line">[] == []; <span class="comment">// false 比较的是地址</span></span><br><span class="line">&#123;&#125; == &#123;&#125;; <span class="comment">// false 比较的是地址</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="literal">null</span>; <span class="comment">// true; 特殊情况，记下</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>对象转字符串，得到的是’[object Object]’</strong></p></blockquote><p><strong>考题 1：以下输出结果</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] == <span class="literal">false</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><ul><li>[] 转换成字符串是’’ ，然后’’ 转换成数值是 0</li><li>false 转换成数值是 0 所以最后比较的值是 0==0 ，结果为 true</li></ul></blockquote><p><strong>考题 2：以下输出结果</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([]) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;能弹出吗？&quot;</span>); <span class="comment">// 可以弹出弹窗</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>if 语句中的表达式或值都会被转成 boolean</li><li>[] 转成布尔值是 true，所以可以弹出。</li></ul></blockquote><h3 id="什么是变量提升-？">什么是变量提升 ？</h3><p>是指使用 var 关键字声明的变量会自动提升到当前作用域的最前面。不过<strong>只会提升声明，不会提升其初始化</strong>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="number">10</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> b = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">fn</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>变量只有被声明后，才能使用</strong></p><ul><li>我们在 var a=10; 之前 console.log(a); 之所以不会报错，就是因为变 a 的声明被提前到了当前作用域的最顶部</li><li>不过只提升了声明，并没会提升初始化，所以打印结果为 undefined; （变量声明初始化，其默认值是 undefined）</li></ul><p>上面代码可以看成如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="language-javascript">  a = <span class="number">10</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> b;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="language-javascript">    b = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">fn</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>补充</strong>：</p><ul><li>函数声明也会被提升，函数和变量相比，会被优先提升。</li><li>这意味着函数会被提升到更靠前的位置，如果出现了重名的变量和函数，声明提升时会以函数为主。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// function num()&#123;console.log(&#x27;函数&#x27;);&#125;  函数被优先提升</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> num = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// 1 在从上往下执行时num变量赋值为 1</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">num</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;函数&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">num</span>()); <span class="comment">// 报错，因为变量num被重新赋值为1，不会再有函数了</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="const、let、var-区别">const、let、var 区别</h3><p>const、let、var 三者的区别，我们可以从以下 5 个点来展开对比</p><ul><li><strong>变量提升和暂时性死区</strong>： var 存在变量提升，let 和 const 不存在变量提升，所以 let 和 const 会存在暂时性死区</li><li><strong>块级作用域</strong>： var 不存在块级作用域，let 和 const 存在块级作用域</li><li><strong>重复声明</strong>： var 允许重复声明变量，let 和 const 在同一作用域下不允许重复声明变量</li><li><strong>修改变量</strong>： var 和 let 声明的变量可以修改，const 是不可以的。</li><li><strong>使用</strong>：const 用来声明常量，引用类型值。其它情况推荐用 let ，避免用 var</li></ul><p><strong>① 变量提升</strong></p><p>详细解读</p><ul><li>var 声明的变量存在变量提升，即变量可以在声明之前被调用。</li><li>let 和 const 不存在变量提升，即它们所声明的变量一定要在声明后使用，否则会报错</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// Cannot access &#x27;b&#x27; before initialization</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> b = <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(c); <span class="comment">// Cannot access &#x27;c&#x27; before initialization</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> c = <span class="number">3</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>② 块级作用域</strong></p><p>详细解析</p><p>var 不存在块级作用域，let 和 const 存在块级作用域</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// Uncaught ReferenceError: b is not defined</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> c = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c); <span class="comment">// Uncaught ReferenceError: c is not defined</span></span><br></pre></td></tr></table></figure><p><strong>③ 重复声明</strong></p><p>详细解读</p><p>var 允许重复声明变量，let 和 const 在同一作用域下不允许重复声明变量</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> b = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> b = <span class="number">2</span>; <span class="comment">// Uncaught SyntaxError: Identifier &#x27;b&#x27; has already been declared</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> c = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> c = <span class="number">2</span>; <span class="comment">// Uncaught SyntaxError: Identifier &#x27;c&#x27; has already been declared</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>④ 修改变量</strong></p><p>详细解读</p><ul><li>var 和 let 声明的变量，可以修改</li><li>const 声明的是一个只读的常量。一旦声明，常量的值就不能改变</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  a = <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> b = <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">  b = <span class="number">3</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b); <span class="comment">// 2 3</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> c = <span class="number">3</span>;</span></span><br><span class="line"><span class="language-javascript">  c = <span class="number">3</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(c); <span class="comment">// ncaught TypeError: Assignment to constant variable.</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>⑤ 使用</strong></p><p>详细解读</p><ul><li>能用 const 的情况尽量使用 const，比如声明的变量是用来保存 对象、数组等引用类型时，用 const</li><li>其他情况下大多数使用 let，比如 for 循环，避免使用 var</li></ul><blockquote><p>提示：var 在全局作用域中声明的变量，相当于 window 对象的属性。</p></blockquote><h3 id="const-定义的值一定是不能改变的吗？">const 定义的值一定是不能改变的吗？</h3><ul><li>const 实际上保证的，并不是变量的值不得改动，而是变量指向的那个<strong>栈内存</strong>地址所保存的数据不得改动。</li><li>对于简单类型的数据（数值、字符串、布尔值）值就保存在变量指向的那个栈内存地址，因此等同于常量。</li><li>引用类型的数据（主要是对象和数组）变量指向的栈内存地址，保存的只是一个指向实际数据的指针</li><li>const 只能保证这个指针是固定的（即总是指向另一个固定的地址），至于它指向的数据结构是不是可变的，就完全不能控制了。</li></ul><p>所以如果是 const 声明的是一个引用类型的变量，其引用类型的结构是可以发生改变的。</p><h3 id="const-声明了数组，还能-push-元素吗，为什么-？">const 声明了数组，还能 push 元素吗，为什么 ？</h3><p>可以</p><ul><li>因为 const 声明的变量保存的只是<strong>栈内存</strong>中的地址，只是一个指向实际数据的指针。指针指向堆内存中保存的数据。</li><li>const 只能保证栈内存中的地址不变，但是堆内存中的数据如何改变是没有办法控制的。</li><li>push 方法相当于是改变了堆内存中的数据结构。</li></ul><h2 id="闭包-、作用域面试题">闭包 、作用域面试题</h2><h3 id="闭包里面的变量为什么不会被垃圾回收">闭包里面的变量为什么不会被垃圾回收</h3><p><strong>① 首先我们来了解下什么是垃圾回收 ？</strong></p><p>详细解读</p><p>在 js 中所谓的垃圾就是指不会再被使用的值，就会被当成垃圾回收掉。</p><ul><li><p>javaScript 会自动回收不再使用的变量，释放其所占的内存，开发人员不需要手动的做垃圾回收的处理。</p></li><li><p>垃圾回收机制只会回收局部变量，全局变量不会被回收，因为全局变量随时有可能被使用。（全局变量在浏览器关闭之后会回收）所以当我们定义了一个全局对象时，在使用完毕之后，最好给它重新复值为 null，以便释放其所占用的内存。</p></li><li><p>目前浏览器基本使用<strong>标记清除</strong>和<strong>引用计数</strong>两种垃圾回收策略</p><ul><li>标记清理<ul><li>当函数被调用，变量进入上下文时，会被加上存在上下文标记，是不会被清理的。</li><li>当函数执行完成后，就会去掉存在上下文中的标记，随后垃圾回收程序会做一次内存清理，销毁这些变量。</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>; <span class="comment">// 函数调用时 被标记 进入上下文</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>(); <span class="comment">// 函数执行完毕，a的标记去掉，被回收</span></span><br></pre></td></tr></table></figure><ul><li>引用计数<ul><li>引用计数就是追踪<strong>值</strong>被引用的次数。声明变量并给它赋一个引用类型值时，这个值的引用数 为 1。</li><li>如果同一个值又被赋给另一个变量，那引用数+1 。如果保存该值引用的变量被其它值覆 盖了，则引用数减 1。</li><li>当引用计数为 0 时，表示这个值不再用到，垃圾收集器就会回收他所占 用的内存。</li></ul></li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// [1,2,3]的引用计数为1</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> b = a; <span class="comment">// 变量b也引用了这个数组，所以[1,2,3]的引用数为2</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="literal">null</span>; <span class="comment">// [1,2,3]的引用被切断，引用数-1，所以[1,2,3]的引用数为1</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 如果只是到这里，那[1,2,3]不所占的内存不会被回收</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> b = <span class="literal">null</span>; <span class="comment">// [1,2,3] 的引用被切断，引用数-1，所 [1,2,3]的引用数为0</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 到这里，垃圾收集器在下一次清理内存时，就会把[1,2,3]所占的内存清理掉</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>引用计数有一个很大的坑，就是循环引用时，会造成内存永远无法释放。</p></blockquote><p>②<strong>为什么闭包中的变量不会被垃圾回收 ？</strong></p><p>答案解析</p><p>这里我们要明确一个点，如果闭包函数的引用计数为 0 时，函数就会释放，它引用的变量也会被释放。</p><ul><li>只有当闭包函数的引用计数不为 0 时，说明闭包函数随时有可能被调用，他被调用后，就会引用他在定义时所处的环境的变量。</li><li>闭包中的变量就得一直需要在内存中，则就不会被垃圾回收掉。</li></ul><h3 id="说说-JS-作用域及作用域链">说说 JS 作用域及作用域链</h3><ul><li><p>作用域是一套规则，规定了代码的作用范围。</p></li><li><p>每个执行环境都有一个与之关联的<strong>变量对象</strong>，环境中定义的所有变量和函数都保存在这个对象中。</p></li><li><p>局部作用域（函数作用域）</p><ul><li>函数被调用时创建函数作用域，函数执行完毕后，函数作用域被销毁，保存在其中的变量和函数定义了随之被销毁（<strong>闭包除外，只有当闭包函数的引用次数为 0 时，闭包函数和闭包中的变量被销毁</strong>）</li></ul><h4 id="特殊的闭包">特殊的闭包</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">checkWeight</span>(<span class="params">weight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">_weight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      weight &gt; _weight ? <span class="title function_">alert</span>(<span class="string">&quot;过胖&quot;</span>) : <span class="title function_">alert</span>(<span class="string">&quot;ok达标&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> <span class="variable constant_">P1</span> = <span class="title function_">checkWeight</span>(<span class="number">100</span>); <span class="comment">// 调用完毕，作用域和变量weight不会被销毁</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">P1</span>(<span class="number">110</span>); <span class="comment">// 调用完毕，作用域和变量_weight会被销毁</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><ul><li>如果我们在最后加上<code>P1 = null</code>，则垃圾回收器回在下一次清理内存时</li><li>销毁掉 checkWeight 调用形成的作用域和作用域中的变量 weight。</li></ul></blockquote></li><li><p>使用 let 或 const 关键字声明的变量，会形成块级作用域。</p><ul><li>在 {}、if 、for 里用 let 来声明变量，会形成块级作用域。{} 之外是不能访问 {} 里面的内容</li><li>块级作用域中定义的变量，在 if 或 for 等语句执行完后，变量就会被销，不占用内存</li><li>对象的 { } 不会形成块级作用域</li></ul></li></ul><h4 id="作用域链">作用域链</h4><p>当代码在一个环境中执行时，会创建<strong>变量对象</strong>的一个作用域链（作用域形成的链条）</p><h3 id="怎么理解-JS-静态作用域和动态作用域">怎么理解 JS 静态作用域和动态作用域</h3><ul><li><strong>静态作用域</strong>：又称词法作用域，是指作用域在词法阶段就被确定了（<strong>函数定义的位置就决定了函数的作用域</strong>）不会改变，javascript 采用的是词法作用域。</li><li><strong>动态作用域</strong>：函数的作用域在函数调用时才决定的。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> a = <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">fn</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">test</span>(); <span class="comment">// 1</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>最终输出的结果为 1</p></blockquote><p>说明 fn 中打印的是全局下的 a ，这也印证了 JavaScript 使用了静态作用域。</p><p><strong>静态作用域执行过程</strong></p><p>当执行 fn 函数时，先从内部查找是否有<code>a</code>变量，如果没有，沿着作用域链往上查找(由于<code>JavaScript</code>是词法作用域)，上层为全局<code>a</code>，所以结果打印<code>1</code></p><h3 id="以下代码输出的结果是-？">以下代码输出的结果是 ？</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> s = <span class="title class_">Symbol</span>();</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    [s]: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;c&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>，</span><br><span class="line">    <span class="attr">value</span>: <span class="number">40</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> val <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上输出的结果为：b，c，a</p></blockquote><p><code>for...in</code>语句以任意顺序遍历一个对象的可枚举属性（除 Symbol 类型的属性）</p><h2 id="原型、原型链面试题">原型、原型链面试题</h2><h3 id="如何理解原型和原型链">如何理解原型和原型链</h3><table><thead><tr><th style="text-align:left">问题</th><th style="text-align:left">相关知识点</th></tr></thead><tbody><tr><td style="text-align:left">什么是原型和原型特点</td><td style="text-align:left">构造函数、对象实例、prototype、<code>__proto__</code>、constructor</td></tr><tr><td style="text-align:left">什么是原型链</td><td style="text-align:left">绘制实例对象原型链、数组原型链、原型链的终点</td></tr><tr><td style="text-align:left">原型链查找</td><td style="text-align:left">原型链查找、属性遮蔽</td></tr><tr><td style="text-align:left">重写原型带来的问题</td><td style="text-align:left">切断现有实例与新原型之间的联系、 会导致原型对象的 constructor 属性指向 Object</td></tr><tr><td style="text-align:left">Object.create() 方法</td><td style="text-align:left">手写 create 方法、用 create 方法实现继承</td></tr><tr><td style="text-align:left">instanceof 操作符</td><td style="text-align:left">用法和实现原理</td></tr><tr><td style="text-align:left">in 和 hasOwnProperty 操作符</td><td style="text-align:left">in 与 hasOwnProperty 的对比、如何判断一个属性是原型上属性</td></tr><tr><td style="text-align:left">for …in</td><td style="text-align:left">for…in 的用法、可枚举对象的哪些属性？</td></tr></tbody></table><p><strong>扩展知识点：</strong></p><table><thead><tr><th style="text-align:left">方法</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">Object.keys()</td><td style="text-align:left">Object.keys()方法可以将一个对象作为参数，然后把这个对象<code>[key，value]</code>对中的 key 值以数组的形式遍历出来。</td></tr><tr><td style="text-align:left">Object.values()</td><td style="text-align:left">Object.values()方法可以将一个对象作为参数，然后把这个对象<code>[key，value]</code>对中的 value 值以数组的形式遍历出来。</td></tr><tr><td style="text-align:left">Object.entries()</td><td style="text-align:left">Object.entries()方法可以将对象作为参数，返回一个给定对象自身可枚举属性的键值对数组，其排列与使用 <code>for...in</code>循环遍历该对象时返回的顺序一致（区别在于 for-in 循环还会枚举原型链中的属性）</td></tr><tr><td style="text-align:left">getOwnPropertyNames()</td><td style="text-align:left">方法返回一个由指定对象的所有<strong>自身属性的属性名</strong>（包括不可枚举属性但不包括 Symbol 值作为名称的属性）组成的数组。</td></tr></tbody></table><h3 id="原型和原型特点">原型和原型特点</h3><ul><li>我们创建的每一个函数都有一个<strong>prototype（原型）属性，被称为显示原型</strong>，这个属性是一个指针，指向一个对象（原型对象）。</li><li>这个对象的好处是，在它上面定义的属性和方法可以由特定类型的所有实例共享。</li><li>原型对象默认拥有一个 constructor 属性，指向它的构造函数</li></ul><h4 id="原型结构图">原型结构图</h4><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/20220523prototype011.7f1b23e4.png" alt="原型结构图"></p><ul><li>原型对象默认拥有一个 constructor 属性，指向它的构造函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">Person</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>每个<code>对象实例</code>都有一个隐藏的属性<code>__proto__</code>，被称为<code>隐式原型</code>,指向它的构造函数的原型</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">__proto__</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>对象实例可以共享原型上面的所有属性和方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p1.<span class="title function_">sayHello</span>(); <span class="comment">// 大家好，我是小明今年23岁了</span></span><br></pre></td></tr></table></figure><ul><li>实例自身的属性会<code>屏蔽(遮蔽)</code>原型上同名的属性，实例上没有的属性就会去原型上去找</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p1.<span class="title function_">study</span>(); <span class="comment">// 我小明正在学习web前端开发课程</span></span><br></pre></td></tr></table></figure><h3 id="原型链-v2">原型链</h3><ul><li>JavaScript 中所有的对象都是由它的原型对象继承而来。</li><li>而原型对象自身也是一个对象，它也有自己的原型对象，这样层层上溯，就形成了一个类似链表的结构，这就是原型链</li></ul><h4 id="原型链结构图"><strong>原型链结构图</strong></h4><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/20220523proto0233.642ec42d.png" alt="原型链结构图"></p><blockquote><ul><li>所有原型链的终点都是 Object.prototype</li><li><code>Objec.prototype</code> 指向的原型对象同样拥有原型<code>Object.prototype.__proto__，不过它的原型是 null</code> ，而 <code>null</code> 则没有原型</li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;JS-检测数据类型的-4-种方式&quot;&gt;&lt;strong&gt;JS 检测数据类型的 4 种方式&lt;/strong&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;typeof&lt;/li&gt;
&lt;li&gt;instanceof&lt;/li&gt;
&lt;li&gt;constructor&lt;/li&gt;
&lt;li&gt;Object.pr</summary>
      
    
    
    
    <category term="面试宝典✨" scheme="https://blog.cilicili.xyz/categories/%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8%E2%9C%A8/"/>
    
    
    <category term="JavaScript" scheme="https://blog.cilicili.xyz/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>【面试】JavaScript面试题库</title>
    <link href="https://blog.cilicili.xyz/posts/207bb36f.html"/>
    <id>https://blog.cilicili.xyz/posts/207bb36f.html</id>
    <published>2022-09-17T07:53:30.000Z</published>
    <updated>2022-09-20T13:14:36.567Z</updated>
    
    <content type="html"><![CDATA[<h1>事件循环机制</h1><ul><li>javascript是一门<strong>单线程</strong>语言。</li><li>Javascript事件循环</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/15fdd88994142347~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="img"></p><p>导图要表达的内容用文字来表述的话：</p><ul><li>同步和异步任务分别进入不同的执行&quot;场所&quot;，同步的进入主线程，异步的进入Event Table并注册函数。</li><li>当指定的事情完成时，Event Table会将这个函数移入Event Queue（任务队列）。</li><li>主线程内的任务执行完毕为空，会去Event Queue读取对应的函数，进入主线程执行。</li><li>上述过程会不断重复，也就是常说的Event Loop(事件循环)。</li></ul><p><strong>那怎么知道主线程执行栈为空呢</strong>？js引擎存在monitoring process进程，会持续不断的检查主线程执行栈是否为空，一旦为空，就会去Event Queue那里检查是否有等待被调用的函数。</p><p>说了这么多文字，不如直接一段代码更直白：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = [];</span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:www.<span class="property">javascript</span>.<span class="property">com</span>,</span><br><span class="line">    <span class="attr">data</span>:data,</span><br><span class="line">    <span class="attr">success</span>:<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发送成功!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;代码执行结束&#x27;</span>);</span><br></pre></td></tr></table></figure><p>上面是一段简易的<code>ajax</code>请求代码：</p><ul><li>ajax进入Event Table，注册回调函数<code>success</code>。</li><li>执行<code>console.log('代码执行结束')</code>。</li><li>ajax事件完成，回调函数<code>success</code>进入Event Queue。</li><li>主线程从Event Queue读取回调函数<code>success</code>并执行。</li></ul><p>相信通过上面的文字和代码，你已经对js的执行顺序有了初步了解。接下来我们来研究进阶话题：setTimeout。</p><h2 id="又爱又恨的setTimeout">又爱又恨的setTimeout</h2><p>大名鼎鼎的<code>setTimeout</code>无需再多言，大家对他的第一印象就是异步可以延时执行，我们经常这么实现延时3秒执行：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;延时3秒&#x27;</span>);</span><br><span class="line">&#125;,<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>渐渐的<code>setTimeout</code>用的地方多了，问题也出现了，有时候明明写的延时3秒，实际却5，6秒才执行函数，这又咋回事啊？</p><p>先看一个例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">task</span>();</span><br><span class="line">&#125;,<span class="number">3000</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行console&#x27;</span>);</span><br></pre></td></tr></table></figure><p>根据前面我们的结论，<code>setTimeout</code>是异步的，应该先执行<code>console.log</code>这个同步任务，所以我们的结论是：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行console</span></span><br><span class="line"><span class="comment">//task()</span></span><br></pre></td></tr></table></figure><p>去验证一下，结果正确！ 然后我们修改一下前面的代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">task</span>()</span><br><span class="line">&#125;,<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">sleep</span>(<span class="number">10000000</span>)</span><br></pre></td></tr></table></figure><p>乍一看其实差不多嘛，但我们把这段代码在chrome执行一下，却发现控制台执行<code>task()</code>需要的时间远远超过3秒，说好的延时三秒，为啥现在需要这么长时间啊？</p><p>这时候我们需要重新理解<code>setTimeout</code>的定义。我们先说上述代码是怎么执行的：</p><ul><li><code>task()</code>进入Event Table并注册,计时开始。</li><li>执行<code>sleep</code>函数，很慢，非常慢，计时仍在继续。</li><li>3秒到了，计时事件<code>timeout</code>完成，<code>task()</code>进入Event Queue，但是<code>sleep</code>也太慢了吧，还没执行完，只好等着。</li><li><code>sleep</code>终于执行完了，<code>task()</code>终于从Event Queue进入了主线程执行。</li></ul><p>上述的流程走完，我们知道<code>setTimeout</code>这个函数，是经过指定时间后，把要执行的任务(本例中为<code>task()</code>)加入到Event Queue中，又因为是单线程任务要一个一个执行，如果前面的任务需要的时间太久，那么只能等着，导致真正的延迟时间远远大于3秒。</p><p>我们还经常遇到<code>setTimeout(fn,0)</code>这样的代码，0秒后执行又是什么意思呢？是不是可以立即执行呢？</p><p>答案是不会的，<code>setTimeout(fn,0)</code>的含义是，指定某个任务在主线程最早可得的空闲时间执行，意思就是不用再等多少秒了，只要主线程执行栈内的同步任务全部执行完成，栈为空就马上执行。举例说明：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;先执行这里&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行啦&#x27;</span>)</span><br><span class="line">&#125;,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//代码2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;先执行这里&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行啦&#x27;</span>)</span><br><span class="line">&#125;,<span class="number">3000</span>);  </span><br></pre></td></tr></table></figure><p>代码1的输出结果是：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先执行这里</span></span><br><span class="line"><span class="comment">//执行啦</span></span><br></pre></td></tr></table></figure><p>代码2的输出结果是：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先执行这里</span></span><br><span class="line"><span class="comment">// ... 3s later</span></span><br><span class="line"><span class="comment">// 执行啦</span></span><br></pre></td></tr></table></figure><p>关于<code>setTimeout</code>要补充的是，即便主线程为空，0毫秒实际上也是达不到的。根据HTML的标准，最低是4毫秒。有兴趣的同学可以自行了解。</p><h2 id="又恨又爱的setInterval">又恨又爱的setInterval</h2><p>上面说完了<code>setTimeout</code>，当然不能错过它的孪生兄弟<code>setInterval</code>。他俩差不多，只不过后者是循环的执行。对于执行顺序来说，<code>setInterval</code>会每隔指定的时间将注册的函数置入Event Queue，如果前面的任务耗时太久，那么同样需要等待。</p><p>唯一需要注意的一点是，对于<code>setInterval(fn,ms)</code>来说，我们已经知道不是每过<code>ms</code>秒会执行一次<code>fn</code>，而是每过<code>ms</code>秒，会有<code>fn</code>进入Event Queue。一旦**<code>setInterval</code>的回调函数<code>fn</code>执行时间超过了延迟时间<code>ms</code>，那么就完全看不出来有时间间隔了**。这句话请读者仔细品味。</p><h2 id="Promise与process-nextTick-callback">Promise与process.nextTick(callback)</h2><p>传统的定时器我们已经研究过了，接着我们探究<code>Promise</code>与<code>process.nextTick(callback)</code>的表现。</p><p><code>Promise</code>的定义和功能本文不再赘述，不了解的读者可以学习一下阮一峰老师的<a href="https://link.juejin.cn?target=http%3A%2F%2Fes6.ruanyifeng.com%2F%23docs%2Fpromise">Promise</a>。而<code>process.nextTick(callback)</code>类似node.js版的&quot;setTimeout&quot;，在事件循环的下一次循环中调用 callback 回调函数。</p><p>我们进入正题，除了广义的同步任务和异步任务，我们对任务有更精细的定义：</p><ul><li>macro-task(宏任务)：包括整体代码script，setTimeout，setInterval</li><li>micro-task(微任务)：Promise，process.nextTick</li></ul><p>不同类型的任务会进入对应的Event Queue，比如<code>setTimeout</code>和<code>setInterval</code>会进入相同的Event Queue。</p><p>事件循环的顺序，决定js代码的执行顺序。进入整体代码(宏任务)后，开始第一次循环。接着执行所有的微任务。然后再次从宏任务开始，找到其中一个任务队列执行完毕，再执行所有的微任务。听起来有点绕，我们用文章最开始的一段代码说明：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;console&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>这段代码作为宏任务，进入主线程。</li><li>先遇到<code>setTimeout</code>，那么将其回调函数注册后分发到宏任务Event Queue。(注册过程与上同，下文不再描述)</li><li>接下来遇到了<code>Promise</code>，<code>new Promise</code>立即执行，<code>then</code>函数分发到微任务Event Queue。</li><li>遇到<code>console.log()</code>，立即执行。</li><li>好啦，整体代码script作为第一个宏任务执行结束，看看有哪些微任务？我们发现了<code>then</code>在微任务Event Queue里面，执行。</li><li>ok，第一轮事件循环结束了，我们开始第二轮循环，当然要从宏任务Event Queue开始。我们发现了宏任务Event Queue中<code>setTimeout</code>对应的回调函数，立即执行。</li><li>结束。</li></ul><p>事件循环，宏任务，微任务的关系如图所示：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/15fdcea13361a1ec~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p><p>我们来分析一段较复杂的代码，看看你是否真的掌握了js的执行机制：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;6&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;7&#x27;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">    process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;10&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;11&#x27;</span>);</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>第一轮事件循环流程分析如下：</p><ul><li>整体script作为第一个宏任务进入主线程，遇到<code>console.log</code>，输出1。</li><li>遇到<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中。我们暂且记为<code>setTimeout1</code>。</li><li>遇到<code>process.nextTick()</code>，其回调函数被分发到微任务Event Queue中。我们记为<code>process1</code>。</li><li>遇到<code>Promise</code>，<code>new Promise</code>直接执行，输出7。<code>then</code>被分发到微任务Event Queue中。我们记为<code>then1</code>。</li><li>又遇到了<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中，我们记为<code>setTimeout2</code>。</li></ul><table><thead><tr><th style="text-align:center">宏任务Event Queue</th><th style="text-align:center">微任务Event Queue</th></tr></thead><tbody><tr><td style="text-align:center">setTimeout1</td><td style="text-align:center">process1</td></tr><tr><td style="text-align:center">setTimeout2</td><td style="text-align:center">then1</td></tr></tbody></table><ul><li>上表是第一轮事件循环宏任务结束时各Event Queue的情况，此时已经输出了1和7。</li><li>我们发现了<code>process1</code>和<code>then1</code>两个微任务。</li><li>执行<code>process1</code>,输出6。</li><li>执行<code>then1</code>，输出8。</li></ul><p>好了，第一轮事件循环正式结束，这一轮的结果是输出1，7，6，8。那么第二轮时间循环从<code>setTimeout1</code>宏任务开始：</p><ul><li>首先输出2。接下来遇到了<code>process.nextTick()</code>，同样将其分发到微任务Event Queue中，记为<code>process2</code>。<code>new Promise</code>立即执行输出4，<code>then</code>也分发到微任务Event Queue中，记为<code>then2</code>。</li></ul><table><thead><tr><th style="text-align:center">宏任务Event Queue</th><th style="text-align:center">微任务Event Queue</th></tr></thead><tbody><tr><td style="text-align:center">setTimeout2</td><td style="text-align:center">process2</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">then2</td></tr></tbody></table><ul><li>第二轮事件循环宏任务结束，我们发现有<code>process2</code>和<code>then2</code>两个微任务可以执行。</li><li>输出3。</li><li>输出5。</li><li>第二轮事件循环结束，第二轮输出2，4，3，5。</li><li>第三轮事件循环开始，此时只剩setTimeout2了，执行。</li><li>直接输出9。</li><li>将<code>process.nextTick()</code>分发到微任务Event Queue中。记为<code>process3</code>。</li><li>直接执行<code>new Promise</code>，输出11。</li><li>将<code>then</code>分发到微任务Event Queue中，记为<code>then3</code>。</li></ul><table><thead><tr><th>宏任务Event Queue</th><th style="text-align:center">微任务Event Queue</th></tr></thead><tbody><tr><td></td><td style="text-align:center">process3</td></tr><tr><td></td><td style="text-align:center">then3</td></tr></tbody></table><ul><li>第三轮事件循环宏任务执行结束，执行两个微任务<code>process3</code>和<code>then3</code>。</li><li>输出10。</li><li>输出12。</li><li>第三轮事件循环结束，第三轮输出9，11，10，12。</li></ul><p>整段代码，共进行了三次事件循环，完整的输出为1，7，6，8，2，4，3，5，9，11，10，12。 (请注意，node环境下的事件监听依赖libuv与前端环境不完全相同，输出顺序可能会有误差)</p><h2 id="写在最后">写在最后</h2><h3 id="js的异步">js的异步</h3><p>我们从最开头就说javascript是一门单线程语言，不管是什么新框架新语法糖实现的所谓异步，其实都是用同步的方法去模拟的，牢牢把握住单线程这点非常重要。</p><h3 id="事件循环Event-Loop">事件循环Event Loop</h3><p>事件循环是js实现异步的一种方法，也是js的执行机制。</p><h3 id="javascript的执行和运行">javascript的执行和运行</h3><p>执行和运行有很大的区别，javascript在不同的环境下，比如node，浏览器，Ringo等等，执行方式是不同的。而运行大多指javascript解析引擎，是统一的。</p><h3 id="setImmediate">setImmediate</h3><p>微任务和宏任务还有很多种类，比如<code>setImmediate</code>等等，执行都是有共同点的，有兴趣的同学可以自行了解。</p><h3 id="最后的最后">最后的最后</h3><ul><li>javascript是一门单线程语言</li><li>Event Loop是javascript的执行机制</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;事件循环机制&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;javascript是一门&lt;strong&gt;单线程&lt;/strong&gt;语言。&lt;/li&gt;
&lt;li&gt;Javascript事件循环&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src= &quot;/img/loading.gif&quot; data-lazy-s</summary>
      
    
    
    
    <category term="面试宝典✨" scheme="https://blog.cilicili.xyz/categories/%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8%E2%9C%A8/"/>
    
    
    <category term="JavaScript" scheme="https://blog.cilicili.xyz/tags/JavaScript/"/>
    
    <category term="实现原理" scheme="https://blog.cilicili.xyz/tags/%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>【面试】Vue原理面试题总结</title>
    <link href="https://blog.cilicili.xyz/posts/714ca07c.html"/>
    <id>https://blog.cilicili.xyz/posts/714ca07c.html</id>
    <published>2022-09-14T12:29:52.000Z</published>
    <updated>2022-09-15T02:18:20.903Z</updated>
    
    <content type="html"><![CDATA[<h1>数据驱动视图</h1><h2 id="MVVM模型-v2">MVVM模型</h2><ol><li><p><code>MVVM</code> 是<code>Model-View-ViewModel</code> 的缩写，它是一种<strong>基于前端开发的架构模式</strong>，其<strong>核心</strong>是<strong>提供对View 和 ViewModel 的双向数据绑定</strong>，这使得ViewModel 的状态改变可以自动传递给 View，即所谓的<strong>数据双向绑定</strong>。</p></li><li><p>在<code>MVVM</code>的架构下，<code>View层</code>和<code>Model层</code>并没有直接联系，而是通过<code>ViewModel层</code>进行交互。<code>ViewModel层</code>通过<strong>双向数据绑定</strong>将<code>View层</code>和<code>Model层</code>连接了起来，使得<code>View层</code>和<code>Model层</code>的同步工作完全是自动的。因此开发者只需关注业务逻辑，<strong>无需手动操作DOM，复杂的数据状态维护交给MVVM统一来管理</strong>。</p></li></ol><blockquote><ul><li>M：模型<strong>Model</strong>，<code>data</code>中的数据</li><li>V：视图<strong>View</strong>，模板代码</li><li>VM：视图模型<strong>ViewModel</strong>，<code>Vue实例</code></li></ul></blockquote><p>观察发现</p><ul><li><code>data</code>中所有的属性，最后都出现在了<code>vm</code>身上</li><li><code>vm</code>身上所有的属性及<code>Vue原型</code>身上所有的属性，在<code>Vue模板</code>中都可以直接使用</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/1643097677438-36b4834c-18e8-4cd0-aa8e-c5f154e6bde0.jpeg" alt="img"></p><p><strong>本质</strong>：<strong>事件 + 方法 + 改变数据 = ViewModel</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>   // 事件</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;   </span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;vue&#x27;</span>,</span><br><span class="line"><span class="attr">list</span>: [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;  <span class="comment">// Model</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">changeName</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;双越&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;  <span class="comment">// 方法</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>Vue.js中MVVM的体现:</strong></p><p>Vue.js的实现方式，是对<strong>数据（Model）进行劫持</strong>，当数据变动时，数据会触发劫持时绑定的方法，对视图进行更新。</p></blockquote><h2 id="实现细节">实现细节</h2><p><code>Vue</code>是采用<code>Object.defineProperty</code>的<code>getter</code>和<code>setter</code>，并结合观察者模式来实现数据绑定的。当把一个普通的<code>javascript对象</code>传给<code>Vue实例</code>来作为它的<code>data选项</code>时，Vue将<code>遍历</code>它的属性，用<code>Object.defineProperty</code>将它们转为<code>getter/setter</code>。用户看不到<code>getter/setter</code>，但是在内部它们让Vue<code>追踪依赖</code>，在属性被访问和修改时通知变化。</p><p><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20190218152745303.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzYxNTkx,size_16,color_FFFFFF,t_70" alt="vue双向绑定图示"></p><ul><li><p><strong>Observer数据监听器</strong>，能够对数据对象的所有属性进行监听，如有变动可拿到最新的值并通知订阅者，内部采用的Obiect.defineProperty的getter和setter来实现。</p></li><li><p><strong>complie指令解析器</strong>，它的作用对每个元素节点的指令进行扫描和解析，根据指令模板替换数据，以及绑定Observer和Complie的桥梁,能够订阅并收到每个属性变动的通知，执行指令绑定的相应的回调函数</p></li><li><p><strong>Watcher订阅者</strong>，作为连接Observer和Complie的桥梁,能够订阅并收到每个属性变动的通知，执行指令绑定的相应回调函数。</p></li><li><p><strong>Dep消息订阅器</strong>，内部维护了一个数组，用来收集订阅者（watcher）,数据变动触发notify函数，再调用订阅者的update方法。</p><p>以上过程可总结为：</p></li></ul><blockquote><ul><li>Observer相当于Model层观察vue实例中的data数据，当数据发生变化时，通知Watcher订阅者。</li><li>Compile指令解析器位于View层，初始化View的视图，将数据变化与更新函数绑定，传给Watcher订阅者。</li><li>Watcher是整个模型的核心，对应ViewModel层，连接Observer和Compile。所有的Watchers存于Dep订阅器中，Watcher将Observer监听到的数据变化对应相应的回调函数，处理数据，反馈给View层更新界面视图。</li></ul></blockquote><blockquote><p>参考文章:</p><p><strong><a href="https://juejin.cn/post/6844903630546403336#heading-8">深入MVVM模型带你理解Vue.js的双向绑定</a></strong></p><p><a href="https://blog.csdn.net/qq_41761591/article/details/87621440">MVVM模型简单介绍</a></p></blockquote><h1>Vue响应式</h1><p><code>vue</code>是一个<code>MVVM</code>框架，所谓<code>MVVM</code>，最核心的就是数据驱动视图，通俗一点讲就是，用户不直接操作<code>dom</code>，而是通过操作数据，当数据改变时，<code>vue</code>内部监听数据变化然后更新视图。同样，用户在视图上的操作（事件）也会反过来改变数据。而响应式，则是实现数据驱动视图的第一步，即监听数据的变化，使得用户在设置数据时，可以通知<code>vue</code>内部进行视图更新。</p><blockquote><p>即组件data的数据一旦变化，立刻触发视图的更新，是实现数据驱动视图的第一步。</p></blockquote><p><strong>一些小问题</strong>：</p><ul><li><p>核心API-<code>Object.defineProperty</code></p><blockquote><p>通过设定对象属性<code>getter/setter</code>方法来监听数据的变化；</p><p>同时<code>getter</code>也用于收集依赖，而<code>setter</code>在数据变更时通知订阅者更新视图。</p></blockquote></li><li><p>如何实现<strong>响应式</strong>，代码演示。</p></li><li><p><code>Object.defineProperty</code>的一些缺点</p></li><li><p><code>proxy</code>存在<strong>兼容性问题</strong>，且无法<code>polyfill</code></p></li></ul><h2 id="Vue2-x实现响应式">Vue2.x实现响应式</h2><h3 id="Object-defineProperty如何实现响应式（代码实现）">Object.defineProperty如何实现响应式（代码实现）</h3><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220909204915331.png" alt="image-20220909204915331" style="zoom: 33%;" /><p>上面代码中我们可以看到，<code>Object.defineProperty()</code>的用法就是给一个对象定义一个<strong>属性（方法）</strong>，并提供<code>set</code>和<code>get</code>两个内部实现，让我们可以<strong>获取</strong>或者<strong>设置</strong>这个属性（方法）。</p><blockquote><ul><li><p>对于<strong>原始类型和对象</strong>（如字符串、数字和布尔值等）：<strong>直接返回</strong></p></li><li><p>对于<strong>引用类型对象</strong>：我们就需要<strong>对对象进行遍历</strong>，<strong>分别设置</strong>对对象的每一个<strong>key值</strong>使用<code>Object.defineProperty()</code>。注意，这个过程是<strong>需要递归调用</strong>的，因为我们给出的数据对象<strong>可能是多层嵌套</strong>的。</p></li><li><p>对于<strong>数组</strong>：<code>Object.defineProperty()</code>是无法对数组实现响应式的，因此，<code>Vue</code>改写了数组的方法。</p></li></ul><p>此<strong>核心方法</strong>为<code>Object.create(prototype)</code>，这个方法就是<strong>创建一个对象</strong>，使他的<strong>原型指向参数prototype</strong>。</p></blockquote><h4 id="Object-defineProperty存在的问题">Object.defineProperty存在的问题</h4><ol><li><p><strong>无法检测到对象属性的新增或删除</strong></p><p>只能追踪对象已有数据是否被修改，无法追踪新增属性和删除属性。</p><p>目前<strong>Vue</strong>保证响应式对象新增属性也是响应式的，有两种方式：</p><ul><li><p><code>Vue.set(obj, properName/index, value)</code></p></li><li><p>响应式对象的子对象新增属性，可以给子响应式对象重新赋值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data.<span class="property">location</span> = &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line">data.<span class="property">location</span> = &#123;...data, <span class="attr">z</span>: <span class="number">100</span>&#125;</span><br></pre></td></tr></table></figure></li><li><p>响应式对象删除属性，可以使用<code>Vue.delete(obj, propertyName/index)</code>或者<code>vue.$delete(obj, propertyName/index)</code>; 类似于删除响应式对象子对象的某个属性，也可以重新给子对象赋值来解决。</p></li></ul></li><li><p><strong>不能监听数组的变化</strong></p><ul><li><p><strong>Vue</strong>在实现数组的响应式时，把无法监听数组的情况通过<strong>重写数组的部分方法</strong>来实现响应式。</p></li><li><p>这也只限制在数组的<code>push/pop/shift/unshift/splice/sort/reverse</code>七个方法，其他数组方法及数组的使用则无法检测到，例如如下两种使用方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.<span class="property">items</span>[index] = newValue</span><br><span class="line"></span><br><span class="line">vm.<span class="property">items</span>.<span class="property">length</span>--</span><br></pre></td></tr></table></figure></li><li><p>Vue实现数组的响应式并不是重写数组的<code>Array.prototype</code>对应的方法，具体来说就是重新指定要操作数组的<code>prototype</code>，并重写<code>prototype</code>中对应的7个数组方法。</p></li></ul></li><li><p><strong>深度监听，需要一次性递归到底，导致计算量大。</strong></p></li></ol><h2 id="Vue3-x实现响应式">Vue3.x实现响应式</h2><h3 id="Proxy和Reflect">Proxy和Reflect</h3><p>因为vue2.x版本响应式的实现存在的那些问题，<code>vue</code>官方在3.0版本中完全重写了响应式的实现，改用<code>Proxy</code>和<code>Reflect</code>代替<code>Object.defineProperty()</code>。</p><h4 id="Proxy">Proxy</h4><p><strong>定义</strong>：<code>Proxy对象</code>用来给一些基本操作定义自定义行为（比如查找，赋值，枚举，函数调用等等）</p><p>基本用法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler)</span><br></pre></td></tr></table></figure><p>上面的参数意义：(注意<code>target</code>可以是原生数组)</p><ol><li><code>target</code>: 用<code>Proxy</code>包装的目标对象（可以是任何类型的对象，包括<code>原生数组</code>，函数，甚至另一个代理）。</li><li><code>handler</code>: 一个对象，其属性是当执行一个操作时定义代理的行为的函数。</li></ol><h4 id="Reflect">Reflect</h4><p><code>Reflect</code> 是一个内置的对象，提供<strong>拦截 JavaScript 操作</strong>的方法。这些方法与proxy的 handlers相同。Reflect不是一个函数对象，因此它是不可构造的。</p><p>Refelct对象提供很多方法，这里只介绍实现响应式会用到的几个常用方法：</p><ol><li><code>Reflect.get()</code>: 获取对象身上某个属性的值，类似于 <code>target[name]</code>。</li><li><code>Reflect.set()</code>: 将值分配给属性的函数。返回一个<code>Boolean</code>，如果更新成功，则返回<code>true</code>。</li><li><code>Reflect.has()</code>: 判断一个对象是否存在某个属性，和 <code>in</code> 运算符 的功能完全相同。</li><li><code>Reflect.deleteProperty()</code>: 作为函数的delete操作符，相当于执行 delete target[name]。</li></ol><p>于是，我们可以联合<code>Proxy</code>和<code>Reflect</code>完成响应式监听</p><h3 id="Proxy和Reflect实现响应式的优点">Proxy和Reflect实现响应式的优点</h3><ol><li><code>Proxy</code>支持监听原生数组</li><li><code>Proxy</code>的获取数据，只会递归到需要获取的层级，不会继续递归</li><li><code>Proxy</code>可以监听数据的手动新增和删除</li></ol><p><strong>存在的小问题</strong>：主要原因在于<code>Proxy</code>和<code>Reflect</code>的浏览器兼容问题，且无法被<code>polyfill</code>。</p><blockquote><p><code>Polyfill</code>是一块代码（通常是 Web 上的 JavaScript），用来为旧浏览器提供它没有原生支持的较新的功能。</p></blockquote><h3 id="代码实现">代码实现</h3><blockquote><p>参考文章：</p><p><a href="https://juejin.cn/post/6844904078724562951">深入Vue响应式原理</a></p><p><a href="https://zhuanlan.zhihu.com/p/88648401">最简化Vue的响应式原理</a></p></blockquote><h1>虚拟DOM（Virtual DOM）和 diff算法</h1><h2 id="虚拟DOM的概念与作用">虚拟DOM的概念与作用</h2><p><strong>概念</strong>：<strong>虚拟dom就是一个普通的js对象</strong>。</p><ul><li>是一个用来描述真实dom结构的js对象，因为他不是真实dom，所以才叫虚拟dom。</li></ul><p><strong>作用（重点）</strong>：</p><ul><li><p><strong>传统dom数据发生变化</strong>的时候，我们<strong>需要不断的去操作dom</strong>，才能<strong>更新dom的数据</strong>，虽然后面出现了<code>模板引擎</code>这种东西，可以让我们一次性去更新多个dom。但模板引擎依旧<strong>没有</strong>一种<strong>可以追踪状态的机制</strong>，当引擎内某个数据发生变化时，它依然要操作dom去<strong>重新渲染</strong>整个引擎。</p><blockquote><p><strong>提升渲染效率</strong>：<strong>虚拟dom可以很好的跟踪当前dom状态</strong>，因为它会<strong>根据当前数据生成</strong>一个描述当前dom结构的<strong>虚拟dom</strong>，然后<strong>数据发生变化</strong>时，又会<strong>生成一个新的虚拟dom</strong>，而<strong>这两个虚拟dom恰恰保存了变化前后的状态</strong>。然后<strong>通过diff算法，计算出两个前后两个虚拟dom之间的差异</strong>，得出一个<strong>更新的最优方法</strong>（哪些发生改变，就更新哪些），<strong>该方法可以很明显的提升渲染效率以及用户体验</strong></p></blockquote></li><li><p><strong>跨端性</strong>：因为<strong>虚拟dom是一个普通的javascript对象</strong>，故他<strong>不单单只能允许在浏览器端</strong>，<strong>渲染出来的虚拟dom</strong>可同时在<strong>node环境</strong>下或者<strong>weex的app环境</strong>下允许，<strong>有很好的跨端性</strong>。</p></li></ul><blockquote><p><strong>虚拟dom的结构</strong>是一个对象，下面有<strong>6个属性</strong>:<strong>sel</strong>表示当前节点标签名，<strong>data</strong>内是节点的属性，<strong>elm</strong>表示当前虚拟节点对应的真实节点，<strong>text</strong>表示当前节点下的文本，<strong>children</strong>表示当前节点下的其他标签</p></blockquote><h2 id="Vue中的虚拟dom">Vue中的虚拟dom</h2><p>目前<code>虚拟dom</code>的类库有多种，常见的有<code>snabbdom</code>和<code>virtual-dom</code>。</p><ul><li><code>vue</code>以前用的是<code>virtual-dom</code>，从<code>2.x版本</code>后都是使用的<code>snabbdom</code>。</li></ul><p><strong>核心方法</strong>：</p><ul><li><strong>h函数</strong></li><li><strong>patch函数</strong></li><li><strong>patchVnode函数</strong></li><li><strong>updateChildren函数</strong></li></ul><h3 id="h函数">h函数</h3><p><strong>概念</strong>：<strong>h函数</strong>是在<code>render函数</code>内运行的。</p><p>Vue在生命周期的<code>created --&gt; beforeMount</code>阶段会将模板编译成<code>render函数</code>，其实就是将模板编译成<code>h函数</code>所认可的格式放在<code>render函数</code>内，然后当<code>render函数</code>运行的时候，就会生成<strong>虚拟dom</strong>。</p><p><strong>总结</strong>：</p><ul><li>首先，代码初次运行，会走<strong>生命周期</strong>，当生命周期走到<strong>created</strong>到<strong>beforeMount</strong>之间的时候，会编译<strong>template模板</strong>成<strong>render函数</strong>。然后当<strong>render函数运行</strong>时，<strong>h函数被调用</strong>，而<strong>h函数内调用了vnode函数生成虚拟dom</strong>，并返回生成结果，<strong>虚拟dom首次生成</strong>。</li><li>之后，当<strong>数据发生变化时</strong>会重新编译生成一个<strong>新虚拟dom</strong>，然后就等待<strong>新、旧两个虚拟dom进行对比</strong>，这就涉及到下面的<strong>diff算法</strong>了。</li></ul><h3 id="diff算法比较规则">diff算法比较规则</h3><ul><li><p><strong>diff</strong> 比较两个虚拟dom<strong>只会在同层级之间进行比较</strong>，不会跨层级进行比较。</p></li><li><p>而用来判断是否是同层级的标准就是</p><ol><li><p>是否在同一层</p></li><li><p>是否有相同的父级</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/20210224145121751.png" alt="在这里插入图片描述"></p></li></ol></li><li><p><strong>diff</strong>是采用<strong>先序深度优先遍历</strong>的方式进行节点比较的。即，当比较某个节点时，如果该节点存在子节点，那么会优先比较他的子节点，直到所有子节点全部比较完成，才会开始去比较改节点的下一个同层级节点。</p></li></ul><h4 id="diff比较整体思路"><strong>diff比较整体思路</strong></h4><ul><li><p>首先开始比较两个vdom时，这两个vdom肯定是都有各自的根节点的，且根节点必定是一个元素。我们首先要比较的肯定是根节点，那我们都知道根节点只有一个，就可以直接进行比较。</p><blockquote><p>声明，下面所说的sel选择器相同，指的是标签名，id，class都相同。<br>例如<code>&lt;div class=&quot;abc&quot; id=&quot;app&quot;&gt;</code>这样一个dom，他的sel是&quot;div#app.abc&quot;</p></blockquote></li></ul><p>一个节点的比较，通常分为3个部分：</p><ol><li><p><strong>比较两个节点是否是相同节点</strong>，判断是否是相同节点的条件是，**key和sel（选择器）**必须都相同。</p><blockquote><p>那有的人可能会说了，那我标签没有key怎么办啊，没有key那就是undefined，undefined === undefined 始终为true，所以没有key只需要保证sel相同就行。</p></blockquote><p><strong>如果不相同</strong>，那么执行<strong>替换操作</strong>（即新增新vnode上的元素，删除旧vnode上的元素，例如，原来是div，新vnode变成了p，那么就是新增p元素，再删除div元素。相当于就是p替换了div）。</p><p>这一步，<strong>只有比较根节点时，是在patch函数中进行的</strong>，<strong>非根节点都是在<code>updateChildren</code>函数中执行的</strong>。因为根节点只会有一个，可以直接比较，而其他节点会存在多个，需要通过一些算法来判断。</p></li><li><p>如果<strong>节点相同</strong>，那么比较两个节点的<strong>属性</strong>是否相同。即，节点<strong>是否存在文本</strong>，<strong>文本是否相同</strong>；<strong>是否存在子节点，子节点是否相同</strong>。这部分主要在<code>patchVnode</code>函数中执行。</p><blockquote><p>那么，在第二部分，会<strong>做哪些事情</strong>呢?</p><ol><li>如果存在文本时，<strong>更新文本</strong></li><li>如果存在属性时，<strong>更新属性</strong></li><li>如果存在子节点时，<strong>更新子节点</strong></li></ol><p>那么，<strong>如何更新</strong>呢，逻辑也很简单，遵循以下规则：</p><ol><li>如果旧vnode上存在，而新vnode上不存在，那么执行<strong>删除操作</strong></li><li>如果旧vnode上不存在，而新vnode上存在，那么执行<strong>新增操作</strong></li><li>如果新旧vnode上都存在，那么执行<strong>替换操作</strong>（即，新增新的，删除旧的）。<ul><li>文本和属性的替换是在这部分完成，而对于子节点，如果新vnode和旧vnode上都存在子节点时，那么会进入第三部分比较，比较子节点的差异。</li></ul></li></ol></blockquote></li><li><p>主要在<code>updateChildren</code>函数中执行，主要用于比较某个节点下的子节点差异。（请见后文详解）</p></li></ol><h3 id="patch函数">patch函数</h3><p><strong>概念</strong>：patch函数是比较的开始，相当于是<strong>diff的入口</strong>。</p><ul><li>那么既然是开始，说明patch函数<strong>比较</strong>的肯定就是<strong>两个新旧vdom的根节点</strong>了，所以，两个vdom直接比较，patch只会触发一次。</li></ul><p><strong>作用</strong>：比较两个虚拟dom根节点是否相同。</p><h3 id="patchVnode函数">patchVnode函数</h3><p><strong>概念</strong>：<code>patchVnode</code> 是用于<strong>比较</strong>两个相同节点的**子级（文本，或子节点）**的一个函数。</p><ul><li>故它的调用总是在<code>sameVnode判断</code>之后。只有判断当前比较的两个vnode相同时才会被执行（两个vnode相同仅仅代表<code>key</code>相同且<code>sel选择器</code>相同）。</li><li>在对比之前，会先判断下<code>oldVnode === vNode</code> ，因为如果全等，代表子级肯定也完全相等，那么就没必要对比了，直接return。</li></ul><p><strong>作用</strong>：对比新旧两个节点，更新dom的子级（子级包含文本或者是子节点）</p><p><strong>对比过程</strong>：</p><ol><li><p>如果新vnode有text属性</p><ul><li>旧vnode是否有子节点，如果有，代表原来是子节点，现在变成文本了，那么删除子节点，并且设置vnode对象的真实dom的text值（使用setTextContent函数）</li><li>其他情况不用管，直接设置vnode对象的真实dom的text值</li></ul></li><li><p>如果新vnode没有text属性</p><ul><li>如果新vnode和旧vnode都存在子节点时。是不是要深度对比两个vnode的子节点啊。这个时候会进入第三步，比较子节点（执行updateChildren）</li><li>如果只有新vnode有子节点，老vnode没有，那么很简单，执行添加节点的操作</li><li>如果只有旧vnode有子节点，新vnode没有子节点，很明显，要执行删除旧vnode子节点的操作</li><li>如果两个vnode上都没有子节点。但旧节点有text，那么很简单，说明原来有文本，现在没有了，清空vnode对应dom的text</li></ul></li></ol><h3 id="updateChildren函数">updateChildren函数</h3><p><strong>作用</strong>：用于比较新旧两个vnode的子节点。</p><blockquote><p>声明：下文中所指的匹配上，指的就是判断是否是sameVnode，即上文中所说的，key相同，sel选择器相同</p></blockquote><p><strong>比较规则</strong>：</p><ol><li><p>首先，会将新旧vnode的<strong>子节点（oldCh, Ch）提取出来</strong>，并分别加上两个指针**<code>oldStart, oldEnd, newStart, newEnd</code><strong>。分别指向</strong>odlCh的第一个节点，oldCh的最后一个节点，Ch的第一个节点，Ch的最后一个节点**。</p></li><li><p>比较时，会优先拿<code>oldStart&lt;—&gt;newStart，oldStart&lt;—&gt;newEnd，oldEnd&lt;—&gt;newStart，oldEnd&lt;—&gt;newEnd</code> 两两进行对比。</p><ul><li><strong>如果匹配上</strong>，那么会将旧节点对应的真实dom移到新节点的位置上，并将匹配上了的指针往中间移动。同时匹配上了的两个节点会继续指向patchVnode函数去进一步比对（指针的移动相当于永远保持指针中间的节点还是尚未匹配状态，已经匹配到的移到指针外面去）</li><li>如果上面4种比较都<strong>没有匹配上</strong>，那么这个时候，有key和没key处理方式就不一样了。</li></ul></li><li><p>当<code>oldStart &gt; oldEnd</code> 或者 <code>newStart &gt; newEnd</code>时，结束对比。此时：</p><ul><li>如果是<code>oldStart &gt; oldEnd</code>，代表<strong>oldCh都已匹配完成</strong>，而此时，如果<code>newStart &lt;= newEnd</code>，那么代表 <code>newStart</code> 和 <code>newEnd</code>直接的节点为新增节点。那么真实dom会在当前<code>newStart</code> 和<code>newEnd</code>之间新增<code>newStart</code> 和 <code>newEnd</code>中间还未匹配的节点。</li><li>如果是n<code>ewStart &gt; newEnd</code>，代表<strong>Ch全都已经匹配完成</strong>，而此时，如果<code>oldStart</code> 和 <code>newEnd</code>之间还有节点，则说明，这些节点是原来存在的，但现在没有了，此时真实dom删除这些节点。</li></ul></li><li><p>比较结束</p></li></ol><h2 id="虚拟DOM与Diff算法总结（Vue）">虚拟DOM与Diff算法总结（Vue）</h2><h3 id="步骤"><strong>步骤</strong></h3><ol><li><p><strong>比较两个虚拟dom树，对根节点root进行执行patch函数</strong>(oldVnode，newVnode)。比较两个根节点是否是相同节点，如果不同，直接替换（新增新的，删除旧的）。</p></li><li><p>如果相同，对两个节点执行<strong>patchVnode</strong>（oldVnode, newVnode），比较<strong>属性、文本</strong>以及<strong>子节点</strong>。</p><ul><li>此时，要么新增，要么删除，要么直接修改文本内容。只有当都存在子节点时，并且oldVnode === newVnode 为false时。会执行updateChildren函数，去进一步比较他们的子节点。</li></ul></li><li><p>比较分为3大类。</p><ol><li><p><strong>oldStart === newStart， oldStart === newEnd，oldEnd === newStart，oldEnd === newEnd 这4种情况的比较</strong>。如果这4种情况中任何一种匹配。那么会执行patchVnode进一步比较。同时指针往中间移</p></li><li><p><strong>oldStart &gt; oldEnd 或者 newStart &gt; newEnd时，表示匹配结束</strong>。此时，多余的元素删除，新增的元素新增。</p></li><li><p>上面几种情况都不匹配，那么这个时候<strong>判断key是否存在</strong>。</p><ul><li><strong>存在key时</strong>，可以直接通过key去找到节点的原来的位置。如果没有找到，就新增节点；找到了，就移动节点位置。（查找效率非常高）</li><li><strong>没有key时</strong>，那么压根就不会去原来的节点中查找了，而是直接新增这个节点。这就导致这个节点下的所有子节点都会被重新新增，会出现明显的性能损耗。所以，合理的应用key，也是一种性能上的优化。</li></ul></li></ol></li><li><p><strong>总之一句话。diff的过程，就是一个 <code>patch —&gt; patchVnode —&gt; updateChildren —&gt; patchVnode —&gt; updateChildren —&gt; patchVnode...</code> 这样的一个循环递归的过程</strong>。</p></li></ol><h3 id="面试回答"><strong>面试回答</strong></h3><h4 id="虚拟-DOM"><strong>虚拟 DOM</strong></h4><p>虚拟 DOM（Virtual DOM）的简写为 vdom，它是实现 Vue 和 React 的重要基石。</p><p>在 jQuery 及更早的时代，我们需要手动调整 DOM，这是一个非常耗费性能的操作，因此需要自行控制 DOM 操作的时机来优化 jQuery 性能。</p><p>DOM 更新非常耗时，但 JS 执行速度很快，因此现代前端框架（如 Vue 和 React）都引入了 vdom 的概念：用 JS 模拟 DOM 结构（vnode），新旧 vnode 对比，得出最小的更新范围，最后更新 DOM。</p><p>在数据驱动视图的模式下，vdom 能有效控制 DOM 操作。</p><h4 id="diff-算法">diff 算法</h4><p>diff 算法是 vdom 中最核心、最关键的部分。</p><p>为了将时间复杂度优化到 <code>O(n)</code>，大部分前端框架中实现 diff 算法的思路是：</p><ul><li>只比较同一层级，不跨级比较。</li><li>tag 不相同，则直接删掉重建，不再深度比较。</li><li>tag 和 key 两者都相同，则认为是相同节点，不再深度比较。</li></ul><h2 id="diff算法和数据劫持的共同工作原理">diff算法和数据劫持的共同工作原理</h2><p>另外，有的同学可能会疑惑。通过这个虚拟dom的diff算法就能精准的知道被更新的地方在哪，然后去更新变动的部分。那我Vue靠这个就够了呀。我为什么还需要数据劫持呢，还需要getter，setter呢。没错，其实单单靠虚拟dom的diff确实是可以实现的。比如react就是这么做的。react精确查找数据的更新就是纯用虚拟dom的diff的。<br>但是这会产生一个什么问题呢。当项目非常大的时候，dom树是非常复杂的，如果每次一个小小的改动，就要通过diff算法去精确找到改动的地方，那么这个计算量是非常大的，产生的性能损耗也会巨大。这显然是不合理的！</p><p>那么vue和react分别是怎么解决这个问题的呢？</p><ul><li><p><strong>Vue</strong>: 了解Vue的MVVM原理的人应该都清楚，vue通过Object.defineproperty的数据劫持，会劫持到每一个状态数据，给他们加上getter，setter。并且创建一个发布者Dep。同时，会给依赖这个状态数据的每个依赖者添加一个订阅者watcher。这样，当数据发生变化时，会触发对应的setter，从而Dep会发布通知，通知每一个订阅者watcher，然后watcher更新对应的数据。但是，如果任何一个数据的依赖我都增加一个watcher，那么项目中的watcher数量是会非常庞大的，这会导致细粒度太高，带来内存和依赖关系维护的巨大消耗。这种情况下，<strong>vue采用响应式 + diff 的方式，即通过响应式的getter，setter快速知道数据的变化发生在哪个组件中，然后组件内部再通过 diff 的方式去获取更详细的更新情况，并更新数据。</strong></p></li><li><p><strong>React</strong>: <strong>通过他的一个生命周期函数shouldComponentUpdate实现的</strong>。通过手动在这个生命周期函数中判断当前组件的数据是否有发生变化，来决定当前组件是否需要更新。这样，没有发生状态数据变化的组件就不需要进行diff，进而缩小diff的范围。</p></li></ul><blockquote><p>参考文章：</p><p><a href="https://blog.csdn.net/weixin_42707287/article/details/113994483">Vue 虚拟dom和diff算法详解</a></p></blockquote><h1>模板编译</h1><h2 id="Vue-模板被编译成什么">Vue 模板被编译成什么</h2><ul><li>Vue 的模板不是 html，因为它有指令、插值、JS 表达式，能实现判断、循环；</li><li>html 是标签语言，只有 JS 才能实现判断、循环。</li></ul><p>因此，模板一定是转换为某种 JS 代码，即编译模板。</p><h2 id="Vue-模板编译过程">Vue 模板编译过程</h2><p><strong>模板编译流程</strong>：</p><ul><li>模板编译为 render 函数，执行 render 函数返回 vnode；</li><li>基于 vnode 再执行 patch 和 diff；</li><li>使用 Webpack 时，vue-loader 会在开发环境下编译模板（目前业内主流）；否则会在浏览器运行中编译（单独在页面中引入 vue.js 使用）。</li></ul><blockquote><p><strong>模板编译流程图</strong>：</p><p><code>template --&gt; AST --&gt; render函数 --&gt; 创建虚拟dom --&gt; diff算法更新虚拟 dom --&gt; 产生、更新真实节点</code></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/0172b97deb9241f6b9a267ba3efb5d18~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="image.png"></p></blockquote><p><strong>模板编译成渲染函数的步骤</strong>：</p><p>将模板编译成渲染函数可以分两个步骤，先将模板解析成 AST（Abstract Syntax Tree，抽象语法树），然后再使用 AST 生成渲染函数。但是由于静态节点不需要总是重新渲染，所以在生成 AST 之后、生成渲染函数之前这个阶段，可以做一个操作，那就是遍历一遍 AST，给所有静态节点做一个标记，这样在虚拟 DOM 中更新节点时，如果发现节点有这个标记，就不会重新渲染它。</p><p>所以，在大体逻辑上，模板编译分三部分内容：</p><ul><li>将模板解析为 AST</li><li>遍历 AST 标记静态节点</li><li>使用 AST 生成渲染函数</li></ul><p>这三部分内容在模板编译中分别抽象出三个模块来实现各自的功能，分别是：</p><ul><li>解析器</li><li>优化器</li><li>代码生成器</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/fc20e0849ee54413821fcf08d2dc7a46~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="image.png"></p><ol><li><p>解析器 —— 将模板解析成 AST</p><p>在解析器内部，分成了很多小解析器，其中包括过滤器解析器（解析过滤器）、文本解析器（解析带变量的文本）和 HTML 解析器（核心）。</p><p>AST 和 vnode 类似，都是使用 JavaScript 中的对象来表示节点。</p></li><li><p>优化器 —— 标记静态节点</p><p>什么是静态节点？没有使用任何变量，后续不会发生变化的节点。比如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>我是一个静态节点，因为我没用到什么变量。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>为什么要标记静态节点？避免做一些无用功，因为静态节点不会随着状态的变化而变化，在虚拟 DOM patch 时可以跳过。</p></li><li><p>代码生成器——将 AST 转换成“代码字符串”</p><p>就是我们要输入到渲染函数中的内容，之后生成的代码字符串将用于渲染函数。</p></li></ol><blockquote><p>详细内容请参阅：</p><p><a href="https://juejin.cn/post/7035832002620162084">Vue模板是如何编译的</a></p><p><a href="https://juejin.cn/post/6911983128844189704">别再问我Vue模板是怎么编译了</a></p></blockquote><h1>Vue和React的简单对比</h1><h2 id="相同点">相同点</h2><ul><li>都有<strong>组件化</strong>思想</li><li>都支持<strong>服务器端渲染</strong></li><li>都有Virtual DOM（<strong>虚拟dom</strong>）</li><li><strong>数据驱动视图</strong></li><li>都有支持<strong>native</strong>的方案：<code>Vue</code>的<code>weex</code>、<code>React</code>的<code>React native</code></li><li>都有自己的<strong>构建工具</strong>：<code>Vue</code>的<code>vue-cli</code>、<code>React</code>的<code>Create React App</code></li></ul><h2 id="不同点">不同点</h2><ul><li>数据<strong>流向的不同</strong>。<code>react</code>从诞生开始就推崇单向数据流，而<code>Vue</code>是双向数据流</li><li><strong>数据变化</strong>的实现<strong>原理不同</strong>。<code>react</code>使用的是不可变数据，而<code>Vue</code>使用的是可变的数据</li><li><strong>组件化通信</strong>的不同。<code>react</code>中我们通过使用回调函数来进行通信的，而<code>Vue</code>中子组件向父组件传递消息有两种方式：事件和回调函数</li><li><strong>diff算法</strong>不同。<code>react</code>主要使用diff队列保存需要更新哪些DOM，得到patch树，再统一操作批量更新DOM。<code>Vue</code> 使用双向指针，边对比，边更新DOM。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;数据驱动视图&lt;/h1&gt;
&lt;h2 id=&quot;MVVM模型-v2&quot;&gt;MVVM模型&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;MVVM&lt;/code&gt; 是&lt;code&gt;Model-View-ViewModel&lt;/code&gt; 的缩写，它是一种&lt;strong&gt;基于前端开发的架构模式</summary>
      
    
    
    
    <category term="面试宝典✨" scheme="https://blog.cilicili.xyz/categories/%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8%E2%9C%A8/"/>
    
    
    <category term="Vue" scheme="https://blog.cilicili.xyz/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>【面试】JavaScript手撕面试题总结</title>
    <link href="https://blog.cilicili.xyz/posts/c7d52961.html"/>
    <id>https://blog.cilicili.xyz/posts/c7d52961.html</id>
    <published>2022-09-13T07:57:02.000Z</published>
    <updated>2022-09-21T13:55:51.426Z</updated>
    
    <content type="html"><![CDATA[<h1>防抖和节流</h1><h2 id="防抖（deounce）">防抖（deounce）</h2><h3 id="定义">定义</h3><p><strong>防抖</strong>指只有在n秒内没有再次触发某个函数时，才会真正执行这个函数；若n秒内再次触发此函数，则重新计算时间。</p><h3 id="应用场景">应用场景</h3><ul><li>输入框中频繁的输入内容，搜索或者提交信息；</li><li>频繁的点击按钮，触发某个事件；</li><li>监听浏览器滚动事件完成操作；</li><li>用户缩放浏览器的resize事件(浏览器窗口大小发生变化时触发)</li></ul><h3 id="代码实现-v2">代码实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timeout;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> context = <span class="variable language_">this</span>; <span class="comment">// 保存this指向</span></span><br><span class="line">        <span class="keyword">let</span> args = <span class="variable language_">arguments</span>; <span class="comment">// 拿到event对象</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout) <span class="comment">// 清除定时器</span></span><br><span class="line">        timeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            func.<span class="title function_">apply</span>(context, args)</span><br><span class="line">        &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="节流（throttle）">节流（throttle）</h2><h3 id="定义-v2">定义</h3><p><strong>节流</strong>指一定时间内回调函数只会执行一次，即执行函数的频率是固定的。</p><p>类似于10 分钟一趟的公交车，不管10 分钟内有多少人在公交站等，10 分钟一到就会按时发车。</p><h3 id="应用场景-v2">应用场景</h3><ul><li>监听页面的滚动事件；</li><li>鼠标移动事件；</li><li>用户频繁点击按钮操作；</li><li>游戏中的一些设计（如飞船发射导弹的频率）</li></ul><h3 id="代码实现-v3">代码实现</h3><ol><li><p>使用时间戳写法，事件会立即执行，停止触发后没有办法再次执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttled1</span>(<span class="params">fn, delay = <span class="number">500</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> oldtime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> newtime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        <span class="keyword">if</span> (newtime - oldtime &gt;= delay) &#123;</span><br><span class="line">            fn.<span class="title function_">apply</span>(<span class="literal">null</span>, args)</span><br><span class="line">            oldtime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用定时器写法，<code>delay</code>毫秒后第一次执行，第二次事件停止触发后依然会再一次执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttled2</span>(<span class="params">fn, delay = <span class="number">500</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!timer) &#123;</span><br><span class="line">            timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">                timer = <span class="literal">null</span></span><br><span class="line">            &#125;, delay);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>可以将时间戳写法的特性与定时器写法的特性相结合，实现一个更加精确的节流。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttled</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> starttime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> curTime = <span class="title class_">Date</span>.<span class="title function_">now</span>() <span class="comment">// 当前时间</span></span><br><span class="line">        <span class="keyword">let</span> remaining = delay - (curTime - starttime)  <span class="comment">// 从上一次到现在，还剩下多少多余时间</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="variable language_">this</span></span><br><span class="line">        <span class="keyword">let</span> args = <span class="variable language_">arguments</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            fn.<span class="title function_">apply</span>(context, args)</span><br><span class="line">            starttime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timer = <span class="built_in">setTimeout</span>(fn, remaining);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="防抖和节流的区别">防抖和节流的区别</h2><p>相同点：</p><ul><li>都可以通过使用 <code>setTimeout</code> 实现</li><li>目的都是，降低回调执行频率，节省计算资源</li></ul><p>不同点：</p><ul><li><p>函数防抖，在一段连续操作结束后，处理回调，利用<code>clearTimeout</code>和 <code>setTimeout</code>实现</p><p>函数节流，在一段连续操作中，每一段时间只执行一次，频率较高的事件中使用来提高性能</p></li><li><p>函数防抖关注一定时间连续触发的事件，只在最后执行一次，而函数节流一段时间内只执行一次</p></li></ul><h1>深拷贝和浅拷贝</h1><h2 id="数据类型存储">数据类型存储</h2><p>JavaScript中存在两大数据类型：</p><ul><li>基本类型</li><li>引用类型</li></ul><p><strong>基本类型数据</strong>保存在在<strong>栈内存</strong>中</p><p><strong>引用类型数据</strong>保存在<strong>堆内存</strong>中（引用数据类型的变量是一个指向堆内存中实际对象的引用，存在栈中）</p><h2 id="深拷贝">深拷贝</h2><p><strong>概念</strong>：深拷贝开辟一个新的栈，两个对象<strong>属性完全相同</strong>，但是<strong>对应两个不同的地址</strong>，修改一个对象的属性，不会改变另一个对象的属性。</p><p>常见的<strong>深拷贝方式</strong>：</p><ul><li>_.cloneDeep()</li><li>jQuery.extend()</li><li>JSON.stringify()</li><li>手写循环递归</li></ul><h3 id="cloneDeep">_.cloneDeep()</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: &#123; <span class="attr">f</span>: &#123; <span class="attr">g</span>: <span class="number">1</span> &#125; &#125;,</span><br><span class="line">    <span class="attr">c</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = _.<span class="title function_">cloneDeep</span>(obj1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">b</span>.<span class="property">f</span> === obj2.<span class="property">b</span>.<span class="property">f</span>);<span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="jQuery-extend">jQuery.extend()</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: &#123; <span class="attr">f</span>: &#123; <span class="attr">g</span>: <span class="number">1</span> &#125; &#125;,</span><br><span class="line">    <span class="attr">c</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = $.<span class="title function_">extend</span>(<span class="literal">true</span>, &#123;&#125;, obj1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">b</span>.<span class="property">f</span> === obj2.<span class="property">b</span>.<span class="property">f</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="JSON-stringify">JSON.stringify()</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2=<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj1)); <span class="comment">// JSON.parse() 方法将数据转换为 JavaScript 对象</span></span><br></pre></td></tr></table></figure><p>但是这种方式存在弊端，会忽略<code>undefined</code>、<code>symbol</code>和<code>函数</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">name1</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">name3</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">    <span class="attr">name4</span>:  <span class="title class_">Symbol</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">// &#123;name: &quot;A&quot;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="循环递归">循环递归</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj, hash = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span>) <span class="keyword">return</span> obj; <span class="comment">// 如果是null或者undefined我就不进行拷贝操作</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(obj);</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(obj);</span><br><span class="line">  <span class="comment">// 可能是对象或者普通的值  如果是函数的话是不需要深拷贝</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> obj;</span><br><span class="line">  <span class="comment">// 是对象的话就要进行深拷贝</span></span><br><span class="line">  <span class="keyword">if</span> (hash.<span class="title function_">get</span>(obj)) <span class="keyword">return</span> hash.<span class="title function_">get</span>(obj);</span><br><span class="line">  <span class="keyword">let</span> cloneObj = <span class="keyword">new</span> obj.<span class="title function_">constructor</span>(<span class="params"></span>);</span><br><span class="line">  <span class="comment">// 找到的是所属类原型上的constructor,而原型上的 constructor指向的是当前类本身</span></span><br><span class="line">  hash.<span class="title function_">set</span>(obj, cloneObj);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      <span class="comment">// 实现一个递归拷贝</span></span><br><span class="line">      cloneObj[key] = <span class="title function_">deepClone</span>(obj[key], hash);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="浅拷贝">浅拷贝</h2><ul><li><p>浅拷贝，指的是创建新的数据，这个数据有着原始数据属性值的一份精确拷贝</p></li><li><p>如果属性是基本类型，拷贝的就是基本类型的值；如果属性是引用类型，拷贝的就是内存地址。</p><p>即浅拷贝是拷贝一层，深层次的引用类型则共享内存地址。</p></li></ul><p>下面简单实现一个浅拷贝</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">shallowClone</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newObj = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span>(obj.<span class="title function_">hasOwnProperty</span>(prop))&#123;</span><br><span class="line">            newObj[prop] = obj[prop];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>JavaScript</code>中，存在浅拷贝的现象有：</p><ul><li><code>Object.assign</code></li><li><code>Array.prototype.slice()</code>, <code>Array.prototype.concat()</code></li><li>使用拓展运算符实现的复制</li></ul><h3 id="Object-assign">Object.assign</h3><p><code>Object.assign()</code> 方法将属性从一个或多个源对象复制到目标对象，返回修改后的对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> source = &#123; <span class="attr">b</span>: <span class="number">4</span>, <span class="attr">c</span>: <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> returnedTarget = <span class="title class_">Object</span>.<span class="title function_">assign</span>(target, source);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target);</span><br><span class="line"><span class="comment">// expected output: Object &#123; a: 1, b: 4, c: 5 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(returnedTarget);</span><br><span class="line"><span class="comment">// expected output: Object &#123; a: 1, b: 4, c: 5 &#125;</span></span><br></pre></td></tr></table></figure><h3 id="slice">slice()</h3><p><code>Array.slice()</code> 方法从数组中返回选定的元素，作为一个新数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=[<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;dd&#x27;</span>,<span class="string">&#x27;ee&#x27;</span>,<span class="string">&#x27;ff&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> data=arr.<span class="title function_">slice</span>(<span class="number">2</span>,<span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data) <span class="comment">// [&quot;cc&quot;, &quot;dd&quot;]</span></span><br><span class="line"><span class="keyword">var</span> data1=arr.<span class="title function_">slice</span>(<span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data1) <span class="comment">// [&quot;cc&quot;, &quot;dd&quot;, &quot;ee&quot;, &quot;ff&quot;]</span></span><br></pre></td></tr></table></figure><h3 id="concat">concat()</h3><p><code>concat()</code> 方法用于连接两个或多个数组。</p><ul><li>该方法不会更改现有数组，而是返回一个新数组，其中包含已连接数组的值。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sedan = [<span class="string">&quot;S60&quot;</span>, <span class="string">&quot;S90&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">SUV</span> = [<span class="string">&quot;XC40&quot;</span>, <span class="string">&quot;XC60&quot;</span>, <span class="string">&quot;XC90&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Volvo</span> = sedan.<span class="title function_">concat</span>(<span class="variable constant_">SUV</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Volvo</span>) <span class="comment">//[&quot;S60&quot;,&quot;S90&quot;,&quot;XC40&quot;,&quot;XC60&quot;,&quot;XC90&quot;]</span></span><br></pre></td></tr></table></figure><h3 id="拓展运算符">拓展运算符</h3><p>扩展运算符<code>(...args)</code>是ES6的语法，用于取出参数对象的所有可遍历属性，然后拷贝到当前对象之中。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>, <span class="attr">age</span>: <span class="number">15</span>&#125;</span><br><span class="line"><span class="keyword">let</span> someone = &#123; ...person &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(someone)  <span class="comment">// &#123;name: &quot;Amy&quot;, age: 15&#125;</span></span><br></pre></td></tr></table></figure><h4 id="拓展运算符特殊用法">拓展运算符特殊用法</h4><h5 id="数组-v2">数组</h5><p>由于数组是特殊的对象，所以对象的扩展运算符也可以用于数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123; ...[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>] &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo) <span class="comment">// &#123;0: &quot;a&quot;, 1: &quot;b&quot;, 2: &quot;c&quot;&#125;</span></span><br></pre></td></tr></table></figure><h5 id="空对象">空对象</h5><p>如果扩展运算符后面是一个空对象，则没有任何效果。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;...&#123;&#125;, <span class="attr">a</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// &#123; a: 1 &#125;</span></span><br></pre></td></tr></table></figure><h5 id="Number类型、Boolen类型、undefined、null">Number类型、Boolen类型、undefined、null</h5><p>如果扩展运算符后面是上面这几种类型，都会返回一个空对象，因为它们没有自身属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等同于 &#123;...Object(1)&#125;</span></span><br><span class="line">&#123;...<span class="number">1</span>&#125; <span class="comment">// &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于 &#123;...Object(true)&#125;</span></span><br><span class="line">&#123;...<span class="literal">true</span>&#125; <span class="comment">// &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于 &#123;...Object(undefined)&#125;</span></span><br><span class="line">&#123;...<span class="literal">undefined</span>&#125; <span class="comment">// &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于 &#123;...Object(null)&#125;</span></span><br><span class="line">&#123;...<span class="literal">null</span>&#125; <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure><h5 id="字符串">字符串</h5><p>如果扩展运算符后面是字符串，它会自动转成一个类似数组的对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;...<span class="string">&#x27;hello&#x27;</span>&#125;</span><br><span class="line"><span class="comment">// &#123;0: &quot;h&quot;, 1: &quot;e&quot;, 2: &quot;l&quot;, 3: &quot;l&quot;, 4: &quot;o&quot;&#125;</span></span><br></pre></td></tr></table></figure><h5 id="对象的合并">对象的合并</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = &#123;<span class="attr">age</span>: <span class="number">15</span>&#125;</span><br><span class="line"><span class="keyword">let</span> name = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>&#125;</span><br><span class="line"><span class="keyword">let</span> person = &#123;...age, ...name&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person) <span class="comment">// &#123;age: 15, name: &quot;Amy&quot;&#125;</span></span><br></pre></td></tr></table></figure><h5 id="注意事项-v2">注意事项</h5><p>自定义的属性和拓展运算符对象里面属性的相同的时候：</p><p><strong>自定义的属性在拓展运算符后面，则拓展运算符对象内部同名的属性将被覆盖掉。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>, <span class="attr">age</span>: <span class="number">15</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> someone = &#123; ...person, <span class="attr">name</span>: <span class="string">&quot;Mike&quot;</span>, <span class="attr">age</span>: <span class="number">17</span>&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(someone);  <span class="comment">//&#123;name: &quot;Mike&quot;, age: 17&#125;</span></span><br></pre></td></tr></table></figure><p><strong>自定义的属性在拓展运算度前面，则变成设置新对象默认属性值。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>, <span class="attr">age</span>: <span class="number">15</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> someone = &#123;<span class="attr">name</span>: <span class="string">&quot;Mike&quot;</span>, <span class="attr">age</span>: <span class="number">17</span>, ...person&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(someone);  <span class="comment">//&#123;name: &quot;Amy&quot;, age: 15&#125;</span></span><br></pre></td></tr></table></figure><h2 id="深拷贝和浅拷贝的区别">深拷贝和浅拷贝的区别</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/d9862c00-69b8-11eb-ab90-d9ae814b240d.png" alt="img"></p><p>从上图发现，浅拷贝和深拷贝<strong>都创建出一个新的对象</strong>，但在复制对象属性的时候，行为就不一样。</p><ul><li><p><strong><code>浅拷贝</code>只复制属性指向某个对象的指针，而不复制对象本身，新旧对象还是共享同一块内存，修改对象属性会影响原对象。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浅拷贝</span></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    name : <span class="string">&#x27;init&#x27;</span>,</span><br><span class="line">    arr : [<span class="number">1</span>,[<span class="number">2</span>,<span class="number">3</span>],<span class="number">4</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj3=<span class="title function_">shallowClone</span>(obj1) <span class="comment">// 一个浅拷贝方法</span></span><br><span class="line">obj3.<span class="property">name</span> = <span class="string">&quot;update&quot;</span>;</span><br><span class="line">obj3.<span class="property">arr</span>[<span class="number">1</span>] = [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>] ; <span class="comment">// 新旧对象还是共享同一块内存</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj1&#x27;</span>,obj1) <span class="comment">// obj1 &#123; name: &#x27;init&#x27;,  arr: [ 1, [ 5, 6, 7 ], 4 ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj3&#x27;</span>,obj3) <span class="comment">// obj3 &#123; name: &#x27;update&#x27;, arr: [ 1, [ 5, 6, 7 ], 4 ] &#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>深拷贝`会另外创造一个一模一样的对象，新对象跟原对象不共享内存，修改新对象不会改到原对象。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 深拷贝</span></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    name : <span class="string">&#x27;init&#x27;</span>,</span><br><span class="line">    arr : [<span class="number">1</span>,[<span class="number">2</span>,<span class="number">3</span>],<span class="number">4</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj4=<span class="title function_">deepClone</span>(obj1) <span class="comment">// 一个深拷贝方法</span></span><br><span class="line">obj4.<span class="property">name</span> = <span class="string">&quot;update&quot;</span>;</span><br><span class="line">obj4.<span class="property">arr</span>[<span class="number">1</span>] = [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>] ; <span class="comment">// 新对象跟原对象不共享内存</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj1&#x27;</span>,obj1) <span class="comment">// obj1 &#123; name: &#x27;init&#x27;, arr: [ 1, [ 2, 3 ], 4 ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj4&#x27;</span>,obj4) <span class="comment">// obj4 &#123; name: &#x27;update&#x27;, arr: [ 1, [ 5, 6, 7 ], 4 ] &#125;</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>前提为拷贝类型为引用类型的情况下：</p><ul><li><strong>浅拷贝</strong>是<strong>拷贝一层</strong>，属性为对象时，浅拷贝是复制，两个对象指向同一个地址</li><li><strong>深拷贝</strong>是<strong>递归拷贝深层次</strong>，属性为对象时，深拷贝是新开栈，两个对象指向不同的地址</li></ul></blockquote><h1>原型和原型链</h1><h2 id="原型">原型</h2><p><strong>概念</strong>：<code>JavaScript</code> 常被描述为一种基于原型的语言——每个对象拥有一个原型对象。</p><ul><li><p>当试图访问一个对象的属性时，它不仅仅在该对象上搜寻，还会搜寻该对象的原型，以及该对象的原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或到达原型链的末尾。</p></li><li><p>准确地说，这些属性和方法定义在Object的构造器函数（constructor functions）之上的<code>prototype</code>属性上，而非实例对象本身。</p></li></ul><p>下面举个例子：</p><p>函数可以有属性， 每个函数都有一个特殊的属性叫作原型<code>prototype</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( doSomething.<span class="property"><span class="keyword">prototype</span></span> );</span><br></pre></td></tr></table></figure><p>控制台输出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">constructor</span>: ƒ <span class="title function_">doSomething</span>(),</span><br><span class="line">    <span class="attr">__proto__</span>: &#123;</span><br><span class="line">        <span class="attr">constructor</span>: ƒ <span class="title class_">Object</span>(),</span><br><span class="line">        <span class="attr">hasOwnProperty</span>: ƒ <span class="title function_">hasOwnProperty</span>(),</span><br><span class="line">        <span class="attr">isPrototypeOf</span>: ƒ <span class="title function_">isPrototypeOf</span>(),</span><br><span class="line">        <span class="attr">propertyIsEnumerable</span>: ƒ <span class="title function_">propertyIsEnumerable</span>(),</span><br><span class="line">        <span class="attr">toLocaleString</span>: ƒ <span class="title function_">toLocaleString</span>(),</span><br><span class="line">        <span class="attr">toString</span>: ƒ <span class="title function_">toString</span>(),</span><br><span class="line">        <span class="attr">valueOf</span>: ƒ <span class="title function_">valueOf</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这个对象，就是大家常说的<strong>原型对象</strong>。</p><p>可以看到，原型对象有一个自有属性<code>constructor</code>，这个属性指向该函数，如下图关系展示：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/56d87250-725e-11eb-ab90-d9ae814b240d.png" alt="img"></p><h2 id="原型链">原型链</h2><p><strong>概念</strong>：原型对象也可能拥有原型，并从中继承方法和属性，一层一层、以此类推。这种关系常被称为<strong>原型链 (prototype chain)</strong>，它解释了为何一个对象会拥有定义在其他对象中的属性和方法。</p><blockquote><p>在对象实例和它的构造器之间建立一个链接（它是<code>__proto__</code>属性，是从构造函数的<code>prototype</code>属性派生的），之后通过上溯原型链，在构造器中找到这些属性和方法。</p></blockquote><p>下面举个例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">18</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第二步 创建实例</span></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;person&#x27;</span>)</span><br></pre></td></tr></table></figure><p>根据代码，得到下图：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/60825aa0-725e-11eb-85f6-6fac77c0c9b3.png" alt="img"></p><p>下面分析一下：</p><ul><li>构造函数<code>Person</code>存在原型对象<code>Person.prototype</code></li><li>构造函数生成实例对象<code>person</code>，<code>person</code>的<code>__proto__</code>指向构造函数<code>Person</code>原型对象</li><li><code>Person.prototype.__proto__</code> 指向内置对象，因为 <code>Person.prototype</code> 是个对象，默认是由 <code>Object</code>函数作为类创建的，而 <code>Object.prototype</code> 为内置对象</li><li><code>Person.__proto__</code> 指向内置匿名函数 <code>anonymous</code>，因为 Person 是个函数对象，默认由 Function 作为类创建</li><li><code>Function.prototype</code> 和 <code>Function.__proto__</code>同时指向内置匿名函数 <code>anonymous</code>，这样原型链的终点就是 <code>null</code></li></ul><h2 id="总结-v2">总结</h2><p><code>__proto__</code>作为不同对象之间的桥梁，用来指向创建它的构造函数的原型对象。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/6a742160-725e-11eb-ab90-d9ae814b240d.png" alt="img"></p><p>每个对象的<code>__proto__</code>都是指向它的构造函数的原型对象<code>prototype</code>的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person1.<span class="property">__proto__</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span></span><br></pre></td></tr></table></figure><p>构造函数是一个函数对象，是通过 <code>Function</code>构造器产生的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Person</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span></span><br></pre></td></tr></table></figure><p>原型对象本身是一个普通对象，而普通对象的构造函数都是<code>Object</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span></span><br></pre></td></tr></table></figure><p>刚刚上面说了，所有的构造器都是函数对象，函数对象都是 <code>Function</code>构造产生的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span></span><br></pre></td></tr></table></figure><p><code>Object</code>的原型对象也有<code>__proto__</code>属性指向<code>null</code>，<code>null</code>是原型链的顶端</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>下面作出总结：</p><ul><li>一切对象都是继承自<code>Object</code>对象，<code>Object</code> 对象直接继承根源对象<code>null</code></li><li>一切的函数对象（包括 <code>Object</code> 对象），都是继承自 <code>Function</code> 对象</li><li><code>Object</code> 对象直接继承自 <code>Function</code> 对象</li><li><code>Function</code>对象的<code>__proto__</code>会指向自己的原型对象，最终还是继承自<code>Object</code>对象</li></ul><h1>继承</h1><p>在编写代码时，有些对象会有方法（函数），如果把这些方法都放在构造函数中声明就会导致内存的浪费。</p><p>如下，通过调用构造函数的方式来创建对象，<code>Person</code> 是 <code>p1</code>、<code>p2</code> 的构造函数。所有的 <code>Person</code> 对象都有 <code>say</code> 方法，并且功能相似，但是他们占据了不同的内存，会导致内存浪费（内存泄露）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">say</span> === p2.<span class="property">say</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>于是，我们就需要用到<strong>继承</strong>。</p><blockquote><p>通过某种方式让一个对象可以访问到另一个对象中的属性和方法，我们把这种方式称之为<strong>继承</strong>。</p></blockquote><p><strong>实现方式</strong></p><p>主流通常有 8 种方式：</p><ul><li>原型链继承</li><li>借用构造函数继承</li><li>组合模式继承</li><li>共享原型继承</li><li>原型式继承</li><li>寄生式继承</li><li>寄生组合式继承</li><li>ES6 中 class 的继承（新）</li></ul><h2 id="原型链继承">原型链继承</h2><p>通过实例化一个新的函数，子类的原型指向了父类的实例，子类就可以调用其父类原型对象上的私有属性和公有方法。（本质就是重写了原型对象）</p><p>代码示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">parentName</span> = <span class="string">&#x27;父类&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getParentName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">parentName</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">childName</span> = <span class="string">&#x27;子类&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getChildName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">childName</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="title function_">getParentName</span>()); <span class="comment">// &#x27;父类&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="需要注意的问题">需要注意的问题</h3><p><strong>1）别忘记默认的类型</strong></p><p>我们知道，所有的引用类型都继承了 Object，而这个继承也是通过原型链实现的。所以所有的对象都拥有 Object 具有的一些默认的方法。如：<code>hasOwnProperty()</code>、<code>propertyIsEnumerable()</code>、<code>toLocaleString()</code>、<code>toString()</code> 和 <code>valueOf()</code>。</p><p><strong>2）确定原型和实例的关系</strong></p><p>可以通过两种方式来确定原型和实例之间的关系。</p><ul><li>第一种：使用 <code>instanceof</code> 操作符，只要用这个操作符来测试实例与原型链中出现过的构造函数，结果就会返回 <code>true</code>。</li><li>第二种：使用 <code>isPrototypeOf()</code> 方法。同样，只要是原型链中出现过的原型，都可以说是该原型链所派生的实例的原型，因此 <code>isPrototypeOf()</code> 方法也会返回 <code>true</code>。</li></ul><p>还是上面的代码，尝试打印一些比对关系：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c <span class="keyword">instanceof</span> <span class="title class_">Object</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c <span class="keyword">instanceof</span> <span class="title class_">Parent</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c <span class="keyword">instanceof</span> <span class="title class_">Child</span>); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(c)); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(c)); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(c)); <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><strong>3）子类要在继承后定义新方法</strong></p><p>因为，原型链继承实质上是重写原型对象。所以，如果在继承前就在子类的 prototype 上定义了一些方法和属性，那么继承后，子类的这些属性和方法将会被覆盖。</p><p><strong>4）不能使用对象字面量创建原型方法</strong></p><p>这个的原理跟上一条的实际上是一样的。当你使用对象字面量创建原型方法重写原型的时候，实质上相当于重写了原型链，所以原来的原型链就被切断了。</p><p>代码示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">parentName</span> = <span class="string">&#x27;父类&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getParentName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">parentName</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">childName</span> = <span class="string">&#x27;子类&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承 Parent</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"><span class="comment">// 使用对象字面量添加新方法，会导致上一行代码无效</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">getChildName</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">childName</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">someOtherMethod</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title class_">Child</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="property">getParentName</span>) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p><strong>5）注意父类包含引用类型的情况</strong></p><p>代码示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;父类&quot;</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">hobbies</span> = [<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="comment">// 继承 Parent</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">c1.<span class="property">name</span> = <span class="string">&quot;c1&quot;</span>;</span><br><span class="line">c1.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&quot;coding&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">name</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">hobbies</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c2.<span class="property">name</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c2.<span class="property">hobbies</span>);</span><br></pre></td></tr></table></figure><p>上述代码执行后，输出结果为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;c1&quot;</span></span><br><span class="line">[<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>, <span class="string">&quot;coding&quot;</span>]</span><br><span class="line"><span class="string">&quot;父类&quot;</span></span><br><span class="line">[<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>, <span class="string">&quot;coding&quot;</span>]</span><br></pre></td></tr></table></figure><p>这个例子中的 Parent 构造函数定义了一个 hobbies 属性，该属性包含一个数组（引用类型值）。Parent 的每个实例都会有各自包含自己数组的 hobbies 属性。当 Child 通过原型链继承了 Parent 之后，Child.prototype 就变成了 Parent 的一个实例，因此它也拥有了一个它自己的 hobbies 属性 —— 就跟专门创建了一个 Child.prototype.hobbies 属性一样。但结果是什么呢？结果是 Child 的所有实例都会共享这一个 hobbies 属性。而我们对 c1.hobbies 的修改能够通过 c2.hobbies 反映出来。也就是说，这样的修改会影响各个实例。</p><h3 id="原型链继承的优点">原型链继承的优点</h3><ul><li>简单，易实现</li><li>父类新增原型方法/原型属性，子类都能访问</li></ul><h3 id="原型链继承的缺点">原型链继承的缺点</h3><ul><li>无法实现多继承</li><li>引用类型的值会被实例共享</li><li>子类型无法给超类型传递参数</li></ul><p>鉴于这些缺点，实践中很少会单独使用原型链继承。</p><h2 id="借用构造函数继承（对象冒充）">借用构造函数继承（对象冒充）</h2><p>在解决原型链继承中包含引用类型值所带来问题的过程中，开发人员开始使用一种叫做借用构造函数（constructor stealing）的技术。</p><p>这种技术的基本思想相当简单，即在子类型构造函数的内部调用超类型构造函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">hobbies</span> = [<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">24</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c2&#x27;</span>);</span><br><span class="line">c1.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&#x27;coding&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">hobbies</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c2.<span class="property">hobbies</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1 <span class="keyword">instanceof</span> <span class="title class_">Parent</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1 <span class="keyword">instanceof</span> <span class="title class_">Child</span>)</span><br></pre></td></tr></table></figure><p>上述代码执行后，输出结果为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>, <span class="string">&quot;coding&quot;</span>] <span class="comment">// false</span></span><br><span class="line">[<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>] <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>借用构造函数的基本思想就是利用 <code>call</code> 或者 <code>apply</code> 把父类中通过 <code>this</code> 指定的属性和方法复制（借用）到子类创建的实例中。</p><p>因为 <code>this</code> 对象是在运行时基于函数的执行环境绑定的。也就是说，在全局中，<code>this</code> 等于 <code>window</code>，而当函数被作为某个对象的方法调用时，<code>this</code> 等于那个对象。<code>call</code> 、<code>apply</code> 方法可以用来代替另一个对象调用一个方法。<code>call</code>、<code>apply</code> 方法可将一个函数的对象上下文从初始的上下文改变为由 thisObj 指定的新对象。</p><p>所以，这个借用构造函数就是，<code>new</code> 对象的时候（注意，<code>new</code> 操作符与直接调用是不同的，以函数的方式直接调用的时候，<code>this</code> 指向 <code>window</code>，<code>new</code> 创建的时候，<code>this</code> 指向创建的这个实例），创建了一个新的实例对象，并且执行 Child 里面的代码，而 Child 里面用 <code>call</code> 调用了 Parent，也就是说把 <code>this</code> 指向改成了指向新的实例，所以就会把 Parent 里面的 <code>this</code> 相关属性和方法赋值到新的实例上，而不是赋值到 Child 上面。所有实例中就拥有了父类定义的这些 <code>this</code> 的属性和方法。</p><h3 id="借用构造函数的优点">借用构造函数的优点</h3><ul><li>解决了引用类型的值被实例共享的问题</li><li>可以向超类传递参数</li><li>可以实现多继承（call 若干个超类）</li></ul><h3 id="借用构造函数的缺点">借用构造函数的缺点</h3><ul><li>不能继承超类原型上的属性和方法</li><li>无法实现函数复用，由于 call 有多个父类实例的副本，性能损耗。</li><li>原型链丢失</li></ul><h2 id="组合模式继承">组合模式继承</h2><p>组合继承（combination inheritance），有时候也叫做伪经典继承。是将原型链继承和借用构造函数继承的技术组合到一块，从而发挥二者之长的一种继承模式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">hobbies</span> = [<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">24</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>(<span class="string">&#x27;父类&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;name&#x27;</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="title function_">getName</span>()); <span class="comment">// &quot;c1&quot;</span></span><br><span class="line"></span><br><span class="line">c1.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&#x27;coding&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">hobbies</span>); <span class="comment">// [&quot;sing&quot;, &quot;dance&quot;, &quot;rap&quot;, &quot;coding&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c2.<span class="property">hobbies</span>); <span class="comment">// [&quot;sing&quot;, &quot;dance&quot;, &quot;rap&quot;]</span></span><br></pre></td></tr></table></figure><p>这种继承方式看起来似乎没有问题，但是它却调用了 2 次超类型构造函数：一次在子类构造函数内，另一次是将子类的原型指向父类构造的实例，导致生成了 2 次 name 和 hobbies，只不过实例屏蔽了原型上的<code>console.log(c1)</code>。虽然达成了目的，却不是我们最想要的。</p><p>这个问题将在寄生组合式继承里得到解决。</p><h2 id="共享原型继承">共享原型继承</h2><p>这种方式下子类和父类共享一个原型。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hobbies</span> = [<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&quot;c1&quot;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&quot;c2&quot;</span>, <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">c1.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&quot;coding&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">hobbies</span>); <span class="comment">// [&quot;sing&quot;, &quot;dance&quot;, &quot;rap&quot;, &quot;coding&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c2.<span class="property">hobbies</span>); <span class="comment">// [&quot;sing&quot;, &quot;dance&quot;, &quot;rap&quot;, &quot;coding&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">name</span>); <span class="comment">// &quot;c1&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c2.<span class="property">name</span>); <span class="comment">// &quot;c2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="共享原型继承的优点">共享原型继承的优点</h3><ul><li>简单</li></ul><h3 id="共享原型继承的缺点">共享原型继承的缺点</h3><ul><li>只能继承父类原型属性方法，不能继承构造函数属性方法</li><li>与原型链继承一样，存在引用类型问题</li></ul><h2 id="原型式继承">原型式继承</h2><p>这种继承方式普遍用于基于当前已有对象创建新对象。</p><p>在 ES5 之前实现方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createAnother</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;父对象&#x27;</span>,</span><br><span class="line">  <span class="attr">say</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o2 = <span class="title function_">createAnother</span>(o1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o2.<span class="property">name</span>); <span class="comment">// &quot;父对象&quot;</span></span><br></pre></td></tr></table></figure><p>ES5 新增了 <code>Object.create()</code> 方法规范化了原型式继承。调用方法为：<code>Object.create(o)</code>，如下代码所示：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用法一：创建一个纯洁的对象：对象什么属性都没有</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法二：创建一个子对象，它继承自某个父对象</span></span><br><span class="line"><span class="keyword">var</span> o1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;父对象&#x27;</span>,</span><br><span class="line">  <span class="attr">say</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> o2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(o1);</span><br></pre></td></tr></table></figure><h2 id="寄生式继承">寄生式继承</h2><p>寄生式继承是原型式继承的加强版，它结合原型式继承和工厂模式，创建一个仅用于封装继承过程的函数，该函数在内部以某种方式来增强对象，最后返回对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createAnother</span>(<span class="params">origin</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> clone = <span class="title class_">Object</span>.<span class="title function_">create</span>(origin); <span class="comment">// 通过调用函数创建一个新对象</span></span><br><span class="line">  clone.<span class="property">sayHi</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">// 以某种方式来增强这个对象</span></span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;Hi&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> clone; <span class="comment">// 返回这个对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;父对象&quot;</span>,</span><br><span class="line">  <span class="attr">hobbies</span>: [<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> o2 = <span class="title function_">createAnother</span>(o1);</span><br><span class="line">o2.<span class="title function_">sayHi</span>();</span><br></pre></td></tr></table></figure><p>在上述例子中，createAnother 函数接收了一个参数，也就是将要被继承的对象。</p><p>o2 是基于 o1 创建的一个新对象，新对象不仅具有 o1 的所有属性和方法，还有自己的 sayHi() 方法。</p><p>简单而言，寄生式继承在产生了这个继承父类的对象之后，为这个对象添加了一些增强方法。</p><h3 id="寄生式继承的优点">寄生式继承的优点</h3><p>没啥优点</p><h3 id="寄生式继承的缺点">寄生式继承的缺点</h3><p>原型式继承有的缺点它都有，只是外面装个壳，就演化成了另一种继承模式。</p><h2 id="寄生组合式继承">寄生组合式继承</h2><p>顾名思义，寄生式 + 组合式。它是寄生式继承的加强版。这也是为了避免组合继承中无可避免地要调用两次父类构造函数的最佳方案。</p><p><strong>开发人员普遍认为寄生组合式继承是引用类型最理想的继承范式</strong>。</p><p>基本写法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">SubType, SuperType</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prototype = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  prototype.<span class="property">constructor</span> = <span class="title class_">SubType</span>;</span><br><span class="line">  <span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>兼容写法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">object</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">W</span>(<span class="params"></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  W.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> W;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">SubType, SuperType</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prototype;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Object</span>.<span class="property">create</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    prototype = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    prototype = <span class="title function_">object</span>(<span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  &#125;         </span><br><span class="line">  prototype.<span class="property">constructor</span> = <span class="title class_">SubType</span>;</span><br><span class="line">  <span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本质是子类的原型继承自父类的原型，申明一个用于继承原型的 inheritPrototype 方法，通过这个方法我们能够将子类的原型指向超类的原型，从而避免超类二次实例化。</p><p>实例代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">hobbies</span> = [<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getHobbies</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">hobbies</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">24</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试结果</span></span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1 <span class="keyword">instanceof</span> <span class="title class_">Child</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1 <span class="keyword">instanceof</span> <span class="title class_">Parent</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">constructor</span>); <span class="comment">// Child</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">c1.<span class="property">hobbies</span>.<span class="title function_">push</span>(<span class="string">&#x27;coding&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="title function_">getHobbies</span>()); <span class="comment">// [&quot;sing&quot;, &quot;dance&quot;, &quot;rap&quot;, &quot;coding&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c2.<span class="title function_">getHobbies</span>()); <span class="comment">// [&quot;sing&quot;, &quot;dance&quot;, &quot;rap&quot;]</span></span><br></pre></td></tr></table></figure><p>这也是目前最完美的继承方案，它与 ES6 的 class 的实现方式最为接近。</p><h3 id="寄生组合式继承的优点">寄生组合式继承的优点</h3><p>堪称完美</p><h3 id="寄生组合式继承的缺点">寄生组合式继承的缺点</h3><p>代码多</p><h2 id="class-继承-ES6">class 继承(ES6)</h2><p>ES6 中，通过 <code>class</code> 关键字来定义类，子类可以通过 <code>extends</code> 继承父类。</p><p>代码示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>&#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hobbies</span> = [<span class="string">&quot;sing&quot;</span>, <span class="string">&quot;dance&quot;</span>, <span class="string">&quot;rap&quot;</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getHobbies</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">hobbies</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getCurrent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;c2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1 <span class="keyword">instanceof</span> <span class="title class_">Child</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1 <span class="keyword">instanceof</span> <span class="title class_">Parent</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>要点：</p><ul><li><code>constructor</code> 为构造函数，即使未定义也会自动创建。</li><li>在父类构造函数内 <code>this</code> 定义的都是实例属性和方法，其他方法包括 <code>constructor</code>、<code>getHobbies</code> 都是原型方法。</li><li><code>static</code> 关键字定义的静态方法都必须通过类名调用，其 <code>this</code> 指向调用者而并非实例。</li><li>通过 <code>extends</code> 可以继承父类的所有原型属性及 <code>static</code> 类方法，子类 <code>constructor</code> 调用 <code>super</code> 父类构造函数实现实例属性和方法的继承。</li></ul><p>对比：</p><ul><li>ES5 的继承，实质是先创造子类的实例对象 <code>this</code>，然后再将父类的方法添加到 <code>this</code> 上面（<code>Parent.apply(this)</code>）。</li><li>ES6 的继承机制完全不同，实质是先将父类实例对象的属性和方法，加到 <code>this</code> 上面（所以必须先调用 <code>super</code> 方法），然后再用子类的构造函数修改 <code>this</code>。</li></ul><h2 id="总结-v3">总结</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/0df74700-731c-11eb-ab90-d9ae814b240d.png" alt="img"></p><p>通过<code>Object.create</code> 来划分不同的继承方式，最后的寄生式组合继承方式是通过组合继承改造之后的最优继承方式，而 <code>extends</code> 的语法糖和寄生组合继承的方式基本类似。</p><blockquote><p>参考文章：</p><ul><li><a href="https://cloud.tencent.com/developer/article/1851143">https://cloud.tencent.com/developer/article/1851143</a></li></ul></blockquote><h1>作用域和作用域链</h1><h2 id="作用域">作用域</h2><p><strong>概念</strong>：作用域是在程序运行时代码中的某些特定部分中变量、函数和对象的<strong>可访问性</strong>。</p><ul><li><p>从使用方面来<strong>解释</strong>，作用域就是变量的使用范围，也就是在代码的哪些部分可以访问这个变量，哪些部分无法访问到这个变量，换句话说就是这个变量在程序的哪些区域可见。</p></li><li><p>从存储上来<strong>解释</strong>的话，作用域<strong>本质</strong>上是一个<strong>对象，</strong> 作用域中的变量可以理解为是该对象的成员。</p></li></ul><p><strong>总结</strong>：作用域就是代码的执行环境，全局作用域就是全局执行环境，局部作用域就是函数的执行环境，它们都是栈内存</p><h3 id="作用域分类"><strong>作用域分类</strong></h3><p>作用域又分为<strong>全局作用域</strong>和<strong>局部作用域</strong>。在ES6之前，局部作用域只包含了函数作用域，ES6的到来为我们提供了 <strong>块级作用域</strong>（由一对花括号包裹），可以通过新增命令let和const来实现；而对于全局作用域这里有一个小细节需要注意一下：</p><blockquote><ul><li>在 Web 浏览器中，全局作用域被认为是 <strong><code>window</code></strong> 对象，因此所有全局变量和函数都是作为 <strong><code>window</code></strong> 对象的属性和方法创建的。</li><li>在 Node环境中，全局作用域是 <strong><code>global</code></strong> 对象。</li></ul></blockquote><p>全局作用域很好理解，现在我们再来解释一下局部作用域吧，先来看看<strong>函数作用域</strong>，所谓函数作用域，顾名思义就是由函数定义产生出来的作用域，代码示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fun1</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> variable = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun2</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> variable = <span class="string">&#x27;cba&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fun1</span>();</span><br><span class="line"><span class="title function_">fun2</span>();</span><br><span class="line"><span class="comment">//这里有两个函数，他们分别都有一个同名变量variable，在严格模式下，程序不会报错，</span></span><br><span class="line"><span class="comment">//这是因为这两个同名变量位于不同的函数内，也就是位于不同的作用域中，所以他们不会产生冲突。</span></span><br></pre></td></tr></table></figure><p>我们再来看看<strong>块级作用域</strong>，ES6 之前 JavaScript 没有块级作用域，只有全局作用域和函数（局部）作用域。块语句（ <strong><code>&#123;&#125;</code></strong> 中间的语句），如 <strong><code>if</code></strong> 和 <strong><code>switch</code></strong> 条件语句， <strong><code>for</code></strong> 和 <strong><code>while</code></strong> 循环语句，不同于函数，它们<strong>不会创建一个新的作用域</strong>；但是ES6及之后的版本，块语句也<strong>会创建一个新的作用域，</strong> 块级作用域可通过新增命令let和const声明，所声明的变量在<strong>指定块</strong>的<strong>作用域外无法被访问</strong>。块级作用域在如下情况被创建：</p><blockquote><ol><li>在一个函数内部</li><li>在一个代码块（由一对花括号包裹）内部</li></ol></blockquote><p>let 声明的语法与 var 的语法一致。基本上可以用 let 来代替 var 进行变量声明，但会将变量的作用域限制在当前代码块中 <strong>（注意：块级作用域并不影响var声明的变量）。</strong> 但是使用let时有几点需要<strong>注意</strong>：</p><blockquote><ul><li><strong>声明变量不会提升到代码块顶部，即不存在变量提升</strong></li><li><strong>禁止重复声明同一变量</strong></li><li><strong>for循环语句中（）内部，即圆括号之内会建立一个隐藏的作用域，该作用域不属于for后边的{}中，并且只有for后边的{}产生的块作用域能够访问这个隐藏的作用域，这就使循环中</strong> <strong>绑定块作用域有了妙用</strong></li></ul></blockquote><p>这里分别演示一下ES5和ES6版本的代码，ES5：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>ES6：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(i);<span class="comment">//0,1,2,3,4,5,6,7,8,9</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i);<span class="comment">// Uncaught ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">     <span class="keyword">let</span> i = <span class="number">9</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i);<span class="comment">// Uncaught ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure><h2 id="作用域链-scope-chain">作用域链(scope chain)</h2><p><strong>概念</strong>：多个作用域对象连续引用形成的链式结构。</p><p><strong>使用</strong>方面<strong>解释</strong>：当在Javascript中使用一个变量的时候，首先Javascript引擎会尝试在当前作用域下去寻找该变量，如果没找到，再到它的上层作用域寻找，以此类推直到找到该变量或是已经到了全局作用域，如果在全局作用域里仍然找不到该变量，它就会直接报错。</p><p><strong>存储</strong>方面<strong>解释</strong>：作用域链在JS内部中是以数组的形式存储的，数组的第一个索引对应的是函数本身的执行期上下文，也就是当前执行的代码所在环境的变量对象，下一个索引对应的空间存储的是该对象的外部执行环境，依次类推，一直到全局执行环境</p><p>代码示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">100</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">200</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">//100</span></span><br><span class="line"><span class="comment">// fun函数局部作用域中没有变量a，于是从它的上一级，也就是全局作用域中找，</span></span><br><span class="line"><span class="comment">//在全局中a被赋值为100，于是输出100</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b)<span class="comment">//200 fun函数局部作用域中有变量b，并且它被赋值为了200，输出200</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fun</span>()</span><br></pre></td></tr></table></figure><p>再来看个栗子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">show</span>(<span class="params">f</span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> a = <span class="number">20</span></span><br><span class="line">   (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">f</span>()   <span class="comment">//10，而不是20; 函数的作用域是在函数定义的时候就被决定了，与函数在哪里被调用无关</span></span><br><span class="line">   &#125;)()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">show</span>(fun)</span><br></pre></td></tr></table></figure><p>由于变量的查找是沿着作用域链来实现的，所以也称作用域链为<strong>变量查找的机制</strong>。是不是很好理解，这里再来补充一点作用域的作用</p><blockquote><ol><li>作用域最为重要的一点是安全。<strong>变量只能在特定的区域内才能被访问，外部环境不能访问内部环境的任何变量和函数，即可以向上搜索，但不可以向下搜索，</strong> 有了作用域我们就可以避免在程序其它位置意外对某个变量做出修改导致程序发生事故。</li><li>作用域能够减轻命名的压力。我们可以在不同的作用域内定义相同的变量名，并且这些变量名不会产生冲突。</li></ol></blockquote><blockquote><p>参考文章：<a href="https://juejin.cn/post/7096818495450513445">https://juejin.cn/post/7096818495450513445</a></p></blockquote><h1>闭包</h1><p>定义：<strong>函数创建和函数执行不在同一个作用域下就会形成闭包。</strong>（来自《你不知道的javaScrip》）</p><h2 id="变量的作用域"><strong>变量的作用域</strong></h2><p>要理解闭包，首先必须理解Javascript特殊的变量作用域。</p><p>变量的作用域无非就是两种：<strong>全局变量</strong>和<strong>局部变量</strong>。</p><p>Javascript语言的特殊之处，就在于函数内部可以直接读取全局变量。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n=<span class="number">999</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;</span><br><span class="line">　<span class="title function_">alert</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f1</span>(); <span class="comment">// 999</span></span><br></pre></td></tr></table></figure><p>另一方面，在函数外部自然无法读取函数内的局部变量。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;</span><br><span class="line">　　<span class="keyword">var</span> n=<span class="number">999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(n); <span class="comment">// error</span></span><br></pre></td></tr></table></figure><p>这里有一个地方需要注意，函数内部声明变量的时候，一定要使用var命令。如果不用的话，你实际上声明了一个全局变量！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;</span><br><span class="line">　n=<span class="number">999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f1</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(n); <span class="comment">// 999</span></span><br></pre></td></tr></table></figure><h2 id="如何从外部读取局部变量？">如何从外部读取局部变量？</h2><p>在使用JS进行编程的时候，我们有时候需要在函数外部得到函数内的局部变量，可是我们前面已经说了，正常情况下这是不可能的。</p><p>嘿嘿，既然都说了是正常情况，那肯定有“不正常情况”啦！那就是在函数的内部，再定义一个函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">var</span> n=<span class="number">999</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params"></span>)&#123;</span><br><span class="line">　　　　<span class="title function_">alert</span>(n); <span class="comment">// 999</span></span><br><span class="line">　　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的代码中，函数fun2就被包括在函数fun1内部，这时fun1内部的所有局部变量，对fun2都是可见的。但是反过来就不行，fun2内部的局部变量，对fun1都是不可见的。这就是Javascript语言所特有的<strong>链式作用域</strong>结构（chain scope），子对象会一级一级地向上寻找所有父对象的变量。<strong>总结</strong>：父对象的所有变量，对子对象都是可见的，反之则不成立。</p><p>这样我们就能够访问到函数fun1内部的变量了，可是问题来了，我们无法从外部调用函数fun2，那我们应该怎样才能够在外部访问fun2呢，我们只需要将<strong>fun2</strong>作为<strong>fun1</strong>的<strong>返回值</strong>返回，这样我们不就能在fun1外部访问到fun1内部的变量了吗，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;</span><br><span class="line">　　<span class="keyword">var</span> n=<span class="number">999</span>;</span><br><span class="line">　　<span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params"></span>)&#123;</span><br><span class="line">　　　　<span class="title function_">alert</span>(n);</span><br><span class="line">　　&#125;</span><br><span class="line"><span class="keyword">return</span> f2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result=<span class="title function_">f1</span>();</span><br><span class="line"><span class="title function_">result</span>(); <span class="comment">// 999</span></span><br></pre></td></tr></table></figure><h2 id="闭包的概念">闭包的概念</h2><p>上一节代码中的f2函数，就是<strong>闭包</strong>。</p><p>关于闭包的概念，在前面我们已经说了官方给出的定义，官方给的定义虽然比较准确一点，但是对于初学者来说晦涩难懂，这里来说说我对闭包的理解，<strong>我的理解</strong>是，闭包就是<strong>能够读取其他函数内部变量的函数</strong>。在本质上，闭包就是将函数内部和函数外部连接起来的一座<strong>桥梁</strong>。</p><p>前面我们虽然也说了闭包不是一个函数，但是为了方便理解和学习我们通常可以将闭包称为一个函数，但是我们也要时刻在心里记住闭包不是一个函数，而是<strong>函数和声明该函数的词法环境的组合，这个环境包含了这个闭包创建时所能访问的所有局部变量</strong>。记住，它是一个组合！组合！</p><h2 id="闭包的用途">闭包的用途</h2><p>想要使用闭包，必须知道它的<strong>结构</strong>，也是它的<strong>产生条件</strong>：</p><blockquote><ol><li>一个函数，里面有一些变量和另一个函数</li><li>外部函数里面的函数使用了外部函数的变量</li><li>外部函数最后把它里面的那个函数用return抛出去</li></ol></blockquote><p>以及闭包的<strong>作用</strong>：</p><blockquote><ul><li>在函数外部可以读取函数内部的变量</li><li>让这些变量的值始终保持在内存中</li></ul></blockquote><p>怎么来理解这句话呢？请看下面的代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun1</span>(<span class="params"></span>) &#123;</span><br><span class="line">   test = <span class="number">10</span>;　　　　</span><br><span class="line">   <span class="keyword">var</span> n = <span class="number">999</span>;　　　　</span><br><span class="line">   nAdd = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">         n += <span class="number">1</span>;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(n);</span><br><span class="line">   &#125;　　　　</span><br><span class="line">   <span class="keyword">function</span> <span class="title function_">fun2</span>(<span class="params"></span>) &#123;　　　　　　</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(n);　　　　</span><br><span class="line">   &#125;　　　　</span><br><span class="line">   <span class="keyword">return</span> fun2;　　</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">fun1</span>();</span><br><span class="line"><span class="title function_">result</span>(); <span class="comment">// 999</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test);<span class="comment">//10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n);<span class="comment">//1</span></span><br><span class="line"><span class="title function_">nAdd</span>();</span><br><span class="line"><span class="title function_">result</span>(); <span class="comment">// 1000</span></span><br></pre></td></tr></table></figure><p>在这段代码中，result实际上就是闭包fun2函数。它一共运行了两次，第一次的值是999，第二次的值是1000。这证明了函数fun1中的局部变量n一直保存在内存中，并没有在fun1调用执行完之后被自动清除。</p><p>发生这样的情况原因就在于fun1是fun2的父函数，而fun2又通过fun1的return语句被赋给了一个全局变量，这导致fun2始终在内存中，而fun2的存在依赖于fun1，因此fun1也始终在内存中，不会在调用结束后，被垃圾回收机制（garbage collection）回收。</p><p>另外需要注意的地方是&quot;nAdd=function(){n+=1}&quot;这一行，首先在nAdd前面没有使用var关键字，因此nAdd是一个全局变量，而不是局部变量。其次，nAdd的值是一个匿名函数，而这个匿名函数本身也是一个闭包，所以nAdd可以在函数外部对函数内部的局部变量进行操作。</p><h2 id="使用闭包的注意点">使用闭包的注意点</h2><ul><li><p>由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，可能导致内存泄露。解决方法是，在退出函数之前，将不需要的局部变量赋值为null。</p></li><li><p>闭包会在父函数外部改变父函数内部变量的值。如果你把父函数当作对象使用，把闭包当作它的公用方法，把内部变量当作它的私有属性，这时一定要注意，不要随便改变父函数内部变量的值。</p></li><li><p>当定义一个函数时，它实际上保存一个作用域链。当调用这个函数时，它创建一个新的对象来存储它的局部变量，并将这个对象添加至保存的那个作用域链上，同时创建一个新的更长的表示函数调用作用域的“链”。对于嵌套函数来讲，事情变得更加有趣，每次调用外部函数时，内部函数又会重新定义一遍。因为每次调用外部函数的时候，作用域链都是不同的。内部函数在每次定义的时候都有微妙的差别——在每次调用外部函数时，内部函数的代码都是相同的，但是关联这段代码的作用域链不相同，用闭包概念来说，也就是产生了新的闭包</p></li></ul><blockquote><p>参考文章：<a href="https://juejin.cn/post/7097141521102667813#heading-1">https://juejin.cn/post/7097141521102667813#heading-1</a></p></blockquote><hr><blockquote><p>更多Web前端面试题，请前往此大佬博客😋</p><p><a href="https://vue3js.cn/interview/JavaScript/data_type.html#%E5%89%8D%E8%A8%80">https://vue3js.cn/interview/JavaScript/data_type.html#前言</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;防抖和节流&lt;/h1&gt;
&lt;h2 id=&quot;防抖（deounce）&quot;&gt;防抖（deounce）&lt;/h2&gt;
&lt;h3 id=&quot;定义&quot;&gt;定义&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;防抖&lt;/strong&gt;指只有在n秒内没有再次触发某个函数时，才会真正执行这个函数；若n秒内再次触发此函数，则重新</summary>
      
    
    
    
    <category term="面试宝典✨" scheme="https://blog.cilicili.xyz/categories/%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8%E2%9C%A8/"/>
    
    
    <category term="JavaScript" scheme="https://blog.cilicili.xyz/tags/JavaScript/"/>
    
    <category term="实现原理" scheme="https://blog.cilicili.xyz/tags/%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>【面试】Webpack常见面试题</title>
    <link href="https://blog.cilicili.xyz/posts/a6cd716a.html"/>
    <id>https://blog.cilicili.xyz/posts/a6cd716a.html</id>
    <published>2022-09-09T08:02:18.000Z</published>
    <updated>2022-09-09T09:24:40.627Z</updated>
    
    <content type="html"><![CDATA[<h1>面试官灵魂三连问</h1><ol><li>你用过webpack么，它的原理是什么？</li><li>你还知道些构建工具，各有什么优缺点？</li><li>你在项目中有配置过么，在哪些场景配置过？</li></ol><h1>Webpack介绍</h1><h2 id="什么是webpack">什么是webpack</h2><p><strong>webpack 是一个模块打包器</strong>。webpack 的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换(transform)、打包(bundle)。</p><h2 id="webpack原理是什么">webpack原理是什么</h2><h3 id="工作原理">工作原理</h3><p>webpack可以看做是模块打包机：</p><p>它做的事情是，分析你的项目结构，找到JavaScript模块以及其它的一些浏览器不能直接运行的拓展语言（Sass，TypeScript等），并将其转换和打包为合适的格式供浏览器使用。</p><p>在3.0出现后，Webpack还肩负起了优化项目的责任。</p><h3 id="打包原理">打包原理</h3><p>把一切都视为模块：不管是 css、JS、Image 还是 html 都可以互相引用，通过定义 entry.js，对所有依赖的文件进行跟踪，将各个模块通过 loader 和 plugins 处理，然后打包在一起。</p><p><strong>按需加载</strong>：打包过程中 Webpack 通过 Code Splitting 功能将文件分为多个 chunks，还可以将重复的部分单独提取出来作为 commonChunk，从而实现按需加载。把所有依赖打包成一个 bundle.js 文件，通过代码分割成单元片段并按需加载</p><h3 id="核心概念">核心概念</h3><ul><li>Entry：入口，webpack 执行构建的第一步将从 Entry 开始，可抽象成输入。告诉webpack要使用哪个模块作为构建项目的起点，默认为./src/index.js</li><li>output ：出口，告诉webpack在哪里输出它打包好的代码以及如何命名，默认为./dist</li><li>Module：模块，在 webpack 里一切皆模块，一个模块对应着一个文件。webpack 会从配置的 Entry 开始递归找出所有依赖的模块。</li><li>Chunk：代码块，一个 Chunk 由多个模块组合而成，用于代码合并与分割。</li><li>Loader：模块转换器，用于把模块原内容按照需求转换成新内容。</li><li>Plugin：扩展插件，在 webpack 构建流程中的特定时机会广播出对应的事件，插件可以监听这些事件的发生，在特定时机做对应的事情。</li></ul><h3 id="构建流程">构建流程</h3><p>Webpack 的运⾏流程是⼀个串⾏的过程，从启动到结束会依次执⾏以下流程：</p><ol><li><strong>初始化参数</strong>：解析webpack配置参数，合并shell传入和webpack.config.js文件配置的参数，形成最后的配置结果。</li><li><strong>开始编译</strong>：上一步得到的参数初始化compiler对象，注册所有配置的插件，插件监听webpack构建生命周期的事件节点，做出相应的反应，执行对象的 run 方法开始执行编译。</li><li><strong>确定入口</strong>：从配置的entry入口，开始解析文件构建AST语法树，找出依赖，递归下去。</li><li><strong>编译模块</strong>：递归中根据文件类型和loader配置，调用所有配置的loader对文件进行转换，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理。</li><li><strong>完成模块编译</strong>：在经过第4步使⽤ Loader 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系；</li><li><strong>输出资源</strong>：根据⼊⼝和模块之间的依赖关系，组装成⼀个个包含多个模块的 Chunk，再把每个 Chunk 转换成⼀个单独的⽂件加⼊到输出列表，这步是可以修改输出内容的最后机会；</li><li><strong>输出完成</strong>：在确定好输出内容后，根据配置确定输出的路径和⽂件名，把⽂件内容写⼊到⽂件系统。</li></ol><blockquote><p><strong>注意</strong>：</p><p>在以上过程中，Webpack 会在特定的时间点，⼴播出特定的事件，插件在监听到感兴趣的事件后，会执⾏特定的逻辑。并且插件可以调⽤ Webpack 提供的 API ，改变 Webpack 的运⾏结果。比如UglifyPlugin，会在loader转换递归完，对结果使用UglifyJs压缩，覆盖之前的结果。</p></blockquote><h3 id="基本功能">基本功能</h3><ul><li>代码转换：TypeScript 编译成 JavaScript、SCSS 编译成 CSS 等等</li><li>文件优化：压缩 JavaScript、CSS、html 代码，压缩合并图片等</li><li>代码分割：提取多个页面的公共代码、提取首屏不需要执行部分的代码让其异步加载</li><li>模块合并：在采用模块化的项目有很多模块和文件，需要构建功能把模块分类合并成一个文件</li><li>自动刷新：监听本地源代码的变化，自动构建，刷新浏览器</li><li>代码校验：在代码被提交到仓库前需要检测代码是否符合规范，以及单元测试是否通过</li><li>自动发布：更新完代码后，自动构建出线上发布代码并传输给发布系统。</li></ul><h2 id="webpack基本配置">webpack基本配置</h2><h3 id="安装">安装</h3><p>全局安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -g webpack</span><br><span class="line">npm install -g webpack-cli</span><br></pre></td></tr></table></figure><p>项目依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack</span><br><span class="line">npm install --save-dev webpack-cli</span><br></pre></td></tr></table></figure><h3 id="基本配置-入口：">基本配置-入口：</h3><p>入口起点(entry point)指示 webpack 应该使用哪个模块，来作为构建其内部依赖图的开始。</p><h3 id="基本配置-出口">基本配置-出口</h3><p>output 属性告诉 webpack 在哪里输出它所创建的 bundles</p><h3 id="基本配置-loaders">基本配置-loaders</h3><p>loader 让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。</p><h3 id="基本配置-plugins">基本配置-plugins</h3><p>webpack插件(自动打开浏览器、热更新等)</p><blockquote><ol><li><strong>loader</strong>是使webpack拥有加载和解析非js文件的能力</li><li><strong>plugin</strong> 可以扩展webpack的功能，使得webpack更加灵活。可以在构建的过程中通过webpack的api改变输出的结果</li></ol></blockquote><h3 id="基本配置-模式">基本配置-模式</h3><p>package.json中设置：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">”scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: <span class="string">&quot;webpack --mode development&quot;</span>,  // 开发环境</span><br><span class="line">     <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --mode production&quot;</span>,  // 生产环境</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>webpack.config.js中设置：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module<span class="selector-class">.exports</span> = &#123;</span><br><span class="line">    entry: <span class="string">&#x27;./src/app.js&#x27;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.<span class="built_in">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        filename: <span class="string">&#x27;main.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">&#x27;development&#x27;</span> // 设置mode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>development：有内置的调试功能；<strong>打包后的代码可阅读，没被压缩</strong></p><p>production：内置生产阶段的很多优化功能；<strong>代码被压缩</strong></p><h3 id="基本配置-启动本地服务">基本配置-启动本地服务</h3><h4 id="方式一：">方式一：</h4><p>在package.json里的script属性里配置，完了执行<code>npm run xxx</code></p><p>例如vue项目中</p><p>package.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service serve&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service lint&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>命令行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h4 id="方式二：">方式二：</h4><p>通过npx</p><p>例如vue项目中</p><p>命令行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx cli-service serve</span><br></pre></td></tr></table></figure><p>npx：<a href="https://link.juejin.cn?target=https%3A%2F%2Flinks.jianshu.com%2Fgo%3Fto%3Dhttps%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fnpx">www.npmjs.com/package/npx</a></p><h3 id="模块化-v2">模块化</h3><p><strong>webpack 默认使用common.js规范</strong>。</p><p>如果只是使用import 导入模后，浏览器是不能直接识别的，必须导入webpack才行。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/a3ab5e18643f451fa35621b2b2df5427~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20220908051238818.png"></p><h2 id="其他基本常用配置">其他基本常用配置</h2><h3 id="webpack跨域解决方案">webpack跨域解决方案</h3><p>proxy</p><h3 id="ES6转ES5">ES6转ES5</h3><p>babel</p><h3 id="less转css">less转css</h3><p>less-loader</p><p><img src= "/img/loading.gif" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52c12510c2934e729c07cbb025752362~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image-20220908035219133.png"></p><p><strong>注意</strong>：配置时执行顺序默认是<strong>从右到左，从下到上</strong>。</p><h3 id="处理图片">处理图片</h3><h4 id="方式一：url-loader">方式一：url-loader</h4><p>小于limit限制的转base64</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/59df8f0eba8447e888617569324cb7a7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20220509013551329.png"> <strong>说明</strong>：url-loader处理的图片一般比较小，会把图片转换成<strong>base64</strong>代码，直接添加页面。提供了一个方便的选择 <strong>limit</strong>，该选项用于控制当文件大小小于 limit 时才使用 url-loader。通常会设置<strong>5-8kb</strong>。</p><p><strong>扩展</strong>：哈希的作用是<strong>命中缓存</strong>，使返回更快些。</p><h4 id="方式二：file-loader">方式二：file-loader</h4><p>把图片转换成路径。</p><p><img src= "/img/loading.gif" data-lazy-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94ef4dc4b5824b62b007ec145a7cf922~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image-20220908035830131.png"></p><h3 id="拆分配置和merge">拆分配置和merge</h3><blockquote><p>背景：‘‘基本配置-模式’’，里面介绍过模式之间的区别，为了解决手动更改mode带来的不便，所以，要将这些打包的配置，拆分到不同的文件里面来。</p></blockquote><ul><li>webpack.dev.config.js 开发环境的配置；</li><li>webpack.prod.config.js生产环境的配置；</li><li>webpack.base.config.js是开发环境和生产环境都会使用的配置；</li><li>通过<strong>webpack-merge</strong>模块将不同配置的代码合并；</li></ul><p><em>webpack.dev.config.js</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.base.config&#x27;</span>)</span><br><span class="line"><span class="comment">// webpack-merge 将公共的配置 和 开发的配置合并结合</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">smart</span>: merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(commonConfig, devConfig)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><em>webpack.prod.config.js</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.base.config&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">smart</span>: merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> prodConfig = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(commonConfig, prodConfig)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="业务场景">业务场景</h2><ol><li><p>单页应用</p></li><li><p>一个项目管理多个单页面</p></li><li><p>代码分隔优化</p><p>一个好的代码分割对浏览器首屏效果提升很大。</p></li><li><p>构建服务端渲染</p></li><li><p>热更新</p></li><li><p>优化开发编译、生产环境打包速度</p></li><li><p>优化首屏速度</p></li></ol><h1>扩展：还知道哪些构建工具？有什么优缺点？</h1><blockquote><p>大致了解下就好  ，现在主流的是<strong>webpack、rollup、vite</strong></p></blockquote><h2 id="构建工具有哪些？">构建工具有哪些？</h2><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2F">webpack</a> 与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.gruntjs.net%2F">grunt</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.gulpjs.com.cn%2F">gulp</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Ffex.baidu.com%2Ffis3%2F%EF%BC%89">FIS3</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.cn%2F">Vite</a>等</p><h2 id="他们有什么不同？">他们有什么不同？</h2><ul><li>都是前端构建工具，grunt和gulp在早期比较流行，FIS3停止维护了，现在webpack相对来说比较主流，不过一些轻量化的任务，还是会用gulp来处理，比如单独打包CSS文件等。</li><li>grunt和gulp是基于<em><strong>任务</strong>和</em><em>流</em>**（Task、Stream）的。类似<strong>jQuery</strong>，找到一个（或一类）文件，对其做一系列链式操作，更新流上的数据， 整条<strong>链式操作</strong>构成了一个<strong>任务</strong>，多个任务就构成了整个web的构建<strong>流程</strong>。</li><li>webpack是基于<em><strong>入口</strong></em>的。webpack会自动地<strong>递归解析</strong>入口所需要加载的所有<strong>资源文件</strong>，然后用不同的<strong>Loader</strong>来处理不同的文件，用<strong>Plugin</strong>来扩展webpack功能。</li><li>webpack优点是专注于处理模块化的项目，尤其适合单页应用。Webpack的缺点是只能用于采用模块化开发的项目。</li><li>FIS3并没有<strong>入口</strong>(entry)的概念，在FIS3中，构建流程不单单根据js来，而是分析每一个文件的依赖关系，生成一个资源表‘sourceMap’，你可以根据资源表定义任何的产出规则</li><li>Fis3的<strong>优点</strong>是集成了各种Web开发所需的构建功能，配置简单、开箱即用。其<strong>缺点</strong>是目前官方已经<strong>不再更新和维护</strong>，<strong>不支持</strong>最新版本的Node.js。Fis3是一种专注于Web开发的完整解决方案，如果将Grunt、Gulp比作汽车的<strong>发动机</strong>，则可以将Fis3比作一辆完整的<strong>汽车</strong>。</li></ul><p>总结：</p><p><strong>从构建思路来说</strong>：gulp和grunt需要开发者将整个前端构建过程拆分成多个Task，并合理控制所有Task的调用关系； webpack需要开发者找到入口，并需要清楚对于不同的资源应该使用什么Loader做何种解析和加工；FIS3任何文件都可以作为入口</p><p><strong>对于知识背景</strong>：gulp更像后端开发者的思路，需要对于整个流程了如指掌； webpack更倾向于前端开发者的思路。</p><p>参考文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjava_goodstudy%2Farticle%2Fdetails%2F52797499">前端工具简介 fis3,webpack</a></p><p>补充：</p><ol><li>Webpack是一个模块打包器，他可以递归的打包项目中的所有模块，最终生成几个打包后的文件。</li><li>他和其他的工具最大的不同在于他支持<strong>code-splitting、模块化(AMD，ESM，CommonJs)、全局分析。</strong></li></ol><h2 id="有类似webpack的工具么？">有类似webpack的工具么？</h2><p>同样是<strong>基于入口</strong>的打包工具还有以下几个：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2F">webpack</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rollupjs.com%2F">rollup</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.parceljs.cn%2F">parcel</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.cn%2F">vite</a>，<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.snowpack.cn%2F">snowpack</a></p><p>从应用场景上来看：</p><ul><li><code>webpack</code>：适合大型复杂的前端站点构建，尤其是模块化的，单页应用。</li><li><code>rollup</code>：专门针对类库进行打包，它的优点是小巧而专注。因此现在很多我们熟知的库都都使用它进行打包，比如：Vue、React和three.js等。</li><li><code>parcel</code>：零配置，傻瓜式。适用于简单的实验室项目，打包出错很难调试。不支持Tree Shaking。更多优点：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F350601275">传送门</a>。</li><li><code>vite</code>：灵活、复杂度适中，未来趋势。开发期间无需打包，越大型体验感越好。</li><li><code>snowpack</code>与<code>vite</code>类似。</li></ul><p>rollup、vite、snowpack，都是基于ESM，开发期间无需构建，浏览器直用。</p><p><em>参考文章：</em></p><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fbroadview2006%2Farticle%2Fdetails%2F79091719%3Fspm%3D1001.2101.3001.6661.1%26utm_medium%3Ddistribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-79091719-blog-52797499.pc_relevant_multi_platform_whitelistv3%26depth_1-utm_source%3Ddistribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-79091719-blog-52797499.pc_relevant_multi_platform_whitelistv3%26utm_relevant_index%3D1"><em>从Npm Script到Webpack，6种常见的前端构建工具对比</em></a></p><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000014049700"><em>webpack VS parcel</em></a></p><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F350601275"><em>深入对比Webpack、Parcel、Rollup打包工具</em></a></p><h2 id="作为官方推荐的vite，和现在应用最广的webpack的区别？">作为官方推荐的vite，和现在应用最广的webpack的区别？</h2><blockquote><p><strong>需要理解，当下最火，被问到概率大</strong></p></blockquote><blockquote><p><strong>技巧提示</strong>：</p><p>加粗字体连起来，就是浓缩重点～</p></blockquote><p><strong>Webpack</strong> 是一个打包模块化 JavaScript 的工具，在 Webpack 里一切文件皆模块，通过 Loader 转换文件，通过 Plugin 注入钩子，最后输出由多个模块组合成的文件。Webpack 专注于构建模块化项目。</p><p>一切文件：JavaScript、CSS、SCSS、图片、模板，在 Webpack 眼中都是一个个模块，这样的好处是能清晰的描述出各个模块之间的依赖关系，以方便 Webpack 对模块进行组合和打包。 经过 Webpack 的处理，最终会输出浏览器能使用的静态资源。因此<strong>每次编译都需要重新构建</strong>。</p><p><strong>vite</strong>主要遵循的是使用<strong>ESM</strong>(Es modules模块)的规范来执行代码，由于现代浏览器基本上都支持了ESM规范，所以在<strong>开发阶段</strong>并不需要将代码打包编译成es5模块，即可<strong>直接在浏览器上运行</strong>。我们只需要从入口文件出发， 在遇到对应的 <code>import</code> 语句时，将对应的模块加载到浏览器中就可以了。当项目越大，文件越多时，vite的开发时优势越明显。vite<strong>热更新</strong>比webpack，<strong>vite</strong>在HRM方面，当某个模块内容改变时，让<em><strong>浏览器直接重新请求该模块即可，而不是像webpack重新将该模块的所有依赖重新编译</strong></em>。</p><p>Vite的使用简单，只需执行初始化命令，就可以得到一个预设好的开发环境，开箱即获得一堆功能，包括：CSS预处理、html预处理、异步加载、分包、压缩、HMR等。使用<strong>复杂度介于Parcel和Webpack的中间</strong>，只是暴露了极少数的配置项和plugin接口，既不会像Parcel一样配置不灵活，又不会像Webpack一样需要了解庞大的loader、plugin生态，灵活适中、复杂度适中。</p><p>总体来说，Vite在前端构建工具领域上开辟了一条和webpack完全不同的道路，很好地解决了前端开发阶段构建速度慢的问题。</p><p>参考文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_34703156%2Farticle%2Fdetails%2F119735721">Vite介绍和原理解析</a></p><h1>扩展：常见Webpack面试真题</h1><h2 id="前端为何要进行打包和构建？">前端为何要进行打包和构建？</h2><p><strong>代码层面</strong>：</p><ul><li>体积更小（Tree-Shaking、压缩、合并），加载更快</li><li>编译高级语言或语法（TS、ES6+，模块化，SCSS）</li><li>兼容性和错误检查（Polyfill、postcss、eslint）</li></ul><p><strong>研发流程层面</strong>：</p><ul><li>统一、高效的开发环境</li><li>统一的构建流程和产出标准</li><li>集成公司构建规范（提测、上线等）</li></ul><h2 id="module-chunk-bundle区别">module\chunk\bundle区别</h2><ul><li><strong>module</strong>：各个源码文件，webpack中一切皆模块。</li><li><strong>chunk</strong>：在内存中还没有产出的代码块。</li><li><strong>bundle</strong>：每个chunk打包后，都可以产生个bundle文件。</li></ul><h2 id="loader和plugin区别">loader和plugin区别</h2><ul><li>loader模块转换器，如less-&gt;css，举2-3个例子</li><li>plugin扩展插件，如HtmlWebpackPlugin，举2-3个例子</li></ul><blockquote><p><strong>Webpack的loader的加载顺序为什么是从右向左</strong>:</p><ol><li><p>Webpack选择了compose方式（即 函数式编程），而不是pipe的方式。</p></li><li><p>对于loader来说呢，有一个最大的需求——<strong>任意组合</strong>。而使用compose函数就很好的能完成这个需求，我们只需要在loader中的顺序就可以完成这个函数嵌套的需求，让编程更精练、算法更清晰。</p></li></ol></blockquote><h2 id="常见的loader和plugin">常见的loader和plugin</h2><p>挑几个记一下。</p><p>全面完整版：</p><ol><li><p><strong>loader</strong>：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.webpackjs.com%2Floaders%2F">www.webpackjs.com/loaders/</a></p></li><li><p><strong>plugin</strong>：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.webpackjs.com%2Fplugins%2F">www.webpackjs.com/plugins/</a></p></li></ol><h2 id="babel和webpack的区别">babel和webpack的区别</h2><p><strong>Babel.js</strong>是新语法编译工具，<strong>不关心模块化</strong>。</p><p><strong>webpack</strong>是打包构建工具，是多个loader、plugin的集合。你配置什么loader plugin，它就有什么能力。</p><h2 id="bable-polyfill和able-runtime的区别">bable-polyfill和able-runtime的区别</h2><ul><li>babel-polyfill 会污染全局</li><li>babel-runtime不会污染全局</li><li>产出第三方lib要用babel-runtime</li></ul><h2 id="webpack如何实现懒加载">webpack如何实现懒加载</h2><ul><li>import()</li><li>结合Vue React异步组件</li><li>结合Vue-router React-router异步加载路由</li></ul><h2 id="为何Proxy不能被Polyfill">为何Proxy不能被Polyfill?</h2><p>因为没有任何东西，可以模拟它。</p><ul><li>如Class可以用funciton模拟</li><li>如Promse可以用callback来模拟</li><li>但Proxy的功能用Object.defineProperty模拟</li></ul><h2 id="webpack如何优化构建速度？">webpack如何优化构建速度？</h2><h3 id="可用于生产环境">可用于生产环境</h3><ul><li><p>优化babel-loader</p></li><li><p>IgnorePlugin</p></li><li><p>noParse</p><p>多进程：</p></li><li><p>happyPack</p></li><li><p>ParallelUglifyPlugin</p></li></ul><h3 id="不可用于生产环境">不可用于生产环境</h3><ul><li>自动刷新</li><li>热更新</li><li>DIIPlugin</li></ul><h2 id="如何利用webpack来优化前端性能">如何利用webpack来优化前端性能</h2><ol><li><p>提取公共代码。</p></li><li><p>压缩代码。（development和production）</p></li><li><p>使用loader的时候，使用exclude排除node_modules中的文件</p></li><li><p>配置extractTextWebpackPlugin插件</p></li><li><p>使用TreeShaking插件：Tree-shaking 概念最早由Rollup.js 提出，后来在webpack2中被引入进来，但是这个这一特性能够被支持得益于ES6 modules的静态特性。ES6的模块声明相比于传统CommonJS的同步require有着本质区别。这种modules设计保证了依赖关系是提前确定的，使得静态分析成为了可能，与运行时无关。（除那些引用的但却没有使用的代码）</p></li></ol><h2 id="webpack-dev-server和http服务器如nginx有什么区别">webpack-dev-server和http服务器如nginx有什么区别?</h2><ol><li>webpack-dev-server使用内存来存储webpack开发环境下的打包文件</li><li>并且可以使用模块热更新</li><li>他比传统的http服务对开发更加简单高效。</li></ol><h2 id="什么是长缓存？在webpack中如何做到长缓存优化？">什么是长缓存？在webpack中如何做到长缓存优化？</h2><ol><li><p>浏览器在用户访问页面的时候，为了加快加载速度，会对用户访问的静态资源进行存储，但是每一次代码升级或是更新，都需要浏览器去下载新的代码，最方便和简单的更新方式就是引入新的文件名称。</p></li><li><p>在webpack中可以在output纵输出的文件指定chunkhash,并且分离经常更新的代码和框架代码。</p></li><li><p>通过NameModulesPlugin或是HashedModuleIdsPlugin使再次打包文件名不变。</p></li></ol><h2 id="什么是Tree-shaking-CSS可以Tree-shaking吗？">什么是Tree-shaking?CSS可以Tree-shaking吗？</h2><ol><li>Tree-shaking是指在打包中去除那些引入了，但是在代码中没有被用到的那些死代码。</li><li>在webpack中Tree-shaking是通过uglifySPlugin来Tree-shaking JS</li><li>css需要使用Purify-CSS。</li></ol><h2 id="Webpack5和Webpack4的区别有哪些？">Webpack5和Webpack4的区别有哪些？</h2><p><strong>1. Tree Shaking(强大)</strong></p><p>如果我们的项目中引入了loader 包，但是我只用了其中的一个方法。其他没有用到的方法是不是冗余的？此时 tree-shaking 就可以把没有用的那些东西剔除掉，来大大减少最终的bundle体积。</p><p><strong>2. 压缩代码</strong></p><p>内部本身就自带 js 压缩功能，他内置了 terser-webpack-plugin 插件，我们不用再下载安装。</p><p>而且在 mode=“production” 的时候会自动开启 js 压缩功能。</p><p><strong>3. 缓存配置</strong></p><p>webpack5 内部内置了 cache 缓存机制。直接配置即可。</p><p>cache 会在开发模式下被设置成 <code>type: memory</code> ，而且会在生产模式把cache 给禁用掉。</p><p><strong>4. 启动服务的差别</strong></p><ol><li><strong>webpack4 启动服务</strong>: 通过 webpack-dev-server 启动服务</li><li><strong>webpack5 启动服务</strong>: 内置使用 webpack serve 启动，但是他的日志不是很好，所以一般都加都喜欢用 webpack-dev-server 优化。</li></ol><p><strong>5. 打包</strong></p><ul><li>webpack4打包: 即使后续没有使用到num1的函数，依然会将代码打包进去</li><li>webpack5打包: 后续没有使用到num1的函数，不会将代码打包进去</li></ul><p><strong>6. 输出代码</strong></p><ul><li>webpack4只能输出es5的代码</li><li>webpack5新增属性output.ecmaVersion，可以生成ES5和ES6的代码</li></ul><p><strong>7. splitChunk</strong></p><p>webpack4 将超过30kb的文件单独提为一个chunk</p><p>webpack5可以区分是js还是css，可以精确划分</p><hr><blockquote><p>本篇笔记参考<a href="https://juejin.cn/post/7140769906080874504">稀土掘金何逸轩</a>、<a href="https://juejin.cn/post/7072174385225793567">一支鱼</a>，仅供博主学习使用。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;面试官灵魂三连问&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;你用过webpack么，它的原理是什么？&lt;/li&gt;
&lt;li&gt;你还知道些构建工具，各有什么优缺点？&lt;/li&gt;
&lt;li&gt;你在项目中有配置过么，在哪些场景配置过？&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;Webpack介绍&lt;/h1&gt;
&lt;h2 </summary>
      
    
    
    
    <category term="面试宝典✨" scheme="https://blog.cilicili.xyz/categories/%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8%E2%9C%A8/"/>
    
    
    <category term="Webpack" scheme="https://blog.cilicili.xyz/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>【前端】Webpack5入门到原理</title>
    <link href="https://blog.cilicili.xyz/posts/638e1b31.html"/>
    <id>https://blog.cilicili.xyz/posts/638e1b31.html</id>
    <published>2022-09-08T10:56:50.000Z</published>
    <updated>2022-09-09T09:35:41.749Z</updated>
    
    <content type="html"><![CDATA[<h1>基本使用</h1><p><strong><code>Webpack</code> 是一个静态资源打包工具。</strong></p><p>它会以一个或多个文件作为打包的入口，将我们整个项目所有文件编译组合成一个或多个文件输出出去。</p><p>输出的文件就是编译好的文件，就可以在浏览器段运行了。</p><p>我们将 <code>Webpack</code> 输出的文件叫做 <code>bundle</code>。</p><h2 id="功能介绍">功能介绍</h2><p>Webpack 本身功能是有限的:</p><ul><li>开发模式：仅能编译 JS 中的 <code>ES Module</code> 语法</li><li>生产模式：能编译 JS 中的 <code>ES Module</code> 语法，还能压缩 JS 代码</li></ul><h2 id="开始使用">开始使用</h2><h3 id="资源目录">资源目录</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">webpack_code # 项目根目录（所有指令必须在这个目录运行）</span><br><span class="line">    └── src # 项目源码目录</span><br><span class="line">        ├── js # js文件目录</span><br><span class="line">        │   ├── count.js</span><br><span class="line">        │   └── sum.js</span><br><span class="line">        └── main.js # 项目主文件</span><br></pre></td></tr></table></figure><h3 id="创建文件">创建文件</h3><ul><li>count.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">count</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x - y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>sum.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">p, c</span>) =&gt;</span> p + c, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><h3 id="下载依赖">下载依赖</h3><p>打开终端，来到项目根目录。运行以下指令：</p><ul><li>初始化<code>package.json</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><p>此时会生成一个基础的 <code>package.json</code> 文件。</p><p><strong>需要注意的是 <code>package.json</code> 中 <code>name</code> 字段不能叫做 <code>webpack</code>, 否则下一步会报错</strong></p><ul><li>下载依赖</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli -D</span><br></pre></td></tr></table></figure><h3 id="启用-Webpack">启用 Webpack</h3><ul><li>开发模式</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=development</span><br></pre></td></tr></table></figure><ul><li>生产模式</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=production</span><br></pre></td></tr></table></figure><p><code>npx webpack</code>: 是用来运行本地安装 <code>Webpack</code> 包的。</p><p><code>./src/main.js</code>: 指定 <code>Webpack</code> 从 <code>main.js</code> 文件开始打包，不但会打包 <code>main.js</code>，还会将其依赖也一起打包进来。</p><p><code>--mode=xxx</code>：指定模式（环境）。</p><h3 id="观察输出文件">观察输出文件</h3><p>默认 <code>Webpack</code> 会将文件打包输出到 <code>dist</code> 目录下，我们查看 <code>dist</code> 目录下文件情况就好了</p><h2 id="小结">小结</h2><p><code>Webpack</code> 本身功能比较少，只能处理 <code>js</code> 资源，一旦遇到 <code>css</code> 等其他资源就会报错。</p><p>所以我们学习 <code>Webpack</code>，就是主要学习如何处理其他资源。</p><h1>基本配置</h1><p>在开始使用 <code>Webpack</code> 之前，我们需要对 <code>Webpack</code> 的配置有一定的认识。</p><h2 id="5-大核心概念">5 大核心概念</h2><ol><li><p><strong>entry（入口）</strong></p><p>指示 Webpack 从哪个文件开始打包</p></li><li><p><strong>output（输出）</strong></p><p>指示 Webpack 打包完的文件输出到哪里去，如何命名等</p></li><li><p><strong>loader（加载器）</strong></p><p>webpack 本身只能处理 js、json 等资源，其他资源需要借助 loader，Webpack 才能解析</p></li><li><p><strong>plugins（插件）</strong></p><p>扩展 Webpack 的功能</p></li><li><p><strong>mode（模式）</strong></p><p>主要由两种模式：</p><ul><li><strong>开发模式：development</strong></li><li><strong>生产模式：production</strong></li></ul></li></ol><h2 id="准备-Webpack-配置文件">准备 Webpack 配置文件</h2><p>在项目根目录下新建文件：<code>webpack.config.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 加载器</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Webpack 是基于 Node.js 运行的，所以采用 Common.js 模块化规范</p><h2 id="修改配置文件">修改配置文件</h2><ol><li>配置文件</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js的核心模块，专门用来处理文件路径</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="comment">// 相对路径和绝对路径都行</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// path: 文件输出目录，必须是绝对路径</span></span><br><span class="line">    <span class="comment">// path.resolve()方法返回一个绝对路径</span></span><br><span class="line">    <span class="comment">// __dirname 当前文件的文件夹绝对路径</span></span><br><span class="line">    <span class="comment">// &quot;dist&quot;输出目录</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="comment">// filename: 输出文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 加载器</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        <span class="comment">// loader的配置</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">     <span class="comment">// plugin的配置</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>, <span class="comment">// 开发模式</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>运行指令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>此时功能和之前一样，也不能处理样式资源</p><h2 id="小结-v2">小结</h2><p>Webpack 将来都通过 <code>webpack.config.js</code> 文件进行配置，来增强 Webpack 的功能</p><p>我们后面会以两个模式来分别搭建 Webpack 的配置，先进行开发模式，再完成生产模式</p><h1>开发模式介绍</h1><p>开发模式顾名思义就是我们开发代码时使用的模式。</p><p>这个模式下我们主要做两件事：</p><ol><li><p>编译代码，使浏览器能识别运行</p><p>开发时我们有样式资源、字体图标、图片资源、html 资源等，webpack 默认都不能处理这些资源，所以我们要加载配置来编译这些资源</p></li><li><p>代码质量检查，树立代码规范</p><p>提前检查代码的一些隐患，让代码运行时能更加健壮。</p><p>提前检查代码规范和格式，统一团队编码风格，让代码更优雅美观。</p></li></ol><h1>处理样式资源</h1><p>本章节我们学习使用 Webpack 如何处理 Css、Less、Sass、Scss、Styl 样式资源</p><h2 id="介绍">介绍</h2><p>Webpack 本身是不能识别样式资源的，所以我们需要借助 Loader 来帮助 Webpack 解析样式资源</p><p>我们找 Loader 都应该去官方文档中找到对应的 Loader，然后使用</p><p>官方文档找不到的话，可以从社区 Github 中搜索查询</p><p><a href="https://webpack.docschina.org/loaders/">Webpack 官方 Loader 文档</a></p><h2 id="处理-Css-资源">处理 Css 资源</h2><h3 id="下载包">下载包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i css-loader style-loader -D</span><br></pre></td></tr></table></figure><p>注意：需要下载两个 loader</p><h3 id="功能介绍-v2">功能介绍</h3><ul><li><code>css-loader</code>：负责将 Css 文件编译成 Webpack 能识别的模块</li><li><code>style-loader</code>：会动态创建一个 Style 标签，里面放置 Webpack 中 Css 模块内容</li></ul><p>此时样式就会以 Style 标签的形式在页面上生效</p><h3 id="配置">配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件，\是转义符</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左,从下到上</span></span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">            <span class="string">&quot;style-loader&quot;</span>,<span class="comment">// 将js中css通过创建style标签添加html文件中生效</span></span><br><span class="line">            <span class="string">&quot;css-loader&quot;</span>, <span class="comment">// 将css资源编译成commonjs的模块到js中</span></span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="添加-Css-资源">添加 Css 资源</h3><ul><li>src/css/index.css</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>src/main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入 Css 资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><ul><li>public/index.html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Webpack5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 准备一个使用样式的 DOM 容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入打包后的js文件，才能看到效果 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="运行指令">运行指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开 index.html 页面查看效果</p><h2 id="处理-Less-资源">处理 Less 资源</h2><h3 id="下载包-v2">下载包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i less-loader -D</span><br></pre></td></tr></table></figure><h3 id="功能介绍-v3">功能介绍</h3><ul><li><code>less-loader</code>：负责将 Less 文件编译成 Css 文件</li></ul><h3 id="配置-v2">配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="添加-Less-资源">添加 Less 资源</h3><ul><li>src/less/index.less</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: deeppink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>src/main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><ul><li>public/index.html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Webpack5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="运行指令-v2">运行指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开 index.html 页面查看效果</p><h2 id="处理-Sass-和-Scss-资源">处理 Sass 和 Scss 资源</h2><h3 id="下载包-v3">下载包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i sass-loader sass -D</span><br></pre></td></tr></table></figure><p>注意：需要下载两个</p><h3 id="功能介绍-v4">功能介绍</h3><ul><li><code>sass-loader</code>：负责将 Sass 文件编译成 css 文件</li><li><code>sass</code>：<code>sass-loader</code> 依赖 <code>sass</code> 进行编译</li></ul><h3 id="配置-v3">配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="添加-Sass-资源">添加 Sass 资源</h3><ul><li>src/sass/index.sass</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 可以省略大括号和分号 */</span></span><br><span class="line"><span class="selector-class">.box3</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span></span><br><span class="line">  height: <span class="number">100px</span></span><br><span class="line">  background-color: hotpink</span><br></pre></td></tr></table></figure><ul><li>src/sass/index.scss</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box4</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lightpink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>src/main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><ul><li>public/index.html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Webpack5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="运行指令-v3">运行指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开 index.html 页面查看效果</p><h2 id="处理-Styl-资源">处理 Styl 资源</h2><h3 id="下载包-v4">下载包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i stylus-loader -D</span><br></pre></td></tr></table></figure><h3 id="功能介绍-v5">功能介绍</h3><ul><li><code>stylus-loader</code>：负责将 Styl 文件编译成 Css 文件</li></ul><h3 id="配置-v4">配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="添加-Styl-资源">添加 Styl 资源</h3><ul><li>src/styl/index.styl</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 可以省略大括号、分号、冒号 */</span></span><br><span class="line"><span class="selector-class">.box</span> </span><br><span class="line">  <span class="attribute">width</span> <span class="number">100px</span> </span><br><span class="line">  <span class="attribute">height</span> <span class="number">100px</span> </span><br><span class="line">  <span class="attribute">background-color</span> pink</span><br></pre></td></tr></table></figure><ul><li>src/main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&quot;./math&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><ul><li>public/index.html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Webpack5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 准备一个使用样式的 DOM 容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="运行指令-v4">运行指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开 index.html 页面查看效果</p><h1>处理图片资源</h1><p>过去在 Webpack4 时，我们处理图片资源通过 <code>file-loader</code> 和 <code>url-loader</code> 进行处理</p><p>现在 Webpack5 已经将两个 Loader 功能内置到 Webpack 里了，我们只需要简单配置即可处理图片资源</p><h2 id="配置-v5">配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="添加图片资源">添加图片资源</h2><ul><li>src/images/1.jpeg</li><li>src/images/2.png</li><li>src/images/3.gif</li></ul><h2 id="使用图片资源">使用图片资源</h2><ul><li>src/less/index.less</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;../images/1.jpeg&quot;</span>);</span><br><span class="line">  <span class="attribute">background-size</span>: cover;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>src/sass/index.sass</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box3</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span></span><br><span class="line">  height: <span class="number">100px</span></span><br><span class="line">  background-image: <span class="built_in">url</span>(<span class="string">&quot;../images/2.png&quot;</span>)</span><br><span class="line">  background-size: cover</span><br></pre></td></tr></table></figure><ul><li>src/styl/index.styl</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box5</span></span><br><span class="line">  <span class="attribute">width</span> <span class="number">100px</span></span><br><span class="line">  <span class="attribute">height</span> <span class="number">100px</span></span><br><span class="line">  <span class="attribute">background-image</span> url(&quot;../images/<span class="number">3</span><span class="selector-class">.gif</span>&quot;)</span><br><span class="line">  <span class="attribute">background-size</span> cover</span><br></pre></td></tr></table></figure><h2 id="运行指令-v5">运行指令</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开 index.html 页面查看效果</p><h2 id="输出资源情况">输出资源情况</h2><p>此时如果查看 dist 目录的话，会发现多了三张图片资源</p><p>因为 Webpack 会将所有打包好的资源输出到 dist 目录下</p><ul><li>为什么样式资源没有呢？</li></ul><p>因为经过 <code>style-loader</code> 的处理，样式资源打包到 main.js 里面去了，所以没有额外输出出来</p><h2 id="对图片资源进行优化">对图片资源进行优化</h2><p>将小于某个大小的图片转化成 data URI 形式（Base64 格式）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>优点：减少请求数量</li><li>缺点：体积变得更大</li></ul><p>此时输出的图片文件就只有两张，有一张图片以 data URI 形式内置到 js 中了 （注意：需要将上次打包生成的文件清空，再重新打包才有效果）</p><h1>修改输出资源的名称和路径</h1><h2 id="配置-v6">配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="修改-index-html">修改 index.html</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Webpack5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 修改 js 资源路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/static/js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="运行指令-v6">运行指令</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><ul><li>此时输出文件目录：</li></ul><p>（注意：需要将上次打包生成的文件清空，再重新打包才有效果）</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── dist</span><br><span class="line">    └── static</span><br><span class="line">         ├── imgs</span><br><span class="line">         │    └── 7003350e.png</span><br><span class="line">         └── js</span><br><span class="line">              └── main.js</span><br></pre></td></tr></table></figure><h1>自动清空上次打包资源</h1><h2 id="配置-v7">配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>,</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">40</span> * <span class="number">1024</span>, <span class="comment">// 小于40kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="运行指令-v7">运行指令</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>观察 dist 目录资源情况</p><h1>处理字体图标资源</h1><h2 id="下载字体图标文件">下载字体图标文件</h2><ol><li>打开<a href="https://www.iconfont.cn/">阿里巴巴矢量图标库</a></li><li>选择想要的图标添加到购物车，统一下载到本地</li></ol><h2 id="添加字体图标资源">添加字体图标资源</h2><ul><li>src/fonts/iconfont.ttf</li><li>src/fonts/iconfont.woff</li><li>src/fonts/iconfont.woff2</li><li>src/css/iconfont.css<ul><li>注意字体文件路径需要修改</li></ul></li><li>src/main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&quot;./math&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><ul><li>public/index.html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Webpack5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用字体图标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-arrow-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-ashbin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-browse&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/static/js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="配置-v8">配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>type: &quot;asset/resource&quot;</code>和<code>type: &quot;asset&quot;</code>的区别：</p><ol><li><code>type: &quot;asset/resource&quot;</code> 相当于<code>file-loader</code>, 将文件转化成 Webpack 能识别的资源，其他不做处理</li><li><code>type: &quot;asset&quot;</code> 相当于<code>url-loader</code>, 将文件转化成 Webpack 能识别的资源，同时小于某个大小的资源会处理成 data URI 形式</li></ol><h2 id="运行指令-v8">运行指令</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开 index.html 页面查看效果</p><h1>处理其他资源</h1><p>开发中可能还存在一些其他资源，如音视频等，我们也一起处理了</p><h2 id="配置-v9">配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?|map4|map3|avi)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>就是在处理字体图标资源基础上增加其他文件类型，统一处理即可</p><h2 id="运行指令-v9">运行指令</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开 index.html 页面查看效果</p><h1>处理 js 资源</h1><p>有人可能会问，js 资源 Webpack 不能已经处理了吗，为什么我们还要处理呢？</p><p>原因是 Webpack 对 js 处理是有限的，只能编译 js 中 ES 模块化语法，不能编译其他语法，导致 js 不能在 IE 等浏览器运行，所以我们希望做一些兼容性处理。</p><p>其次开发中，团队对代码格式是有严格要求的，我们不能由肉眼去检测代码格式，需要使用专业的工具来检测。</p><ul><li>针对 js 兼容性处理，我们使用 Babel 来完成</li><li>针对代码格式，我们使用 Eslint 来完成</li></ul><p>我们先完成 Eslint，检测代码格式无误后，在由 Babel 做代码兼容性处理</p><h2 id="Eslint">Eslint</h2><p>可组装的 JavaScript 和 JSX 检查工具。</p><p>这句话意思就是：它是用来检测 js 和 jsx 语法的工具，可以配置各项功能</p><p>我们使用 Eslint，关键是写 Eslint 配置文件，里面写上各种 rules 规则，将来运行 Eslint 时就会以写的规则对代码进行检查</p><h3 id="配置文件">配置文件</h3><p>配置文件由很多种写法：</p><ul><li><code>.eslintrc.*</code>：新建文件，位于项目根目录<ul><li><code>.eslintrc</code></li><li><code>.eslintrc.js</code></li><li><code>.eslintrc.json</code></li><li>区别在于配置格式不一样</li></ul></li><li><code>package.json</code> 中 <code>eslintConfig</code>：不需要创建文件，在原有文件基础上写</li></ul><p>ESLint 会查找和自动读取它们，所以以上配置文件只需要存在一个即可</p><h3 id="具体配置">具体配置</h3><p>我们以 <code>.eslintrc.js</code> 配置文件为例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 解析选项</span></span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 具体检查规则</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 继承其他规则</span></span><br><span class="line">  <span class="attr">extends</span>: [],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// 其他规则详见：https://eslint.bootcss.com/docs/user-guide/configuring</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol><li>parserOptions 解析选项</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">parserOptions</span>: &#123;</span><br><span class="line">  <span class="attr">ecmaVersion</span>: <span class="number">6</span>, <span class="comment">// ES 语法版本</span></span><br><span class="line">  <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>, <span class="comment">// ES 模块化</span></span><br><span class="line">  <span class="attr">ecmaFeatures</span>: &#123; <span class="comment">// ES 其他特性</span></span><br><span class="line">    <span class="attr">jsx</span>: <span class="literal">true</span> <span class="comment">// 如果是 React 项目，就需要开启 jsx 语法</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>rules 具体规则</li></ol><ul><li><code>&quot;off&quot;</code> 或 <code>0</code> - 关闭规则</li><li><code>&quot;warn&quot;</code> 或 <code>1</code> - 开启规则，使用警告级别的错误：<code>warn</code> (不会导致程序退出)</li><li><code>&quot;error&quot;</code> 或 <code>2</code> - 开启规则，使用错误级别的错误：<code>error</code> (当被触发的时候，程序会退出)</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: &#123;</span><br><span class="line">  <span class="attr">semi</span>: <span class="string">&quot;error&quot;</span>, <span class="comment">// 禁止使用分号</span></span><br><span class="line">  <span class="string">&#x27;array-callback-return&#x27;</span>: <span class="string">&#x27;warn&#x27;</span>, <span class="comment">// 强制数组方法的回调函数中有 return 语句，否则警告</span></span><br><span class="line">  <span class="string">&#x27;default-case&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;warn&#x27;</span>, <span class="comment">// 要求 switch 语句中有 default 分支，否则警告</span></span><br><span class="line">    &#123; <span class="attr">commentPattern</span>: <span class="string">&#x27;^no default$&#x27;</span> &#125; <span class="comment">// 允许在最后注释 no default, 就不会有警告了</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">eqeqeq</span>: [</span><br><span class="line">    <span class="string">&#x27;warn&#x27;</span>, <span class="comment">// 强制使用 === 和 !==，否则警告</span></span><br><span class="line">    <span class="string">&#x27;smart&#x27;</span> <span class="comment">// https://eslint.bootcss.com/docs/rules/eqeqeq#smart 除了少数情况下不会有警告</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更多规则详见：<a href="https://eslint.bootcss.com/docs/rules/">规则文档</a></p><ol start="3"><li>extends 继承</li></ol><p>开发中一点点写 rules 规则太费劲了，所以有更好的办法，继承现有的规则。</p><p>现有以下较为有名的规则：</p><ul><li><a href="https://eslint.bootcss.com/docs/rules/">Eslint 官方的规则</a>：<code>eslint:recommended</code></li><li><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-plugin-eslint">Vue Cli 官方的规则</a>：<code>plugin:vue/essential</code></li><li><a href="https://github.com/facebook/create-react-app/tree/main/packages/eslint-config-react-app">React Cli 官方的规则</a>：<code>react-app</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如在React项目中，我们可以这样写配置</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&quot;react-app&quot;</span>],</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="comment">// 我们的规则会覆盖掉react-app的规则</span></span><br><span class="line">    <span class="comment">// 所以想要修改规则直接改就是了</span></span><br><span class="line">    <span class="attr">eqeqeq</span>: [<span class="string">&quot;warn&quot;</span>, <span class="string">&quot;smart&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="在-Webpack-中使用">在 Webpack 中使用</h3><ol><li>下载包</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint-webpack-plugin eslint -D</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 Eslint 配置文件</li></ol><ul><li>.eslintrc.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 继承 Eslint 规则</span></span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&quot;eslint:recommended&quot;</span>],</span><br><span class="line">  <span class="attr">env</span>: &#123;<span class="comment">// 环境变量</span></span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span>, <span class="comment">// 启用node中全局变量</span></span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>, <span class="comment">// 启用浏览器中全局变量</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="number">6</span>,<span class="comment">// es6</span></span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>,  <span class="comment">// es 模块化</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&quot;no-var&quot;</span>: <span class="number">2</span>, <span class="comment">// 不能使用 var 定义变量</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>修改 js 文件代码</li></ol><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">var</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br></pre></td></tr></table></figure><ol start="4"><li>配置</li></ol><ul><li>webpack.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="5"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>在控制台查看 Eslint 检查效果</p><h3 id="VSCode-Eslint-插件">VSCode Eslint 插件</h3><p>打开 VSCode，下载 Eslint 插件，即可不用编译就能看到错误，可以提前解决</p><p>但是此时就会对项目所有文件默认进行 Eslint 检查了，我们 dist 目录下的打包后文件就会报错。但是我们只需要检查 src 下面的文件，不需要检查 dist 下面的文件。</p><p>所以可以使用 Eslint 忽略文件解决。在项目根目录新建下面文件:</p><ul><li><code>.eslintignore</code></li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 忽略dist目录下所有文件</span><br><span class="line">dist</span><br></pre></td></tr></table></figure><h2 id="Babel">Babel</h2><p>JavaScript 编译器。</p><p>主要用于将 ES6 语法编写的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中</p><h3 id="配置文件-v2">配置文件</h3><p>配置文件由很多种写法：</p><ul><li><p><code>babel.config.*</code>：新建文件，位于项目根目录</p><ul><li><code>babel.config.js</code></li><li><code>babel.config.json</code></li></ul></li><li><p><code>.babelrc.*</code>：新建文件，位于项目根目录</p><ul><li><code>.babelrc</code></li><li><code>.babelrc.js</code></li><li><code>.babelrc.json</code></li></ul></li><li><p><code>package.json</code> 中 <code>babel</code>：不需要创建文件，在原有文件基础上写</p></li></ul><p>Babel 会查找和自动读取它们，所以以上配置文件只需要存在一个即可</p><h3 id="具体配置-v2">具体配置</h3><p>我们以 <code>babel.config.js</code> 配置文件为例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 预设</span></span><br><span class="line">  <span class="attr">presets</span>: [],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol><li><p>presets 预设</p><p>简单理解：就是一组 Babel 插件, 扩展 Babel 功能</p><ul><li><code>@babel/preset-env</code>: 一个智能预设，允许您使用最新的 JavaScript。</li><li><code>@babel/preset-react</code>：一个用来编译 React jsx 语法的预设</li><li><code>@babel/preset-typescript</code>：一个用来编译 TypeScript 语法的预设</li></ul></li></ol><h3 id="在-Webpack-中使用-v2">在 Webpack 中使用</h3><ol><li><p>下载包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-loader @babel/core @babel/preset-env -D</span><br></pre></td></tr></table></figure></li><li><p>定义 Babel 配置文件</p></li></ol><ul><li>babel.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>修改 js 文件代码</li></ol><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br></pre></td></tr></table></figure><ol start="4"><li>配置</li></ol><ul><li>webpack.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="5"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>打开打包后的 <code>dist/static/js/main.js</code> 文件查看，会发现箭头函数等 ES6 语法已经转换了</p><h1>处理 Html 资源</h1><h2 id="下载包-v5">下载包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i html-webpack-plugin -D</span><br></pre></td></tr></table></figure><h2 id="配置-v10">配置</h2><ul><li>webpack.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="修改-index-html-v2">修改 index.html</h2><p>去掉引入的 js 文件，因为 HtmlWebpackPlugin 会自动引入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Webpack5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-arrow-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-ashbin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-browse&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="运行指令-v10">运行指令</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>此时 dist 目录就会输出一个 index.html 文件</p><h1>开发服务器&amp;自动化</h1><p>每次写完代码都需要手动输入指令才能编译代码，太麻烦了，我们希望一切自动化</p><h2 id="下载包-v6">下载包</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-dev-server -D</span><br></pre></td></tr></table></figure><h2 id="配置-v11">配置</h2><ul><li>webpack.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 开发服务器: 不会输出资源，在内存中编译打包</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="运行指令-v11">运行指令</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack serve</span><br></pre></td></tr></table></figure><p><strong>注意运行指令发生了变化</strong></p><p>并且当你使用开发服务器时，所有代码都会在内存中编译打包，并不会输出到 dist 目录下。</p><p>开发时我们只关心代码能运行，有效果即可，至于代码被编译成什么样子，我们并不需要知道。</p><h1>生产模式介绍</h1><p>生产模式是开发完成代码后，我们需要得到代码将来部署上线。</p><p>这个模式下我们主要对代码进行优化，让其运行性能更好。</p><p>优化主要从两个角度出发:</p><ol><li>优化代码运行性能</li><li>优化代码打包速度</li></ol><h2 id="生产模式准备">生产模式准备</h2><p>我们分别准备两个配置文件来放不同的配置</p><h3 id="文件目录">文件目录</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">├── webpack-test (项目根目录)</span><br><span class="line">    ├── config (Webpack配置文件目录)</span><br><span class="line">    │    ├── webpack.dev.js(开发模式配置文件)</span><br><span class="line">    │    └── webpack.prod.js(生产模式配置文件)</span><br><span class="line">    ├── node_modules (下载包存放目录)</span><br><span class="line">    ├── src (项目源码目录，除了html其他都在src里面)</span><br><span class="line">    │    └── 略</span><br><span class="line">    ├── public (项目html文件)</span><br><span class="line">    │    └── index.html</span><br><span class="line">    ├── .eslintrc.js(Eslint配置文件)</span><br><span class="line">    ├── babel.config.js(Babel配置文件)</span><br><span class="line">    └── package.json (包的依赖管理配置文件)</span><br></pre></td></tr></table></figure><h3 id="修改-webpack-dev-js">修改 webpack.dev.js</h3><p>因为文件目录变了，所以所有绝对路径需要回退一层目录才能找到对应的文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="literal">undefined</span>, <span class="comment">// 开发模式没有输出，不需要指定输出目录</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="comment">// clean: true, // 开发模式没有输出，不需要清空输出结果</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>运行开发模式的指令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack serve --config ./config/webpack.dev.js</span><br></pre></td></tr></table></figure><h3 id="修改-webpack-prod-js">修改 webpack.prod.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>运行生产模式的指令：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --config ./config/webpack.prod.js</span><br></pre></td></tr></table></figure><h3 id="配置运行指令">配置运行指令</h3><p>为了方便运行不同模式的指令，我们将指令定义在 package.json 中 scripts 里面</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npx webpack serve --config ./config/webpack.dev.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npx webpack --config ./config/webpack.prod.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>以后启动指令：</p><ul><li>开发模式：<code>npm start</code> 或 <code>npm run dev</code></li><li>生产模式：<code>npm run build</code></li></ul><h1>Css 处理</h1><h2 id="提取-Css-成单独文件">提取 Css 成单独文件</h2><p>Css 文件目前被打包到 js 文件中，当 js 文件加载时，会创建一个 style 标签来生成样式</p><p>这样对于网站来说，会出现闪屏现象，用户体验不好</p><p>我们应该是单独的 Css 文件，通过 link 标签加载性能才好</p><h3 id="下载包-v7">下载包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure><h3 id="配置-v12">配置</h3><ul><li>webpack.prod.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="运行指令-v12">运行指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><h2 id="Css-兼容性处理">Css 兼容性处理</h2><h3 id="下载包-v8">下载包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i postcss-loader postcss postcss-preset-env -D</span><br></pre></td></tr></table></figure><h3 id="配置-v13">配置</h3><ul><li>webpack.prod.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                  <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                  <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;less-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                  <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;sass-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                  <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;stylus-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="控制兼容性">控制兼容性</h3><p>我们可以在 <code>package.json</code> 文件中添加 <code>browserslist</code> 来控制样式的兼容性做到什么程度。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  <span class="attr">&quot;browserslist&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ie &gt;= 8&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>想要知道更多的 <code>browserslist</code> 配置，查看<a href="https://github.com/browserslist/browserslist">browserslist 文档</a></p><p>以上为了测试兼容性所以设置兼容浏览器 ie8 以上。</p><p>实际开发中我们一般不考虑旧版本浏览器了，所以我们可以这样设置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  <span class="attr">&quot;browserslist&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;last 2 version&quot;</span><span class="punctuation">,</span>  <span class="comment">// 最近的两个版本</span></span><br><span class="line">      <span class="string">&quot;&gt; 1%&quot;</span><span class="punctuation">,</span> <span class="comment">// 覆盖99%的浏览器</span></span><br><span class="line">      <span class="string">&quot;not dead&quot;</span> <span class="comment">// 死的</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="合并配置">合并配置</h3><ul><li>webpack.prod.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="运行指令-v13">运行指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><h2 id="Css-压缩">Css 压缩</h2><h3 id="下载包-v9">下载包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i css-minimizer-webpack-plugin -D</span><br></pre></td></tr></table></figure><h3 id="配置-v14">配置</h3><ul><li>webpack.prod.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">          <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">          <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">          <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">          <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="运行指令-v14">运行指令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><h1>html 压缩</h1><p>默认生产模式已经开启了：html 压缩和 js 压缩</p><p>不需要额外进行配置</p><h1>总结</h1><p>我们学会了 Webpack 基本使用，掌握了以下功能：</p><ol><li><p>两种开发模式</p><ul><li>开发模式：代码能编译自动化运行</li><li>生产模式：代码编译优化输出</li></ul></li><li><p>Webpack 基本功能</p><ul><li>开发模式：可以编译 ES Module 语法</li><li>生产模式：可以编译 ES Module 语法，压缩 js 代码</li></ul></li><li><p>Webpack 配置文件</p><ul><li>5 个核心概念<ul><li>entry</li><li>output</li><li>loader</li><li>plugins</li><li>mode</li></ul></li><li>devServer 配置</li></ul></li><li><p>Webpack 脚本指令用法</p><ul><li><code>webpack</code> 直接打包输出</li><li><code>webpack serve</code> 启动开发服务器，内存编译打包没有输出</li></ul></li></ol><hr><h1>Webpack5高级优化</h1><h2 id="介绍-v2">介绍</h2><p>主要介绍 Webpack 高级配置。</p><p>所谓高级配置其实就是进行 Webpack 优化，让我们代码在编译/运行时性能更好~</p><p>我们会从以下角度来进行优化：</p><ol><li>提升开发体验</li><li>提升打包构建速度</li><li>减少代码体积</li><li>优化代码运行性能</li></ol><h1>提升开发体验</h1><h2 id="SourceMap">SourceMap</h2><h3 id="为什么">为什么</h3><p>开发时我们运行的代码是经过 webpack 编译后的，例如下面这个样子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ATTENTION: The &quot;eval&quot; devtool has been used (maybe by default in mode: &quot;development&quot;).</span></span><br><span class="line"><span class="comment"> * This devtool is neither made for production nor for readable output files.</span></span><br><span class="line"><span class="comment"> * It uses &quot;eval()&quot; calls to create a separate source file in the browser devtools.</span></span><br><span class="line"><span class="comment"> * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)</span></span><br><span class="line"><span class="comment"> * or disable the default devtool with &quot;devtool: false&quot;.</span></span><br><span class="line"><span class="comment"> * If you are looking for production-ready output files, see mode: &quot;production&quot; (https://webpack.js.org/configuration/mode/).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/******/</span> (<span class="function">() =&gt;</span> &#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span> <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="comment">/******/</span> <span class="keyword">var</span> __webpack_modules__ = (&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> <span class="string">&quot;./node_modules/css-loader/dist/cjs.js!./node_modules/less-loader/dist/cjs.js!./src/less/index.less&quot;</span>:</span><br><span class="line"><span class="comment">/*!**********************************************************************************************************!*\</span></span><br><span class="line"><span class="comment">  !*** ./node_modules/css-loader/dist/cjs.js!./node_modules/less-loader/dist/cjs.js!./src/less/index.less ***!</span></span><br><span class="line"><span class="comment">  \**********************************************************************************************************/</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function">(<span class="params"><span class="variable language_">module</span>, __webpack_exports__, __webpack_require__</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, &#123;\n/* harmony export */   \&quot;default\&quot;: () =&gt; (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ &#125;);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/noSourceMaps.js */ \&quot;./node_modules/css-loader/dist/runtime/noSourceMaps.js\&quot;);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ \&quot;./node_modules/css-loader/dist/runtime/api.js\&quot;);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \&quot;.box2 &#123;\\n  width: 100px;\\n  height: 100px;\\n  background-color: deeppink;\\n&#125;\\n\&quot;, \&quot;\&quot;]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n//# sourceURL=webpack://webpack5/./src/less/index.less?./node_modules/css-loader/dist/cjs.js!./node_modules/less-loader/dist/cjs.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"><span class="comment">// 其他省略</span></span><br></pre></td></tr></table></figure><p>所有 css 和 js 合并成了一个文件，并且多了其他代码。此时如果代码运行出错那么提示代码错误位置我们是看不懂的。一旦将来开发代码文件很多，那么很难去发现错误出现在哪里。</p><p>所以我们需要更加准确的错误提示，来帮助我们更好的开发代码。</p><h3 id="是什么">是什么</h3><p>SourceMap（源代码映射）是一个用来生成源代码与构建后代码一一映射的文件的方案。</p><p>它会生成一个 xxx.map 文件，里面包含源代码和构建后代码每一行、每一列的映射关系。当构建后代码出错了，会通过 xxx.map 文件，从构建后代码出错位置找到映射后源代码出错位置，从而让浏览器提示源代码文件出错位置，帮助我们更快的找到错误根源。</p><h3 id="怎么用">怎么用</h3><p>通过查看<a href="https://webpack.docschina.org/configuration/devtool/">Webpack DevTool 文档</a>可知，SourceMap 的值有很多种情况.</p><p>但实际开发时我们只需要关注两种情况即可：</p><ul><li>开发模式：<code>cheap-module-source-map</code><ul><li>优点：打包编译速度快，只包含行映射</li><li>缺点：没有列映射</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>生产模式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source-map</span><br></pre></td></tr></table></figure><ul><li>优点：包含行/列映射</li><li>缺点：打包编译速度更慢</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>提升打包构建速度</h1><h2 id="HotModuleReplacement">HotModuleReplacement</h2><h3 id="为什么-v2">为什么</h3><p>开发时我们修改了其中一个模块代码，Webpack 默认会将所有模块全部重新打包编译，速度很慢。</p><p>所以我们需要做到修改某个模块代码，就只有这个模块代码需要重新打包编译，其他模块不变，这样打包速度就能很快。</p><h3 id="是什么-v2">是什么</h3><p>HotModuleReplacement（HMR/热模块替换）：在程序运行中，替换、添加或删除模块，而无需重新加载整个页面。</p><h3 id="怎么用-v2">怎么用</h3><ol><li>基本配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// 开启HMR功能（只能用于开发环境，生产环境不需要了）</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>此时 css 样式经过 style-loader 处理，已经具备 HMR 功能了。 但是 js 还不行。</p><ol start="2"><li>JS 配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否支持HMR功能</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./js/count.js&quot;</span>, <span class="keyword">function</span> (<span class="params">count</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./js/sum.js&quot;</span>, <span class="keyword">function</span> (<span class="params">sum</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这样写会很麻烦，所以实际开发我们会使用其他 loader 来解决。</p><p>比如：<a href="https://github.com/vuejs/vue-loader">vue-loader</a>, <a href="https://github.com/gaearon/react-hot-loader">react-hot-loader</a>。</p><h2 id="OneOf">OneOf</h2><h3 id="为什么-v3">为什么</h3><p>打包时每个文件都会经过所有 loader 处理，虽然因为 <code>test</code> 正则原因实际没有处理上，但是都要过一遍。比较慢。</p><h3 id="是什么-v3">是什么</h3><p>顾名思义就是只能匹配上一个 loader, 剩下的就不匹配了。</p><h3 id="怎么用-v3">怎么用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="literal">undefined</span>, <span class="comment">// 开发模式没有输出，不需要指定输出目录</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="comment">// clean: true, // 开发模式没有输出，不需要清空输出结果</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">              <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">              <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">              <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">              <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 开发服务器</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// 开启HMR功能</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>生产模式也是如此配置。</p><h2 id="Include-Exclude">Include/Exclude</h2><h3 id="为什么-v4">为什么</h3><p>开发时我们需要使用第三方的库或插件，所有文件都下载到 node_modules 中了。而这些文件是不需要编译可以直接使用的。</p><p>所以我们在对 js 文件处理时，要排除 node_modules 下面的文件。</p><h3 id="是什么-v4">是什么</h3><ul><li>include</li></ul><p>包含，只处理 xxx 文件</p><ul><li>exclude</li></ul><p>排除，除了 xxx 文件以外其他文件都处理</p><h3 id="怎么用-v4">怎么用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="literal">undefined</span>, <span class="comment">// 开发模式没有输出，不需要指定输出目录</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="comment">// clean: true, // 开发模式没有输出，不需要清空输出结果</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">              <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">              <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">              <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">              <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 开发服务器</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// 开启HMR功能</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>生产模式也是如此配置。</p><h2 id="Cache">Cache</h2><h3 id="为什么-v5">为什么</h3><p>每次打包时 js 文件都要经过 Eslint 检查 和 Babel 编译，速度比较慢。</p><p>我们可以缓存之前的 Eslint 检查 和 Babel 编译结果，这样第二次打包时速度就会更快了。</p><h3 id="是什么-v5">是什么</h3><p>对 Eslint 检查 和 Babel 编译结果进行缓存。</p><h3 id="怎么用-v5">怎么用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="literal">undefined</span>, <span class="comment">// 开发模式没有输出，不需要指定输出目录</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="comment">// clean: true, // 开发模式没有输出，不需要清空输出结果</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;stylus-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">              <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">              <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">              <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">              <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">              <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 开发服务器</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// 开启HMR功能</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Thead">Thead</h2><h3 id="为什么-v6">为什么</h3><p>当项目越来越庞大时，打包速度越来越慢，甚至于需要一个下午才能打包出来代码。这个速度是比较慢的。</p><p>我们想要继续提升打包速度，其实就是要提升 js 的打包速度，因为其他文件都比较少。</p><p>而对 js 文件处理主要就是 eslint 、babel、Terser 三个工具，所以我们要提升它们的运行速度。</p><p>我们可以开启多进程同时处理 js 文件，这样速度就比之前的单进程打包更快了。</p><h3 id="是什么-v6">是什么</h3><p>多进程打包：开启电脑的多个进程同时干一件事，速度更快。</p><p><strong>需要注意：请仅在特别耗时的操作中使用，因为每个进程启动就有大约为 600ms 左右开销。</strong></p><h3 id="怎么用-v6">怎么用</h3><p>我们启动进程的数量就是我们 CPU 的核数。</p><ol><li>如何获取 CPU 的核数，因为每个电脑都不一样。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nodejs核心模块，直接使用</span></span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>下载包</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i thread-loader -D</span><br></pre></td></tr></table></figure><ol start="3"><li>使用</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">              <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">              <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">              <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">              <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我们目前打包的内容都很少，所以因为启动进程开销原因，使用多进程打包实际上会显著的让我们打包时间变得很长。</p><h1>减少代码体积</h1><h2 id="Tree-Shaking">Tree Shaking</h2><h3 id="为什么-v7">为什么</h3><p>开发时我们定义了一些工具函数库，或者引用第三方工具函数库或组件库。</p><p>如果没有特殊处理的话我们打包时会引入整个库，但是实际上可能我们可能只用上极小部分的功能。</p><p>这样将整个库都打包进来，体积就太大了。</p><h3 id="是什么-v7">是什么</h3><p><code>Tree Shaking</code> 是一个术语，通常用于描述移除 JavaScript 中的没有使用上的代码。</p><p><strong>注意：它依赖 <code>ES Module</code>。</strong></p><h3 id="怎么用-v7">怎么用</h3><p>Webpack 已经默认开启了这个功能，无需其他配置。</p><h2 id="Babel-v2">Babel</h2><h3 id="为什么-v8">为什么</h3><p>Babel 为编译的每个文件都插入了辅助代码，使代码体积过大！</p><p>Babel 对一些公共方法使用了非常小的辅助代码，比如 <code>_extend</code>。默认情况下会被添加到每一个需要它的文件中。</p><p>你可以将这些辅助代码作为一个独立模块，来避免重复引入。</p><h3 id="是什么-v8">是什么</h3><p><code>@babel/plugin-transform-runtime</code>: 禁用了 Babel 自动对每个文件的 runtime 注入，而是引入 <code>@babel/plugin-transform-runtime</code> 并且使所有辅助代码从这里引用。</p><h3 id="怎么用-v8">怎么用</h3><ol><li>下载包</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/plugin-transform-runtime -D</span><br></pre></td></tr></table></figure><ol start="2"><li>配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">              <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">              <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">              <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">              <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Image-Minimizer">Image Minimizer</h2><h3 id="为什么-v9">为什么</h3><p>开发如果项目中引用了较多图片，那么图片体积会比较大，将来请求速度比较慢。</p><p>我们可以对图片进行压缩，减少图片体积。</p><p><strong>注意：如果项目中图片都是在线链接，那么就不需要了。本地项目静态图片才需要进行压缩。</strong></p><h3 id="是什么-v9">是什么</h3><p><code>image-minimizer-webpack-plugin</code>: 用来压缩图片的插件</p><h3 id="怎么用-v9">怎么用</h3><ol><li>下载包</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i image-minimizer-webpack-plugin imagemin -D</span><br></pre></td></tr></table></figure><p>还有剩下包需要下载，有两种模式：</p><ul><li>无损压缩</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo -D</span><br></pre></td></tr></table></figure><ul><li>有损压缩</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imagemin-gifsicle imagemin-mozjpeg imagemin-pngquant imagemin-svgo -D</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://baike.baidu.com/item/%E6%97%A0%E6%8D%9F%E3%80%81%E6%9C%89%E6%8D%9F%E5%8E%8B%E7%BC%A9">有损/无损压缩的区别</a></p></blockquote><ol start="2"><li>配置</li></ol><p>我们以无损压缩配置为例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">              <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">              <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">              <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">              <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 压缩图片</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">minimizer</span>: &#123;</span><br><span class="line">          <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">xmlnsOrder</span>: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>优化代码运行性能</h1><h2 id="Code-Split">Code Split</h2><h3 id="为什么-v10">为什么</h3><p>打包代码时会将所有 js 文件打包到一个文件中，体积太大了。我们如果只要渲染首页，就应该只加载首页的 js 文件，其他文件不应该加载。</p><p>所以我们需要将打包生成的文件进行代码分割，生成多个 js 文件，渲染哪个页面就只加载某个 js 文件，这样加载的资源就少，速度就更快。</p><h3 id="是什么-v10">是什么</h3><p>代码分割（Code Split）主要做了两件事：</p><ol><li>分割文件：将打包生成的文件进行分割，生成多个 js 文件。</li><li>按需加载：需要哪个文件就加载哪个文件。</li></ol><h3 id="怎么用-v10">怎么用</h3><p>代码分割实现方式有不同的方式，为了更加方便体现它们之间的差异，我们会分别创建新的文件来演示</p><h5 id="1-多入口">1. 多入口</h5><ol><li>文件目录</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── public</span><br><span class="line">├── src</span><br><span class="line">|   ├── app.js</span><br><span class="line">|   └── main.js</span><br><span class="line">├── package.json</span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure><ol start="2"><li>下载包</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli html-webpack-plugin -D</span><br></pre></td></tr></table></figure><ol start="3"><li>新建文件</li></ol><p>内容无关紧要，主要观察打包输出的结果</p><ul><li>app.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello app&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello main&quot;</span>);</span><br></pre></td></tr></table></figure><ol start="4"><li>配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 单入口</span></span><br><span class="line">  <span class="comment">// entry: &#x27;./src/main.js&#x27;,</span></span><br><span class="line">  <span class="comment">// 多入口</span></span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&quot;./src/app.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    <span class="comment">// [name]是webpack命名规则，使用chunk的name作为输出的文件名。</span></span><br><span class="line">    <span class="comment">// 什么是chunk？打包的资源就是chunk，输出出去叫bundle。</span></span><br><span class="line">    <span class="comment">// chunk的name是啥呢？ 比如： entry中xxx: &quot;./src/xxx.js&quot;, name就是xxx。注意是前面的xxx，和文件名无关。</span></span><br><span class="line">    <span class="comment">// 为什么需要这样命名呢？如果还是之前写法main.js，那么打包生成两个js文件都会叫做main.js会发生覆盖。(实际上会直接报错的)</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/[name].js&quot;</span>,</span><br><span class="line">    <span class="attr">clear</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="5"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>此时在 dist 目录我们能看到输出了两个 js 文件。</p><p>总结：配置了几个入口，至少输出几个 js 文件。</p><h5 id="2-提取重复代码">2. 提取重复代码</h5><p>如果多入口文件中都引用了同一份代码，我们不希望这份代码被打包到两个文件中，导致代码重复，体积更大。</p><p>我们需要提取多入口的重复代码，只打包生成一个 js 文件，其他文件引用它就好。</p><ol><li>修改文件</li></ol><ul><li>app.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&quot;./math&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello app&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&quot;./math&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello main&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure><ul><li>math.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">p, c</span>) =&gt;</span> p + c, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改配置文件</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 单入口</span></span><br><span class="line">  <span class="comment">// entry: &#x27;./src/main.js&#x27;,</span></span><br><span class="line">  <span class="comment">// 多入口</span></span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&quot;./src/app.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    <span class="comment">// [name]是webpack命名规则，使用chunk的name作为输出的文件名。</span></span><br><span class="line">    <span class="comment">// 什么是chunk？打包的资源就是chunk，输出出去叫bundle。</span></span><br><span class="line">    <span class="comment">// chunk的name是啥呢？ 比如： entry中xxx: &quot;./src/xxx.js&quot;, name就是xxx。注意是前面的xxx，和文件名无关。</span></span><br><span class="line">    <span class="comment">// 为什么需要这样命名呢？如果还是之前写法main.js，那么打包生成两个js文件都会叫做main.js会发生覆盖。(实际上会直接报错的)</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/[name].js&quot;</span>,</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 以下是默认值</span></span><br><span class="line">      <span class="comment">// minSize: 20000, // 分割代码最小的大小</span></span><br><span class="line">      <span class="comment">// minRemainingSize: 0, // 类似于minSize，最后确保提取的文件大小不能为0</span></span><br><span class="line">      <span class="comment">// minChunks: 1, // 至少被引用的次数，满足条件才会代码分割</span></span><br><span class="line">      <span class="comment">// maxAsyncRequests: 30, // 按需加载时并行加载的文件的最大数量</span></span><br><span class="line">      <span class="comment">// maxInitialRequests: 30, // 入口js文件最大并行请求数量</span></span><br><span class="line">      <span class="comment">// enforceSizeThreshold: 50000, // 超过50kb一定会单独打包（此时会忽略minRemainingSize、maxAsyncRequests、maxInitialRequests）</span></span><br><span class="line">      <span class="comment">// cacheGroups: &#123; // 组，哪些模块要打包到一个组</span></span><br><span class="line">      <span class="comment">//   defaultVendors: &#123; // 组名</span></span><br><span class="line">      <span class="comment">//     test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span></span><br><span class="line">      <span class="comment">//     priority: -10, // 权重（越大越高）</span></span><br><span class="line">      <span class="comment">//     reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span></span><br><span class="line">      <span class="comment">//   &#125;,</span></span><br><span class="line">      <span class="comment">//   default: &#123; // 其他没有写的配置会使用上面的默认值</span></span><br><span class="line">      <span class="comment">//     minChunks: 2, // 这里的minChunks权重更大</span></span><br><span class="line">      <span class="comment">//     priority: -20,</span></span><br><span class="line">      <span class="comment">//     reuseExistingChunk: true,</span></span><br><span class="line">      <span class="comment">//   &#125;,</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="comment">// 修改配置</span></span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="comment">// 组，哪些模块要打包到一个组</span></span><br><span class="line">        <span class="comment">// defaultVendors: &#123; // 组名</span></span><br><span class="line">        <span class="comment">//   test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span></span><br><span class="line">        <span class="comment">//   priority: -10, // 权重（越大越高）</span></span><br><span class="line">        <span class="comment">//   reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span></span><br><span class="line">        <span class="comment">// &#125;,</span></span><br><span class="line">        <span class="attr">default</span>: &#123;</span><br><span class="line">          <span class="comment">// 其他没有写的配置会使用上面的默认值</span></span><br><span class="line">          <span class="attr">minSize</span>: <span class="number">0</span>, <span class="comment">// 我们定义的文件体积太小了，所以要改打包的最小文件体积</span></span><br><span class="line">          <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">priority</span>: -<span class="number">20</span>,</span><br><span class="line">          <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>此时我们会发现生成 3 个 js 文件，其中有一个就是提取的公共模块。</p><h5 id="按需加载，动态导入">按需加载，动态导入</h5><p>想要实现按需加载，动态导入模块。还需要额外配置：</p><ol><li>修改文件</li></ol><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello main&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 动态导入 --&gt; 实现按需加载</span></span><br><span class="line">  <span class="comment">// 即使只被引用了一次，也会代码分割</span></span><br><span class="line">  <span class="title function_">import</span>(<span class="string">&quot;./math.js&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; sum &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>app.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello app&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>public/index.html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Code Split<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello webpack<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>计算<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>我们可以发现，一旦通过 import 动态导入语法导入模块，模块就被代码分割，同时也能按需加载了。</p><h5 id="单入口">单入口</h5><p>开发时我们可能是单页面应用（SPA），只有一个入口（单入口）。那么我们需要这样配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 单入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="comment">// 多入口</span></span><br><span class="line">  <span class="comment">// entry: &#123;</span></span><br><span class="line">  <span class="comment">//   main: &quot;./src/main.js&quot;,</span></span><br><span class="line">  <span class="comment">//   app: &quot;./src/app.js&quot;,</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    <span class="comment">// [name]是webpack命名规则，使用chunk的name作为输出的文件名。</span></span><br><span class="line">    <span class="comment">// 什么是chunk？打包的资源就是chunk，输出出去叫bundle。</span></span><br><span class="line">    <span class="comment">// chunk的name是啥呢？ 比如： entry中xxx: &quot;./src/xxx.js&quot;, name就是xxx。注意是前面的xxx，和文件名无关。</span></span><br><span class="line">    <span class="comment">// 为什么需要这样命名呢？如果还是之前写法main.js，那么打包生成两个js文件都会叫做main.js会发生覆盖。(实际上会直接报错的)</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/[name].js&quot;</span>,</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 以下是默认值</span></span><br><span class="line">      <span class="comment">// minSize: 20000, // 分割代码最小的大小</span></span><br><span class="line">      <span class="comment">// minRemainingSize: 0, // 类似于minSize，最后确保提取的文件大小不能为0</span></span><br><span class="line">      <span class="comment">// minChunks: 1, // 至少被引用的次数，满足条件才会代码分割</span></span><br><span class="line">      <span class="comment">// maxAsyncRequests: 30, // 按需加载时并行加载的文件的最大数量</span></span><br><span class="line">      <span class="comment">// maxInitialRequests: 30, // 入口js文件最大并行请求数量</span></span><br><span class="line">      <span class="comment">// enforceSizeThreshold: 50000, // 超过50kb一定会单独打包（此时会忽略minRemainingSize、maxAsyncRequests、maxInitialRequests）</span></span><br><span class="line">      <span class="comment">// cacheGroups: &#123; // 组，哪些模块要打包到一个组</span></span><br><span class="line">      <span class="comment">//   defaultVendors: &#123; // 组名</span></span><br><span class="line">      <span class="comment">//     test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span></span><br><span class="line">      <span class="comment">//     priority: -10, // 权重（越大越高）</span></span><br><span class="line">      <span class="comment">//     reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span></span><br><span class="line">      <span class="comment">//   &#125;,</span></span><br><span class="line">      <span class="comment">//   default: &#123; // 其他没有写的配置会使用上面的默认值</span></span><br><span class="line">      <span class="comment">//     minChunks: 2, // 这里的minChunks权重更大</span></span><br><span class="line">      <span class="comment">//     priority: -20,</span></span><br><span class="line">      <span class="comment">//     reuseExistingChunk: true,</span></span><br><span class="line">      <span class="comment">//   &#125;,</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h6 id="更新配置">更新配置</h6><p>最终我们会使用单入口+代码分割+动态导入方式来进行配置。更新之前的配置文件。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">              <span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">              <span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">              <span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">              <span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/imgs/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 压缩图片</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">minimizer</span>: &#123;</span><br><span class="line">          <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">xmlnsOrder</span>: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 其他内容用默认配置即可</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="给动态导入文件取名称">给动态导入文件取名称</h5><ol><li>修改文件</li></ol><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下代码生产模式下会删除</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./js/sum.js&quot;</span>, <span class="keyword">function</span> (<span class="params">sum</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>).<span class="property">onClick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// eslint会对动态导入语法报错，需要修改eslint配置文件</span></span><br><span class="line">  <span class="comment">// webpackChunkName: &quot;math&quot;：这是webpack动态导入模块命名的方式</span></span><br><span class="line">  <span class="comment">// &quot;math&quot;将来就会作为[name]的值显示。</span></span><br><span class="line">  <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;math&quot; */</span> <span class="string">&quot;./js/math.js&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; count &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>eslint 配置</li></ol><ul><li>下载包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint-plugin-import -D</span><br></pre></td></tr></table></figure><ul><li>配置</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 继承 Eslint 规则</span></span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&quot;eslint:recommended&quot;</span>],</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span>, <span class="comment">// 启用node中全局变量</span></span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>, <span class="comment">// 启用浏览器中全局变量</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&quot;import&quot;</span>], <span class="comment">// 解决动态导入import语法报错问题 --&gt; 实际使用eslint-plugin-import的规则解决的</span></span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&quot;no-var&quot;</span>: <span class="number">2</span>, <span class="comment">// 不能使用 var 定义变量</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>统一命名配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/[name].js&quot;</span>, <span class="comment">// 入口文件打包输出资源命名方式</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;static/js/[name].chunk.js&quot;</span>, <span class="comment">// 动态导入输出资源命名方式</span></span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&quot;static/media/[name].[hash][ext]&quot;</span>, <span class="comment">// 图片、字体等资源命名方式（注意用hash）</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   // 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">            <span class="comment">//   // 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">            <span class="comment">//   // [hash:8]: hash值取8位</span></span><br><span class="line">            <span class="comment">//   // [ext]: 使用之前的文件扩展名</span></span><br><span class="line">            <span class="comment">//   // [query]: 添加之前的query参数</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/imgs/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/media/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/[name].css&quot;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&quot;static/css/[name].chunk.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 压缩图片</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">minimizer</span>: &#123;</span><br><span class="line">          <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">xmlnsOrder</span>: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 其他内容用默认配置即可</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="4"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><p>观察打包输出 js 文件名称。</p><h2 id="Preload-Prefetch">Preload / Prefetch</h2><h3 id="为什么-v11">为什么</h3><p>我们前面已经做了代码分割，同时会使用 import 动态导入语法来进行代码按需加载（我们也叫懒加载，比如路由懒加载就是这样实现的）。</p><p>但是加载速度还不够好，比如：是用户点击按钮时才加载这个资源的，如果资源体积很大，那么用户会感觉到明显卡顿效果。</p><p>我们想在浏览器空闲时间，加载后续需要使用的资源。我们就需要用上 <code>Preload</code> 或 <code>Prefetch</code> 技术。</p><h3 id="是什么-v11">是什么</h3><ul><li><code>Preload</code>：告诉浏览器立即加载资源。</li><li><code>Prefetch</code>：告诉浏览器在空闲时才开始加载资源。</li></ul><p>它们共同点：</p><ul><li>都只会加载资源，并不执行。</li><li>都有缓存。</li></ul><p>它们区别：</p><ul><li><code>Preload</code>加载优先级高，<code>Prefetch</code>加载优先级低。</li><li><code>Preload</code>只能加载当前页面需要使用的资源，<code>Prefetch</code>可以加载当前页面资源，也可以加载下一个页面需要使用的资源。</li></ul><p>总结：</p><ul><li>当前页面优先级高的资源用 <code>Preload</code> 加载。</li><li>下一个页面需要使用的资源用 <code>Prefetch</code> 加载。</li></ul><p>它们的问题：兼容性较差。</p><ul><li>我们可以去 <a href="https://caniuse.com/">Can I Use</a> 网站查询 API 的兼容性问题。</li><li><code>Preload</code> 相对于 <code>Prefetch</code> 兼容性好一点。</li></ul><h3 id="怎么用-v11">怎么用</h3><ol><li>下载包</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @vue/preload-webpack-plugin -D</span><br></pre></td></tr></table></figure><ol start="2"><li>配置 webpack.prod.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PreloadWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;@vue/preload-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/[name].js&quot;</span>, <span class="comment">// 入口文件打包输出资源命名方式</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;static/js/[name].chunk.js&quot;</span>, <span class="comment">// 动态导入输出资源命名方式</span></span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&quot;static/media/[name].[hash][ext]&quot;</span>, <span class="comment">// 图片、字体等资源命名方式（注意用hash）</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   // 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">            <span class="comment">//   // 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">            <span class="comment">//   // [hash:8]: hash值取8位</span></span><br><span class="line">            <span class="comment">//   // [ext]: 使用之前的文件扩展名</span></span><br><span class="line">            <span class="comment">//   // [query]: 添加之前的query参数</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/imgs/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/media/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/[name].css&quot;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&quot;static/css/[name].chunk.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PreloadWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">rel</span>: <span class="string">&quot;preload&quot;</span>, <span class="comment">// preload兼容性更好</span></span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">      <span class="comment">// rel: &#x27;prefetch&#x27; // prefetch兼容性更差</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 压缩图片</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">minimizer</span>: &#123;</span><br><span class="line">          <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">xmlnsOrder</span>: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 其他内容用默认配置即可</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Network-Cache">Network Cache</h2><h3 id="为什么-v12">为什么</h3><p>将来开发时我们对静态资源会使用缓存来优化，这样浏览器第二次请求资源就能读取缓存了，速度很快。</p><p>但是这样的话就会有一个问题, 因为前后输出的文件名是一样的，都叫 main.js，一旦将来发布新版本，因为文件名没有变化导致浏览器会直接读取缓存，不会加载新资源，项目也就没法更新了。</p><p>所以我们从文件名入手，确保更新前后文件名不一样，这样就可以做缓存了。</p><h3 id="是什么-v12">是什么</h3><p>它们都会生成一个唯一的 hash 值。</p><ul><li><p>fullhash（webpack4 是 hash）</p><p>每次修改任何一个文件，所有文件名的 hash 值都将改变。所以一旦修改了任何一个文件，整个项目的文件缓存都将失效。</p></li><li><p>chunkhash</p><p>根据不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的哈希值。我们 js 和 css 是同一个引入，会共享一个 hash 值。</p></li><li><p>contenthash</p><p>根据文件内容生成 hash 值，只有文件内容变化了，hash 值才会变化。所有文件 hash 值是独享且不同的。</p></li></ul><h3 id="怎么用-v12">怎么用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PreloadWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;@vue/preload-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="comment">// [contenthash:8]使用contenthash，取8位长度</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/[name].[contenthash:8].js&quot;</span>, <span class="comment">// 入口文件打包输出资源命名方式</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;static/js/[name].[contenthash:8].chunk.js&quot;</span>, <span class="comment">// 动态导入输出资源命名方式</span></span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&quot;static/media/[name].[hash][ext]&quot;</span>, <span class="comment">// 图片、字体等资源命名方式（注意用hash）</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   // 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">            <span class="comment">//   // 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">            <span class="comment">//   // [hash:8]: hash值取8位</span></span><br><span class="line">            <span class="comment">//   // [ext]: 使用之前的文件扩展名</span></span><br><span class="line">            <span class="comment">//   // [query]: 添加之前的query参数</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/imgs/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/media/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&quot;static/css/[name].[contenthash:8].chunk.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PreloadWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">rel</span>: <span class="string">&quot;preload&quot;</span>, <span class="comment">// preload兼容性更好</span></span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">      <span class="comment">// rel: &#x27;prefetch&#x27; // prefetch兼容性更差</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 压缩图片</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">minimizer</span>: &#123;</span><br><span class="line">          <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">xmlnsOrder</span>: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 其他内容用默认配置即可</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>问题：</li></ul><p>当我们修改 math.js 文件再重新打包的时候，因为 contenthash 原因，math.js 文件 hash 值发生了变化（这是正常的）。</p><p>但是 main.js 文件的 hash 值也发生了变化，这会导致 main.js 的缓存失效。明明我们只修改 math.js, 为什么 main.js 也会变身变化呢？</p><ul><li>原因：<ul><li>更新前：math.xxx.js, main.js 引用的 math.xxx.js</li><li>更新后：math.yyy.js, main.js 引用的 math.yyy.js, 文件名发生了变化，间接导致 main.js 也发生了变化</li></ul></li><li>解决：</li></ul><p>将 hash 值单独保管在一个 runtime 文件中。</p><p>我们最终输出三个文件：main、math、runtime。当 math 文件发送变化，变化的是 math 和 runtime 文件，main 不变。</p><p>runtime 文件只保存文件的 hash 值和它们与文件关系，整个文件体积就比较小，所以变化重新请求的代价也小。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PreloadWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;@vue/preload-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="comment">// [contenthash:8]使用contenthash，取8位长度</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/[name].[contenthash:8].js&quot;</span>, <span class="comment">// 入口文件打包输出资源命名方式</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;static/js/[name].[contenthash:8].chunk.js&quot;</span>, <span class="comment">// 动态导入输出资源命名方式</span></span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&quot;static/media/[name].[hash][ext]&quot;</span>, <span class="comment">// 图片、字体等资源命名方式（注意用hash）</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   // 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">            <span class="comment">//   // 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">            <span class="comment">//   // [hash:8]: hash值取8位</span></span><br><span class="line">            <span class="comment">//   // [ext]: 使用之前的文件扩展名</span></span><br><span class="line">            <span class="comment">//   // [query]: 添加之前的query参数</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/imgs/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/media/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&quot;static/css/[name].[contenthash:8].chunk.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PreloadWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">rel</span>: <span class="string">&quot;preload&quot;</span>, <span class="comment">// preload兼容性更好</span></span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">      <span class="comment">// rel: &#x27;prefetch&#x27; // prefetch兼容性更差</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 压缩图片</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">minimizer</span>: &#123;</span><br><span class="line">          <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">xmlnsOrder</span>: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 其他内容用默认配置即可</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 提取runtime文件</span></span><br><span class="line">    <span class="attr">runtimeChunk</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="function">(<span class="params">entrypoint</span>) =&gt;</span> <span class="string">`runtime~<span class="subst">$&#123;entrypoint.name&#125;</span>`</span>, <span class="comment">// runtime文件命名规则</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Core-js">Core-js</h2><h3 id="为什么-v13">为什么</h3><p>过去我们使用 babel 对 js 代码进行了兼容性处理，其中使用@babel/preset-env 智能预设来处理兼容性问题。</p><p>它能将 ES6 的一些语法进行编译转换，比如箭头函数、点点点运算符等。但是如果是 async 函数、promise 对象、数组的一些方法（includes）等，它没办法处理。</p><p>所以此时我们 js 代码仍然存在兼容性问题，一旦遇到低版本浏览器会直接报错。所以我们想要将 js 兼容性问题彻底解决</p><h3 id="是什么-v13">是什么</h3><p><code>core-js</code> 是专门用来做 ES6 以及以上 API 的 <code>polyfill</code>。</p><p><code>polyfill</code>翻译过来叫做垫片/补丁。就是用社区上提供的一段代码，让我们在不兼容某些新特性的浏览器上，使用该新特性。</p><h3 id="怎么用-v13">怎么用</h3><ol><li>修改 main.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"><span class="comment">// 添加promise代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello promise&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>此时 Eslint 会对 Promise 报错。</p><ol start="2"><li>修改配置文件</li></ol><ul><li>下载包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/eslint-parser -D</span><br></pre></td></tr></table></figure><ul><li>.eslintrc.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 继承 Eslint 规则</span></span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&quot;eslint:recommended&quot;</span>],</span><br><span class="line">  <span class="attr">parser</span>: <span class="string">&quot;@babel/eslint-parser&quot;</span>, <span class="comment">// 支持最新的最终 ECMAScript 标准</span></span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span>, <span class="comment">// 启用node中全局变量</span></span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>, <span class="comment">// 启用浏览器中全局变量</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&quot;import&quot;</span>], <span class="comment">// 解决动态导入import语法报错问题 --&gt; 实际使用eslint-plugin-import的规则解决的</span></span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="number">6</span>, <span class="comment">// es6</span></span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>, <span class="comment">// es module</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&quot;no-var&quot;</span>: <span class="number">2</span>, <span class="comment">// 不能使用 var 定义变量</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>此时观察打包输出的 js 文件，我们发现 Promise 语法并没有编译转换，所以我们需要使用 <code>core-js</code> 来进行 <code>polyfill</code>。</p><ol start="4"><li>使用<code>core-js</code></li></ol><ul><li>下载包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i core-js</span><br></pre></td></tr></table></figure><ul><li>手动全部引入</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"><span class="comment">// 添加promise代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello promise&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这样引入会将所有兼容性代码全部引入，体积太大了。我们只想引入 promise 的 <code>polyfill</code>。</p><ul><li>手动按需引入</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/es/promise&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"><span class="comment">// 添加promise代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello promise&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>只引入打包 promise 的 <code>polyfill</code>，打包体积更小。但是将来如果还想使用其他语法，我需要手动引入库很麻烦。</p><ul><li><p>自动按需引入</p><ul><li>main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"><span class="comment">// 添加promise代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello promise&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>babel.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 智能预设：能够编译ES6语法</span></span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      <span class="comment">// 按需加载core-js的polyfill</span></span><br><span class="line">      &#123; <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>, <span class="attr">corejs</span>: &#123; <span class="attr">version</span>: <span class="string">&quot;3&quot;</span>, <span class="attr">proposals</span>: <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><p>此时就会自动根据我们代码中使用的语法，来按需加载相应的 <code>polyfill</code> 了。</p><h2 id="PWA">PWA</h2><h3 id="为什么-v14">为什么</h3><p>开发 Web App 项目，项目一旦处于网络离线情况，就没法访问了。</p><p>我们希望给项目提供离线体验。</p><h3 id="是什么-v14">是什么</h3><p>渐进式网络应用程序(progressive web application - PWA)：是一种可以提供类似于 native app(原生应用程序) 体验的 Web App 的技术。</p><p>其中最重要的是，在 <strong>离线(offline)</strong> 时应用程序能够继续运行功能。</p><p>内部通过 Service Workers 技术实现的。</p><h3 id="怎么用-v14">怎么用</h3><ol><li>下载包</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i workbox-webpack-plugin -D</span><br></pre></td></tr></table></figure><ol start="2"><li>修改配置文件</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PreloadWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;@vue/preload-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WorkboxPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;workbox-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="comment">// [contenthash:8]使用contenthash，取8位长度</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/[name].[contenthash:8].js&quot;</span>, <span class="comment">// 入口文件打包输出资源命名方式</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;static/js/[name].[contenthash:8].chunk.js&quot;</span>, <span class="comment">// 动态导入输出资源命名方式</span></span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&quot;static/media/[name].[hash][ext]&quot;</span>, <span class="comment">// 图片、字体等资源命名方式（注意用hash）</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;stylus-loader&quot;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   // 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">            <span class="comment">//   // 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">            <span class="comment">//   // [hash:8]: hash值取8位</span></span><br><span class="line">            <span class="comment">//   // [ext]: 使用之前的文件扩展名</span></span><br><span class="line">            <span class="comment">//   // [query]: 添加之前的query参数</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/imgs/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="comment">// generator: &#123;</span></span><br><span class="line">            <span class="comment">//   filename: &quot;static/media/[hash:8][ext][query]&quot;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                  <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">      <span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取css成单独文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&quot;static/css/[name].[contenthash:8].chunk.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// css压缩</span></span><br><span class="line">    <span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PreloadWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">rel</span>: <span class="string">&quot;preload&quot;</span>, <span class="comment">// preload兼容性更好</span></span><br><span class="line">      <span class="attr">as</span>: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">      <span class="comment">// rel: &#x27;prefetch&#x27; // prefetch兼容性更差</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">WorkboxPlugin</span>.<span class="title class_">GenerateSW</span>(&#123;</span><br><span class="line">      <span class="comment">// 这些选项帮助快速启用 ServiceWorkers</span></span><br><span class="line">      <span class="comment">// 不允许遗留任何“旧的” ServiceWorkers</span></span><br><span class="line">      <span class="attr">clientsClaim</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">skipWaiting</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 压缩图片</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">minimizer</span>: &#123;</span><br><span class="line">          <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminGenerate</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">              [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">plugins</span>: [</span><br><span class="line">                    <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                      <span class="attr">params</span>: &#123;</span><br><span class="line">                        <span class="attr">xmlnsOrder</span>: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">      <span class="comment">// 其他内容用默认配置即可</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// devServer: &#123;</span></span><br><span class="line">  <span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">  <span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">  <span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>修改 main.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"><span class="comment">// 添加promise代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello promise&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.<span class="property">serviceWorker</span></span><br><span class="line">      .<span class="title function_">register</span>(<span class="string">&quot;/service-worker.js&quot;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">registration</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SW registered: &quot;</span>, registration);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">registrationError</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SW registration failed: &quot;</span>, registrationError);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>运行指令</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>此时如果直接通过 VSCode 访问打包后页面，在浏览器控制台会发现 <code>SW registration failed</code>。</p><p>因为我们打开的访问路径是：<code>http://127.0.0.1:5500/dist/index.html</code>。此时页面会去请求 <code>service-worker.js</code> 文件，请求路径是：<code>http://127.0.0.1:5500/service-worker.js</code>，这样找不到会 404。</p><p>实际 <code>service-worker.js</code> 文件路径是：<code>http://127.0.0.1:5500/dist/service-worker.js</code>。</p><ol><li>解决路径问题</li></ol><ul><li>下载包</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i serve -g</span><br></pre></td></tr></table></figure><p>serve 也是用来启动开发服务器来部署代码查看效果的。</p><ul><li>运行指令</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serve dist</span><br></pre></td></tr></table></figure><p>此时通过 serve 启动的服务器我们 service-worker 就能注册成功了。</p><ol start="2"><li>打包时会出现报错：</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error: Error with &#x27;src\images\1.jpeg&#x27;: &#x27;&quot;C:\Users\86176\Desktop\webpack\webpack_code\node_modules\jpegtran-bin\vendor\jpegtran.exe&quot;&#x27;</span><br><span class="line">Error with &#x27;src\images\3.gif&#x27;: spawn C:\Users\86176\Desktop\webpack\webpack_code\node_modules\optipng-bin\vendor\optipng.exe ENOENT</span><br></pre></td></tr></table></figure><p>我们需要安装两个文件到 node_modules 中才能解决, 文件可以从课件中找到：</p><ul><li>jpegtran.exe</li></ul><p>需要复制到 <code>node_modules\jpegtran-bin\vendor</code> 下面</p><blockquote><p><a href="http://jpegclub.org/jpegtran/">jpegtran 官网地址</a></p></blockquote><ul><li>optipng.exe</li></ul><p>需要复制到 <code>node_modules\optipng-bin\vendor</code> 下面</p><blockquote><p><a href="http://optipng.sourceforge.net/">OptiPNG 官网地址</a></p></blockquote><h1>总结</h1><p>我们从 4 个角度对 webpack 和代码进行了优化：</p><ol><li><p>提升开发体验</p><ul><li>使用 <code>Source Map</code> 让开发或上线时代码报错能有更加准确的错误提示。</li></ul></li><li><p>提升 webpack 提升打包构建速度</p><ul><li>使用 <code>HotModuleReplacement</code> 让开发时只重新编译打包更新变化了的代码，不变的代码使用缓存，从而使更新速度更快。</li><li>使用 <code>OneOf</code> 让资源文件一旦被某个 loader 处理了，就不会继续遍历了，打包速度更快。</li><li>使用 <code>Include/Exclude</code> 排除或只检测某些文件，处理的文件更少，速度更快。</li><li>使用 <code>Cache</code> 对 eslint 和 babel 处理的结果进行缓存，让第二次打包速度更快。</li><li>使用 <code>Thead</code> 多进程处理 eslint 和 babel 任务，速度更快。（需要注意的是，进程启动通信都有开销的，要在比较多代码处理时使用才有效果）</li></ul></li><li><p>减少代码体积</p><ul><li>使用 <code>Tree Shaking</code> 剔除了没有使用的多余代码，让代码体积更小。</li><li>使用 <code>@babel/plugin-transform-runtime</code> 插件对 babel 进行处理，让辅助代码从中引入，而不是每个文件都生成辅助代码，从而体积更小。</li><li>使用 <code>Image Minimizer</code> 对项目中图片进行压缩，体积更小，请求速度更快。（需要注意的是，如果项目中图片都是在线链接，那么就不需要了。本地项目静态图片才需要进行压缩。）</li></ul></li><li><p>优化代码运行性能</p><ul><li>使用 <code>Code Split</code> 对代码进行分割成多个 js 文件，从而使单个文件体积更小，并行加载 js 速度更快。并通过 import 动态导入语法进行按需加载，从而达到需要使用时才加载该资源，不用时不加载资源。</li><li>使用 <code>Preload / Prefetch</code> 对代码进行提前加载，等未来需要使用时就能直接使用，从而用户体验更好。</li><li>使用 <code>Network Cache</code> 能对输出资源文件进行更好的命名，将来好做缓存，从而用户体验更好。</li><li>使用 <code>Core-js</code> 对 js 进行兼容性处理，让我们代码能运行在低版本浏览器。</li><li>使用 <code>PWA</code> 能让代码离线也能访问，从而提升用户体验。</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;基本使用&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Webpack&lt;/code&gt; 是一个静态资源打包工具。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;它会以一个或多个文件作为打包的入口，将我们整个项目所有文件编译组合成一个或多个文件输出出去。&lt;/p&gt;
&lt;p&gt;输出的文件就是编译好的</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="Webpack" scheme="https://blog.cilicili.xyz/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>【后端】基于Express的大事件后台API项目</title>
    <link href="https://blog.cilicili.xyz/posts/b9d48db8.html"/>
    <id>https://blog.cilicili.xyz/posts/b9d48db8.html</id>
    <published>2022-09-08T10:16:46.000Z</published>
    <updated>2022-09-09T09:34:52.864Z</updated>
    
    <content type="html"><![CDATA[<h1>大事件后台 API 项目</h1><blockquote><p><a href="https://www.showdoc.cc/escook?page_id=3707158761215217">API 接口文档</a></p></blockquote><h2 id="项目初始化">项目初始化</h2><h3 id="创建项目">创建项目</h3><ol><li>新建 <code>api_server</code> 文件夹作为项目根目录，并在项目根目录中运行如下的命令，初始化包管理配置文件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><ol start="2"><li>运行如下的命令，安装特定版本的 <code>express</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express@4.17.1</span><br></pre></td></tr></table></figure><ol start="3"><li>在项目根目录中新建 <code>app.js</code> 作为整个项目的入口文件，并初始化如下的代码：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// write your code here...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3007</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;api server running at http://127.0.0.1:3007&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="配置-cors-跨域">配置 cors 跨域</h3><ol><li>运行如下的命令，安装 <code>cors</code> 中间件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cors@2.8.5</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并配置 <code>cors</code> 中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br></pre></td></tr></table></figure><h3 id="配置解析表单数据的中间件">配置解析表单数据的中间件</h3><p>通过如下的代码，配置解析 <code>application/x-www-form-urlencoded</code> 格式的表单数据的中间件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br></pre></td></tr></table></figure><h3 id="初始化路由相关的文件夹">初始化路由相关的文件夹</h3><ol><li>在项目根目录中，新建 <code>router</code> 文件夹，用来存放所有的<code>路由</code>模块</li></ol><blockquote><p>路由模块中，只存放客户端的请求与处理函数之间的映射关系</p></blockquote><ol start="2"><li>在项目根目录中，新建 <code>router_handler</code> 文件夹，用来存放所有的 <code>路由处理函数模块</code></li></ol><blockquote><p>路由处理函数模块中，专门负责存放每个路由对应的处理函数</p></blockquote><h3 id="初始化用户路由模块">初始化用户路由模块</h3><ol><li>在 <code>router</code> 文件夹中，新建 <code>user.js</code> 文件，作为用户的路由模块，并初始化代码：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/reguser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;reguser OK&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;login OK&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中，导入注册用户路由模块 ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/user&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, userRouter)</span><br></pre></td></tr></table></figure><h3 id="抽离用户路由模块中的处理函数">抽离用户路由模块中的处理函数</h3><blockquote><p>目的：为了保证 <code>路由模块</code> 的纯粹性，所有的 <code>路由处理函数</code>，必须抽离到对应的 <code>路由处理函数模块</code> 中</p></blockquote><ol><li>在 <code>/router_handler/user.js</code> 中，使用 <code>exports</code> 对象，分别向外共享如下两个 <code>路由处理函数</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在这里定义和用户相关的路由处理函数，供 /router/user.js 模块进行调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">regUser</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;reguser OK&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">login</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;login OK&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>将 <code>/router/user.js</code> 中的代码修改为如下结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userHandler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/reguser&#x27;</span>, userHandler.<span class="property">regUser</span>)</span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, userHandler.<span class="property">login</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><h2 id="登录注册">登录注册</h2><h3 id="新建-ev-users-表">新建 ev_users 表</h3><p>在 <code>test</code> 数据库中，新建 <code>ev_users</code> 表如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/ev_users.77f8cdd3.png" alt="ev_users表结构"></p><h3 id="安装并配置-mysql-模块">安装并配置 mysql 模块</h3><blockquote><p>在 API 接口项目中，需要安装并配置 <code>mysql</code> 这个第三方模块，来连接和操作 MySQL 数据库</p></blockquote><ol><li>运行如下命令，安装 <code>mysql</code> 模块：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mysql@2.18.1</span><br></pre></td></tr></table></figure><ol start="2"><li>在项目根目录中新建 <code>/db/index.js</code> 文件，在此自定义模块中创建数据库的连接对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建数据库连接对象</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享 db 数据库连接对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = db</span><br></pre></td></tr></table></figure><h3 id="注册">注册</h3><h4 id="实现步骤">实现步骤</h4><ol><li>检测表单数据是否合法</li><li>检测用户名是否被占用</li><li>对密码进行加密处理</li><li>插入新用户</li></ol><h4 id="检测表单数据是否合法">检测表单数据是否合法</h4><p>判断用户名和密码是否为空</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收表单数据</span></span><br><span class="line"><span class="keyword">const</span> userinfo = req.<span class="property">body</span></span><br><span class="line"><span class="comment">// 判断数据是否合法</span></span><br><span class="line"><span class="keyword">if</span> (!userinfo.<span class="property">username</span> || !userinfo.<span class="property">password</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名或密码不能为空！&#x27;</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="检测用户名是否被占用">检测用户名是否被占用</h4><ol><li>导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_users where username=?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>执行 SQL 语句并根据结果判断用户名是否被占用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, [userinfo.<span class="property">username</span>], <span class="keyword">function</span> (<span class="params">err, results</span>) &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 用户名被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名被占用，请更换其他用户名！&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> 用户名可用，继续后续流程...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="对密码进行加密处理">对密码进行加密处理</h4><blockquote><p>为了保证密码的安全性，不建议在数据库以 <code>明文</code> 的形式保存用户密码，推荐对密码进行 <code>加密存储</code></p></blockquote><hr><p>在当前项目中，使用 <code>bcryptjs</code> 对用户密码进行加密，优点：</p><ul><li>加密之后的密码，<strong>无法被逆向破解</strong></li><li>同一明文密码多次加密，得到的<strong>加密结果各不相同</strong>，保证了安全性</li></ul><hr><ol><li>运行如下命令，安装指定版本的 <code>bcryptjs</code> ：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i bcryptjs@2.4.3</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/user.js</code> 中，导入 <code>bcryptjs</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>在注册用户的处理函数中，确认用户名可用之后，调用 <code>bcrypt.hashSync(明文密码, 随机盐的长度)</code> 方法，对用户的密码进行加密处理：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对用户的密码,进行 bcrype 加密，返回值是加密之后的密码字符串</span></span><br><span class="line">userinfo.<span class="property">password</span> = bcrypt.<span class="title function_">hashSync</span>(userinfo.<span class="property">password</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure><h4 id="插入新用户">插入新用户</h4><ol><li>定义插入用户的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;insert into ev_users set ?&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句，插入新用户：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, &#123; <span class="attr">username</span>: userinfo.<span class="property">username</span>, <span class="attr">password</span>: userinfo.<span class="property">password</span> &#125;, <span class="keyword">function</span> (<span class="params">err, results</span>) &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但影响行数不为 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;注册用户失败，请稍后再试！&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 注册成功</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">&#x27;注册成功！&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="优化-res-send-代码">优化 res.send() 代码</h3><blockquote><p>在处理函数中，需要多次调用 <code>res.send()</code> 向客户端响应 <code>处理失败</code> 的结果，为了简化代码，可以手动封装一个 <a href="http://res.cc">res.cc</a>() 函数</p></blockquote><ol><li>在 <code>app.js</code> 中，所有路由之前，声明一个全局中间件，为 res 对象挂载一个 <code>res.cc()</code> 函数 ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应数据的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// status = 0 为成功； status = 1 为失败； 默认将 status 的值设置为 1，方便处理失败的情况</span></span><br><span class="line">  res.<span class="property">cc</span> = <span class="keyword">function</span> (<span class="params">err, status = <span class="number">1</span></span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="comment">// 状态</span></span><br><span class="line">      status,</span><br><span class="line">      <span class="comment">// 状态描述，判断 err 是 错误对象 还是 字符串</span></span><br><span class="line">      <span class="attr">message</span>: err <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? err.<span class="property">message</span> : err,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="优化表单数据验证">优化表单数据验证</h3><blockquote><p>表单验证的原则：前端验证为辅，后端验证为主，后端<strong>永远不要相信</strong>前端提交过来的<strong>任何内容</strong></p></blockquote><p>在实际开发中，前后端都需要对表单的数据进行合法性的验证，而且，<strong>后端做为数据合法性验证的最后一个关口</strong>，在拦截非法数据方面，起到了至关重要的作用。</p><p>单纯的使用 <code>if...else...</code> 的形式对数据合法性进行验证，效率低下、出错率高、维护性差。因此，推荐使用<strong>第三方数据验证模块</strong>，来降低出错率、提高验证的效率与可维护性，<strong>让后端程序员把更多的精力放在核心业务逻辑的处理上</strong>。</p><ol><li>安装 <code>joi</code> 包，为表单中携带的每个数据项，定义验证规则：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install joi</span><br></pre></td></tr></table></figure><ol start="2"><li>安装 <code>@escook/express-joi</code> 中间件，来实现自动对表单数据进行验证的功能：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @escook/express-joi</span><br></pre></td></tr></table></figure><ol start="3"><li>新建 <code>/schema/user.js</code> 用户信息验证规则模块，并初始化代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * string() 值必须是字符串</span></span><br><span class="line"><span class="comment"> * alphanum() 值只能是包含 a-zA-Z0-9 的字符串</span></span><br><span class="line"><span class="comment"> * min(length) 最小长度</span></span><br><span class="line"><span class="comment"> * max(length) 最大长度</span></span><br><span class="line"><span class="comment"> * required() 值是必填项，不能为 undefined</span></span><br><span class="line"><span class="comment"> * pattern(正则表达式) 值必须符合正则表达式的规则</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户名的验证规则</span></span><br><span class="line"><span class="keyword">const</span> username = joi.<span class="title function_">string</span>().<span class="title function_">alphanum</span>().<span class="title function_">min</span>(<span class="number">1</span>).<span class="title function_">max</span>(<span class="number">10</span>).required()</span><br><span class="line"><span class="comment">// 密码的验证规则</span></span><br><span class="line"><span class="keyword">const</span> password = joi</span><br><span class="line">  .<span class="title function_">string</span>()</span><br><span class="line">  .<span class="title function_">pattern</span>(<span class="regexp">/^[\S]&#123;6,12&#125;$/</span>)</span><br><span class="line">  .required()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册和登录表单的验证规则对象</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">reg_login_schema</span> = &#123;</span><br><span class="line">  <span class="comment">// 表示需要对 req.body 中的数据进行验证</span></span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    username,</span><br><span class="line">    password,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>修改 <code>/router/user.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userHandler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 导入验证表单数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; reg_login_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line"><span class="comment">// 3. 在注册新用户的路由中，声明局部中间件，对当前请求中携带的数据进行验证</span></span><br><span class="line"><span class="comment">// 3.1 数据验证通过后，会把这次请求流转给后面的路由处理函数</span></span><br><span class="line"><span class="comment">// 3.2 数据验证失败后，终止后续代码的执行，并抛出一个全局的 Error 错误，进入全局错误级别中间件中进行处理</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/reguser&#x27;</span>, <span class="title function_">expressJoi</span>(reg_login_schema), userHandler.<span class="property">regUser</span>)</span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, userHandler.<span class="property">login</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><ol start="5"><li>在 <code>app.js</code> 的全局错误级别中间件中，捕获验证失败的错误，并把验证失败的结果响应给客户端：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">err, req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// 数据验证失败</span></span><br><span class="line">  <span class="keyword">if</span> (err <span class="keyword">instanceof</span> joi.<span class="property">ValidationError</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line">  <span class="comment">// 未知错误</span></span><br><span class="line">  res.<span class="title function_">cc</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="登录">登录</h3><h4 id="实现步骤-v2">实现步骤</h4><ol><li>检测表单数据是否合法</li><li>根据用户名查询用户的数据</li><li>判断用户输入的密码是否正确</li><li>生成 JWT 的 Token 字符串</li></ol><h4 id="检测登录表单的数据是否合法">检测登录表单的数据是否合法</h4><ol><li>将 <code>/router/user.js</code> 中 <code>登录</code> 的路由代码修改如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="title function_">expressJoi</span>(reg_login_schema), userHandler.<span class="property">login</span>)</span><br></pre></td></tr></table></figure><h4 id="根据用户名查询用户的数据">根据用户名查询用户的数据</h4><ol><li>接收表单数据：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userinfo = req.<span class="property">body</span></span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_users where username=?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>执行 SQL 语句，查询用户的数据：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, userinfo.<span class="property">username</span>, <span class="keyword">function</span> (<span class="params">err, results</span>) &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但是查询到数据条数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;登录失败！&#x27;</span>)</span><br><span class="line">  <span class="comment">// TODO：判断用户输入的登录密码是否和数据库中的密码一致</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="判断用户输入的密码是否正确">判断用户输入的密码是否正确</h4><blockquote><p>核心实现思路：调用 <code>bcrypt.compareSync(用户提交的密码, 数据库中的密码)</code> 方法比较密码是否一致</p></blockquote><blockquote><p>返回值是布尔值（true 一致、false 不一致）</p></blockquote><p>具体的实现代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拿着用户输入的密码,和数据库中存储的密码进行对比</span></span><br><span class="line"><span class="keyword">const</span> compareResult = bcrypt.<span class="title function_">compareSync</span>(userinfo.<span class="property">password</span>, results[<span class="number">0</span>].<span class="property">password</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果对比的结果等于 false, 则证明用户输入的密码错误</span></span><br><span class="line"><span class="keyword">if</span> (!compareResult) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;登录失败！&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO：登录成功，生成 Token 字符串</span></span><br></pre></td></tr></table></figure><h4 id="生成-JWT-的-Token-字符串">生成 JWT 的 Token 字符串</h4><blockquote><p>核心注意点：在生成 Token 字符串的时候，一定要剔除 <strong>密码</strong> 和 <strong>头像</strong> 的值</p></blockquote><ol><li>通过 ES6 的高级语法，快速剔除 <code>密码</code> 和 <code>头像</code> 的值：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 剔除完毕之后，user 中只保留了用户的 id, username, nickname, email 这四个属性的值</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; ...results[<span class="number">0</span>], <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">user_pic</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>运行如下的命令，安装生成 Token 字符串的包：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i jsonwebtoken@8.5.1</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router_handler/user.js</code> 模块的头部区域，导入 <code>jsonwebtoken</code> 包：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用这个包来生成 Token 字符串</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>创建 <code>config.js</code> 文件，并向外共享 <strong>加密</strong> 和 <strong>还原</strong> Token 的 <code>jwtSecretKey</code> 字符串：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">jwtSecretKey</span>: <span class="string">&#x27;Bruce&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>将用户信息对象加密成 Token 字符串：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;../config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成 Token 字符串</span></span><br><span class="line"><span class="keyword">const</span> tokenStr = jwt.<span class="title function_">sign</span>(user, config.<span class="property">jwtSecretKey</span>, &#123;</span><br><span class="line">  <span class="attr">expiresIn</span>: <span class="string">&#x27;10h&#x27;</span>, <span class="comment">// token 有效期为 10 个小时</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="6"><li>将生成的 Token 字符串响应给客户端：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">send</span>(&#123;</span><br><span class="line">  <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">  <span class="comment">// 为了方便客户端使用 Token，在服务器端直接拼接上 Bearer 的前缀</span></span><br><span class="line">  <span class="attr">token</span>: <span class="string">&#x27;Bearer &#x27;</span> + tokenStr,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="配置解析-Token-的中间件">配置解析 Token 的中间件</h3><ol><li>运行如下的命令，安装解析 Token 的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express-jwt@<span class="number">5.3</span><span class="number">.3</span></span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中注册路由之前，配置解析 Token 的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析 token 的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 .unless(&#123; path: [/^\/api\//] &#125;) 指定哪些接口不需要进行 Token 的身份认证</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">expressJWT</span>(&#123; <span class="attr">secret</span>: config.<span class="property">jwtSecretKey</span> &#125;).<span class="title function_">unless</span>(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>app.js</code> 中的 <code>错误级别中间件</code> 里面，捕获并处理 Token 认证失败后的错误：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">err, req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// 省略其它代码...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 捕获身份认证失败的错误</span></span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;UnauthorizedError&#x27;</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;身份认证失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 未知错误...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="个人中心">个人中心</h2><h3 id="获取用户的基本信息">获取用户的基本信息</h3><h4 id="实现步骤-v3">实现步骤</h4><ol><li>初始化 <strong>路由</strong> 模块</li><li>初始化 <strong>路由处理函数</strong> 模块</li><li>获取用户的基本信息</li></ol><h4 id="初始化路由模块">初始化路由模块</h4><ol><li>创建 <code>/router/userinfo.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户的基本信息</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/userinfo&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享路由对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用个人中心的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并使用用户信息路由模块</span></span><br><span class="line"><span class="keyword">const</span> userinfoRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/userinfo&#x27;</span>)</span><br><span class="line"><span class="comment">// 注意：以 /my 开头的接口，都是有权限的接口，需要进行 Token 身份认证</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/my&#x27;</span>, userinfoRouter)</span><br></pre></td></tr></table></figure><h4 id="初始化路由处理函数模块">初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/userinfo.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户基本信息的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getUserInfo</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/userinfo.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户信息的处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userinfo_handler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/userinfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户的基本信息</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/userinfo&#x27;</span>, userinfo_handler.<span class="property">getUserInfo</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><h4 id="获取用户的基本信息-v2">获取用户的基本信息</h4><ol><li>在 <code>/router_handler/userinfo.js</code> 头部导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据用户的 id，查询用户的基本信息</span></span><br><span class="line"><span class="comment">// 注意：为了防止用户的密码泄露，需要排除 password 字段</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select id, username, nickname, email, user_pic from ev_users where id=?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：req 对象上的 user 属性，是 Token 解析成功，express-jwt 中间件帮我们挂载上去的</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, req.<span class="property">user</span>.<span class="property">id</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 执行 SQL 语句成功，但是查询到的数据条数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;获取用户信息失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 将用户信息响应给客户端</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取用户基本信息成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: results[<span class="number">0</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="更新用户的基本信息">更新用户的基本信息</h3><h4 id="实现步骤-v4">实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现更新用户基本信息的功能</li></ol><h4 id="定义路由和处理函数">定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>更新用户基本信息</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户的基本信息</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/userinfo&#x27;</span>, userinfo_handler.<span class="property">updateUserInfo</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>更新用户基本信息</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户基本信息的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">updateUserInfo</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="验证表单数据">验证表单数据</h4><ol><li>在 <code>/schema/user.js</code> 验证规则模块中，定义 <code>id</code>，<code>nickname</code>，<code>email</code> 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 id, nickname, emial 的验证规则</span></span><br><span class="line"><span class="keyword">const</span> id = joi.<span class="title function_">number</span>().<span class="title function_">integer</span>().<span class="title function_">min</span>(<span class="number">1</span>).required()</span><br><span class="line"><span class="keyword">const</span> nickname = joi.<span class="title function_">string</span>().required()</span><br><span class="line"><span class="keyword">const</span> email = joi.<span class="title function_">string</span>().<span class="title function_">email</span>().required()</span><br></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证规则对象 - 更新用户基本信息</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">update_userinfo_schema</span> = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    id,</span><br><span class="line">    nickname,</span><br><span class="line">    email,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/userinfo.js</code> 模块中，导入验证数据合法性的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入验证数据合法性的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; update_userinfo_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="5"><li>在 <code>/router/userinfo.js</code> 模块中，修改 <code>更新用户的基本信息</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户的基本信息</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/userinfo&#x27;</span>, <span class="title function_">expressJoi</span>(update_userinfo_schema), userinfo_handler.<span class="property">updateUserInfo</span>)</span><br></pre></td></tr></table></figure><h4 id="实现更新用户基本信息的功能">实现更新用户基本信息的功能</h4><ol><li>定义待执行的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_users set ? where id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句并传参：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, [req.<span class="property">body</span>, req.<span class="property">body</span>.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但影响行数不为 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;修改用户基本信息失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改用户信息成功</span></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;修改用户基本信息成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="重置密码">重置密码</h3><h4 id="实现步骤-v5">实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现重置密码的功能</li></ol><h4 id="定义路由和处理函数-v2">定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>重置密码</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置密码的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/updatepwd&#x27;</span>, userinfo_handler.<span class="property">updatePassword</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>重置密码</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置密码的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">updatePassword</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="验证表单数据-v2">验证表单数据</h4><blockquote><p>核心验证思路：旧密码与新密码，必须符合密码的验证规则，并且新密码不能与旧密码一致！</p></blockquote><ol><li>在 <code>/schema/user.js</code> 模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证规则对象 - 重置密码</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">update_password_schema</span> = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="comment">// 使用 password 这个规则，验证 req.body.oldPwd 的值</span></span><br><span class="line">    <span class="attr">oldPwd</span>: password,</span><br><span class="line">    <span class="comment">// 使用 joi.not(joi.ref(&#x27;oldPwd&#x27;)).concat(password) 规则，验证 req.body.newPwd 的值</span></span><br><span class="line">    <span class="comment">// 解读：</span></span><br><span class="line">    <span class="comment">// 1. joi.ref(&#x27;oldPwd&#x27;) 表示 newPwd 的值必须和 oldPwd 的值保持一致</span></span><br><span class="line">    <span class="comment">// 2. joi.not(joi.ref(&#x27;oldPwd&#x27;)) 表示 newPwd 的值不能等于 oldPwd 的值</span></span><br><span class="line">    <span class="comment">// 3. .concat() 用于合并 joi.not(joi.ref(&#x27;oldPwd&#x27;)) 和 password 这两条验证规则</span></span><br><span class="line">    <span class="attr">newPwd</span>: joi.<span class="title function_">not</span>(joi.<span class="title function_">ref</span>(<span class="string">&#x27;oldPwd&#x27;</span>)).<span class="title function_">concat</span>(password),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; update_userinfo_schema, update_password_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>并在 <code>重置密码的路由</code> 中，使用 <code>update_password_schema</code> 规则验证表单的数据，示例代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/updatepwd&#x27;</span>, <span class="title function_">expressJoi</span>(update_password_schema), userinfo_handler.<span class="property">updatePassword</span>)</span><br></pre></td></tr></table></figure><h4 id="实现重置密码的功能">实现重置密码的功能</h4><ol><li>根据 <code>id</code> 查询用户是否存在：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义根据 id 查询用户数据的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_users where id=?`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句查询用户是否存在</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, req.<span class="property">user</span>.<span class="property">id</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查指定 id 的用户是否存在</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;用户不存在！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：判断提交的旧密码是否正确</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>判断提交的 <strong>旧密码</strong> 是否正确：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在头部区域导入 bcryptjs 后，</span></span><br><span class="line"><span class="comment">// 即可使用 bcrypt.compareSync(提交的密码，数据库中的密码) 方法验证密码是否正确</span></span><br><span class="line"><span class="comment">// compareSync() 函数的返回值为布尔值，true 表示密码正确，false 表示密码错误</span></span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断提交的旧密码是否正确</span></span><br><span class="line"><span class="keyword">const</span> compareResult = bcrypt.<span class="title function_">compareSync</span>(req.<span class="property">body</span>.<span class="property">oldPwd</span>, results[<span class="number">0</span>].<span class="property">password</span>)</span><br><span class="line"><span class="keyword">if</span> (!compareResult) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;原密码错误！&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>对新密码进行 <code>bcrypt</code> 加密之后，更新到数据库中：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义更新用户密码的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_users set password=? where id=?`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对新密码进行 bcrypt 加密处理</span></span><br><span class="line"><span class="keyword">const</span> newPwd = bcrypt.<span class="title function_">hashSync</span>(req.<span class="property">body</span>.<span class="property">newPwd</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句，根据 id 更新用户的密码</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, [newPwd, req.<span class="property">user</span>.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// SQL 语句执行失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;更新密码失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新密码成功</span></span><br><span class="line">  res.<span class="title function_">cc</span>(<span class="string">&#x27;更新密码成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="更新用户头像">更新用户头像</h3><h4 id="实现步骤-v6">实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现更新用户头像的功能</li></ol><h4 id="定义路由和处理函数-v3">定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>更新用户头像</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户头像的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/update/avatar&#x27;</span>, userinfo_handler.<span class="property">updateAvatar</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>更新用户头像</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户头像的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">updateAvatar</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="验证表单数据-v3">验证表单数据</h4><ol><li>在 <code>/schema/user.js</code> 验证规则模块中，定义 <code>avatar</code> 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dataUri() 指的是如下格式的字符串数据：</span></span><br><span class="line"><span class="comment">// data:image/png;base64,VE9PTUFOWVNFQ1JFVFM=</span></span><br><span class="line"><span class="keyword">const</span> avatar = joi.<span class="title function_">string</span>().<span class="title function_">dataUri</span>().required()</span><br></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证规则对象 - 更新头像</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">update_avatar_schema</span> = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    avatar,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; update_avatar_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router/userinfo.js</code> 模块中，修改 <code>更新用户头像</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/update/avatar&#x27;</span>, <span class="title function_">expressJoi</span>(update_avatar_schema), userinfo_handler.<span class="property">updateAvatar</span>)</span><br></pre></td></tr></table></figure><h4 id="实现更新用户头像的功能">实现更新用户头像的功能</h4><ol><li>定义更新用户头像的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;update ev_users set user_pic=? where id=?&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句，更新对应用户的头像：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, [req.<span class="property">body</span>.<span class="property">avatar</span>, req.<span class="property">user</span>.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;更新头像失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新用户头像成功</span></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;更新头像成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="文章分类管理">文章分类管理</h2><h3 id="新建-ev-article-cate-表">新建 ev_article_cate 表</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/ev_article_cate.f52fe7ce.png" alt="文章分类表结构"></p><h3 id="获取文章分类列表">获取文章分类列表</h3><h4 id="实现步骤-v7">实现步骤</h4><ol><li>初始化路由模块</li><li>初始化路由处理函数模块</li><li>获取文章分类列表数据</li></ol><h4 id="初始化路由模块-v2">初始化路由模块</h4><ol><li>创建 <code>/router/artcate.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文章分类的列表数据</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/cates&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享路由对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用文章分类的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并使用文章分类路由模块</span></span><br><span class="line"><span class="keyword">const</span> artCateRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/artcate&#x27;</span>)</span><br><span class="line"><span class="comment">// 为文章分类的路由挂载统一的访问前缀 /my/article</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/my/article&#x27;</span>, artCateRouter)</span><br></pre></td></tr></table></figure><h4 id="初始化路由处理函数模块-v2">初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/artcate.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取文章分类列表数据的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getArticleCates</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/artcate.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文章分类的路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> artcate_handler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文章分类的列表数据</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/cates&#x27;</span>, artcate_handler.<span class="property">getArticleCates</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><h4 id="获取文章分类列表数据">获取文章分类列表数据</h4><ol><li>在 <code>/router_handler/artcate.js</code> 头部导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据分类的状态，获取所有未被删除的分类列表数据</span></span><br><span class="line"><span class="comment">// is_delete 为 0 表示没有被 标记为删除 的数据</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;select * from ev_article_cate where is_delete=0 order by id asc&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 执行 SQL 语句成功</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取文章分类列表成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: results,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="新增文章分类">新增文章分类</h3><h4 id="实现步骤-v8">实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>查询 <code>分类名称</code> 与 <code>分类别名</code> 是否被占用</li><li>实现新增文章分类的功能</li></ol><h4 id="定义路由和处理函数-v4">定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>新增文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增文章分类的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/addcates&#x27;</span>, artcate_handler.<span class="property">addArticleCates</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>新增文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">addArticleCates</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="验证表单数据-v4">验证表单数据</h4><ol><li>创建 <code>/schema/artcate.js</code> 文章分类数据验证模块，并定义如下的验证规则：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入定义验证规则的模块</span></span><br><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 分类名称 和 分类别名 的校验规则</span></span><br><span class="line"><span class="keyword">const</span> name = joi.<span class="title function_">string</span>().required()</span><br><span class="line"><span class="keyword">const</span> alias = joi.<span class="title function_">string</span>().<span class="title function_">alphanum</span>().required()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验规则对象 - 添加分类</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">add_cate_schema</span> = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    name,</span><br><span class="line">    alias,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，使用 <code>add_cate_schema</code> 对数据进行验证：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入验证数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"><span class="comment">// 导入文章分类的验证模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; add_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增文章分类的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/addcates&#x27;</span>, <span class="title function_">expressJoi</span>(add_cate_schema), artcate_handler.<span class="property">addArticleCates</span>)</span><br></pre></td></tr></table></figure><h4 id="查询分类名称与别名是否被占用">查询分类名称与别名是否被占用</h4><ol><li>定义查重的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义查询 分类名称 与 分类别名 是否被占用的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_article_cate where name=? or alias=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行查重的操作：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行查重操作</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, [req.<span class="property">body</span>.<span class="property">name</span>, req.<span class="property">body</span>.<span class="property">alias</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断 分类名称 和 分类别名 是否被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> === <span class="number">2</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;分类名称与别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="comment">// 分别判断 分类名称 和 分类别名 是否被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].<span class="property">name</span> === req.<span class="property">body</span>.<span class="property">name</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;分类名称被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].<span class="property">alias</span> === req.<span class="property">body</span>.<span class="property">alias</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;分类别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：新增文章分类</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="实现新增文章分类的功能">实现新增文章分类的功能</h4><ol><li>定义新增文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`insert into ev_article_cate set ?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行新增文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, req.<span class="property">body</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// SQL 语句执行失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;新增文章分类失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 新增文章分类成功</span></span><br><span class="line">  res.<span class="title function_">cc</span>(<span class="string">&#x27;新增文章分类成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="根据-Id-删除文章分类">根据 Id 删除文章分类</h3><h4 id="实现步骤-v9">实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现删除文章分类的功能</li></ol><h4 id="定义路由和处理函数-v5">定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>删除文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/deletecate/:id&#x27;</span>, artcate_handler.<span class="property">deleteCateById</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>删除文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">deleteCateById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="验证表单数据-v5">验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，定义 id 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 分类Id 的校验规则</span></span><br><span class="line"><span class="keyword">const</span> id = joi.<span class="title function_">number</span>().<span class="title function_">integer</span>().<span class="title function_">min</span>(<span class="number">1</span>).required()</span><br></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则对象 - 删除分类</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">delete_cate_schema</span> = &#123;</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    id,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入删除分类的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; delete_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除文章分类的路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/deletecate/:id&#x27;</span>, <span class="title function_">expressJoi</span>(delete_cate_schema), artcate_handler.<span class="property">deleteCateById</span>)</span><br></pre></td></tr></table></figure><h4 id="实现删除文章分类的功能">实现删除文章分类的功能</h4><ol><li>定义删除文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_article_cate set is_delete=1 where id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行删除文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, req.<span class="property">params</span>.<span class="property">id</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;删除文章分类失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除文章分类成功</span></span><br><span class="line">  res.<span class="title function_">cc</span>(<span class="string">&#x27;删除文章分类成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="根据-Id-获取文章分类数据">根据 Id 获取文章分类数据</h3><h4 id="实现步骤-v10">实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现获取文章分类的功能</li></ol><h4 id="定义路由和处理函数-v6">定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>根据 Id 获取文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/cates/:id&#x27;</span>, artcate_handler.<span class="property">getArticleById</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>根据 Id 获取文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 Id 获取文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getArticleById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="验证表单数据-v6">验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则对象 - 根据 Id 获取分类</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">get_cate_schema</span> = &#123;</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    id,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入根据 Id 获取分类的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; get_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 Id 获取文章分类的路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/cates/:id&#x27;</span>, <span class="title function_">expressJoi</span>(get_cate_schema), artcate_handler.<span class="property">getArticleById</span>)</span><br></pre></td></tr></table></figure><h4 id="实现获取文章分类的功能">实现获取文章分类的功能</h4><ol><li>定义根据 Id 获取文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_article_cate where id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, req.<span class="property">params</span>.<span class="property">id</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是没有查询到任何数据</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;获取文章分类数据失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把数据响应给客户端</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取文章分类数据成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: results[<span class="number">0</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="根据-Id-更新文章分类数据">根据 Id 更新文章分类数据</h3><h4 id="实现步骤-v11">实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>查询 <code>分类名称</code> 与 <code>分类别名</code> 是否被占用</li><li>实现更新文章分类的功能</li></ol><h4 id="定义路由和处理函数-v7">定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>更新文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新文章分类的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/updatecate&#x27;</span>, artcate_handler.<span class="property">updateCateById</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>更新文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">updateCateById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="验证表单数据-v7">验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则对象 - 更新分类</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">update_cate_schema</span> = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="title class_">Id</span>: id,</span><br><span class="line">    name,</span><br><span class="line">    alias,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入更新文章分类的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; update_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新文章分类的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/updatecate&#x27;</span>, <span class="title function_">expressJoi</span>(update_cate_schema), artcate_handler.<span class="property">updateCateById</span>)</span><br></pre></td></tr></table></figure><h4 id="查询分类名称与别名是否被占用-v2">查询分类名称与别名是否被占用</h4><ol><li>定义查重的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义查询 分类名称 与 分类别名 是否被占用的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_article_cate where Id&lt;&gt;? and (name=? or alias=?)`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行查重的操作：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行查重操作</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, [req.<span class="property">body</span>.<span class="property">Id</span>, req.<span class="property">body</span>.<span class="property">name</span>, req.<span class="property">body</span>.<span class="property">alias</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断 分类名称 和 分类别名 是否被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> === <span class="number">2</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;分类名称与别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].<span class="property">name</span> === req.<span class="property">body</span>.<span class="property">name</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;分类名称被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">length</span> === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].<span class="property">alias</span> === req.<span class="property">body</span>.<span class="property">alias</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;分类别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：更新文章分类</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="实现更新文章分类的功能">实现更新文章分类的功能</h4><ol><li>定义更新文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_article_cate set ? where Id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, [req.<span class="property">body</span>, req.<span class="property">body</span>.<span class="property">Id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;更新文章分类失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新文章分类成功</span></span><br><span class="line">  res.<span class="title function_">cc</span>(<span class="string">&#x27;更新文章分类成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="文章管理">文章管理</h2><h3 id="新建-ev-articles-表">新建 ev_articles 表</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/ev_articles.01220b03.png" alt="ev_articles表结构"></p><h3 id="发布新文章">发布新文章</h3><h4 id="实现步骤-v12">实现步骤</h4><ol><li>初始化路由模块</li><li>初始化路由处理函数模块</li><li>使用 multer 解析表单数据</li><li>验证表单数据</li><li>实现发布文章的功能</li></ol><h4 id="初始化路由模块-v3">初始化路由模块</h4><ol><li>创建 <code>/router/article.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布新文章</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享路由对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用文章的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并使用文章路由模块</span></span><br><span class="line"><span class="keyword">const</span> articleRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/article&#x27;</span>)</span><br><span class="line"><span class="comment">// 为文章的路由挂载统一的访问前缀 /my/article</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/my/article&#x27;</span>, articleRouter)</span><br></pre></td></tr></table></figure><h4 id="初始化路由处理函数模块-v3">初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/article.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">addArticle</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/article.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文章的路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> article_handler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/article&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布新文章</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/add&#x27;</span>, article_handler.<span class="property">addArticle</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><h4 id="使用-multer-解析表单数据">使用 multer 解析表单数据</h4><blockquote><p>注意：使用 <code>express.urlencoded()</code> 中间件无法解析 <code>multipart/form-data</code> 格式的请求体数据。</p></blockquote><blockquote><p>当前项目，推荐使用 multer 来解析 <code>multipart/form-data</code> 格式的表单数据。<a href="https://www.npmjs.com/package/multer">https://www.npmjs.com/package/multer</a></p></blockquote><ol><li>运行如下的终端命令，在项目中安装 <code>multer</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i multer@1.4.2</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/article.js</code> 模块中导入并配置 <code>multer</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入解析 formdata 格式表单数据的包</span></span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>)</span><br><span class="line"><span class="comment">// 导入处理路径的核心模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 multer 的实例对象，通过 dest 属性指定文件的存放路径</span></span><br><span class="line"><span class="keyword">const</span> upload = <span class="title function_">multer</span>(&#123; <span class="attr">dest</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../uploads&#x27;</span>) &#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>修改 <code>发布新文章</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的路由</span></span><br><span class="line"><span class="comment">// upload.single() 是一个局部生效的中间件，用来解析 FormData 格式的表单数据</span></span><br><span class="line"><span class="comment">// 将文件类型的数据，解析并挂载到 req.file 属性中</span></span><br><span class="line"><span class="comment">// 将文本类型的数据，解析并挂载到 req.body 属性中</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/add&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;cover_img&#x27;</span>), article_handler.<span class="property">addArticle</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router_handler/article.js</code> 模块中的 <code>addArticle</code> 处理函数中，将 <code>multer</code> 解析出来的数据进行打印：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">addArticle</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>) <span class="comment">// 文本类型的数据</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;--------分割线----------&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">file</span>) <span class="comment">// 文件类型的数据</span></span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="验证表单数据-v8">验证表单数据</h4><blockquote><p>实现思路：通过 express-joi <strong>自动验证</strong> req.body 中的文本数据；通过 if 判断<strong>手动验证</strong> req.file 中的文件数据；</p></blockquote><ol><li>创建 <code>/schema/article.js</code> 验证规则模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入定义验证规则的模块</span></span><br><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 标题、分类Id、内容、发布状态 的验证规则</span></span><br><span class="line"><span class="keyword">const</span> title = joi.<span class="title function_">string</span>().required()</span><br><span class="line"><span class="keyword">const</span> cate_id = joi.<span class="title function_">number</span>().<span class="title function_">integer</span>().<span class="title function_">min</span>(<span class="number">1</span>).required()</span><br><span class="line"><span class="keyword">const</span> content = joi.<span class="title function_">string</span>().required().<span class="title function_">allow</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> state = joi.<span class="title function_">string</span>().<span class="title function_">valid</span>(<span class="string">&#x27;已发布&#x27;</span>, <span class="string">&#x27;草稿&#x27;</span>).required()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证规则对象 - 发布文章</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">add_article_schema</span> = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    title,</span><br><span class="line">    cate_id,</span><br><span class="line">    content,</span><br><span class="line">    state,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/article.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入验证数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"><span class="comment">// 导入文章的验证模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; add_article_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/article&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布新文章的路由</span></span><br><span class="line"><span class="comment">// 注意：在当前的路由中，先后使用了两个中间件：</span></span><br><span class="line"><span class="comment">//       先使用 multer 解析表单数据</span></span><br><span class="line"><span class="comment">//       再使用 expressJoi 对解析的表单数据进行验证</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/add&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;cover_img&#x27;</span>), <span class="title function_">expressJoi</span>(add_article_schema), article_handler.<span class="property">addArticle</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router_handler/article.js</code> 模块中的 <code>addArticle</code> 处理函数中，通过 <code>if</code> 判断客户端是否提交了 <code>封面图片</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">addArticle</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 手动判断是否上传了文章封面</span></span><br><span class="line">  <span class="keyword">if</span> (!req.<span class="property">file</span> || req.<span class="property">file</span>.<span class="property">fieldname</span> !== <span class="string">&#x27;cover_img&#x27;</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;文章封面是必选参数！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：表单数据合法，继续后面的处理流程...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="实现发布文章的功能">实现发布文章的功能</h4><ol><li>整理要插入数据库的文章信息对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入处理路径的 path 核心模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> articleInfo = &#123;</span><br><span class="line">  <span class="comment">// 标题、内容、状态、所属的分类Id</span></span><br><span class="line">  ...req.<span class="property">body</span>,</span><br><span class="line">  <span class="comment">// 文章封面在服务器端的存放路径</span></span><br><span class="line">  <span class="attr">cover_img</span>: path.<span class="title function_">join</span>(<span class="string">&#x27;/uploads&#x27;</span>, req.<span class="property">file</span>.<span class="property">filename</span>),</span><br><span class="line">  <span class="comment">// 文章发布时间</span></span><br><span class="line">  <span class="attr">pub_date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">  <span class="comment">// 文章作者的Id</span></span><br><span class="line">  <span class="attr">author_id</span>: req.<span class="property">user</span>.<span class="property">id</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>定义发布文章的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`insert into ev_articles set ?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行发布文章的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, articleInfo, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;发布文章失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布文章成功</span></span><br><span class="line">  res.<span class="title function_">cc</span>(<span class="string">&#x27;发布文章成功&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>app.js</code> 中，使用 <code>express.static()</code> 中间件，将 <code>uploads</code> 目录中的图片托管为静态资源：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 托管静态资源文件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/uploads&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;./uploads&#x27;</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;大事件后台 API 项目&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://www.showdoc.cc/escook?page_id=3707158761215217&quot;&gt;API 接口文档&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id</summary>
      
    
    
    
    <category term="后端🍟" scheme="https://blog.cilicili.xyz/categories/%E5%90%8E%E7%AB%AF%F0%9F%8D%9F/"/>
    
    
    <category term="Express" scheme="https://blog.cilicili.xyz/tags/Express/"/>
    
    <category term="项目" scheme="https://blog.cilicili.xyz/tags/%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>【前端】正则表达式的简单使用</title>
    <link href="https://blog.cilicili.xyz/posts/5405255.html"/>
    <id>https://blog.cilicili.xyz/posts/5405255.html</id>
    <published>2022-09-08T08:23:14.000Z</published>
    <updated>2022-09-13T13:01:19.526Z</updated>
    
    <content type="html"><![CDATA[<h2 id="正则表达式">正则表达式</h2><ul><li><strong>正则表达式</strong>（Regular Expression）是用于<strong>匹配</strong>字符串中字符组合的模式。</li><li>在 JavaScript中，正则表达式也是对象 。</li><li>通常用来<strong>查找、替换</strong>那些符合正则表达式的文本，许多语言都支持正则表达式。</li></ul><h2 id="语法">语法</h2><h3 id="定义正则表达式语法">定义正则表达式语法</h3><ol><li><p>字面量形式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> 变量名 = <span class="regexp">/表达式/</span></span><br></pre></td></tr></table></figure><ul><li>其中，<code>/  /</code>是正则表达式字面量</li><li>是<code>object</code>（复杂数据类型）</li></ul></li><li><p>内置构造函数创建</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res=<span class="keyword">new</span> <span class="title class_">RegExp</span>(‘abcd’)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res) <span class="comment">//  /abcd/</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="判断是否有符合规则的字符串">判断是否有符合规则的字符串</h3><p><code>test()</code>方法：用来查看正则表达式与指定的字符串是否匹配。</p><p>例如：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908163255374.png" alt="image-20220908163255374"></p><h3 id="检查（查找）符合规则的字符串">检查（查找）符合规则的字符串</h3><p><code>exec()</code> 方法：在一个指定字符串中执行一个搜索匹配。</p><p>例如：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908163433792.png" alt="image-20220908163433792"></p><h2 id="元字符-v2">元字符</h2><ul><li><p><strong>普通字符</strong></p><p>大多数的字符仅能够描述它们本身，这些字符称作普通字符，例如所有的字母和数字。 也就是说普通字符只能够匹配字符串中与它们相同的字符。</p></li><li><p><strong>元字符（特殊字符）</strong></p><p>是一些具有特殊含义的字符，可以极大提高了灵活性和强大的匹配功能。</p><ul><li>比如，规定用户只能输入英文26个英文字母，普通字符的话 abcdefghijklm……</li><li>但是换成元字符写法： [a-z]</li></ul></li></ul><h3 id="边界符">边界符</h3><p>正则表达式中的边界符（位置符）用来<strong>提示字符所处的位置</strong>，主要有两个字符：</p><table><thead><tr><th style="text-align:center">边界符</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">^</td><td style="text-align:center">表示匹配行首的文本（以谁开始）</td></tr><tr><td style="text-align:center">$</td><td style="text-align:center">表示匹配行尾的文本（以谁结束）</td></tr></tbody></table><p><strong>如果<code>^</code>和<code>$</code>在一起，表示必须是精确匹配。</strong></p><p>例如：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908163943056.png" alt="image-20220908163943056"></p><h3 id="量词-v2">量词</h3><p>量词用来 <strong>设定某个模式出现的次数</strong></p><table><thead><tr><th style="text-align:center">量词</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">*</td><td style="text-align:center">重复零次或更多次</td></tr><tr><td style="text-align:center">+</td><td style="text-align:center">重复一次或更多次</td></tr><tr><td style="text-align:center">？</td><td style="text-align:center">重复零次或一次</td></tr><tr><td style="text-align:center">{n}</td><td style="text-align:center">重复n次</td></tr><tr><td style="text-align:center">{n，}</td><td style="text-align:center">重复n次或更多次</td></tr><tr><td style="text-align:center">{n，m}</td><td style="text-align:center">重复n到m次z</td></tr></tbody></table><p><strong>注意：逗号左右量词千万不要出现空格</strong></p><p>例如：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908164211679.png" alt="image-20220908164211679"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908164224761.png" alt="image-20220908164224761"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908164251792.png" alt="image-20220908164251792"></p><h3 id="字符类">字符类</h3><h4 id="匹配字符集合"><code>[ ]</code>匹配字符集合</h4><p>后面的字符串只要<strong>包含</strong> abc <strong>中任意一个字符，都返回 true</strong> 。</p><p>例如：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908164401167.png" alt="image-20220908164401167"></p><h4 id="里面加上-连字符"><code>[ ]</code>里面加上 <code>-</code> 连字符</h4><p>表示一个范围，比如：</p><ul><li><p><code>[a-z]</code> 表示 <code>a</code> 到 <code>z</code> <code>26</code>个英文字母都可以</p></li><li><p><code>[a-zA-Z]</code> 表示<strong>大小写</strong>都可以</p></li><li><p><code>[0-9]</code> 表示 <code>0~9</code> 的数字都可以</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908164628350.png" alt="image-20220908164628350"></p></li></ul><h4 id="里面加上-取反符号"><code>[ ]</code> 里面加上 <code>^</code> 取反符号</h4><p>比如：</p><ul><li><p><code>[^a-z]</code> 匹配除了小写字母以外的字符</p></li><li><p>注意要写到中括号里面</p></li></ul><h4 id="匹配除换行符之外的任何单个字符"><code>.</code>  匹配除换行符之外的任何单个字符</h4><h4 id="预定义字符">预定义字符</h4><p>指的是某些常见模式的简写方式</p><table><thead><tr><th>预定类</th><th>说明</th></tr></thead><tbody><tr><td>\d</td><td>匹配<strong>0-9之间</strong>的任一数字，相当于**[0-9]**</td></tr><tr><td>\D</td><td>匹配所有<strong>0-9以外</strong>的字符，相当于**[^0-9]**</td></tr><tr><td>\w</td><td>匹配任意的<strong>字母、数字和下划线</strong>，相当于**[A-Za-z0-9]**</td></tr><tr><td>\W</td><td>除所有字母、数字和下划线以外的字符，相当于**[^A-Za-z0-9_]**</td></tr><tr><td>\s</td><td>匹配空格（包括换行符、制表符、空格符等），相当于**[\t\r\n\v\f]**</td></tr><tr><td>\S</td><td>匹配非空格的字符，相当于**[^\t\r\n\v\f]**</td></tr></tbody></table><p>比如：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908165321171.png" alt="image-20220908165321171"></p><h4 id="修饰符-v2">修饰符</h4><p>修饰符<strong>约束正则执行的某些细节行为</strong>，如是否区分大小写、是否支持多行匹配等。</p><h5 id="简单修饰符">简单修饰符</h5><p>语法：<code>/表达式/修饰符</code></p><ul><li><p><code>i</code> 是单词 <code>ignore</code> 的缩写，正则匹配时<strong>字母不区分大小写</strong></p></li><li><p><code>g</code> 是单词 <code>global</code> 的缩写，匹配<strong>所有满足正则表达式的结果</strong></p></li></ul><p>比如：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220908165508957.png" alt="image-20220908165508957"></p><h5 id="替换replace">替换replace</h5><p>语法：<code>字符串.replace(/正则表达式/,'替换的文本')</code></p><h2 id="正则的贪婪和非贪婪">正则的贪婪和非贪婪</h2><h3 id="贪婪（-）">贪婪（+）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+/</span></span><br><span class="line"><span class="comment">//能捕获的最大长度</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;abc12345678abc&#x27;</span>)) <span class="comment">// 12345678</span></span><br></pre></td></tr></table></figure><h3 id="非贪婪（-）">非贪婪（?）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+?/</span></span><br><span class="line"><span class="comment">//能捕获的最小长度</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;abc12345678abc&#x27;</span>)) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h3 id="">??</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d??/</span></span><br><span class="line"><span class="comment">//能捕获的最小长度</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;12345678abc&#x27;</span>)) <span class="comment">// &#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="n-获取-n-个">{n,}? 获取 n 个</h3><p>当 n 为 1 的时候，等价于<code>+</code></p><p>当 n 为 0 的时候，等价于<code>*</code></p><h3 id="例子">例子</h3><ol><li><p>获取开标签</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;&lt;div&gt;你是什么呀&lt;/div&gt;&#x27;</span></span><br><span class="line"><span class="comment">//获取开标签</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/&lt;.+?&gt;/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(str)) <span class="comment">//div</span></span><br></pre></td></tr></table></figure></li><li><p>匹配的一个字符</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/abcd&#123;2&#125;/</span></span><br><span class="line"><span class="comment">//是匹配前面一个字符</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcdabcd&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcdd&#x27;</span>)) <span class="comment">//true</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="正则特殊字符">正则特殊字符</h2><h3 id="：一个整体"><strong><code>()</code>：一个整体</strong></h3><p><strong>作用</strong>：1. 表示把 abcd 当作一个整体2. 单独捕获</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(abcd)&#123;2&#125;/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcdabcd&#x27;</span>)) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>单独捕获的场景： 从左括号开始依次捕获，当作整体</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(\d+(\s+))\d+/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;123   123&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/e6c9d24ely1h01nv3p5a3j20s40aojse.jpg" alt="image-20220307215550475"></p><p>不写小括号时</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d+\s+\d+/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;123   123&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/e6c9d24ely1h01o1qxc3ij20s80840te.jpg" alt="image-20220307220213888"></p><h3 id="：整体捕获"><code>(?:)</code>：整体捕获</h3><p><strong>｜：占位或</strong>.表示左边或者右边都行，大部分时候和小括号连用.分开的是左边右边整个</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(abc|def)/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcd&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;defa&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;bcd&#x27;</span>)) <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p><strong>小练习</strong>：如果我们不加小括号。下列正则表示，以 abc 开头，以 def 结尾</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^abc|def$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcd&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;defa&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;bcd&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^ab(c|d)ef$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcd&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;defa&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;bcd&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcef&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abdef&#x27;</span>)) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><strong>[]</strong>：表示包含中间的任意一个都行.<strong>占一个字符位置</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/[abcd]/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abcd&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;d&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;b&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;a&#x27;</span>)) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><strong>[^]</strong>：表示包含中间的任意一个都行.<strong>占一个字符位置</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表示由一个字符组成，只要不是a.b,c，d中的都可以</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^[^abcd]$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;a&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;f&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;b&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;c&#x27;</span>)) <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p><strong>-</strong>：是使用在[]里面的符号，表示从哪一个字符到哪一个字符.，前提是他们的 Ascll 是连着的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表示由一个字符组成，可以是0-9任意</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^[0-9]$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;0&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;1&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;10&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="comment">//表示由一个字符组成，可以是小写字母a-z任意</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^[a-z]$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;a&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;Z&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;A&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//表示由一个字符组成，可以是大写字母A-Z任意</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^[A-Z]$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;a&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;Z&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;A&#x27;</span>)) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><h3 id="等价组合形式">等价组合形式</h3><ul><li><strong>[0-9a-zA-Z_]等价于\w</strong></li><li><strong>[^0-9a-za-z_]等价于\W</strong></li><li><strong>[0-9]等价于\d</strong></li><li><strong>[^0-9]等价于\D</strong></li><li><strong>[ ]等价于\s</strong></li><li><strong>[^ ]等价于\S</strong></li></ul><p>当我们在**[]<strong>里面的时候，点</strong>(.)**就表示一个点，不是上文所述的非换行任意字符</p><h4 id="小练习">小练习</h4><p>验证一个字符串，只能由字母数据下划线组成，6-12 位，不能以下划线开头</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^[0-9a-zA-Z]\w&#123;5,11&#125;$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;123acd&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;_11213sa&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;q1w_dee&#x27;</span>)) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>获取 HTML 标签里面的 text</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;&lt;div&gt;你是什么呀&lt;/div&gt;&#x27;</span></span><br><span class="line"><span class="comment">//获取开标签</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/&gt;(.+)&lt;/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(str))</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/e6c9d24ely1h01ozwnjqyj20ru09imyd.jpg" alt="image-20220307223502689"></p><h3 id="正则表达式的预查">正则表达式的预查</h3><p>比如：“ES2015，ES2016，ES2017 都是 JavaScript 的语法标准”，我们想要查到 ES2015，ES2016</p><h4 id="正向肯定预查">正向肯定预查(?=)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^ES(?=2015|2016)/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//字符串ES2015,ES2016是可以的，但是我只捕获ES</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;ES2015&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;ES2016&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;ES2017&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;ES2015&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;ES2016&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;ES2017&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01pg9nnlej20ry0g6gn7.jpg" alt="image-20220307225046423"></p><h4 id="正向否定预查">正向否定预查(?!)</h4><p>当我在捕获内容的时候，后面必须跟着不是我所指定的.我要的是 ES，但是后面不能跟 2015 和 2016</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/ES(?!2015|2016)/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;ES2015&#x27;</span>)) <span class="comment">//null</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;ES2016&#x27;</span>)) <span class="comment">//null</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;ES2017&#x27;</span>)) <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01pq8p6jwj20ri09qwfb.jpg" alt="image-20220307230022106"></p><h4 id="负向肯定预查">负向肯定预查(?&lt;=)</h4><p>后面是 ES，要求前面是 2015 或者 2016</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(?&lt;=2015|2016)ES/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;2015ES&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;2016ES&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;2017ES&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01q8uc01dj20r20fyq4j.jpg" alt="image-20220307231814557"></p><h4 id="负向否定预查">负向否定预查(?&lt;!)</h4><p>后面是 ES，要求前面不能是 2015 或者 2016</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(?&lt;!2015|2016)ES/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;2015ES&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;2016ES&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;2017ES&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01qbzycfuj20re0aat9i.jpg" alt="image-20220307232116753"></p><h3 id="重复出现符号">重复出现符号</h3><p><strong>/num</strong>：num 是一个数字，表示正则第 num 个可被捕获的()。</p><p>这个可被捕获的小括号位置是什么，出现一份一模一样的内容</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/(abc|def)\d+\1/</span></span><br><span class="line"><span class="comment">//前面是abc，后面就必须是abc</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abc123abc&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;def123&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;abc123def&#x27;</span>)) <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h3 id="邮箱匹配">邮箱匹配</h3><p>名字：6-8 位，不能以_开头，只能是数字，字母下划线组成</p><p>只能是 qq 或者 163 或者 sins 邮箱</p><p><a href="http://xn--epr1cy90e9mx0gc.com">后缀只能是.com</a> <a href="http://xn--1nu597d.cn">或者.cn</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^[0-9a-zA-Z]\w&#123;5,7&#125;@(qq|163|sina)\.(com|cn)$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(<span class="string">&#x27;asdf11@qq.com&#x27;</span>))</span><br></pre></td></tr></table></figure><h3 id="手机号">手机号</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^(?:\+86)?((133|158)\d&#123;8&#125;)$/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">exec</span>(<span class="string">&#x27;+8613378324567&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01qt460cej20s609wdh6.jpg" alt="image-20220307233743247"></p><h2 id="正则表达式标识符">正则表达式标识符</h2><p>标识符：是写在正则表达式外面，用来修饰整个正则表达式的</p><p><strong>i：忽略大小写</strong></p><p><strong>g：全局</strong></p><p><strong>y：粘性全局</strong></p><p>语法：<code>/abcc/igy</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">New</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;abcd&#x27;</span>,<span class="string">&#x27;igy)</span></span><br></pre></td></tr></table></figure><h3 id="i，忽略大小写">i，忽略大小写</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arg = <span class="regexp">/abcd/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">test</span>(<span class="string">&#x27;abcd&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">test</span>(<span class="string">&#x27;abcD&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arg = <span class="regexp">/abcd/i</span> <span class="comment">//忽略大小写</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">test</span>(<span class="string">&#x27;abcd&#x27;</span>)) <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h3 id="g，全局匹配">g，全局匹配</h3><p>因为我们匹配或者捕获都是只能捕获第一个</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arg = <span class="regexp">/abc/g</span> <span class="comment">//全局</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 捕获第二次，会从第一次的结束位开始查找</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">exec</span>(<span class="string">&#x27;abc123abc123abc&#x27;</span>)) <span class="comment">//0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">exec</span>(<span class="string">&#x27;abc123abc123abc&#x27;</span>)) <span class="comment">//6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">exec</span>(<span class="string">&#x27;abc123abc123abc&#x27;</span>)) <span class="comment">//12</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/e6c9d24ely1h01rgyl694j20rg0oa774.jpg" alt="image-20220308000037389"></p><h3 id="y，粘性全局">y，粘性全局</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arg = <span class="regexp">/abc/y</span> <span class="comment">//全局</span></span><br><span class="line"><span class="comment">// 捕获第二次，会从第一次的结束位开始查找</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">exec</span>(<span class="string">&#x27;abc123abc123abc&#x27;</span>)) <span class="comment">//0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">exec</span>(<span class="string">&#x27;abc123abc123abc&#x27;</span>)) <span class="comment">//null</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">exec</span>(<span class="string">&#x27;abc123abc123abc&#x27;</span>)) <span class="comment">//0</span></span><br><span class="line"><span class="comment">// 必须要紧跟着</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="title function_">exec</span>(<span class="string">&#x27;abcabcabc123abc&#x27;</span>)) <span class="comment">//3</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://tva1.sinaimg.cn/large/e6c9d24ely1h01riyfgxcj20rs0hs767.jpg" alt="image-20220308000233640"></p><hr><blockquote><p>参考文章：</p><p><a href="https://donghuan1224.gitee.io/my-blog/2022/02/10/%E8%BF%B7%E6%83%91%E7%82%B9%E5%90%88%E9%9B%86/6_%E6%AD%A3%E5%88%99%E5%AD%A6%E4%B9%A0/#toc-heading-28">https://donghuan1224.gitee.io/my-blog/2022/02/10/迷惑点合集/6_正则学习/#toc-heading-28</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;正则表达式&quot;&gt;正则表达式&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;正则表达式&lt;/strong&gt;（Regular Expression）是用于&lt;strong&gt;匹配&lt;/strong&gt;字符串中字符组合的模式。&lt;/li&gt;
&lt;li&gt;在 JavaScript中，正则表达式</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="正则表达式" scheme="https://blog.cilicili.xyz/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>【前端】Vue核心基础(Vue2.x &amp; Vue3.x &amp; 常用组件库)</title>
    <link href="https://blog.cilicili.xyz/posts/4070eb25.html"/>
    <id>https://blog.cilicili.xyz/posts/4070eb25.html</id>
    <published>2022-09-06T13:06:54.000Z</published>
    <updated>2022-09-09T12:14:38.965Z</updated>
    
    <content type="html"><![CDATA[<h1>Vue 核心基础</h1><p><a href="https://cn.vuejs.org/">官网传送门</a></p><blockquote><p>Vue 是动态构建用户界面的渐进式 JavaScript 框架</p><p>Vue 借鉴 Angular 的模板和数据绑定技术，React 的组件化和虚拟 DOM 技术</p></blockquote><h2 id="数据驱动视图">数据驱动视图</h2><h3 id="MVVM模型">MVVM模型</h3><ul><li>M：模型<strong>Model</strong>，<code>data</code>中的数据</li><li>V：视图<strong>View</strong>，模板代码</li><li>VM：视图模型<strong>ViewModel</strong>，<code>Vue实例</code></li></ul><p>观察发现</p><ul><li><code>data</code>中所有的属性，最后都出现在了<code>vm</code>身上</li><li><code>vm</code>身上所有的属性及<code>Vue原型</code>身上所有的属性，在<code>Vue模板</code>中都可以直接使用</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/1643097677438-36b4834c-18e8-4cd0-aa8e-c5f154e6bde0.jpeg" alt="img"></p><p>MVVM：数据驱动视图，即通过修改视图就能改变数据，反过来也可以。</p><p>本质：<strong>事件 + 方法 + 改变数据 = ViewModel</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  // 事件</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;   </span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;vue&#x27;</span>,</span><br><span class="line"><span class="attr">list</span>: [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;  <span class="comment">// Model</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">changeName</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;双越&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;  <span class="comment">// 方法</span></span><br></pre></td></tr></table></figure><h2 id="数据代理">数据代理</h2><h3 id="Object-defineProperty-的使用">Object.defineProperty() 的使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> number = <span class="number">19</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置一</span></span><br><span class="line"><span class="comment">// 参数：对象、属性名、配置</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(person, <span class="string">&#x27;age&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// 属性值</span></span><br><span class="line">  <span class="attr">value</span>: <span class="number">21</span>,</span><br><span class="line">  <span class="comment">// 属性是否可修改</span></span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 属性是否可枚举（遍历）</span></span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 属性是否可删除</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(person)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置二</span></span><br><span class="line"><span class="comment">// getter、setter 不能和 value、writable 同时指定</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(person, <span class="string">&#x27;age&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">enumberable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;age 属性被读取&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> number</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;age 属性被修改&#x27;</span>, value)</span><br><span class="line">    number = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="何为数据代理">何为数据代理</h3><p>数据代理：通过一个对象对另一个对象的属性进行操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">a</span>: <span class="number">21</span> &#125;</span><br><span class="line"><span class="keyword">let</span> obj2 = &#123; <span class="attr">b</span>: <span class="number">10</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj2, <span class="string">&#x27;a&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.<span class="property">a</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    obj.<span class="property">a</span> = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj2.<span class="property">a</span> <span class="comment">// 21</span></span><br><span class="line">obj2.<span class="property">a</span> = <span class="number">1000</span></span><br><span class="line">obj.<span class="property">a</span> <span class="comment">// 1000</span></span><br></pre></td></tr></table></figure><h3 id="Vue-中的数据代理">Vue 中的数据代理</h3><p><img src= "/img/loading.gif" data-lazy-src="https://brucecai55520.gitee.io/bruceblog/assets/img/%E6%95%B0%E6%8D%AE%E4%BB%A3%E7%90%86.d776171e.png" alt="img"></p><p>Vue 中通过 vm 实例对象代理对 data 对象属性的操作，让我们更方便操作 data 中的数据。</p><p>data 中的数据实际上被存在 <code>vm._data</code> 属性上，如果不进行代理，使用起来很不方便。</p><p>通过 <code>Object.defineProperty()</code> 给 vm 添加属性，并且指定 getter 和 setter，通过 getter 和 setter 访问和修改 data 对应是属性。</p><h2 id="Vue-监测数据的原理">Vue 监测数据的原理</h2><blockquote><p>监测数据，即 Vue 是如何监听数据发生变化，从而重新解析模板渲染页面的。Vue 会监测 data 中所有层级的数据。</p></blockquote><h3 id="Vue-监测对象数据">Vue 监测对象数据</h3><ul><li><p>原理：通过 <code>Object.defineProperty()</code> 为属性添加 <code>getter</code>、<code>setter</code> ，对属性的读取、修改进行拦截，即数据劫持</p></li><li><p>存在问题：</p><ul><li>对象新增加的属性，默认不做响应式处理</li><li>对象删除属性，也不是响应式的</li></ul></li><li><p>解决办法，使用如下 API ：</p><ul><li><code>Vue.set(target, propertyName/index, value)</code></li><li><code>vm.$set(target, propertyName/index, value)</code></li><li><code>Vue.delete(target, propertyName/index)</code></li><li><code>vm.$delete(target, propertyName/index)</code></li></ul></li><li><p><code>Vue.set()</code> 和 <code>vm.$set()</code> 不能给 vm 或 vm 的根数据对象添加属性（即 data）</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单模拟实现对象的数据监测，Vue 更完善</span></span><br><span class="line"><span class="comment">// Vue 通过 vm.name 即可修改</span></span><br><span class="line"><span class="comment">// Vue 实现深层监听</span></span><br><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">99</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Observer</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)</span><br><span class="line"></span><br><span class="line">  keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, key, &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj[key]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据被修改，重新解析模板...&#x27;</span>)</span><br><span class="line">        obj[key] = value</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> observer = <span class="keyword">new</span> <span class="title class_">Observer</span>(person)</span><br><span class="line">vm.<span class="property">_data</span> = observer</span><br></pre></td></tr></table></figure><h3 id="Vue-监测数组">Vue 监测数组</h3><ul><li>原理：通过重写数组的 API 实现拦截：<code>push()、pop()、shift()、unshift()、splice()、sort()、reverse()</code></li><li>7 个 API 之所以是响应式的，是因为 Vue 对这些方法进行了<a href="https://cn.vuejs.org/v2/guide/list.html#%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B">包裹 </a>，即二次封装。做了两件事：调用对应的原生方法更新数组 &amp; 重新解析模板更新页面</li><li>存在问题：<ul><li>直接通过数组下标修改是<a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E5%AF%B9%E4%BA%8E%E6%95%B0%E7%BB%84">非响应式的</a></li></ul></li><li>解决办法：<ul><li>使用 7 个 API 修改数组</li><li><code>Vue.set()</code>、<code>vm.$set()</code></li><li><code>Vue.delete()</code>、<code>vm.$delete()</code></li></ul></li><li><a href="https://segmentfault.com/a/1190000015783546">思否文章</a></li></ul><h2 id="插值语法">插值语法</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：&#123;&#123; username &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>密码&#123;&#123; password &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &#123;&#123;&#125;&#125; 支持简 JS 表达式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; flag ? 111 : 000&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;docsify&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="number">55520</span>,</span><br><span class="line">    <span class="attr">flag</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="属性绑定指令-v-bind">属性绑定指令 v-bind</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-bind:placeholder</span>=<span class="string">&quot;desc&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- v-bind 简写形式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;url&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;这是一张图片&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- v-bind 支持 JS 表达式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:id</span>=<span class="string">&quot;&#x27;hello&#x27; + 1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;请输入用户名&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;www.baidu.com&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="双向绑定指令-v-model">双向绑定指令 v-model</h2><p><code>v-model</code> 用于表单元素如 <code>input</code>，<code>textarea</code>，<code>select</code> 。</p><h3 id="v-model-基础用法">v-model 基础用法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; username &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; province &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;province&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>请选择<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="v-model-指令修饰符">v-model 指令修饰符</h3><table><thead><tr><th>修饰符</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>.number</td><td>将用户输入转为数值类型</td><td><code>&lt;input v-model.number=&quot;age&quot; /&gt;</code></td></tr><tr><td>.trim</td><td>删除输入的首尾空白字符</td><td><code>&lt;input v-model.trim=&quot;msg&quot;&gt;</code></td></tr><tr><td>.lazy</td><td>当失去焦点时，才更新数据，类似防抖</td><td><code>&lt;input v-model.lazy=&quot;msg&quot;&gt;</code></td></tr></tbody></table><h3 id="v-model-收集表单数据">v-model 收集表单数据</h3><ul><li><p><code>&lt;input type=&quot;text&quot;/&gt;</code> ，收集的是 <code>value</code> 值，用户输入的就是 <code>value</code> 值。</p></li><li><p><code>&lt;input type=&quot;radio&quot;/&gt;</code> ，收集的是 <code>value</code> 值，且要给标签配置 <code>value</code> 值。</p></li><li><p><code>&lt;input type=&quot;checkbox&quot;/&gt;</code></p><ul><li>没有配置 <code>value</code> 属性，收集的就是 <code>checked</code></li><li>配置了 value属性:<ul><li><code>v-model</code> 的初始值是非数组，那么收集的就是 <code>checked</code></li><li><code>v-model</code> 的初始值是数组，那么收集的的就是 <code>value</code> 组成的数组</li></ul></li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span>=<span class="string">&quot;demo&quot;</span>&gt;</span></span><br><span class="line">    账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.trim</span>=<span class="string">&quot;userInfo.account&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.password&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&quot;userInfo.age&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    性别： 男<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    女<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;female&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    爱好： 学习<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;study&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    打游戏<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;game&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    吃饭<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;eat&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    所属校区</span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.city&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>请选择校区<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shenzhen&quot;</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;wuhan&quot;</span>&gt;</span>武汉<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    其他信息：</span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;userInfo.other&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;userInfo.agree&quot;</span> /&gt;</span>阅读接受协议</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">userInfo</span>:&#123;</span><br><span class="line">      <span class="attr">account</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">password</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">age</span>:<span class="number">18</span>,</span><br><span class="line">      <span class="attr">sex</span>:<span class="string">&#x27;female&#x27;</span>,</span><br><span class="line">      <span class="attr">hobby</span>:[],</span><br><span class="line">      <span class="attr">city</span>:<span class="string">&#x27;beijing&#x27;</span>,</span><br><span class="line">      <span class="attr">other</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">agree</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">demo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">userInfo</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="事件绑定指令-v-on">事件绑定指令 v-on</h2><h3 id="v-on-基础用法">v-on 基础用法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>count的值：&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- v-on 缩写形式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="事件参数对象">事件参数对象</h3><p>如果事件处理函数没有传参，则默认会传一个时间参数对象 <code>$event</code> ，通过它可以获取触发事件的元素，并进行相关操作。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    e.<span class="property">target</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果事件处理函数传递参数了，则默认的 <code>$event</code> 会被覆盖，需要手动进行传递。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add(2, $event)&quot;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">step, e</span>) &#123;</span><br><span class="line">    e.<span class="property">target</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> += step</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="事件修饰符">事件修饰符</h3><table><thead><tr><th>事件修饰符</th><th>说明</th></tr></thead><tbody><tr><td><strong>.prevent</strong></td><td>阻止默认行为，如 a 链接跳转、表单提交</td></tr><tr><td><strong>.stop</strong></td><td>阻止事件冒泡</td></tr><tr><td>.once</td><td>绑定的事件只触发 1 次</td></tr><tr><td>.capture</td><td>以捕获模式触发事件处理函数</td></tr><tr><td>.self</td><td>只有在 <code>event.target</code> 是当前元素自身时触发事件处理函数</td></tr><tr><td>.passive</td><td>事件的默认行为立即执行，无需等待事件回调执行完毕</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.baidu.com&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;fn&quot;</span>&gt;</span>阻止链接跳转<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.stop</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span>阻止事件冒泡<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- .passive ：如 `onwheel` 鼠标滚轮事件，是先执行事件的回调再进行滚动。 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 如果回调比较耗时，那么会等一段时间才发生滚动。 添加 .passive 后，则先进行滚动再执行回调。--&gt;</span></span><br></pre></td></tr></table></figure><h3 id="按键修饰符">按键修饰符</h3><ol><li>Vue 中常用的按键别名：</li></ol><ul><li>回车 =&gt; enter</li><li>删除 =&gt; delete (捕获“删除”和“退格”键)</li><li>退出 =&gt; esc</li><li>空格 =&gt; space</li><li>换行 =&gt; tab (特殊，必须配合 keydown 去使用)</li><li>上 =&gt; up</li><li>下 =&gt; down</li><li>左 =&gt; left</li><li>右 =&gt; right</li></ul><ol start="3"><li><p>Vue 未提供别名的按键，可以使用按键原始的 <code>key</code> 值去绑定，但注意要转为 kebab-case（短横线命名）</p></li><li><p>系统修饰键（用法特殊）：ctrl、alt、shift、meta（即 win 键）</p></li></ol><ul><li>配合 keyup 使用：按下修饰键的同时，再按下其他键，随后释放其他键，事件才被触发。</li><li>配合 keydown 使用：正常触发事件。</li></ul><ol start="5"><li><p>可使用 keyCode 去指定具体的按键，此法不推荐，因为 keyCode 以后可能废除</p></li><li><p><code>Vue.config.keyCodes.自定义键名 = 键码</code> ，可以去定制按键别名</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.esc</span>=<span class="string">&quot;back&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keydown.tab</span>=<span class="string">&quot;showInfo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.caps-lock</span>=<span class="string">&quot;showInfo&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.huiche</span>=<span class="string">&quot;showInfo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.13</span>=<span class="string">&quot;showInfo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  Vue.config.keyCodes.huiche = 13</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="条件渲染指令">条件渲染指令</h2><h3 id="基础用法">基础用法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;status === 200&quot;</span>&gt;</span>success<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else-if</span>=<span class="string">&quot;status === 201&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>yyy<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-show</span>=<span class="string">&quot;status === 404&quot;</span>&gt;</span>error<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- template 只能和 v-if 搭配使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;status === 200&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>222<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>333<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="v-if-和-v-show-的区别">v-if 和 v-show 的区别</h3><p>实现原理不同：</p><ul><li><code>v-if</code> 通过创建或删除 DOM 元素来控制元素的显示与隐藏</li><li><code>v-show</code> 通过添加或删除元素的 <code>style=&quot;display: none&quot;</code> 样式来控制元素的显示与隐藏</li></ul><p>性能消耗不同：</p><ul><li><code>v-if</code> 切换开销更高，如果运行时条件很少改变，使用 <code>v-if</code> 更好</li><li><code>v-show</code> 初始渲染开销更高，如果切换频繁，使用 <code>v-show</code> 更好</li></ul><h2 id="列表渲染指令-v-for">列表渲染指令 v-for</h2><h3 id="基本用法">基本用法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 遍历数组 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 遍历对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(value, key) in obj&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;key&quot;</span>&gt;</span>&#123;&#123; key &#125;&#125; - &#123;&#123; value &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 遍历字符串 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(char, index) in str&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; index &#125;&#125; - &#123;&#123; char &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 遍历次数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(number, index) in 5&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; index &#125;&#125; - &#123;&#123; number &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">list</span>: [...],</span><br><span class="line">    <span class="attr">obj</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Bruce&#x27;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">88</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&#x27;unknown&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">str</span>: <span class="string">&#x27;hello vue&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="key-的作用">key 的作用</h3><p><strong><code>key</code> 的作用：</strong></p><ul><li>当列表的数据变化时，默认情况下，vue 会尽可能的复用已存在的 DOM 元素，从而提升渲染的性能。但这种默认的性能优化策略，会导致有状态的列表无法被正确更新。</li><li>为了给 vue 一个提示，以便它能跟踪每个节点的身份，从而在保证有状态的列表被正确更新的前提下，提升渲染的性能。此时，需要为每项提供一个唯一的 key 属性。</li><li><code>key</code> 是虚拟 DOM 对象的标识，可提高页面更新渲染的效率。当数据变化时，Vue 会根据新数据生成新的虚拟 DOM，随后进行新旧虚拟 DOM 的差异比较</li></ul><p><strong>比较规则</strong></p><ul><li>旧虚拟 DOM 找到和新虚拟 DOM 相同的 key：<ul><li>若内容没变，直接复用真实 DOM</li><li>若内容改变，生成新的真实 DOM，替换旧的真实 DOM</li></ul></li><li>旧虚拟 DOM 未找到和新虚拟 DOM 相同的 key：创建新的真实 DOM，渲染到页面</li></ul><p><strong><code>key</code> 的注意事项：</strong></p><ul><li>key 的值只能是<strong>字符串</strong>或<strong>数字</strong>类型</li><li>key 的值必须具有唯一性（即：key 的值不能重复）</li><li>建议把数据项 id 属性的值作为 key 的值（因为 id 属性的值具有唯一性）</li><li>使用 index 的值当作 key 的值没有意义（因为 index 的值不具有唯一性）</li><li>建议使用 v-for 指令时一定要指定 key 的值（既提升性能、又防止列表状态紊乱）</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://brucecai55520.gitee.io/bruceblog/assets/img/key.2e34b3cc.png" alt="key的作用"></p><h2 id="其它内置指令">其它内置指令</h2><h3 id="v-text">v-text</h3><p><code>v-text</code> 指令会覆盖元素默认值。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-text</span>=<span class="string">&quot;username&quot;</span>&gt;</span>这段内容会被覆盖<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> &#123; <span class="attr">username</span>: <span class="string">&quot;Bruce&quot;</span> &#125; &#125;</span><br></pre></td></tr></table></figure><h3 id="v-html">v-html</h3><blockquote><p>v-html 存在安全问题，容易导致 XSS 攻击</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;desc&quot;</span>&gt;</span>原本内容被覆盖<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;&lt;h1 style=&quot;color: red&quot;&gt;红色标题&lt;/h1&gt;&#x27;</span>，</span><br><span class="line">    <span class="attr">str</span>: <span class="string">&#x27;&lt;a href=&quot;http://www.baidu.com?&quot;+document.cookie&gt;兄弟我找到你想要的资源了，快来！&lt;/a&gt;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="v-cloak">v-cloak</h3><ul><li>本质是一个特殊属性，Vue 实例创建完毕并接管容器后，会删除 <code>v-cloak</code> 属性</li><li>使用 CSS 配合 <code>v-cloak</code> 可解决网速慢时页面展示 的问题</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[v-cloak]</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-cloak</span>&gt;</span>&#123;&#123; username &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="v-once">v-once</h3><ul><li><code>v-once</code> 所在节点初次渲染后就成为静态内容</li><li>即数据变化不会引起 <code>v-once</code> 所在节点内容的更新，可用于优化性能</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-once</span>&gt;</span>初次的内容：&#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>最新的内容：&#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="v-pre">v-pre</h3><ul><li>跳过所在节点的编译过程</li><li>没有使用插值语法等特殊语法的节点，可用其跳过编译过程，加快编译</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-pre</span>&gt;</span>Vue 内置指令<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：&#123;&#123; username &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="过滤器">过滤器</h2><ul><li>过滤器常用于文本的格式化，可用在插值表达式和 <code>v-bind</code> 属性绑定。</li><li>过滤器只在 <code>vue 2.x</code> 和 <code>vue 1.x</code> 中支持，<code>vue 3.x</code> 废弃了过滤器，官方建议使用计算属性或方法代替过滤器。</li></ul><h3 id="基本使用-v2">基本使用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在 JS 表达式尾部通过管道符进行调用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message | capitalize &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:id</span>=<span class="string">&quot;rawId | formatId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义私有过滤器</span></span><br><span class="line"><span class="attr">filters</span>: &#123;</span><br><span class="line">  <span class="title function_">capitalize</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">charAt</span>(<span class="number">0</span>).<span class="title function_">toUpperCase</span>() + str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 main.js 中定义全局过滤器</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">&#x27;capitalize&#x27;</span>, <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">charAt</span>(<span class="number">0</span>).<span class="title function_">toUpperCase</span>() + str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果私有过滤器和全局过滤器冲突，按照就近原则调用私有过滤器。</p><h3 id="连续调用多个过滤器">连续调用多个过滤器</h3><p>过滤器从左往右调用，前一个过滤器的结果交给下一个过滤器继续处理。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; text | capitalize | maxLength &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="过滤器传参">过滤器传参</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message | myFilter(arg1, arg2) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个参数永远都是管道符前的值</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">&#x27;myFilter&#x27;</span>, <span class="function">(<span class="params">value, arg1, arg2</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="computed-计算属性">computed 计算属性</h2><ul><li>定义：使用的属性不存在，要通过已有属性计算得到</li><li>原理：底层使用了 <code>Object.defineProperty()</code> 提供的 getter 和 setter</li><li>getter 何时执行：<ul><li>初次读取时执行一次</li><li>依赖的数据发生改变时执行</li></ul></li><li>优点：与 <code>methods</code> 相比，有缓存机制，效率更高</li><li>若计算属性要修改，必须声明 setter 响应修改，且 setter 中要引起依赖的数据发生改变</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; fullName &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 完整写法</span></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  <span class="attr">fullName</span>: &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 计算属性依赖于已有属性得到</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&#x27;-&#x27;</span> + <span class="variable language_">this</span>.<span class="property">lastName</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="comment">// setter 中要引起依赖数据的变化</span></span><br><span class="line">      <span class="keyword">const</span> arr = value.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">firstName</span> = arr[<span class="number">0</span>]</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">lastName</span> = arr[<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写形式</span></span><br><span class="line"><span class="comment">// 只有明确计算属性不需要被修改时，才能用简写形式，即没有 setter</span></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  <span class="title function_">fullName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="variable language_">this</span>.<span class="property">lastName</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="watch-侦听器">watch 侦听器</h2><p><code>watch</code> 侦听器允许开发者监视数据的变化，针对数据的变化做特定的操作。</p><blockquote><p>侦听器可以监听普通属性和计算属性</p><p><code>computed</code> 能完成的功能，<code>watch</code> 也能</p><p><code>watch</code> 能完成的功能，<code>computed</code> 不一定，如异步操作</p></blockquote><ul><li>Vue 管理的函数写成普通函数，使其 <code>this</code> 指向 vue 实例对象</li><li>不被 Vue 管理的函数写成箭头函数（定时器回调、<code>ajax</code> 回调、<code>Promise</code> 回调），这样其 <code>this</code> 才是 vue 实例对象</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// watch 简写形式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="title function_">username</span>(<span class="params">newVal, oldVal</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;新值: &#x27;</span>, newVal)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;旧值: &#x27;</span>, oldVal)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>默认情况下，组件在初次加载完毕后不会调用 <code>watch</code> 侦听器。如果想让 <code>watch</code> 侦听器立即被调用，需要使用 <code>immediate</code> 选项：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line">  <span class="comment">// 对象形式的侦听器</span></span><br><span class="line">  <span class="attr">username</span>: &#123;</span><br><span class="line">    <span class="comment">// handler 属性是固定写法</span></span><br><span class="line">    <span class="title function_">handler</span>(<span class="params">newVal, oldVal</span>) &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当 <code>watch</code> 侦听的是一个对象，如果对象中的属性值发生了变化，则无法被监听到。此时需要使用 <code>deep</code> 选项进行<strong>深度监听</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">info</span>: &#123; <span class="attr">username</span>: <span class="string">&#x27;admin&#x27;</span> &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">info</span>: &#123;</span><br><span class="line">      <span class="title function_">handler</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若只想监听对象里单个属性的变化，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">info</span>: &#123; <span class="attr">username</span>: <span class="string">&#x27;admin&#x27;</span> &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="comment">// 记得加引号</span></span><br><span class="line">    <span class="string">&#x27;info.username&#x27;</span>: &#123;</span><br><span class="line">      <span class="title function_">handler</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过 Vue 实例的 <code>$watch</code> 监听：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;...&#125;)</span><br><span class="line"></span><br><span class="line">vm.$watch(<span class="string">&#x27;isHot&#x27;</span>,&#123;</span><br><span class="line">  <span class="attr">immediate</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">handler</span>(<span class="params">newValue,oldValue</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">vm.$watch(<span class="string">&#x27;isHot&#x27;</span>,<span class="keyword">function</span>(<span class="params">newValue,oldValue</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="动态绑定-class-和-style">动态绑定 class 和 style</h2><p>通过动态绑定 <code>class</code> 属性和行内 <code>style</code> 样式，可动态操作元素样式。</p><h3 id="动态绑定-class-类名">动态绑定 class 类名</h3><ul><li>字符串写法：类名不确定，要动态获取</li><li>对象写法：要绑定多个样式，个数不确定，名字也不确定</li><li>数组写法：要绑定多个样式，个数确定，名字也确定，但不确定用不用</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-class">.happy</span> &#123;</span><br><span class="line">    ...;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.sad</span> &#123;</span><br><span class="line">    ...;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;basic&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;mood&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeMood&quot;</span>&gt;</span>字符串写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;basic&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;arr&quot;</span>&gt;</span>数组写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;basic&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;classObj&quot;</span>&gt;</span>对象写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">mood</span>: <span class="string">&#x27;happy&#x27;</span>,</span><br><span class="line">      <span class="attr">arr</span>: [<span class="string">&#x27;happy&#x27;</span>, <span class="string">&#x27;sad&#x27;</span>],</span><br><span class="line">      <span class="attr">classObj</span>: &#123;</span><br><span class="line">        <span class="attr">happy</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">sad</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">changeMood</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">mood</span> = <span class="string">&#x27;sad&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="动态绑定-style-样式">动态绑定 style 样式</h3><p><code>css</code> 属性名既可以用驼峰形式，也能用短横线形式（需要使用引号括起来）。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;color: active, fontSize: fsize + &#x27;px&#x27;, &#x27;background-color&#x27;: bgcolor&#125;&quot;</span>&gt;</span>对象写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;styleObj&quot;</span>&gt;</span>对象写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;[styleObj, styleObj2]&quot;</span>&gt;</span>数组写法（用得少）<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">active</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">fsize</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">bgcolor</span>: <span class="string">&#x27;yellow&#x27;</span>,</span><br><span class="line">    <span class="attr">styleObj</span>: &#123;</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;active&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;font-size&#x27;</span>: <span class="string">&#x27;20px&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">styleObj2</span>: &#123;</span><br><span class="line">      <span class="attr">backgroundColor</span>: <span class="string">&#x27;yellow&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="vue-生命周期">vue 生命周期</h2><p>vue 生命周期是指一个组件从创建、运行、销毁的整个过程。每个阶段对应着不同的生命周期钩子。</p><p>生命周期钩子也可理解为：Vue 在特定的时刻调用特定的函数。</p><p>除了图中 8 个钩子，还有 <code>nextTick</code>，<code>activated</code>，<code>deactivated</code></p><p>关于销毁过程：</p><ul><li>销毁后借助 Vue 开发者工具看不到任何信息。</li><li>销毁后自定义事件会失效，但原生 DOM 事件依然有效。</li><li>一般不在 <code>beforeDestroy</code> 操作数据，因为即便操作数据，也不会再触发更新流程</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/lifecycle2.6eba8c66.png" alt="生命周期图2"> <img src= "/img/loading.gif" data-lazy-src="https://brucecai55520.gitee.io/bruceblog/assets/img/lifecycle.e6900649.png" alt="生命周期图"></p><h1>Vue 组件化编程</h1><blockquote><p>组件：实现应用局部功能代码和资源的集合</p></blockquote><h2 id="非单文件组件">非单文件组件</h2><p>非单文件组件即所有组件写在同一个文件里。</p><h3 id="基本使用-v3">基本使用</h3><p>定义组件：</p><ul><li>使用<code>Vue.extend(options)</code>创建，和<code>new Vue(options)</code>的区别<ul><li><code>el</code> 不写，最终所有的组件都要经过 vm 的管理，由 vm 的 <code>el</code> 决定服务哪个容器</li><li><code>data</code> 必须写成函数，避免组件被复用时，数据存在引用关系</li><li>使用 <code>template</code> 节点可配置组件结构</li></ul></li></ul><p>注册组件；</p><ul><li>局部注册：<code>components</code> 选项</li><li>全局注册：<code>Vue.component('组件名',组件)</code></li></ul><p>使用组件：<code>&lt;school&gt;&lt;/school&gt;</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hello</span>&gt;</span><span class="tag">&lt;/<span class="name">hello</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">school</span>&gt;</span><span class="tag">&lt;/<span class="name">school</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 student 组件</span></span><br><span class="line"><span class="keyword">const</span> student = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h2&gt;学生姓名：&#123;&#123;studentName&#125;&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">studentName</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 hello 组件</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h2&gt;&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Tom&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 school 组件</span></span><br><span class="line"><span class="keyword">const</span> school = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;school&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h2&gt;学校名称：&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">      &lt;student&gt;&lt;/student&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;北京大学&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 组件嵌套</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    student,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局注册</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;hello&#x27;</span>, hello)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#root&#x27;</span>,</span><br><span class="line">  <span class="comment">// 局部注册</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    school,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>注意事项：</p><ol><li>组件名</li></ol><ul><li>一个单词：school, School</li><li>多个单词：my-school, MySchool(需要 vue-cli 支持)</li></ul><ol start="2"><li>使用组件</li></ol><ul><li><code>&lt;school&gt;&lt;/school&gt;</code></li><li><code>&lt;school /&gt;</code> (需要 vue-cli 支持)</li></ul><ol start="3"><li><code>const school = Vue.extend(options)</code> 可简写为 <code>const school = options</code>。这是脚手架里 <code>&lt;script&gt;</code> 代码的简写来源。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">HelloWorld</span> <span class="keyword">from</span> <span class="string">&#x27;./components/HelloWorld.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">HelloWorld</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 完整写法</span></span><br><span class="line"><span class="keyword">const</span> vc = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">HelloWorld</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vc</span><br></pre></td></tr></table></figure><h3 id="关于-VueComponent-构造函数">关于 VueComponent 构造函数</h3><ol><li>组件本质是一个名为 <code>VueComponent</code> 的构造函数，不是程序员定义的，是 <code>Vue.extend</code> 生成的</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> school = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;...&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(school) <span class="comment">//ƒ VueComponent (options)</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>使用组件时，Vue 自动创建组件实例对象，即 <code>new VueComponent(options)</code> 是 Vue 做的</p></li><li><p>每次调用 <code>Vue.extend</code>，返回的都是一个全新的 <code>VueComponent</code> 构造函数</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> school = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;...&#125;)</span><br><span class="line"><span class="keyword">const</span> student = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;...&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(school === student) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><ol start="4"><li><p>组件的 <code>this</code> 指向 <code>VueComponent</code> 实例对象，而非 Vue 实例对象</p></li><li><p>重要的内置关系：<code>VueComponent.prototype.__proto__ === Vue.prototype</code> ，这个改动使得组件实例对象得以访问 Vue 原型上的属性方法</p></li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/VueComponent.66788a9c.png" alt="VueComponent"></p><h2 id="单文件组件">单文件组件</h2><p>单文件组件即 <code>.vue</code> 文件</p><h2 id="scoped-解决样式冲突">scoped 解决样式冲突</h2><ul><li>原理：为当前组件所有 DOM 元素分配唯一的自定义属性，写样式时使用属性选择器防止样式冲突问题</li><li><code>scoped</code> 只给子组件最外层的 div 添加了自定义属性 <code>[data-v-xxx]</code> ，子组件内部的标签并没有添加。因此父组件只能修改子组件最外层的 div 样式，修改子组件内层元素的样式是不可行的</li><li>若想让某些样式对子组件生效，需使用 <code>/deep/</code> 深度选择器</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 细细品味 */</span></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="comment">/* 不加 /deep/，选择器格式为 .title[data-v-052242de] */</span></span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/deep/ <span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="comment">/* 加 /deep/，选择器格式为 [data-v-052242de] .title */</span></span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="组件通信">组件通信</h2><h3 id="自定义属性-props">自定义属性 props</h3><blockquote><p>父传子、子传父</p></blockquote><p><code>props</code> 验证：</p><ul><li>基础类型检查：<code>String, Number, Boolean, Array, Object, Date, Function, Symbol</code></li><li>多个可能的类型</li><li>必填项检查</li><li><a href="https://www.cnblogs.com/mmzuo-798/p/15188014.html">默认值</a></li><li>自定义验证函数 <code>validator</code></li><li><code>props</code> 是只读的，若是对象，对象内部的修改不报错，但不推荐。若需修改，则把 <code>props</code> 内容拷贝一份到 <code>data</code> 进行修改</li></ul><p><strong>父传子：</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父组件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 若 props 属性使用驼峰命名法，可使用驼峰形式或短横线分隔形式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">:num</span>=<span class="string">&quot;count&quot;</span> <span class="attr">:msg</span>=<span class="string">&quot;message&quot;</span> <span class="attr">:pub-time</span>=<span class="string">&quot;time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>父组件传过来的值：&#123;&#123; num &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>父组件传过来的值：&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组形式</span></span><br><span class="line"><span class="attr">props</span>: [<span class="string">&#x27;num&#x27;</span>, <span class="string">&#x27;msg&#x27;</span>, <span class="string">&#x27;pubTime&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 仅限制类型</span></span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line">  <span class="attr">num</span>: <span class="title class_">Number</span>,</span><br><span class="line">  <span class="attr">msg</span>: <span class="title class_">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象形式</span></span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line">  <span class="attr">num</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">msg</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Number</span>],</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">validator</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> value === <span class="string">&#x27;hello&#x27;</span> || value === <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">default</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>子传父：</strong></p><ul><li>父组件通过 <code>props</code> 给子组件传递函数，子组件调用该函数即可修改父组件的数据</li><li>组件 <code>methods</code> 里函数的 this 始终指向该组件实例，可理解为 Vue 底层对这些函数做了<code>bind</code>处理</li><li>通过<code>bind</code>修改 this 指向后的新函数，其 this 指向不能再次修改。<a href="https://cn.vuejs.org/v2/api/#methods">官网说明</a></li><li><a href="https://segmentfault.com/q/1010000015951625">思否文章</a></li><li>不推荐该方式进行子传父，推荐使用自定义事件</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">:addCount</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;addCount&#x27;</span>],</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">addCount</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义事件">自定义事件</h3><blockquote><p>自定义事件可用于实现子传父</p></blockquote><p>子组件触发自定义事件，并传递数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> += <span class="number">1</span></span><br><span class="line">    <span class="variable language_">this</span>.$emit(<span class="string">&#x27;count-change&#x27;</span>, <span class="variable language_">this</span>.<span class="property">count</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>父组件监听子组件的自定义事件，并调用回调函数处理数据：</p><ul><li>父组件通过 <code>this.$refs.xxx.$on('事件名称',回调)</code> 监听子组件自定义事件时，回调函数要么配置在 <code>methods</code> 中，要么用箭头函数，否则 this 指向会出问题</li><li>组件上也可以绑定原生 DOM 事件，需要使用 <code>native</code> 修饰符</li><li>若想让自定义事件只触发一次，可以使用 <code>once</code> 修饰符，或 <code>$once</code> 方法</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方式一 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> @<span class="attr">count-change</span>=<span class="string">&quot;getNewCount&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> @<span class="attr">count-change.once</span>=<span class="string">&quot;getNewCount&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 方式二 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">ref</span>=<span class="string">&quot;sonRef&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 监听子组件原生 DOM 事件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> @<span class="attr">click.native</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">father</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getNewCount</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">father</span> = val</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 方式二</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">sonRef</span>.$on(<span class="string">&#x27;count-change&#x27;</span>, <span class="variable language_">this</span>.<span class="property">getNewCount</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">sonRef</span>.$once(<span class="string">&#x27;count-change&#x27;</span>, <span class="variable language_">this</span>.<span class="property">getNewCount</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 或</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">sonRef</span>.$on(<span class="string">&#x27;count-change&#x27;</span>, <span class="function">(<span class="params">val</span>) =&gt;</span> (<span class="variable language_">this</span>.<span class="property">father</span> = val))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解绑自定义事件<code>this.$off()</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解绑单个自定义事件</span></span><br><span class="line"><span class="variable language_">this</span>.$off(<span class="string">&#x27;count-change&#x27;</span>)</span><br><span class="line"><span class="comment">// 解绑多个自定义事件</span></span><br><span class="line"><span class="variable language_">this</span>.$off([<span class="string">&#x27;count-change&#x27;</span>, <span class="string">&#x27;add&#x27;</span>])</span><br><span class="line"><span class="comment">// 解绑所有自定义事件</span></span><br><span class="line"><span class="variable language_">this</span>.$off()</span><br></pre></td></tr></table></figure><h3 id="EventBus-全局事件总线">EventBus 全局事件总线</h3><blockquote><p>思想：弄一个所有组件实例都能访问到的 Vue 实例对象，Vue 原型上包含事件处理的相关方法，包括 <code>$on, $emit, $off, $once</code></p></blockquote><p><strong>方式一</strong></p><p>安装全局事件总线：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$bus</span> = <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>数据接收方为自定义事件绑定回调函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">handleData</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$bus</span>.$on(<span class="string">&#x27;share&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleData</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 组件销毁，解绑事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$bus</span>.$off(<span class="string">&#x27;share&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>数据发送方触发自定义事件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">sendData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$bus</span>.$emit(<span class="string">&#x27;share&#x27;</span>, <span class="number">666</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>方式二</strong></p><p>创建 eventBus.js 模块，并向外共享一个 Vue 的实例对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eventBus.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vue</span>()</span><br></pre></td></tr></table></figure><p>在数据发送方，调用 <code>bus.$emit('事件名称', 要发送的数据)</code> 方法触发自定义事件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据发送方</span></span><br><span class="line"><span class="keyword">import</span> bus <span class="keyword">from</span> <span class="string">&#x27;./eventBus.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">sendData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      bus.$emit(<span class="string">&#x27;share&#x27;</span>, <span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在数据接收方，通过 <code>bus.$on('事件名称', 事件处理函数)</code> 为自定义事件注册事件处理函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据接收方</span></span><br><span class="line"><span class="keyword">import</span> bus <span class="keyword">from</span> <span class="string">&#x27;./eventBus.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 细节1：在 created 钩子中注册函数</span></span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 细节2：使用箭头函数，则 this 指向该组件而非 bus</span></span><br><span class="line">    bus.$on(<span class="string">&#x27;share&#x27;</span>, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">msg</span> = val</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="消息订阅与发布">消息订阅与发布</h3><blockquote><p>与全局事件总线很相似，因此一般用事件总线，不用这个</p></blockquote><p>安装第三方库 <code>PubSubJS</code> ：<code>npm install -S pubsub.js</code></p><p>订阅消息：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pubsub <span class="keyword">from</span> <span class="string">&#x27;pubsub-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">handleData</span>(<span class="params">messageName, data</span>) &#123;...&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pubId</span> = pubsub.<span class="title function_">subscribe</span>(<span class="string">&#x27;share&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleData</span>)</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pubId</span> = pubsub.<span class="title function_">subscribe</span>(<span class="string">&#x27;share&#x27;</span>, <span class="function">(<span class="params">messageName, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 组件销毁，取消订阅</span></span><br><span class="line">    pubsub.<span class="title function_">unsubscribe</span>(<span class="variable language_">this</span>.<span class="property">pubId</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发布消息：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pubsub <span class="keyword">from</span> <span class="string">&#x27;pubsub-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">sendData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      pubsub.<span class="title function_">publish</span>(<span class="string">&#x27;share&#x27;</span>, <span class="number">666</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ref-refs">ref / $refs</h3><p><code>ref</code> 用于给 DOM 元素或子组件注册引用信息。每个 vue 实例都有 <code>$refs</code> 对象，里面存储着 DOM 元素或子组件的引用。通过该方式可以获取到 DOM 元素或子组件实例。</p><blockquote><p>可以父传子，也能子传父。子传父要和自定义事件搭配使用。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用 DOM 元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ref</span>=<span class="string">&quot;pp&quot;</span>&gt;</span>这是段落<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getRef&quot;</span>&gt;</span>获取 DOM 元素<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 引用子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">son</span> <span class="attr">ref</span>=<span class="string">&quot;sonRef&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">son</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getComponent&quot;</span>&gt;</span>获取子组件实例引用<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">getRef</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取元素的引用</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">pp</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">pp</span>.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;red&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">sonRef</span>)</span><br><span class="line">    <span class="comment">// 可以访问子组件的数据和方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">sonRef</span>.<span class="property">count</span> = <span class="number">1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">sonRef</span>.<span class="title function_">add</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>组件的 <code>$nextTick(cb)</code> 方法，会把 cb 回调推迟到下一个 DOM 更新周期之后执行，即在 DOM 更新完成后再执行回调，从而保证 cb 回调可以获取最新的 DOM 元素。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">showInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">inputVisible</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 对输入框的操作推迟到 DOM 更新完成之后</span></span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">input</span>.<span class="title function_">focus</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>Vue 组件进阶</h1><h2 id="动态组件">动态组件</h2><p>vue 提供了内置的 <code>&lt;component&gt;</code> 组件用于动态切换组件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过 is 属性指定要渲染的组件，传递的是字符串 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;comName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;comName = &#x27;Left&#x27;&quot;</span>&gt;</span>展示Left组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;comName = &#x27;Right&#x27;&quot;</span>&gt;</span>展示Right组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="keep-alive">keep-alive</h2><p>默认情况下，切换动态组件时无法保持组件的状态。此时可以使用 vue 内置的 <code>&lt;keep-alive&gt;</code> 组件保持动态组件的状态，对被包裹的组件进行状态缓存。</p><p>被 <code>&lt;keep-alive&gt;</code> 包裹的组件会多出两个生命周期函数：当组件被激活时，触发 <code>activated</code> 钩子；当组件被缓存时，触发 <code>deactivated</code> 钩子。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;comName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;keep-alive&gt;</code> 的 <code>include</code> 和 <code>exclude</code> 属性，分别用于指明哪些组件要缓存、哪些组件不要缓存。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;Left, Right&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;comName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">&quot;[&#x27;News&#x27;, &#x27;Message&#x27;]&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="插槽">插槽</h2><h3 id="何为插槽">何为插槽</h3><p>插槽可以理解为组件封装期间，为用户预留的<strong>内容占位符</strong>。它是 vue 为组件封装者提供的能力，允许开发者在封装组件时，把<strong>不确定的、希望由用户指定的部分</strong>定义为插槽。</p><h3 id="插槽基本用法">插槽基本用法</h3><p>基础使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 子组件中预留插槽 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;contianer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是子组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 父组件使用子组件时，向插槽填充内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">child-comp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>填充到插槽的内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果子组件没有预留插槽，那么父组件填充给子组件的自定义内容会被丢弃：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 子组件没有预留插槽 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;contianer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是子组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 父组件的自定义内容会被丢弃 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">child-comp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>这段自定义内容会被丢弃<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br></pre></td></tr></table></figure><p>子组件可以为插槽提供<strong>后备内容</strong>，当父组件没有提供自定义内容时，后备内容就会生效。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 子组件提供后备内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;contianer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是子组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>这是后备内容，父组件没有提供自定义内容就会生效<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 父组件没有提供自定义内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">child-comp</span>&gt;</span> <span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="具名插槽">具名插槽</h3><p>组件在预留插槽时可以设置 <code>name</code> 属性，为插槽指定名称，这种有具体名称的插槽就叫具名插槽。 没有设置 <code>name</code> 名称的插槽默认名称为 <code>default</code> 。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 子组件预留多个具名插槽 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;contianer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是子组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span>&gt;</span>title 具名插槽<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span>&gt;</span>content 具名插槽<span class="tag">&lt;/<span class="name">slot</span>&gt;</span>&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>没有设置 name 名称则默认为 default<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;default&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>父组件向具名插槽提供自定义内容</p><ul><li>新的写法：包裹一个 <code>&lt;template&gt;</code> 标签，同时在 <code>&lt;template&gt;</code> 中通过 <code>v-slot:名称</code> 指明插槽的名称。简写形式为 <code>#名称</code> ，且 <code>v-slot</code> 只能使用在 <code>&lt;template&gt;</code> 和组件标签上，普通 HTML 标签不行</li><li>旧的写法：<code>slot=&quot;名称&quot;</code> 指明插槽名称</li><li>如果不指定插槽名称，那么自定义内容会被填充到所有的 <code>default</code> 插槽当中</li><li>同一插槽填充多个内容，是追加不是覆盖</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父组件向具名插槽提供自定义内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">child-comp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>《赠汪伦》<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>《静夜思》<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 简写形式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>床前明月光，疑是地上霜。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>举头望明月，低头思故乡。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这段内容没有指定名称，会被填充到所有 default 插槽中。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="作用域插槽">作用域插槽</h3><ul><li>组件可以为插槽绑定自定义属性 <code>props</code> ，这种插槽叫作用域插槽</li><li>理解：数据在组件的自身，但根据数据生成的结构需要组件的使用者来决定</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 子组件为插槽绑定 props 数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:user</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">list</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;Lily&#x27;</span>,</span><br><span class="line">          <span class="attr">state</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;Ben&#x27;</span>,</span><br><span class="line">          <span class="attr">state</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;Water&#x27;</span>,</span><br><span class="line">          <span class="attr">state</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>父组件向插槽提供自定义内容时，可以接收作用域插槽提供的数据：</p><ul><li>旧写法：<code>scope=&quot;scope&quot;</code> 、<code>slot-scope=&quot;scope&quot;</code></li><li>新写法：<code>v-slot:default=&quot;scope&quot;</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">child-comp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>作用域插槽提供的数据：&#123;&#123; scope &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; scope &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中接收到的数据 <code>scope</code> 是一个对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scope 的内容</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&#x27;user&#x27;</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Lily&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;state&#x27;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在接收作用域插槽提供的数据时可以使用解构赋值。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">child-comp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>id：&#123;&#123; user.id &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>name：&#123;&#123; user.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>state：&#123;&#123; user.state &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">child-comp</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="自定义指令">自定义指令</h2><h3 id="分类">分类</h3><ul><li>私有自定义指令：在组件的 <code>directives</code> 节点声明</li><li>全局自定义指令：在 <code>main.js</code> 文件中声明</li></ul><h3 id="完整写法">完整写法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-focus</span>=<span class="string">&quot;content&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">content</span>: <span class="number">666</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">  <span class="attr">focus</span>: &#123;</span><br><span class="line">    <span class="comment">// 指令与元素成功绑定时执行，执行一次</span></span><br><span class="line">    <span class="title function_">bind</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">      el.<span class="property">value</span> = binding.<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指令所在元素插入页面时执行，执行一次</span></span><br><span class="line">    <span class="title function_">inserted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">      <span class="comment">// 一进入页面输入框获得焦点</span></span><br><span class="line">      el.<span class="title function_">focus</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指令所在元素重新解析（个人觉得不应是渲染，而是解析，重新解析不一定重新渲染）时执行，执行 0+N 次</span></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">      el.<span class="property">value</span> = binding.<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局写法</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">bind</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    el.<span class="property">value</span> = binding.<span class="property">value</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">inserted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    el.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">update</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    el.<span class="property">value</span> = binding.<span class="property">value</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="简写形式">简写形式</h3><ul><li>当 <code>bind</code> 函数和 <code>update</code> 函数里的逻辑完全相同时，可以简写</li><li>不需要定义 <code>inserted</code> 函数才使用简写形式</li><li>因此简写形式的调用时机：初次绑定和 DOM 更新（指令所在模板被重新解析）</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-color</span>=<span class="string">&quot;&#x27;red&#x27;&quot;</span>&gt;</span>简写形式<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">  <span class="title function_">color</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    el.<span class="property">style</span>.<span class="property">color</span> = binding.<span class="property">value</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局写法</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;color&#x27;</span>, <span class="function">(<span class="params">el, binding</span>) =&gt;</span> &#123;</span><br><span class="line">  el.<span class="property">style</span>.<span class="property">color</span> = binding.<span class="property">value</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h3 id="注意事项">注意事项</h3><ul><li>自定义指令使用时需要添加 <code>v-</code> 前缀</li><li>指令名如果是多个单词，要使用 <code>kebab-case</code> 短横线命名方式，不要用 <code>camelCase</code> 驼峰命名</li><li>自定义指令三个函数里的 <code>this</code> 指向 <code>window</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-big-number</span>=<span class="string">&quot;n&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">n</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">  <span class="comment">// 添加引号才是对象键名完整写法</span></span><br><span class="line">  <span class="comment">// 平时不加引号都是简写形式</span></span><br><span class="line">  <span class="comment">// 遇到短横线的键名就必须添加引号</span></span><br><span class="line">  <span class="string">&#x27;big-number&#x27;</span>: &#123;</span><br><span class="line">    <span class="title function_">bind</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) <span class="comment">// Window</span></span><br><span class="line">      el.<span class="property">innerText</span> = binding.<span class="property">value</span> * <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Mixin-混入">Mixin 混入</h2><ul><li>Mixin 可以把多个组件共用的配置提取成一个混入对象</li><li>混入和组件自身的配置会合并</li><li><code>data</code> 、<code>methods</code> 若冲突以自身为准</li><li>对于生命周期钩子，执行动作会合并，且先执行 Mixin 里的动作</li></ul><p>定义混入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mixin.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mixin = &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">showName</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello mixin&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mixin2 = &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">x</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">y</span>: <span class="number">200</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用局部混入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mixin, mixin2 &#125; <span class="keyword">from</span> <span class="string">&#x27;../mixin.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;School&#x27;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">schoolName</span>: <span class="string">&#x27;北大&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mixins</span>: [mixin, mixin2],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用全局混入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; mixin, mixin2 &#125; <span class="keyword">from</span> <span class="string">&#x27;./mixin.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">mixin</span>(mixin)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">mixin</span>(mixin2)</span><br></pre></td></tr></table></figure><h2 id="插件">插件</h2><ul><li>用于增强 Vue</li><li>本质是包含 <code>install</code> 方法的一对象，<code>install</code> 第一个参数是 Vue 构造函数，第二个以后的参数是插件使用者传递的数据</li></ul><p>定义插件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugins.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">Vue, ...rest</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rest)</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">filter</span>(...)</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(...)</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(...)</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myProperty</span> = <span class="string">&#x27;plugins&#x27;</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myMethod</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用插件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> plugins <span class="keyword">from</span> <span class="string">&#x27;./plugins.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(plugins, <span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><h2 id="nextTick">$nextTick</h2><ul><li>语法：<code>this.$nextTick(回调函数)</code></li><li>作用：在下一次 DOM 更新结束后执行其指定的回调</li><li>什么时候用：当改变数据后，要基于更新后的 DOM 进行操作时，要在 <code>nextTick</code> 指定的回调函数中执行</li><li>组件的 <code>$nextTick(cb)</code> 方法，会把 cb 回调推迟到下一个 DOM 更新周期之后执行，即在 DOM 更新完成后再执行回调，从而保证 cb 回调可以获取最新的 DOM 元素</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">showInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">inputVisible</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 对输入框的操作推迟到 DOM 更新完成之后</span></span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">input</span>.<span class="title function_">focus</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>Vue 脚手架</h1><p><a href="https://cli.vuejs.org/zh/">官网传送门</a></p><h2 id="创建-Vue-项目">创建 Vue 项目</h2><ul><li>全局安装 vue 脚手架：<code>npm i -g @vue/cli</code></li><li>创建项目：<code>vue create project-name</code></li><li>运行项目：<code>npm run serve</code></li><li>暴露 webpack 配置：<code>vue inspect &gt; output.js</code></li></ul><h2 id="Vue-脚手架项目结构">Vue 脚手架项目结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">├── node_modules</span><br><span class="line">├── public</span><br><span class="line">│ ├── favicon.ico: 页签图标</span><br><span class="line">│ └── index.html: 主页面</span><br><span class="line">├── src</span><br><span class="line">│ ├── assets: 存放静态资源</span><br><span class="line">│ │ └── logo.png</span><br><span class="line">│ │── component: 存放组件</span><br><span class="line">│ │ └── HelloWorld.vue</span><br><span class="line">│ │── App.vue: 汇总所有组件</span><br><span class="line">│ │── main.js: 入口文件</span><br><span class="line">├── .gitignore: git 版本管制忽略的配置</span><br><span class="line">├── babel.config.js: babel 的配置文件</span><br><span class="line">├── package.json: 应用包配置文件</span><br><span class="line">├── README.md: 应用描述文件</span><br><span class="line">├── package-lock.json：包版本控制文件</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/vue-cli.4f118ba8.png" alt="Vue脚手架项目结构"></p><p><code>index.html</code> 代码分析：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 针对IE浏览器的一个特殊配置，含义是让IE浏览器以最高的渲染级别渲染页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启移动端的理想视口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;%= BASE_URL %&gt; 表示 public 文件夹路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 拿 package-lock.json 的 name 作为标题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当浏览器不支持js时noscript中的元素就会被渲染 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>We&#x27;re sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="不同版本的-Vue-与-render-函数">不同版本的 Vue 与 <code>render</code> 函数</h2><ol><li><code>vue.js</code> 与 <code>vue.runtime.xxx.js</code> 的区别：</li></ol><ul><li><code>import Vue from 'vue'</code> 默认导入 <code>vue.runtime.esm.js</code></li><li><code>vue.js</code> 是完整版的 Vue，包含：核心功能 + 模板解析器</li><li><code>vue.runtime.xxx.js</code> 是运行版的 Vue，只包含：核心功能；没有模板解析器</li></ul><ol start="2"><li><code>vue.runtime.xxx.js</code> 没有模板解析器，故不能使用 <code>template</code> 配置项，需使用 <code>render</code> 函数接收到的 <code>createElement</code> 函数去指定具体内容</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.js&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// render()</span></span><br><span class="line"><span class="attr">render</span>: <span class="keyword">function</span>(<span class="params">createElement</span>) &#123;</span><br><span class="line">  <span class="comment">// 创建元素</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;Hello Vue&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">render</span>: <span class="function"><span class="params">createElement</span> =&gt;</span> <span class="title function_">createElement</span>(<span class="title class_">App</span>)</span><br></pre></td></tr></table></figure><h2 id="vue-config-js-配置文件">vue.config.js 配置文件</h2><ol><li>使用 <code>vue inspect &gt; output.js</code> 可以查看到 Vue 脚手架的默认配置。</li><li>使用 <code>vue.config.js</code> 可以对脚手架进行个性化定制，<a href="https://cli.vuejs.org/zh/config/">详情</a></li></ol><h2 id="TodoList-案例总结">TodoList 案例总结</h2><ol><li>组件化编码流程：</li></ol><ul><li>拆分静态组件：组件要按照功能点拆分，命名不要与 html 元素冲突。</li><li>实现动态组件：考虑好数据的存放位置，数据是一个组件在用，还是一些组件在用：<ul><li>一个组件在用：放在组件自身即可</li><li>一些组件在用：放在他们共同的父组件上（状态提升）</li></ul></li><li>实现交互：从绑定事件开始。</li></ul><ol start="2"><li><code>props</code> 适用于：</li></ol><ul><li>父 ==&gt; 子</li><li>子 ==&gt; 父（要求父先给子一个函数）</li></ul><ol start="3"><li><p><code>v-model</code> 绑定的值不能是 <code>props</code> 传过来的值，因为 <code>props</code> 是不可以修改的！</p></li><li><p><code>props</code> 传过来的若是对象类型的值，修改对象中的属性时 Vue 不会报错，但不推荐</p></li></ol><h2 id="一些第三方包">一些第三方包</h2><ul><li><a href="https://gitee.com/mirrors/nanoid#nano-id">nanoid</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install nanoid</span><br><span class="line"></span><br><span class="line">import &#123; nanoid &#125; from nanoid</span><br><span class="line"></span><br><span class="line">model.id = nanoid()</span><br></pre></td></tr></table></figure><ul><li><a href="https://dayjs.fenxianglu.cn/">dayjs</a></li></ul><h1>Vue 网络请求</h1><h2 id="Vue-脚手架配置代理">Vue 脚手架配置代理</h2><h3 id="配置单个代理">配置单个代理</h3><p>在 <code>vue.config.js</code> 中添加如下配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">proxy</span>: <span class="string">&#x27;http://localhost:5000&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>优点：配置简单，请求资源时直接发给前端（8080）即可。</li><li>缺点：不能配置多个代理，不能灵活的控制请求是否走代理。</li><li>工作方式：若按照上述配置代理，当请求了前端不存在的资源时，那么该请求会转发给服务器 （优先匹配前端资源）</li></ul><h3 id="配置多个代理">配置多个代理</h3><p>编写 <code>vue.config.js</code> 配置具体代理规则：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api1&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment">// 匹配所有以 &#x27;/api1&#x27;开头的请求路径</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:5000&#x27;</span>, <span class="comment">// 代理目标的基础路径</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 把路径的 /api1 替换为空串</span></span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123; <span class="string">&#x27;^/api1&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;/api2&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment">// 匹配所有以 &#x27;/api2&#x27;开头的请求路径</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:5001&#x27;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123; <span class="string">&#x27;^/api2&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">changeOrigin 设置为 true 时，服务器收到的请求头中的 host：localhost:5000</span></span><br><span class="line"><span class="comment">changeOrigin 设置为 false 时，服务器收到的请求头中的 host：localhost:8080</span></span><br><span class="line"><span class="comment">changeOrigin 默认为 true</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><ul><li>优点：可以配置多个代理，且可以灵活的控制请求是否走代理。</li><li>缺点：配置略微繁琐，请求资源时必须加前缀</li></ul><h2 id="vue-2-x-全局配置-axios">vue 2.x 全局配置 axios</h2><p>实际项目开发中，几乎每个组件中都会使用 <code>axios</code> 发起数据请求。此时会遇到如下两个问题：</p><ul><li>每个组件中都需要导入 <code>axios</code>（代码臃肿）</li><li>每次发请求都需要填写完整的请求路径（不利于后期的维护）</li></ul><p>在 <code>main.js</code> 文件中进行配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置请求根路径</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">baseURL</span> = <span class="string">&#x27;http://api.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 axios 挂载到 Vue 原型上</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$http</span> = aixos</span><br></pre></td></tr></table></figure><p><strong>优点</strong>：每个组件可以通过 <code>this.$http.get</code> 直接发起请求，无需再导入 <code>axios</code> ；若根路径发生改变，只需修改 <code>axios.defaults.baseURL</code> ，有利于代码维护。</p><p><strong>缺点</strong>：无法实现 <code>API</code> 的复用。即多个组件需要对同一个接口发起请求，那么每个组件都需要重复书写 <code>this.$http.get('/users')</code> 类似的代码，造成冗余。（视频上的说法，个人认为真正的缺点是如果存在多个根路径，这种方式无法解决，所以才会有下面的改进方式。）</p><p><strong>改进</strong>：对于每一个根路径，独立封装一个 <code>request.js</code> 模块，组件导入所需根路径对应的 <code>axios</code> 进行使用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 axios 实例</span></span><br><span class="line"><span class="keyword">const</span> request = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://api.taobao.com&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br></pre></td></tr></table></figure><h1>Vuex</h1><p><a href="https://vuex.vuejs.org/zh/">官网传送门</a></p><h2 id="概述">概述</h2><p>何为 Vuex ？</p><p>Vuex 专门在 Vue 中实现集中式状态（数据）管理的一个 Vue 插件，对 Vue 应用中多个组件的共享状态进行集中式的管理，也是一种组件间通信的方式，适用于任意组件间通信</p><p>何时用 Vuex ？</p><ul><li>多个组件依赖于同一状态</li><li>来自不同组件的行为需要变更同一状态</li></ul><p>Vuex 工作原理图：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/vuex.6007da7c.png" alt="Vuex工作原理"></p><p>官方 Vuex 项目结构示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── index.html</span><br><span class="line">├── main.js</span><br><span class="line">├── api</span><br><span class="line">│   └── ... # 抽取出API请求</span><br><span class="line">├── components</span><br><span class="line">│   ├── App.vue</span><br><span class="line">│   └── ...</span><br><span class="line">└── store</span><br><span class="line">    ├── index.js          # 组装模块并导出 store 的地方</span><br><span class="line">    ├── actions.js        # 根级别的 action</span><br><span class="line">    ├── mutations.js      # 根级别的 mutation</span><br><span class="line">    └── modules</span><br><span class="line">        ├── cart.js       # 购物车模块</span><br><span class="line">        └── products.js   # 产品模块</span><br></pre></td></tr></table></figure><h2 id="Vuex-核心概念">Vuex 核心概念</h2><h3 id="state">state</h3><ul><li>Vuex 管理的状态对象</li><li>唯一的</li></ul><h3 id="actions">actions</h3><ul><li>值为一个对象，包含多个响应用户动作的回调函数</li><li>通过 <code>commit()</code>触发 mutation 中函数的调用，间接更新 state</li><li>可包含异步代码</li></ul><h3 id="mutations">mutations</h3><ul><li>值为一个对象，包含多个直接更新 state 的方法</li><li>不能写异步代码，只能单纯地操作 state</li></ul><h3 id="getters">getters</h3><ul><li>值为一个对象，包含多个用于返回数据的函数</li><li>类似于计算属性，getters 返回的数据依赖于 state 的数据</li></ul><h3 id="modules">modules</h3><ul><li>一个 module 是一个 store 的配置对象，与一个组件对应</li></ul><h2 id="搭建-Vuex-环境">搭建 Vuex 环境</h2><p>安装 Vuex：<code>npm install vuex@3 --save</code></p><blockquote><p>注意：Vue2 安装 Vuex3，Vue3 安装 Vuex4，版本需对应。</p></blockquote><p>创建文件 <code>src/store/index.js</code> ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> state = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  actions,</span><br><span class="line">  mutations,</span><br><span class="line">  state,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>main.js</code> 配置 <code>store</code> ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="基本使用-v4">基本使用</h2><p>组件实例与 <code>Actions</code> 和 <code>Mutations</code> 对话：</p><ul><li>若没有网络请求或其他业务逻辑，组件中也可以越过 <code>actions</code> ，即不写<code>dispatch</code>，直接编写<code>commit</code>：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;ADD&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">incrementOdd</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;addOdd&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">incrementAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;addAsync&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定义 <code>Actions</code> 和 <code>Mutations</code>：</p><ul><li><code>context</code> 是一个迷你版的 <code>store</code>，可访问 <code>dispatch</code>, <code>commit</code> 方法和 <code>state</code></li><li><code>mutations</code> 的动作类型一般用大写，与 <code>actions</code> 区分</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// context 是一个迷你版的 store</span></span><br><span class="line">  <span class="comment">// 可访问 dispatch, commit 方法和 state</span></span><br><span class="line">  <span class="title function_">addOdd</span>(<span class="params">context, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (context.<span class="property">state</span>.<span class="property">sum</span> % <span class="number">2</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;ADD&#x27;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">addAsync</span>(<span class="params">context, value</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;ADD&#x27;</span>, value)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="comment">// mutations 的动作类型一般用大写，与 actions 区分</span></span><br><span class="line">  <span class="title function_">ADD</span>(<span class="params">state, value</span>) &#123;</span><br><span class="line">    state.<span class="property">sum</span> += value</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">sum</span>: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  actions,</span><br><span class="line">  mutations,</span><br><span class="line">  state,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>组件访问 Vuex 的数据：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; $store.state.sum &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="getters-的使用">getters 的使用</h2><ul><li>当 <code>state</code> 中的数据需要经过加工后再使用时，可以使用 <code>getters</code> 加工</li><li>它不是必须的，当加工逻辑复杂且需要复用时，可以考虑使用</li><li><code>state</code> 与 <code>getters</code> 的关系有点像 <code>data</code> 和 <code>computed</code> 的关系</li><li>组件读取：<code>$store.getters.bigSum</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="title function_">bigSum</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">sum</span> * <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  actions,</span><br><span class="line">  mutations,</span><br><span class="line">  state,</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="四个-mapXxx-方法">四个 mapXxx 方法</h2><h3 id="mapState">mapState()</h3><ul><li>将 <code>state</code> 状态映射为计算属性</li><li>对象写法：键为自取的计算属性名，值为对应的状态（必须为字符串）</li><li>数组写法：当键值同名，可直接写状态名（字符串）</li><li>函数返回一个对象：<code>&#123;sum: f, price: f&#125;</code></li><li>注意对象的 <code>...&#123;&#125;</code> 展开写法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  <span class="comment">// 手动写法</span></span><br><span class="line">  <span class="title function_">sum</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">sum</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">price</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">price</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对象写法</span></span><br><span class="line">  ...<span class="title function_">mapState</span>(&#123;<span class="attr">sum</span>: <span class="string">&#x27;sum&#x27;</span>, <span class="attr">price</span>: <span class="string">&#x27;price&#x27;</span>&#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数组写法</span></span><br><span class="line">  ...<span class="title function_">mapState</span>([<span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;price&#x27;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mapGetters">mapGetters</h3><ul><li>将 <code>getters</code> 的数据映射为计算属性</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  <span class="title function_">bigSum</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">bigSum</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">double</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">double</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对象写法</span></span><br><span class="line">  ...<span class="title function_">mapGetters</span>(&#123;<span class="attr">bigSum</span>: <span class="string">&#x27;bigSum&#x27;</span>, <span class="attr">double</span>: <span class="string">&#x27;double&#x27;</span>&#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数组写法</span></span><br><span class="line">  ...<span class="title function_">mapGetters</span>([<span class="string">&#x27;bigSum&#x27;</span>, <span class="string">&#x27;double&#x27;</span>]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mapActions">mapActions</h3><ul><li>生成与 <code>actions</code> 对话的函数，即包含 <code>$store.dispatch()</code></li><li><code>mapActions</code> 生成的函数不会传入参数，需要在调用时手动传入数据，不传参默认传入 <code>$event</code></li><li>数组写法要注意函数名和 <code>actions</code> 动作类型同名，调用时勿写错</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// 手动写法</span></span><br><span class="line">  <span class="title function_">incrementOdd</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;addOdd&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">incrementAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;addAsync&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对象写法</span></span><br><span class="line">  ...<span class="title function_">mapActions</span>(&#123;<span class="attr">incrementOdd</span>: <span class="string">&#x27;addOdd&#x27;</span>, <span class="attr">incrementAsync</span>: <span class="string">&#x27;addAsync&#x27;</span>&#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数组写法</span></span><br><span class="line">  ...<span class="title function_">mapActions</span>([<span class="string">&#x27;addOdd&#x27;</span>, <span class="string">&#x27;addAsync&#x27;</span>]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementOdd(number)&quot;</span>&gt;</span>奇数+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mapMutations">mapMutations</h3><ul><li>生成与 <code>mutations</code> 对话的函数，即包含 <code>$store.commit()</code></li><li>同样注意传递参数，以及数组形式函数名的问题</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;ADD&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;SUB&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对象写法</span></span><br><span class="line">  ...<span class="title function_">mapMutations</span>(&#123;<span class="attr">increment</span>: <span class="string">&#x27;ADD&#x27;</span>, <span class="attr">decrement</span>: <span class="string">&#x27;SUB&#x27;</span>&#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数组写法</span></span><br><span class="line">  ...<span class="title function_">mapMutations</span>([<span class="string">&#x27;ADD&#x27;</span>, <span class="string">&#x27;SUB&#x27;</span>]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vuex-模块化-命名空间">Vuex 模块化&amp;命名空间</h2><p>让代码更好维护，让多种数据分类更加明确，每一类数据及其相关操作对应一个 <code>store</code> 。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/store/index.js</span></span><br><span class="line"><span class="keyword">const</span> countAbout = &#123;</span><br><span class="line">  <span class="comment">// 开启命名空间</span></span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">sum</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="title function_">bigSum</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">sum</span> * <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> personAbout = &#123;</span><br><span class="line">  <span class="comment">// 开启命名空间</span></span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">personList</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    countAbout,</span><br><span class="line">    personAbout</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>开启命名空间后，组件中读取 <code>state</code> 数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接读取</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">personAbout</span>.<span class="property">personList</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mapState 读取</span></span><br><span class="line">...<span class="title function_">mapState</span>(<span class="string">&#x27;countAbout&#x27;</span>,[<span class="string">&#x27;sum&#x27;</span>,<span class="string">&#x27;school&#x27;</span>]),</span><br></pre></td></tr></table></figure><p>开启命名空间后，组件中读取 <code>getters</code> 数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接读取</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>[<span class="string">&#x27;countAbout/bigSum&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapGetters 读取：</span></span><br><span class="line">...<span class="title function_">mapGetters</span>(<span class="string">&#x27;countAbout&#x27;</span>,[<span class="string">&#x27;bigSum&#x27;</span>])</span><br></pre></td></tr></table></figure><p>开启命名空间后，组件中调用 <code>dispatch</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接 dispatch</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;countAbout/addODdd&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>)</span><br><span class="line"><span class="comment">// 借助 mapActions</span></span><br><span class="line">...<span class="title function_">mapActions</span>(<span class="string">&#x27;countAbout&#x27;</span>, &#123;<span class="attr">incrementOdd</span>:<span class="string">&#x27;addOdd&#x27;</span>, <span class="attr">incrementWait</span>:<span class="string">&#x27;addAsync&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>开启命名空间后，组件中调用 <code>commit</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接 commit</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;personAbout/ADD_PERSON&#x27;</span>, person)</span><br><span class="line"><span class="comment">// 借助 mapMutations</span></span><br><span class="line">...<span class="title function_">mapMutations</span>(<span class="string">&#x27;countAbout&#x27;</span>,&#123;<span class="attr">increment</span>:<span class="string">&#x27;ADD&#x27;</span>,<span class="attr">decrement</span>:<span class="string">&#x27;SUB&#x27;</span>&#125;),</span><br></pre></td></tr></table></figure><h1>Vue Router</h1><p><a href="https://router.vuejs.org/zh/">官网传送门</a></p><h2 id="路由">路由</h2><h3 id="何为路由">何为路由</h3><ul><li>一组路由即一组映射关系（key-value）</li><li>key 为路径，value 可能是 function 或 component</li></ul><h3 id="前端路由">前端路由</h3><p>前端路由即地址和组件之间的对应关系（以下已哈希模式为例）。</p><p>前端路由简易工作方式：</p><ol><li>用户点击了页面上的路由链接</li><li>URL 地址的 Hash 值发生变化</li><li>前端路由监听到 Hash 值的变化</li><li>前端路由渲染 Hash 地址对应的组件</li></ol><p>实现简易的前端路由：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- a 链接添加对应 Hash 值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/home&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/movie&quot;</span>&gt;</span>Movie<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态渲染组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;compName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">compName</span>: <span class="string">&#x27;Home&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 监听 Hash 地址改变，切换组件</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onhashchange</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">switch</span>(location.<span class="property">hash</span>) &#123;</span><br><span class="line">        <span class="attr">case</span>: <span class="string">&#x27;#/home&#x27;</span>:</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">compName</span> = <span class="string">&#x27;Home&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        <span class="attr">case</span>: <span class="string">&#x27;#/movie&#x27;</span>:</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">compName</span> = <span class="string">&#x27;Movie&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        <span class="attr">case</span>: <span class="string">&#x27;#/about&#x27;</span>:</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">compName</span> = <span class="string">&#x27;About&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="后端路由">后端路由</h3><ul><li>后端路由是指请求方式、请求地址与 <code>function</code> 处理函数之间的对应关系</li><li>服务器收到一个请求，根据请求方式、路径匹配对应的函数处理请求，返回响应数据</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/userlist&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;...&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><h2 id="单页面应用程序-SPA">单页面应用程序 SPA</h2><p>单页面应用程序将所有的功能局限于一个 web 页面中，仅在该 web 页面初始化时加载相应的资源（ HTML、JavaScript 和 CSS）。 一旦页面加载完成了，SPA 不会因为用户的操作而进行页面的重新加载或跳转。而是利用 JavaScript 动态地变换 HTML 的内容，从而实现页面与用户的交互。</p><p>SPA 的优点：</p><ul><li>良好的交互体验<ul><li>内容的改变不需要重新加载整个页面</li><li>数据通过 <code>Ajax</code> 异步获取</li><li>没有页面跳转，不会出现白屏现象</li></ul></li><li>良好的前后盾工作分离模式<ul><li>后端专注于提供 API 接口，更易实现接口复用</li><li>前端专注页面渲染，更利于前端工程化发展</li></ul></li><li>减轻服务器压力<ul><li>服务器只提供数据，不负责页面的合成与逻辑处理，吞吐能力会提高</li></ul></li></ul><p>SPA 的缺点：</p><ul><li>首屏加载慢：可使用路由懒加载、代码压缩、CDN 加速、网络传输压缩</li><li>不利于 SEO ：SSR 服务器端渲染</li></ul><h2 id="vue-router-初体验">vue-router 初体验</h2><p>安装 <code>vue-router</code>：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router@3.5.2 -S</span><br></pre></td></tr></table></figure><p>创建路由模块，在 <code>src</code> 源代码目录下，新建 <code>router/index.js</code> 路由模块，初始化代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;@/component/Home.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;@/component/About.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Movie</span> <span class="keyword">from</span> <span class="string">&#x27;@/component/Movie.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 VueRouter 安装为 Vue 的插件</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由匹配规则</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Home</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">About</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/movie&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Movie</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建路由实例对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p>在 <code>main.js</code> 文件中导入并挂载路由模块：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router/index.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>在组件中声明路由链接和占位符：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 路由链接 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/movie&quot;</span>&gt;</span>电影<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 路由出口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意事项：</p><ul><li>组件分为路由组件和一般组件，前者放在 <code>pages(或views)</code> 文件夹，后者放在 <code>components</code> 文件夹</li><li>每个组件都有 <code>$route</code> 属性，存储着组件的路由规则信息</li><li><code>$router</code> 是路由器对象，整个 SPA 只有一个</li></ul><h2 id="声明式导航">声明式导航</h2><p><code>&lt;router-link&gt;</code> 4 个常用属性：</p><ol><li><code>to</code> 属性</li></ol><ul><li>用于指定跳转路由</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>tag</code> 属性</li></ol><ul><li>指明 <code>&lt;router-link&gt;</code> 最终被渲染为何种标签，默认是 a 标签</li><li>渲染为其他标签也会监听点击，触发导航</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;li&quot;</span>&gt;</span>tag<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>tag<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><code>replace</code> 属性</li></ol><ul><li>路由跳转不会增加新的历史记录，而是替换当前历史记录</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">replace</span>&gt;</span>About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li><code>active-class</code> 属性</li></ol><ul><li>指明路由被激活时添加的类名，默认为 <code>router-link-active</code></li><li>详见<a href="https://brucecai55520.gitee.io/bruceblog/notes/vue/vue-router.html#%E8%B7%AF%E7%94%B1%E9%AB%98%E4%BA%AE">路由高亮</a></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="路由高亮">路由高亮</h2><p>被激活的路由链接，默认会添加 <code>router-link-active</code> 的类名。可据此为激活的路由链接设置高亮的样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.router-link-active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定义路由模块时可以自定义路由链接被激活时添加的类名：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  <span class="comment">// 默认的 router-link-active 会被覆盖</span></span><br><span class="line">  <span class="attr">linkActiveClass</span>: <span class="string">&#x27;active-hello&#x27;</span>,</span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>声明路由链接时也可用 <code>active-class</code> 属性自定义激活类名：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- router-link-active 会被覆盖为 active --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="路由重定向">路由重定向</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 访问 / 跳转到 /home</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">component</span>: <span class="string">&#x27;Home&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: <span class="string">&#x27;About&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/movie&#x27;</span>, <span class="attr">component</span>: <span class="string">&#x27;Movie&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><h2 id="嵌套路由">嵌套路由</h2><p><code>About</code> 组件中声明子路由链接和子路由占位符：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;about-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 要把父路由寫上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about/tab1&quot;</span>&gt;</span>tab1<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about/tab2&quot;</span>&gt;</span>tab2<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过 <code>children</code> 属性声明子路由规则：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="string">&#x27;About&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      <span class="comment">// 注意不要写成 /tab1</span></span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;tab1&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Tab1</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;tab2&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Tab2</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="编程式导航">编程式导航</h2><p>声明式导航：</p><ul><li>通过点击链接实现导航</li><li>如普通网页点击 <code>a</code> 链接，<code>vue</code> 点击 <code>&lt;router-link&gt;</code></li></ul><p>编程式导航：</p><ul><li>通过调用 API 实现导航</li><li>普通网页通过 <code>location.href</code> 的方式跳转页面也是编程式导航</li></ul><p><code>vue-router</code> 中实现编程式导航的 API ：</p><ul><li><code>this.$router.push('hash地址')</code> ：跳转到指定页面，并增加一条历史记录</li><li><code>this.$router.replace('hash地址')</code> ：跳转页面，但不会新增历史记录，而是替换当前的历史记录</li><li><code>this.$router.go(数值)</code> ：历史记录前进或后退，相当于点击浏览器前进后退箭头</li><li><code>this.$router.forward()</code> ：前进一步</li><li><code>this.$router.back()</code> ：后退一步</li></ul><h2 id="命名路由">命名路由</h2><p>给路由命名，某些情况可简化路由跳转写法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">About</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;about&#x27;&#125; &quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;about&#x27;, query: &#123; id: 1, title: &#x27;hello&#x27; &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="路由传参">路由传参</h2><h3 id="query-参数">query 参数</h3><p>传递参数：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 字符串写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;`/home/detail?id=$&#123;id&#125;&amp;title=$&#123;title&#125;`&quot;</span>&gt;</span>字符串写法<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 对象写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:to</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">    path: &#x27;/home/detail&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">    query: &#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">      id: 1,</span></span></span><br><span class="line"><span class="string"><span class="tag">      title: &#x27;hello&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">    &#125;</span></span></span><br><span class="line"><span class="string"><span class="tag">  &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  对象写法</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">`/home/detail?id=<span class="subst">$&#123;id&#125;</span>&amp;title=<span class="subst">$&#123;title&#125;</span>`</span>)</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/home/detail&#x27;</span>, <span class="attr">query</span>: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;query&#x27;</span> &#125; &#125;)</span><br></pre></td></tr></table></figure><p>接收参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">id</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">title</span></span><br></pre></td></tr></table></figure><h3 id="params-参数（动态路由）">params 参数（动态路由）</h3><p>动态路由是把 Hash 地址中可变的部分定义为参数项，从而提高路由规则的复用性。</p><p>声明 params 参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义动态路由参数</span></span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;/movie/:id/:age&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Movie</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下类似的路由规则都能合并为上述规则，复用性得到提高</span></span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;/movie/1/21&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Movie</span> &#125;</span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;/movie/2/22&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Movie</span> &#125;</span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;/movie/3/23&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Movie</span> &#125;</span><br></pre></td></tr></table></figure><p>传递 params 参数：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;/movie/1/21&quot;</span>&gt;</span>字符串写法<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 对象写法只能和 name 搭配使用，不能和 path 搭配 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:to</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">  name: &#x27;movie&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">  params: &#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">    id: 1,</span></span></span><br><span class="line"><span class="string"><span class="tag">    age: 21</span></span></span><br><span class="line"><span class="string"><span class="tag">  &#125;</span></span></span><br><span class="line"><span class="string"><span class="tag">&#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  对象写法</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- query 和 params 可以一起用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;`/movie/1/21?id=$&#123;id&#125;`&quot;</span>&gt;</span>字符串写法<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:to</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">    name:&#x27;movie&#x27;, </span></span></span><br><span class="line"><span class="string"><span class="tag">    params: &#123;id:1, age:21&#125;, </span></span></span><br><span class="line"><span class="string"><span class="tag">    query: &#123;school: &#x27;love&#x27;&#125;</span></span></span><br><span class="line"><span class="string"><span class="tag">  &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  对象写法</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">`/movie/1/21?id=<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;movie&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;, <span class="attr">query</span>: &#123; <span class="attr">school</span>: <span class="string">&#x27;love&#x27;</span> &#125; &#125;)</span><br></pre></td></tr></table></figure><p>接收 params 参数：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;movie-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Movie组件，参数值：&#123;&#123; this.$route.params.id &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="路由的-props-配置">路由的 props 配置</h3><p>简化路由组件接收参数。</p><p>在路由规则中开启 <code>props</code> 传参，组件可以使用 <code>props</code> 接收路由参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/movie/:id/:title&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">Movie</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式一：该对象中的所有 key-value 都会以 props 的形式传给组件</span></span><br><span class="line">  <span class="comment">// 该方式是写死的，少用</span></span><br><span class="line">  <span class="attr">props</span>: &#123;<span class="attr">id</span>: <span class="number">666</span>, <span class="attr">title</span>: <span class="string">&#x27;hello&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式二：把 params 参数以 props 的形式传给组件</span></span><br><span class="line">  <span class="comment">// 只能接收 params 参数</span></span><br><span class="line">  <span class="attr">props</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式三：函数写法，啥都能传</span></span><br><span class="line">  <span class="title function_">props</span>(<span class="params">$route</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">id</span>: $route.<span class="property">query</span>.<span class="property">id</span>,</span><br><span class="line">      <span class="attr">title</span>: $route.<span class="property">params</span>.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">21</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>组件接收参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 使用 props 接收路由规则的参数项</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Movie组件，参数值：&#123;&#123; id &#125;&#125;，题目：&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="路由传参注意事项">路由传参注意事项</h3><ol><li>path 不能和 params 一起使用。path+query、name+query/params 都行</li><li>如何指定 params 参数可传可不传？</li></ol><ul><li>若声明了 params 参数 <code>path: '/movie/:title'</code>，默认是必须要传递 params 参数的，否则 URL 会出现问题</li><li>指定 params 参数可不传：<code>path: '/movie/:title?'</code></li></ul><ol start="3"><li>已指明 params 参数可传可不传，但如果传递空串，如何解决？</li></ol><ul><li>传递空串，URL 也会出现问题</li><li>方法：使用 <code>undefined</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;search&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span> &#125;, <span class="attr">query</span>: &#123; <span class="attr">key</span>: <span class="variable language_">this</span>.<span class="property">key</span> &#125; &#125;)</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;search&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span> || <span class="literal">undefined</span> &#125;, <span class="attr">query</span>: &#123; <span class="attr">key</span>: <span class="variable language_">this</span>.<span class="property">key</span> &#125; &#125;)</span><br></pre></td></tr></table></figure><h2 id="路由元信息-meta">路由元信息 meta</h2><p>在 <code>meta</code> 中可以为路由添加自定义信息：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">About</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;hello&#x27;</span>, <span class="attr">isAuth</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="路由守卫">路由守卫</h2><blockquote><p>作用：对路由进行权限控制。</p><p>分类：全局守卫、独享守卫、组件内守卫</p></blockquote><h3 id="全局守卫">全局守卫</h3><ul><li>全局前置守卫：<code>beforeEach()</code></li><li>全局后置守卫：<code>afterEach()</code></li></ul><p>守卫回调函数 3 个形参：</p><ul><li><code>to</code> ：将要访问的路由的信息对象，即 <code>$route</code></li><li><code>from</code> ：将要离开的路由的信息对象</li><li><code>next</code> ：放行函数（后置守卫没有）</li></ul><p><code>next</code> 函数 3 种调用方式：</p><ul><li>直接放行：<code>next()</code></li><li>强制跳转到其他路由：<code>next(/login)</code></li><li>阻止本次跳转：<code>next(false)</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;...&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(to.<span class="property">path</span> === <span class="string">&#x27;/main&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(token) &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">(<span class="params">to,<span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(to.<span class="property">meta</span>.<span class="property">title</span>) &#123;</span><br><span class="line">    <span class="comment">// 修改网页标题</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">title</span> = to.<span class="property">meta</span>.<span class="property">title</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&#x27;vue_test&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="独享路由守卫">独享路由守卫</h3><ul><li>某一条路由规则独享的守卫</li><li>独享守卫只一个</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">About</span>,</span><br><span class="line">  <span class="title function_">beforeEnter</span>(<span class="params">to, <span class="keyword">from</span> ,next</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="组件内路由守卫">组件内路由守卫</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;About&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 进入守卫：通过路由规则，进入该组件时被调用</span></span><br><span class="line">  <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 离开守卫：通过路由规则，离开该组件时被调用</span></span><br><span class="line">  beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="各个守卫执行顺序">各个守卫执行顺序</h3><p>从 <code>About</code> 组件通过路由规则进入 <code>Home</code> 组件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">About-beforeRouteLeave</span><br><span class="line">beforeEach</span><br><span class="line">Home-beforeEnter</span><br><span class="line">Home-beforeRouteEnter</span><br><span class="line">afterEach</span><br><span class="line">Home组件生命周期开始</span><br></pre></td></tr></table></figure><h2 id="vue-router-4-x">vue-router 4.x</h2><p>目前 <code>vue-router</code> 有 <code>3.x</code> 和 <code>4.x</code> 两个版本，前者只能在 <code>vue2.x</code> 中使用，后者只能在 <code>vue3.x</code> 中使用。</p><p>下面是 <code>vue-router 4.x</code> 初体验：</p><p>安装 <code>vue-router 4.x</code> ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router@next -S</span><br></pre></td></tr></table></figure><p>创建路由模块：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 vue-router 按需导入两个方法</span></span><br><span class="line"><span class="comment">// createRouter：创建路由实例对象</span></span><br><span class="line"><span class="comment">// createWebHashHistory：指定路由工作模式为 hash 模式</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  <span class="attr">routes</span>: [&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Home</span> &#125;],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p><code>main.js</code> 导入并挂载路由模块：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h1>Vue3</h1><p><a href="https://v3.cn.vuejs.org/">官网传送门</a>Vue3 的变化</p><p><strong>性能的提升</strong></p><ul><li>打包大小减少 41%</li><li>初次渲染快 55%, 更新渲染快 133%</li><li>内存减少 54%</li></ul><p><strong>源码的升级</strong></p><ul><li>使用 Proxy 代替 defineProperty 实现响应式</li><li>重写虚拟 DOM 的实现和 Tree-Shaking</li></ul><p><strong>拥抱 TypeScript</strong></p><ul><li>Vue3 可以更好的支持 TypeScript</li></ul><p><strong>新的特性</strong></p><ol><li>Composition API（组合 API）</li></ol><ul><li>setup 配置</li><li>ref 与 reactive</li><li>watch 与 watchEffect</li><li>provide 与 inject</li><li>…</li></ul><ol start="2"><li>新的内置组件</li></ol><ul><li>Fragment</li><li>Teleport</li><li>Suspense</li></ul><ol start="3"><li>其他改变</li></ol><ul><li>新的生命周期钩子</li><li>data 选项应始终被声明为一个函数</li><li>移除 keyCode 支持作为 v-on 的修饰符</li><li>…</li></ul><h2 id="创建-Vue3-工程">创建 Vue3 工程</h2><h3 id="vite-和-vue-cli-对比">vite 和 vue-cli 对比</h3><table><thead><tr><th></th><th>vite</th><th>vue-cli</th></tr></thead><tbody><tr><td>支持的 vue 版本</td><td>仅支持 vue3.x</td><td>支持 2.x 和 3.x</td></tr><tr><td>是否基于 webpack</td><td>否</td><td>是</td></tr><tr><td>运行速度</td><td>快</td><td>较慢</td></tr><tr><td>功能完整度</td><td>小而巧</td><td>大而全</td></tr><tr><td>是否建议企业级开发使用</td><td>暂不建议</td><td>建议</td></tr></tbody></table><h3 id="使用-vue-cli-创建">使用 vue-cli 创建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 查看 @vue/cli 版本，确保 @vue/cli 版本在4.5.0以上</span></span><br><span class="line">vue --version</span><br><span class="line"><span class="comment">### 安装或者升级 @vue/cli</span></span><br><span class="line">npm install -g @vue/cli</span><br><span class="line"><span class="comment">### 创建</span></span><br><span class="line">vue create vue_test</span><br><span class="line"><span class="comment">### 启动</span></span><br><span class="line"><span class="built_in">cd</span> vue_test</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure><h3 id="使用-vite-创建">使用 vite 创建</h3><ul><li><a href="https://vitejs.cn/">vite </a>：新一代前端构建工具</li><li>优势：<ul><li>开发环境中，无需打包操作，可快速冷启动（webpack 每次运行项目都要打包）</li><li>轻量快速的热重载 HMR（更改代码局部刷新，webpack 也行，但 vite 更轻量）</li><li>真正的按需编译，无需等待整个应用编译完成</li></ul></li><li>传统构建 与 vite 构建对比（vite 现用现分析，按需导入，因此项目启动更快）</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://brucecai55520.gitee.io/bruceblog/assets/img/bundle.532fd73f.png" alt="Bundle"></p><p><img src= "/img/loading.gif" data-lazy-src="https://brucecai55520.gitee.io/bruceblog/assets/img/ESM.9634d534.png" alt="ESM"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm init vite-app 项目名称</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> 项目名称</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h2 id="Vue3-项目结构">Vue3 项目结构</h2><p>Vue3 中 <code>main.js</code> 代码有所改变：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不再引入 Vue 构造函数，而是引入 createApp 工厂函数</span></span><br><span class="line"><span class="comment">// createApp函数：创建 vue 的 SPA 实例</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建应用实例对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Vue3 支持定义多个根节点，组件的 <code>&lt;template&gt;</code> 支持定义多个根节点：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>根节点<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>根节点<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="常用-Composition-API">常用 Composition API</h2><h3 id="setup">setup</h3><ul><li>setup 是 Vue3 中一个新的配置项，值为函数</li><li>组件中使用的数据、方法等都要配置在 setup 中</li><li>setup 函数两种返回值：<ul><li>返回一个对象，对象中的属性、方法可在模板中直接使用</li><li>返回一个渲染函数，可自定义渲染内容</li></ul></li><li>setup 函数的参数：<ul><li>props：值为对象，包含了组件外部传进来，且组件内部声明接收的属性</li><li>context：上下文对象<ul><li><code>attrs</code>：值为对象，包含了组件外部传进来，且组件内部没有声明接收的属性，相当于 <code>this.$attrs</code></li><li><code>slots</code>：收到的插槽内容，相当于 <code>this.$slots</code></li><li><code>emit</code>：触发自定义事件的函数，相当于 <code>this.$emit</code></li></ul></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没错，渲染函数就叫 h</span></span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">  <span class="comment">// Vue3 需要声明自定义事件，虽然不声明也能运行</span></span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;changeCount&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回函数</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  setup() &#123;</span></span><br><span class="line"><span class="comment">    return () =&gt; h(&#x27;h1&#x27;, &#x27;Hello&#x27;)</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回对象</span></span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="string">&#x27;Vue3&#x27;</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sayHello</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">      context.<span class="title function_">emit</span>(<span class="string">&#x27;changeCount&#x27;</span>, <span class="number">888</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name,</span><br><span class="line">      sayHello,</span><br><span class="line">      test,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><ul><li>setup 在 <code>beforeCreate</code> 钩子之前执行，<code>this</code> 为 <code>undefined</code></li><li>setup 不要和 Vue2 配置混用。Vue2 的配置可以访问到 setup 的属性方法，反过来不行；如有重名，setup 优先</li><li>setup 不能是 async 函数，因为 async 函数返回的是 promise 不是对象，会导致模板无法访问属性方法</li><li>若要返回 promise 实例，需要 <code>Suspense</code> 和异步组件的配合</li></ul><h3 id="ref-函数">ref 函数</h3><p>作用：定义响应式数据</p><p>语法：<code>const name = ref(initValue)</code></p><ul><li><code>ref</code> 函数返回一个 <code>RefImpl</code>(reference implement) 实例对象，全称引用实现的实例对象</li><li>它包含响应式数据，简称引用对象、reference 对象、ref 对象</li><li>JS 访问数据：<code>name.value</code></li><li>模板访问数据：<code>&lt;div&gt;&lt;/div&gt;</code></li></ul><p>注意事项：</p><ul><li><code>ref</code> 函数可以接收基本数据类型和引用数据类型</li><li>基本类型数据的响应式还是靠 <code>Object.defineProperty()</code> 完成</li><li>对象类型数据使用 ES6 的 Proxy 实现响应式，Vue3 把相关操作封装在 <code>reactive</code> 函数中</li><li>按照之前的办法，对于对象数据，应该遍历每一层的属性添加 <code>getter</code> 、<code>setter</code>，但 Vue3 使用 Proxy 把内部数据一口气监测了</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; jobInfo.type &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;Vue3&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> jobInfo = <span class="title function_">ref</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;frontend&#x27;</span>,</span><br><span class="line">      <span class="attr">salary</span>: <span class="string">&#x27;40w&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">changeInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      name.<span class="property">value</span> = <span class="string">&#x27;鱿鱼丝&#x27;</span></span><br><span class="line">      <span class="comment">// jobInfo 是 RefImpl 实例</span></span><br><span class="line">      <span class="comment">// jobInfo.value 是 Proxy 实例对象</span></span><br><span class="line">      jobInfo.<span class="property">value</span>.<span class="property">salary</span> = <span class="string">&#x27;50w&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name,</span><br><span class="line">      jobInfo,</span><br><span class="line">      changeInfo,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="reactive-函数">reactive 函数</h3><ul><li>定义引用类型的响应式数据，不可用于 jibenleixingshuju</li><li><code>const 代理对象 = reactive(源对象)</code> 接收对象或数组，返回代理对象（Proxy 的实例对象）</li><li><code>reactive</code> 的响应式是深度的</li><li>基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Vue3&#x27;</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&#x27;unknown&#x27;</span>,</span><br><span class="line">      <span class="attr">info</span>: &#123;</span><br><span class="line">        <span class="attr">school</span>: <span class="string">&#x27;Oxford&#x27;</span>,</span><br><span class="line">        <span class="attr">major</span>: <span class="string">&#x27;computer&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> color = <span class="title function_">reactive</span>([<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">changeInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      person.<span class="property">info</span>.<span class="property">major</span> = <span class="string">&#x27;art&#x27;</span></span><br><span class="line">      color[<span class="number">0</span>] = <span class="string">&#x27;yellow&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      person,</span><br><span class="line">      color,</span><br><span class="line">      changeInfo,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ref-VS-reactive">ref VS reactive</h3><p>定义数据：</p><ul><li>ref 用于定义基本类型数据</li><li>reactive 用于定义对象或数组类型数据</li><li>ref 也可定义对象或数组类型数据，内部通过 reactive 转为代理对象</li><li>一般使用 reactive 函数，可以把所有数据封装为一个对象</li></ul><p>原理：</p><ul><li>ref 通过 <code>Object.defineProperty()</code> 实现响应式</li><li>reactive 通过 Proxy 实现响应式，Reflect 操作源对象数据</li></ul><p>使用角度：</p><ul><li>ref 定义数据，访问数据需要 <code>.value</code>，模板中不需要</li><li>reactive 定义的数据，都不需要</li></ul><h3 id="Vue3-响应式原理">Vue3 响应式原理</h3><ul><li>通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy </a>代理，拦截对对象属性的操作，包括增删改查</li><li>通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">Reflect </a>反射，对源对象的属性进行操作</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> originPerson = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Lily&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">22</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="title class_">Proxy</span>(originPerson, &#123;</span><br><span class="line">  <span class="comment">// 拦截增加和查询操作</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">    <span class="comment">// 读取源对象的属性</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(originPerson, prop)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 拦截修改操作</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">    <span class="comment">// 修改源对象的属性</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, prop, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 拦截删除操作</span></span><br><span class="line">  <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">    <span class="comment">// 删除源对象的属性</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(target, prop)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>)</span><br><span class="line">person.<span class="property">age</span> = <span class="number">33</span></span><br><span class="line">person.<span class="property">sex</span> = <span class="string">&#x27;unknown&#x27;</span></span><br><span class="line"><span class="keyword">delete</span> person.<span class="property">age</span></span><br></pre></td></tr></table></figure><h3 id="computed-函数">computed 函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">      <span class="attr">firstName</span>: <span class="string">&#x27;Cai&#x27;</span>,</span><br><span class="line">      <span class="attr">lastName</span>: <span class="string">&#x27;QP&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算属性简写形式</span></span><br><span class="line">    person.<span class="property">fullName</span> = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> person.<span class="property">firstName</span> + <span class="string">&#x27;-&#x27;</span> + person.<span class="property">lastName</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算属性完整形式</span></span><br><span class="line">    person.<span class="property">fullName</span> = <span class="title function_">computed</span>(&#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> person.<span class="property">firstName</span> + <span class="string">&#x27;-&#x27;</span> + person.<span class="property">lastName</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> arr = value.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        person.<span class="property">firstName</span> = arr[<span class="number">0</span>]</span><br><span class="line">        person.<span class="property">lastName</span> = arr[<span class="number">1</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      person,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="watch-函数">watch 函数</h3><p>Vue3 <code>watch</code> 能侦听的东西：</p><blockquote><p>A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> msg = <span class="title function_">ref</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Vue3&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">info</span>: &#123;</span><br><span class="line">    <span class="attr">job</span>: &#123;</span><br><span class="line">      <span class="attr">salary</span>: <span class="number">40</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>侦听 ref 定义的响应式数据</strong>：</p><ul><li>注意不要写成 <code>sum.value</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数：侦听的数据，回调，其他配置</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  sum,</span><br><span class="line">  <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal, oldVal)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>侦听多个 ref 定义的响应式数据</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// newVal，oldVal 也是数组</span></span><br><span class="line"><span class="title function_">watch</span>([sum, msg], <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal, oldVal)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>侦听 ref 定义的对象类型数据</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用 ref 定义对象类型数据</span></span><br><span class="line"><span class="keyword">let</span> person = <span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Vue3&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">info</span>: &#123;</span><br><span class="line">    <span class="attr">job</span>: &#123;</span><br><span class="line">      <span class="attr">salary</span>: <span class="number">40</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启深度监听才有效，此时监听的是 RefImpl 实例</span></span><br><span class="line"><span class="comment">// Ref 实例的 value 是 Proxy 对象，存的是地址</span></span><br><span class="line"><span class="comment">// 因此无法监听 person 内部属性的变化</span></span><br><span class="line"><span class="title function_">watch</span>(person, <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123; ... &#125;, &#123; <span class="attr">deep</span>:<span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个和 “侦听 reactive 函数直接返回的那一整坨响应式数据” 效果一致</span></span><br><span class="line"><span class="title function_">watch</span>(person.<span class="property">value</span>, <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;...&#125;)</span><br></pre></td></tr></table></figure><p><strong>侦听 reactive 函数直接返回的那一整坨响应式数据</strong>：</p><ul><li>oldVal 是错误的！和 newVal 的值一样</li><li>强制开启了深度侦听，<code>deep</code> 配置不生效！</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  person,</span><br><span class="line">  <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal, oldVal)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">deep</span>: <span class="literal">false</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>侦听 reactive 定义的响应式数据某个属性</strong>：</p><ul><li>如果是 <code>() =&gt; person.info</code> oldVal 也是错误的！</li><li><code>() =&gt; person.name</code> oldVal 是正确的，何时对何时错自己琢磨吧！</li><li>此处没有强制开启深度监听</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果监视的属性还是对象，则需要开启深度监听</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> person.<span class="property">info</span>,</span><br><span class="line">  <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal, oldVal)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>侦听 reactive 定义的响应式数据多个属性</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  [<span class="function">() =&gt;</span> person.<span class="property">name</span>, <span class="function">() =&gt;</span> person.<span class="property">info</span>],</span><br><span class="line">  <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal, oldVal)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="watchEffect-函数">watchEffect 函数</h3><ul><li><code>watchEffect</code> 不需要指明监听哪个属性，回调里用到哪个属性，就自动监听哪个属性</li><li><code>computed</code> 注重计算的值，即回调函数的返回值，因此必须有返回值</li><li><code>watchEffect</code> 更注重过程，即回调函数的函数体，因此可没有返回值</li><li><code>watchEffect</code> 没有开启深度监听，也不能开启深度监听！</li><li><code>watchEffect</code> 内部自行修改数据，不会重新调用回调，因此不会出现递归调用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调中用到的数据只要发生变化，则直接重新执行回调</span></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> total = sum.<span class="property">value</span></span><br><span class="line">  <span class="keyword">let</span> p = person</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;watchEffect...&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="生命周期">生命周期</h3><p>注意和 <code>vue2.x</code> 的生命周期图作对比，<code>beforeDestroy</code> 和 <code>destroyed</code> 变为 <code>beforeUnmount</code> 和 <code>unmounted</code> 。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/lifecycle.d2f8a1b7.svg" alt="vu3-lifecycle"></p><p>Vue3 也提供了 Composition API 形式的生命周期钩子，与 Vue2 中钩子对应关系如下：</p><ul><li><code>beforeCreate</code>===&gt;<code>setup()</code></li><li><code>created</code>=======&gt;<code>setup()</code></li><li><code>beforeMount</code> ===&gt;<code>onBeforeMount</code></li><li><code>mounted</code>=======&gt;<code>onMounted</code></li><li><code>beforeUpdate</code>===&gt;<code>onBeforeUpdate</code></li><li><code>updated</code> =======&gt;<code>onUpdated</code></li><li><code>beforeUnmount</code> ==&gt;<code>onBeforeUnmount</code></li><li><code>unmounted</code> =====&gt;<code>onUnmounted</code></li></ul><p>若和配置项生命钩子一起使用，则组合式会比配置项的先执行，如 <code>onBeforeMount</code> 先于 <code>beforeMount</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---setup---&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//通过组合式API的形式去使用生命周期钩子</span></span><br><span class="line">  <span class="title function_">onBeforeMount</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---onBeforeMount---&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---onMounted---&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">onBeforeUpdate</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---onBeforeUpdate---&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">onUpdated</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---onUpdated---&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">onBeforeUnmount</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---onBeforeUnmount---&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---onUnmounted---&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;sum&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="hook-函数">hook 函数</h3><ul><li>hook 是一个函数，把 setup 函数的 Composition API 进行了封装</li><li>类似 Vue2 的 Mixin，能复用代码，让 setup 里的逻辑更清晰</li><li>hook 放在 hooks 文件夹中，一个文件对应一个功能模块，以 <code>useXxx</code> 命名</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hooks/usePoint.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; reactive, onMounted, onBeforeUnmount &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//实现鼠标“打点”相关的数据</span></span><br><span class="line">  <span class="keyword">let</span> point = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//实现鼠标“打点”相关的方法</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">savePoint</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    point.<span class="property">x</span> = event.<span class="property">pageX</span></span><br><span class="line">    point.<span class="property">y</span> = event.<span class="property">pageY</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//实现鼠标“打点”相关的生命周期钩子</span></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, savePoint)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, savePoint)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> point</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 hook</span></span><br><span class="line"><span class="keyword">import</span> usePoint <span class="keyword">from</span> <span class="string">&#x27;../hooks/usePoint.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> point = <span class="title function_">usePoint</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; point &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="toRef-函数">toRef 函数</h3><ul><li>创建一个 RefImpl 实例对象，其 value 值指向另一个对象的某个属性，修改 value 值会修改源对象对应的属性</li><li>应用：需要把响应式对象的某个属性单独提供给外部使用</li><li>批量创建：<code>toRefs</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reactive, toRef, toRefs&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Vue3&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">info</span>: &#123;</span><br><span class="line">      <span class="attr">job</span>: &#123;</span><br><span class="line">        <span class="attr">salary</span>: <span class="number">40</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 注意不能写成 ref(person.name)，这和源对象是割裂开的</span></span><br><span class="line">    <span class="attr">name</span>: <span class="title function_">toRef</span>(person, <span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">    <span class="attr">salary</span>: <span class="title function_">toRef</span>(person.<span class="property">info</span>.<span class="property">job</span>, <span class="string">&#x27;salary&#x27;</span>)</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    ...<span class="title function_">toRefs</span>(person)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="其它-Composition-API">其它 Composition API</h2><h3 id="shallowReactive-shallowRef">shallowReactive &amp; shallowRef</h3><ul><li><code>shallowReactive</code>：只处理对象最外层属性的响应式，即浅响应式</li><li><code>shallowRef</code>：基本数据类型和 <code>ref</code> 相同，对象数据不再会调用 <code>reactive</code>，因此只有对象引用改变了才是响应式的</li><li>若一个对象数据，结构很深，但只有最外层属性变化，可用 <code>shallowReactive</code></li><li>若一个对象数据，属性不会改变，而是使用新对象替换，可用 <code>shallowRef</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowReactive, shallowRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> person = <span class="title function_">shallowReactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Vue3&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">    <span class="attr">info</span>: &#123;</span><br><span class="line">      <span class="attr">job</span>: &#123;</span><br><span class="line">        <span class="attr">salary</span>: <span class="number">22</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">let</span> x = <span class="title function_">shallowRef</span>(&#123;</span><br><span class="line">    <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    person,</span><br><span class="line">    x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="readonly-shallowReadonly">readonly &amp; shallowReadonly</h3><ul><li><code>readonly</code>: 让一个响应式数据变为只读的（深只读）</li><li><code>shallowReadonly</code>：让一个响应式数据变为只读的（浅只读）</li><li>应用场景: 不希望数据被修改时，如你用了别人的响应式数据，但是别人不希望你修改时</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;...&#125;)</span><br><span class="line"></span><br><span class="line">  sum = <span class="title function_">readonly</span>(sum)</span><br><span class="line">  person = <span class="title function_">shallowReadonly</span>(person)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    sum,</span><br><span class="line">    person</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="toRaw-markRaw">toRaw &amp; markRaw</h3><p><code>toRaw</code>：</p><ul><li>将一个由 <code>reactive</code> 生成的响应式对象转为普通对象</li><li>用于读取响应式对象对应的普通对象，对该普通对象的操作不会引起页面更新</li></ul><p><code>markRaw</code>：</p><ul><li>标记一个对象，让其不成为响应式对象</li><li>有些值不应设置为响应式，比如复杂的第三方库</li><li>当渲染复杂且不变的数据时，跳过响应式转换可提高性能</li></ul><p>注意：仅仅让数据变为非响应式的，数据变的依旧变，只是没引起页面更新</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showRawPerson</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> p = <span class="title function_">toRaw</span>(person);</span><br><span class="line">    p.<span class="property">age</span>++;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">addCar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> car = &#123; <span class="attr">name</span>: <span class="string">&quot;奔驰&quot;</span>, <span class="attr">price</span>: <span class="number">40</span> &#125;;</span><br><span class="line">    person.<span class="property">car</span> = <span class="title function_">markRaw</span>(car);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="customRef">customRef</h3><p>创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; keyword &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, customRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Demo&#x27;</span>,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 自定义 myRef</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">myRef</span>(<span class="params">value, delay</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> timer</span><br><span class="line">      <span class="comment">// 通过customRef去实现自定义</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">customRef</span>(<span class="function">(<span class="params">track, trigger</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">//告诉Vue这个value值是需要被“追踪”的</span></span><br><span class="line">            <span class="title function_">track</span>()</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">            timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              value = newValue</span><br><span class="line">              <span class="comment">// 告诉Vue去更新界面</span></span><br><span class="line">              <span class="title function_">trigger</span>()</span><br><span class="line">            &#125;, delay)</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> keyword = <span class="title function_">myRef</span>(<span class="string">&#x27;hello&#x27;</span>, <span class="number">500</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      keyword,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="provide-inject">provide / inject</h3><p>实现祖先组件与后代组件之间通信。</p><p><img src= "/img/loading.gif" data-lazy-src="https://brucecai55520.gitee.io/bruceblog/assets/img/provide-inject.840efd40.png" alt="provide-inject"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 祖先组件传递数据</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide, reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> car = <span class="title function_">reactive</span>(&#123;...&#125;)</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">provide</span>(<span class="string">&#x27;sum&#x27;</span>, sum)</span><br><span class="line">  <span class="title function_">provide</span>(<span class="string">&#x27;car&#x27;</span>, car)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 后代组件接收数据</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> car = <span class="title function_">inject</span>(<span class="string">&#x27;car&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> sum = <span class="title function_">inject</span>(<span class="string">&#x27;sum&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> &#123; car, sum &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="响应式数据的判断">响应式数据的判断</h3><ul><li><code>isRef</code>: 检查一个值是否为一个 <code>ref</code> 对象</li><li><code>isReactive</code>: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</li><li><code>isReadonly</code>: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</li><li><code>isProxy</code>: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</li></ul><h2 id="Compositon-API-的优势">Compositon API 的优势</h2><p><strong>Options API 存在的问题</strong></p><p>使用传统 Options API 中，新增或者修改一个需求，就需要分别在 data，methods，computed 等地方修改。</p><p><strong>Composition API 的优势</strong></p><p>可以更加优雅地组织代码、函数，让相关功能的代码更加有序的组织在一起。说白了就是让同一个功能的代码整合到一起，日后修改代码直接找对应的功能模块。</p><h2 id="新的组件">新的组件</h2><h3 id="Fragment">Fragment</h3><ul><li>在 Vue2 中: 组件必须有一个根标签</li><li>在 Vue3 中: 组件可以没有根标签, 内部会将多个标签包含在一个 <code>Fragment</code> 虚拟元素中</li><li>好处: 减少标签层级, 减小内存占用</li></ul><h3 id="Teleport">Teleport</h3><ul><li>将包裹的 HTML 结构移动到指定元素的末尾</li><li><code>to</code> 属性为 CSS 选择器</li></ul><p>简易的模态框效果：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;#root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dialog&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>我是一个弹窗<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;isShow = false&quot;</span>&gt;</span>关闭弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mask</span> &#123;</span><br><span class="line">  <span class="comment">/* 遮罩层铺满窗口 */</span></span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dialog</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Suspense">Suspense</h3><p>等待异步组件时渲染额外内容，让用户体验更好</p><p>异步引入组件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./components/Child.vue&#x27;</span>))</span><br></pre></td></tr></table></figure><p>使用 <code>Suspense</code> 包裹组件，实际上是往插槽填充内容，<code>default</code> 插槽填充组件内容，<code>fallback</code> 插槽填充组件加载时显示的内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:fallback</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>加载中，请稍等...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span><br></pre></td></tr></table></figure><p>另外，若 <code>Child</code> 组件的 <code>setup</code> 函数返回一个 Promise 对象，也能渲染 <code>fallback</code> 里的内容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(&#123;sum&#125;)</span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="其他改变">其他改变</h2><ul><li>全局 API 的转移</li></ul><p>Vue3 将全局的 API，即：<code>Vue.xxx</code> 调整到应用实例 <code>app</code> 上：</p><table><thead><tr><th>Vue2 全局 API</th><th>Vue3 实例 API</th></tr></thead><tbody><tr><td><a href="http://Vue.config.xxx">Vue.config.xxx</a></td><td><a href="http://app.config.xxx">app.config.xxx</a></td></tr><tr><td>Vue.config.productionTip</td><td>移除</td></tr><tr><td>Vue.component</td><td>app.component</td></tr><tr><td>Vue.directive</td><td>app.directive</td></tr><tr><td>Vue.mixin</td><td>app.mixin</td></tr><tr><td>Vue.use</td><td>app.use</td></tr><tr><td>Vue.prototype</td><td>app.config.globalProperties</td></tr></tbody></table><ul><li><code>data</code> 选项应始终被声明为一个函数</li><li>过渡类名的更改：</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Vue2 */</span></span><br><span class="line"><span class="selector-class">.v-enter</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.v-leave</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Vue3 */</span></span><br><span class="line"><span class="selector-class">.v-enter-from</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.v-leave-from</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>移除 <code>keyCode</code> 作为 <code>v-on</code> 的修饰符，同时也不再支持 <code>config.keyCodes</code></li><li>移除 <code>v-on.native</code>修饰符，子组件没有在 <code>emits: ['close']</code> 声明的自定义事件作为原生事件处理</li><li>移除过滤器 <code>filter</code></li><li>…</li></ul><h2 id="组件上的-v-model">组件上的 v-model</h2><p>当需要维护组件内外数据的同步时，可以在组件上使用 <code>v-model</code> 指令。</p><p>父组件传值：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父组件传值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-counter</span> <span class="attr">v-model:number</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-counter</span>&gt;</span></span><br></pre></td></tr></table></figure><p>子组件在 <code>emits</code> 节点声明自定义事件，格式为 <code>update:xxx</code> ，调用 <code>$emit</code> 触发自定义事件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;number&#x27;</span>],</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:number&#x27;</span>],</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;update:number&#x27;</span>, <span class="variable language_">this</span>.<span class="property">number</span>++)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，在 <code>vue3</code> 中 <code>props</code> 属性同样是只读的，上面 <code>this.number++</code> 并没有修改 <code>number</code> 的值。</p><p>其实通过 <code>v-bind</code> 传值和监听自定义事件的方式能实现和 <code>v-model</code> 相同的效果。</p><h2 id="EventBus">EventBus</h2><p>借助于第三方的包 <code>mitt</code> 来创建 <code>eventBus</code> 对象，从而实现兄弟组件之间的数据共享。</p><p>安装 <code>mitt</code> 依赖包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mitt@2.1.0</span><br></pre></td></tr></table></figure><p>创建公共的 <code>eventBus</code> 模块：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mitt <span class="keyword">from</span> <span class="string">&#x27;mitt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 EventBus 实例对象</span></span><br><span class="line"><span class="keyword">const</span> bus = <span class="title function_">mitt</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> bus</span><br></pre></td></tr></table></figure><p>数据接收方调用 <code>bus.on()</code> 监听自定义事件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bus <span class="keyword">from</span> <span class="string">&#x27;./eventBus.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    bus.<span class="title function_">on</span>(<span class="string">&#x27;countChange&#x27;</span>, <span class="function">(<span class="params">count</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span> = count</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>数据接发送方调用 <code>bus.emit()</code> 触发事件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bus <span class="keyword">from</span> <span class="string">&#x27;./eventBus.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">cout</span>: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">      bus.<span class="title function_">emit</span>(<span class="string">&#x27;countChange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">count</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="vue-3-x-全局配置-axios">vue 3.x 全局配置 axios</h2><p>实际项目开发中，几乎每个组件中都会使用 <code>axios</code> 发起数据请求。此时会遇到如下两个问题：</p><ul><li>每个组件中都需要导入 <code>axios</code>（代码臃肿）</li><li>每次发请求都需要填写完整的请求路径（不利于后期的维护）</li></ul><p>在 <code>main.js</code> 文件中进行配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置请求根路径</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">baseURL</span> = <span class="string">&#x27;http://api.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 axios 挂载为 app 全局自定义属性</span></span><br><span class="line"><span class="comment">// 每个组件可通过 this.$http 访问到 axios</span></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$http</span> = axios</span><br></pre></td></tr></table></figure><p>组件调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/users&#x27;</span>)</span><br></pre></td></tr></table></figure><hr><blockquote><p>视频笔记内容来自B站尚硅谷的<a href="https://www.bilibili.com/video/BV1Zy4y1K7SH?p=1&amp;vd_source=f5b24b9dd30b3acd2bf669dccabe17d6">张天禹老师</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Vue 核心基础&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://cn.vuejs.org/&quot;&gt;官网传送门&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Vue 是动态构建用户界面的渐进式 JavaScript 框架&lt;/p&gt;
&lt;p&gt;Vue 借鉴 Angular 的模板</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="Vue" scheme="https://blog.cilicili.xyz/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>【后端】基于Node.js的数据库与身份认证</title>
    <link href="https://blog.cilicili.xyz/posts/706992d4.html"/>
    <id>https://blog.cilicili.xyz/posts/706992d4.html</id>
    <published>2022-09-06T08:33:45.000Z</published>
    <updated>2022-09-09T09:35:00.216Z</updated>
    
    <content type="html"><![CDATA[<h1>数据库和身份认证</h1><ol><li><p>数据库（database）是用来<strong>组织、存储和管理</strong>数据的仓库。</p><p>用户可以对数据库中的数据进行<strong>新增、查询、更新、删除</strong>等操作。</p></li><li><p>最常见的数据库有如下几个：</p></li></ol><ul><li><p>MySQL 数据库（目前使用最广泛、流行度最高的开源免费数据库；Community + Enterprise）</p></li><li><p>Oracle 数据库（收费）</p></li><li><p>SQL Server 数据库（收费）</p></li><li><p>Mongodb 数据库（Community + Enterprise）</p></li></ul><ol start="3"><li><p>其中，MySQL、Oracle、SQL Server 属于<strong>传统型数据库</strong>（又叫做：关系型数据库 或 SQL 数据库）。</p><p>而 Mongodb 属于<strong>新型数据库</strong>（又叫做：非关系型数据库 或 NoSQL 数据库），它在一定程度上弥补了传统型数据库的缺陷。</p></li><li><p>在传统型数据库中，数据的组织结构分为**数据库(database)、数据表(table)、数据行(row)、字段(field)**这 4 大部分组成。</p></li></ol><h2 id="安装MySQL">安装MySQL</h2><p>对于开发人员来说，只需要安装 MySQL Server 和 MySQL Workbench （Navicat）这两个软件，就能满足开发的需要了。</p><ul><li><p>MySQL Server：专门用来提供数据存储和服务的软件。</p></li><li><p>MySQL Workbench（Nacicat）：可视化的 MySQL 管理工具，通过它，可以方便的操作存储在 MySQL Server 中的数据。</p></li></ul><h3 id="什么是SQL">什么是SQL</h3><p>SQL（英文全称：Structured Query Language）是结构化查询语言，专门用来访问和处理数据库的编程语言。</p><p>能够让我们<strong>以编程的形式</strong>，<strong>操作数据库里面的数据</strong>。</p><p><strong>三个关键点</strong>：</p><p>① SQL 是一门数据库编程语言</p><p>② 使用 SQL 语言编写出来的代码，叫做 SQL 语句</p><p>③ SQL 语言只能在关系型数据库中使用（例如 MySQL、Oracle、SQL Server）。非关系型数据库（例如 Mongodb）不支持 SQL 语言</p><h3 id="SQL能做什么">SQL能做什么</h3><p>① 从数据库中<strong>查询数据</strong></p><p>② 向数据库中<strong>插入新的数据</strong></p><p>③ <strong>更新</strong>数据库中的<strong>数据</strong></p><p>④ 从数据库<strong>删除数据</strong></p><p>⑤ 可以创建新数据库</p><p>⑥ 可在数据库中创建新表</p><p>⑦ 可在数据库中创建存储过程、视图</p><p>⑧ etc…</p><h2 id="MySQL的基本使用">MySQL的基本使用</h2><h3 id="SQL的SELECT语句">SQL的SELECT语句</h3><p>SELECT 语句用于从表中<strong>查询数据</strong>。执行的结果被存储在一个<strong>结果表</strong>中（称为<strong>结果集</strong>）。</p><p>语法格式如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906185509837.png" alt="image-20220906185509837"></p><blockquote><p><strong>注意</strong>：SQL 语句中的关键字对<strong>大小写不敏感</strong>。SELECT 等效于 select，FROM 等效于 from。</p></blockquote><h3 id="SQL的-INSERT-INTO语句">SQL的 INSERT INTO语句</h3><p><strong>INSERT INTO</strong> 语句用于向数据表中<strong>插入新的数据行</strong>。</p><p>语法格式如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906185726369.png" alt="image-20220906185726369"></p><h3 id="SQL的UPDATE语句">SQL的UPDATE语句</h3><p><strong>Update</strong> 语句用于<strong>修改表中的数据</strong>。</p><p>语法格式如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906190034371.png" alt="image-20220906190034371"></p><p>例如：把 users 表中 id 为 7 的用户密码，更新为 888888。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> password<span class="operator">=</span><span class="string">&#x27;888888&#x27;</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">7</span></span><br></pre></td></tr></table></figure><h3 id="SQL的DELETE语句">SQL的DELETE语句</h3><p><strong>DELETE</strong> 语句用于<strong>删除表中的行</strong>。</p><p>语法格式如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906190356539.png" alt="image-20220906190356539"></p><h3 id="SQL的WHERE子句">SQL的WHERE子句</h3><p>WHERE 子句用于<strong>限定选择的标准</strong>。在 <strong>SELECT、UPDATE、DELETE</strong> 语句中，<strong>皆可使用</strong> WHERE 子句来限定选择的标准。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906190558124.png" alt="image-20220906190558124"></p><p><strong>可在WHERE子句中使用的运算符</strong>：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906190644158.png" alt="image-20220906190644158"></p><blockquote><p><strong>注意</strong>：在某些版本的SQL中，操作符&lt; &gt;可以写为!=</p></blockquote><p><strong>WHERE子句示例</strong>：可以通过 WHERE 子句来限定 SELECT 的查询条件</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906190825402.png" alt="image-20220906190825402"></p><h3 id="SQL-的-AND-和-OR-运算符">SQL 的 AND 和 OR 运算符</h3><p>AND 和 OR 可<strong>在 WHERE 子语句</strong>中<strong>把两个或多个条件结合起来</strong>。</p><p>AND 表示<strong>必须同时满足多个条件</strong>，相当于 JavaScript 中的 &amp;&amp; 运算符，例如 <strong>if (a !== 10 &amp;&amp; a !== 20)</strong></p><p>OR 表示<strong>只要满足任意一个条件即可</strong>，相当于 JavaScript 中的 || 运算符，例如 <strong>if(a !== 10 || a !== 20)</strong></p><h3 id="SQL的ORDER-BY子句">SQL的ORDER BY子句</h3><p>ORDER BY 语句用于<strong>根据指定的列对结果集进行排序</strong>。</p><p>ORDER BY 语句<strong>默认</strong>按照<strong>升序</strong>对记录进行排序。</p><p>如果您希望按照<strong>降序</strong>对记录进行排序，可以使用 <strong>DESC</strong> 关键字。</p><h4 id="ORDER-BY-子句-升序排序">ORDER BY 子句-升序排序</h4><p>ORDER BY 默认进行升序排序；其中，ASC关键字代表升序排序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> status;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> status <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure><h4 id="ORDER-BY-子句-降序排序"><strong>ORDER BY</strong> <strong>子句</strong>-降序排序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><h4 id="ORDER-BY-字句-多重排序">ORDER BY 字句-多重排序</h4><p>对 users 表中的数据，先按照 <strong>status</strong> 字段进行<strong>降序排序</strong>，再按照 <strong>username</strong> 的字母顺序，进行<strong>升序排序</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> status <span class="keyword">DESC</span>, username <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure><h3 id="SQL的COUNT-函数">SQL的COUNT(*)函数</h3><p><strong>COUNT(*)</strong> 函数用于返回<strong>查询结果的总数据条数</strong>。</p><p>语法格式如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906191825445.png" alt="image-20220906191825445"></p><h4 id="使用AS为列设置别名">使用AS为列设置别名</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> total <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="Node-操作-mysql">Node 操作 mysql</h2><h3 id="在项目中操作数据库的步骤">在项目中操作数据库的步骤</h3><p>① 安装操作 MySQL 数据库的第三方模块（<strong>mysql</strong>）</p><p>② 通过 mysql 模块<strong>连接到 MySQL 数据库</strong></p><p>③ 通过 mysql 模块<strong>执行 SQL 语句</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906192230370.png" alt="image-20220906192230370"></p><h3 id="配置-mysql-模块">配置 mysql 模块</h3><ol><li>安装 mysql 模块</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql</span><br></pre></td></tr></table></figure><ol start="2"><li>配置mysql模块，并建立连接</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.导入mysql模块</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"><span class="comment">// 2.建立与MySQL数据库的连接</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,  <span class="comment">// 数据库的IP地址</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;test&#x27;</span>,  <span class="comment">// 指定要操作哪个数据库</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>测试是否正常工作</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(<span class="string">&#x27;select 1&#x27;</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="操作-mysql-数据库">操作 mysql 数据库</h3><ol><li>查询数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(<span class="string">&#x27;select * from users&#x27;</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>插入数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要插入到users表中的数据对象</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; username; <span class="string">&#x27;Bruce&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;pcc321&#x27;</span>&#125;</span><br><span class="line"><span class="comment">// 待执行的SQL语句，其中英文的 ? 表示占位符</span></span><br><span class="line"><span class="keyword">const</span> sqlStr = <span class="string">&#x27;INSERT INTO users (username, password) VALUES (?, ?)&#x27;</span></span><br><span class="line"><span class="comment">// 使用数组的形式为占位符指定具体的值</span></span><br><span class="line">db.<span class="title function_">query</span>(sqlStr, [user.<span class="property">username</span>, user.<span class="property">password</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;插入成功&#x27;</span>)&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>向表中新增数据时，如果数据对象的每个属性和数据表的字段一一对应，则可以通过如下方式快速插入数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">username</span>:<span class="string">&#x27;Bruce&#x27;</span>, <span class="attr">password</span>:<span class="string">&#x27;55520&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;INSERT INTO users SET ?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, user, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>更新数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要更新的数据对象</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">id</span>:<span class="number">7</span>, <span class="attr">username</span>:<span class="string">&#x27;aaa&#x27;</span>, <span class="attr">password</span>:<span class="string">&#x27;000&#x27;</span>&#125;</span><br><span class="line"><span class="comment">// 要执行的SQL语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;UPDATE users SET username=?, password=? WHERE id=?&#x27;</span></span><br><span class="line"><span class="comment">// 调用db.query()执行SQL语句的同时，使用数组依次为占位符指定具体的值</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, [user.<span class="property">username</span>, user.<span class="property">password</span>, user.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>更新表数据时，如果数据对象的每个属性和数据表的字段一一对应，则快捷方式为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">id</span>:<span class="number">7</span>,<span class="attr">username</span>:<span class="string">&#x27;Bruce&#x27;</span>,<span class="attr">password</span>:<span class="string">&#x27;55520&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;UPDATE users SET ? WHERE id=?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, [user, user.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>删除数据</li></ol><p>如果SQL语句中有多个占位符，必须使用数组为每个占位符指定具体的值。</p><p>如果只有一个占位符，则可以省略数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;DELETE FROM users WHERE id=?&#x27;</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, id, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>使用 DELETE 语句，会把真正的把数据从表中删除掉。为了保险起见，<strong>推荐使用</strong>标记删除的形式，来<strong>模拟删除的动作</strong>。</p><p>所谓的标记删除，就是在表中设置类似于 <strong>status</strong> 这样的<strong>状态字段</strong>，来<strong>标记</strong>当前这条数据是否被删除。</p><p>当用户执行了删除的动作时，我们并没有执行 DELETE 语句把数据删除掉，而是执行了 UPDATE 语句，将这条数据对应的 status 字段标记为删除即可。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(<span class="string">&#x27;UPDATE users SET status=1 WHERE id=?&#x27;</span>, <span class="number">7</span>, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Web-开发模式">Web 开发模式</h2><p>目前主流的 Web 开发模式有<strong>两种</strong>，分别是：</p><ul><li><p>基于<strong>服务端渲染</strong>的传统 Web 开发模式</p></li><li><p>基于<strong>前后端分离</strong>的新型 Web 开发模式</p></li></ul><h3 id="服务端渲染">服务端渲染</h3><p>服务器发送给客户端的 HTML 页面，是<strong>在服务器通过字符串的拼接动态生成</strong>的。</p><p>因此客户端不需要使用 Ajax 额外请求页面的数据。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/index.html&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1.要渲染的数据</span></span><br><span class="line">  <span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;Bruce&#x27;</span>, <span class="attr">age</span>: <span class="number">29</span> &#125;</span><br><span class="line">  <span class="comment">// 2.服务器端通过字符串的拼接，动态生成HTML内容</span></span><br><span class="line">  <span class="keyword">const</span> html = <span class="string">`&lt;h1&gt;username:<span class="subst">$&#123;user.name&#125;</span>, age:<span class="subst">$&#123;user.age&#125;</span>&lt;/h1&gt;`</span></span><br><span class="line">  <span class="comment">// 3.把生成好的页面内容响应给客户端。因此，客户端拿到的是带有真实数据的HTML页面</span></span><br><span class="line">  res.<span class="title function_">send</span>(html)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>优点：</p><ul><li><strong>前端耗时短</strong>。浏览器只需直接渲染页面，无需额外请求数据。</li><li><strong>有利于 SEO</strong>。服务器响应的是完整的 HTML 页面内容，有利于爬虫爬取信息。</li></ul><p>缺点：</p><ul><li><strong>占用服务器资源</strong>。服务器需要完成页面内容的拼接，若请求比较多，会对服务器造成一定访问压力。</li><li><strong>不利于前后端分离，开发效率低</strong>。</li></ul><h3 id="前后端分离">前后端分离</h3><p>前后端分离的开发模式，依赖于 Ajax 技术的广泛应用。后端只负责提供 API 接口，前端使用 Ajax 调用接口。</p><p>优点：</p><ul><li><strong>开发体验好</strong>。前端专业页面开发，后端专注接口开发。</li><li><strong>用户体验好</strong>。页面局部刷新，无需重新请求页面。</li><li><strong>减轻服务器的渲染压力</strong>。页面最终在浏览器里生成。</li></ul><p>缺点：</p><ul><li><p><strong>不利于 SEO</strong>。完整的 HTML 页面在浏览器拼接完成，因此爬虫无法爬取页面的有效信息。</p><p>（解决方案：Vue、React 等框架的 SSR（server side render）技术能解决 SEO 问题。）</p></li></ul><h3 id="如何选择">如何选择</h3><ul><li>企业级网站，主要功能是展示，没有复杂交互，且需要良好的 SEO，可考虑服务端渲染</li><li>后台管理项目，交互性强，无需考虑 SEO，可使用前后端分离</li><li>为同时兼顾首页渲染速度和前后端分离开发效率，可采用首屏服务器端渲染+其他页面前后端分离的开发模式</li></ul><h2 id="身份认证">身份认证</h2><h3 id="什么是身份认证">什么是身份认证</h3><p><strong>身份认证</strong>（Authentication）又称“身份验证”、“鉴权”，是指<strong>通过一定的手段，完成对用户身份的确认</strong>。</p><h4 id="不同开发模式下的身份认证">不同开发模式下的身份认证</h4><p>对于<strong>服务端渲染</strong>和<strong>前后端分离</strong>这两种开发模式来说，分别有着不同的身份认证方案：</p><p>① <strong>服务端渲染</strong>推荐使用 <strong>Session</strong> <strong>认证机制</strong></p><p>② <strong>前后端分离</strong>推荐使用 <strong>JWT</strong> <strong>认证机制</strong></p><h3 id="HTTP协议的无状态性">HTTP协议的无状态性</h3><p>HTTP 协议的无状态性，指的是客户端<strong>的每次</strong> <strong>HTTP</strong> <strong>请求都是独立的</strong>，连续多个请求之间没有直接的关系，<strong>服务器不会主动保留每次</strong> <strong>HTTP</strong> <strong>请求的状态</strong>。</p><h4 id="如何突破HTTP无状态的限制">如何突破HTTP无状态的限制</h4><p>在Web开发中将<strong>Cookie</strong>作为身份认证的方式，类似于现实生活中超市会员卡机制。</p><h5 id="什么是Cookie">什么是Cookie</h5><ul><li><p>Cookie 是<strong>存储在用户浏览器中的一段不超过</strong> <strong>4 KB</strong> <strong>的字符串</strong>。</p></li><li><p>它由一个名称（Name）、一个值（Value）和其它几个用于控制 Cookie 有效期、安全性、使用范围的可选属性组成。</p></li><li><p>不同域名下的 Cookie 各自独立，每当客户端发起请求时，会<strong>自动</strong>把<strong>当前域名下</strong>所有<strong>未过期的</strong> <strong>Cookie</strong> 一同发送到服务器。</p></li></ul><p><strong>Cookie</strong>的几大特性：① 自动发送  ② 域名独立  ③ 过期时限  ④ 4KB 限制</p><h5 id="Cookie在身份认证中的作用">Cookie在身份认证中的作用</h5><p>客户端第一次请求服务器的时候，服务器<strong>通过响应头的形式</strong>，向客户端发送一个身份认证的 Cookie，客户端会自动将 Cookie 保存在浏览器中。</p><p>随后，当客户端浏览器每次请求服务器的时候，浏览器会<strong>自动</strong>将身份认证相关的 Cookie，<strong>通过请求头的形式</strong>发送给服务器，服务器即可验明客户端的身份。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906201647455.png" alt="image-20220906201647455"></p><h5 id="Cookie不具有安全性">Cookie不具有安全性</h5><p>由于 Cookie 是存储在浏览器中的，而且<strong>浏览器也提供了读写</strong> <strong>Cookie</strong> <strong>的</strong> <strong>API</strong>，因此 <strong>Cookie</strong> <strong>很容易被伪造</strong>，不具有安全性。因此不建议服务器将重要的隐私数据，通过 Cookie 的形式发送给浏览器。</p><h3 id="Session-认证机制">Session 认证机制</h3><h4 id="Session-工作原理">Session 工作原理</h4><p><img src= "/img/loading.gif" data-lazy-src="https://brucecai55520.gitee.io/bruceblog/assets/img/Session.c66d5499.png" alt="session"></p><h4 id="Express-中使用-Session-认证">Express 中使用 Session 认证</h4><ol><li>安装 express-session 中间件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session</span><br></pre></td></tr></table></figure><ol start="2"><li>配置中间件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line"><span class="comment">// 使用app.use()来注册session中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;Bruce&#x27;</span>, <span class="comment">// secret 的值为任意字符串</span></span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,  <span class="comment">// 固定写法</span></span><br><span class="line">    <span class="attr">saveUninitalized</span>: <span class="literal">true</span>, <span class="comment">// 固定写法</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol start="3"><li>向 session 中存数据</li></ol><p>中间件配置成功后，可通过 <code>req.session</code> 访问 session 对象，存储用户信息</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.<span class="property">session</span>.<span class="property">user</span> = req.<span class="property">body</span></span><br><span class="line">  req.<span class="property">session</span>.<span class="property">isLogin</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;login done&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>从 session 取数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户姓名的接口</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断用户是否登录</span></span><br><span class="line">  <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">isLogin</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;fail&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">username</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="5"><li><p>清空 session</p><p>调用 <strong>req.session.destroy()</strong> 函数，即可清空服务器保存的 session 信息。</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 清空当前客户端的session信息</span></span><br><span class="line">  req.<span class="property">session</span>.<span class="title function_">destroy</span>()</span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;logout done&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Session认证的局限性">Session认证的局限性</h4><p>Session 认证机制需要配合 Cookie 才能实现。由于 Cookie 默认不支持跨域访问，所以，当涉及到前端跨域请求后端接口的时候，<strong>需要做很多额外的配置</strong>，才能实现跨域 Session 认证。</p><blockquote><p><strong>注意</strong>：</p><ul><li><p>当前端请求后端接口<strong>不存在跨域问题</strong>的时候，<strong>推荐使用</strong> <strong>Session</strong> 身份认证机制。</p></li><li><p>当前端需要跨域请求后端接口的时候，不推荐使用 Session 身份认证机制，推荐使用 JWT 认证机制。</p></li></ul></blockquote><h3 id="JWT-认证机制">JWT 认证机制</h3><p>前后端分离推荐使用 JWT（JSON Web Token）认证机制，是目前最流行的跨域认证解决方案</p><h4 id="JWT-工作原理">JWT 工作原理</h4><p>用户的信息通过 Token 字符串的形式，保存在客户端浏览器中。服务器通过还原 Token 字符串的形式来认证用户的身份。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/JWT.6a82c41d.png" alt="JWT"></p><h5 id="JWT-组成部分">JWT 组成部分</h5><ul><li>通常由三部分组成，分别是 <code>Header（头部）、Payload（有效荷载）、Signature（签名）</code>。三者使用 <code>.</code> 分隔</li></ul><p>其中：</p><ul><li><code>Payload</code> 是真正的用户信息，加密后的字符串</li><li><code>Header</code> 和 <code>Signature</code> 是安全性相关部分，保证 <code>Token</code> 安全性</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格式如下</span></span><br><span class="line"><span class="title class_">Header</span>.<span class="property">Payload</span>.<span class="property">Signature</span></span><br><span class="line"><span class="comment">// JWT字符串的示例</span></span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.<span class="property">eyJpZCI6MTcsInVzZXJuYW1lIjoiQnJ1Y2UiLCJwYXNzd29yZCI6IiIsIm5pY2tuYW1lIjoiaGVsbG8iLCJlbWFpbCI6InNjdXRAcXEuY29tIiwidXNlcl9waWMiOiIiLCJpYXQiOjE2NDE4NjU3MzEsImV4cCI6MTY0MTkwMTczMX0</span>.<span class="property">bmqzAkNSZgD8IZxRGGyVlVwGl7EGMtWitvjGD</span>-a5U5c</span><br></pre></td></tr></table></figure><h5 id="JWT-使用方式">JWT 使用方式</h5><ul><li>客户端会把 JWT 存储在 <strong>localStorage</strong> 或 <strong>sessionStorage</strong> 中</li><li>此后客户端与服务端通信需要携带 JWT 进行身份认证，将 JWT 存在 HTTP 请求头 Authorization 字段中</li><li>加上 Bearer 前缀</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Authorization</span>: <span class="title class_">Bearer</span> &lt;token&gt;</span><br></pre></td></tr></table></figure><h5 id="Express-使用-JWT">Express 使用 JWT</h5><ol><li>安装并使用<code>require()</code>函数导入</li></ol><ul><li><code>jsonwebtoken</code> 用于<strong>生成 JWT 字符串</strong></li><li><code>express-jwt</code> 用于<strong>将 JWT 字符串解析还原成 JSON 对象</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jsonwebtoken express-jwt</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 secret 密钥</li></ol><ul><li>为保证 JWT 字符串的安全性，防止其在网络传输过程中被破解，需定义用于加密和解密的 secret 密钥</li><li>生成 JWT 字符串时，使用密钥加密信息，得到加密好的 JWT 字符串</li><li>把 JWT 字符串解析还原成 JSON 对象时，使用密钥解密</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 密钥为任意字符串</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;itheuima No1 ^_^&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>生成 JWT 字符串</p><p>调用 <strong>jsonwebtoken</strong> 包提供的 <strong>sign()</strong> 方法，将用户的信息加密成 JWT 字符串，响应给客户端</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;登录成功&#x27;</span>,</span><br><span class="line">    <span class="comment">// jwt.sign() 生成 JWT 字符串</span></span><br><span class="line">    <span class="comment">// 参数：用户信息对象、加密密钥、配置对象-token有效期</span></span><br><span class="line">    <span class="comment">// 尽量不保存敏感信息，因此只有用户名，没有密码</span></span><br><span class="line">    <span class="attr">token</span>: jwt.<span class="title function_">sign</span>(&#123;<span class="attr">username</span>: userInfo.<span class="property">username</span>&#125;, secretKey, &#123;<span class="attr">expiresIn</span>: <span class="string">&#x27;30s&#x27;</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>JWT 字符串还原为 JSON 对象</li></ol><ul><li>客户端访问有权限的接口时，需通过请求头的 <code>Authorization</code> 字段，将 Token 字符串发送到服务器进行身份认证</li><li>服务器可以通过 express-jwt 中间件将客户端发送过来的 Token 解析还原成 JSON 对象</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unless(&#123; path: [/^\/api\//] &#125;) 指定哪些接口无需访问权限</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">expressJWT</span>(&#123; <span class="attr">secret</span>: secretKey &#125;).<span class="title function_">unless</span>(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br></pre></td></tr></table></figure><ol start="5"><li>获取用户信息</li></ol><ul><li>当 express-jwt 中间件配置成功后，即可在那些有权限的接口中，使用 <code>req.user</code> 对象，来访问从 JWT 字符串中解析出来的用户信息</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是一个有权限的API接口</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin/getinfo&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">user</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取信息成功&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: req.<span class="property">user</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="6"><li>捕获解析 JWT 失败后产生的错误</li></ol><ul><li>当使用 express-jwt 解析 Token 字符串时，如果客户端发送过来的 Token 字符串过期或不合法，会产生一个解析失败的错误，影响项目的正常运行</li><li>通过 Express 的错误中间件，捕获这个错误并进行相关的处理</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;UnauthorizedError&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">401</span>, <span class="attr">message</span>: <span class="string">&#x27;Invalid token&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">status</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;Unknown error&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;数据库和身份认证&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;数据库（database）是用来&lt;strong&gt;组织、存储和管理&lt;/strong&gt;数据的仓库。&lt;/p&gt;
&lt;p&gt;用户可以对数据库中的数据进行&lt;strong&gt;新增、查询、更新、删除&lt;/strong&gt;等操作。&lt;/p&gt;
&lt;/l</summary>
      
    
    
    
    <category term="后端🍟" scheme="https://blog.cilicili.xyz/categories/%E5%90%8E%E7%AB%AF%F0%9F%8D%9F/"/>
    
    
    <category term="Node" scheme="https://blog.cilicili.xyz/tags/Node/"/>
    
    <category term="Express" scheme="https://blog.cilicili.xyz/tags/Express/"/>
    
    <category term="数据库" scheme="https://blog.cilicili.xyz/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>【后端】Express快速入门</title>
    <link href="https://blog.cilicili.xyz/posts/3f9f8ce4.html"/>
    <id>https://blog.cilicili.xyz/posts/3f9f8ce4.html</id>
    <published>2022-09-05T14:05:13.000Z</published>
    <updated>2022-09-09T09:35:02.289Z</updated>
    
    <content type="html"><![CDATA[<h1>Express</h1><p><a href="https://www.expressjs.com.cn/">官网传送门</a></p><blockquote><p>基于 Node.js 平台，快速、开放、极简的 Web 开发框架</p></blockquote><p>Express 的作用和Node.js内置的http模块类似，是用于快速创建Web服务器的第三方模块。</p><p><strong>Express的作用：</strong></p><p>对于前端程序员来说，最常见的两种服务器，分别是：</p><ul><li><p>Web 网站服务器：专门对外提供 Web 网页资源的服务器。</p></li><li><p>API 接口服务器：专门对外提供 API 接口的服务器。</p></li></ul><p>使用 Express，我们可以方便、快速的创建 Web 网站的服务器或 API 接口的服务器。</p><h2 id="Express-初体验">Express 初体验</h2><h3 id="基本使用">基本使用</h3><p>安装 Express：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure><p>创建服务器，监听客户端请求，并返回内容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 web 服务器</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听客户端的 GET 和 POST 请求，并向客户端响应具体的内容</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span>, <span class="attr">gender</span>: <span class="string">&#x27;男&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;请求成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 通过 req.query 可以获取到客户端发送过来的查询参数，例如?name=zs&amp;age=20</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">query</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">query</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里的 :id 是一个动态的参数</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user/:ids/:username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// req.params 是动态匹配到的 URL 参数，默认是一个空对象</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">params</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">params</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="托管静态资源">托管静态资源</h3><ul><li>通过 <code>express.static()</code> 方法可创建静态资源服务器，向外开放访问静态资源。</li><li>Express 在指定的静态目录中查找文件，并对外提供资源的访问路径，存放静态文件的目录名不会出现在 URL 中</li><li>访问静态资源时，会根据托管顺序查找文件</li><li>可为静态资源访问路径添加前缀</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>)) <span class="comment">// 现在，你就可以访问public目录下的所有文件了</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;files&#x27;</span>))  <span class="comment">// 托管多个静态资源目录，请多次调用</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/bruce&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;bruce&#x27;</span>)) <span class="comment">// 挂载路径前缀</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">可直接访问 public, files 目录下的静态资源</span></span><br><span class="line"><span class="comment">http://localhost:3000/images/bg.jpg</span></span><br><span class="line"><span class="comment">http://localhost:3000/css/style.css</span></span><br><span class="line"><span class="comment">http://localhost:3000/js/login.js</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">通过带有 /bruce 前缀的地址访问 bruce 目录下的文件</span></span><br><span class="line"><span class="comment">http://localhost:8080/bruce/images/logo.png</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="nodemon">nodemon</h3><h4 id="为什么要使用nodemon？">为什么要使用nodemon？</h4><p>在编写调试 Node.js 项目的时候，如果修改了项目的代码，则需要频繁的手动 close 掉，然后再重新启动，非常繁琐。现在，我们可以使用 <a href="https://www.npmjs.com/package/nodemon">nodemon</a>这个工具，它能够监听项目文件的变动，当代码被修改后，<code>nodemon</code> 会自动帮我们重启项目，极大方便了开发和调试。</p><h4 id="安装nodemon">安装nodemon</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nodemon</span><br></pre></td></tr></table></figure><h4 id="使用nodemon">使用nodemon</h4><ul><li><p>当基于 <code>Node.js</code> 编写了一个网站应用的时候，传统的方式，是运行 <code>node app.js</code> 命令，来启动项目。这样做的<strong>坏处</strong>是：代码被修改之后，需要手动重启项目。</p></li><li><p>现在，我们可以将 <code>node</code> 命令替换为 <code>nodemon</code> 命令，使用 <code>nodemon app.js</code> 来启动项目。这样做的<strong>好处</strong>是：代码被修改之后，会被 <code>nodemon</code> 监听到，从而实现自动重启项目的效果。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node app.js</span></span><br><span class="line">nodemon app.js</span><br></pre></td></tr></table></figure><h2 id="Express-路由">Express 路由</h2><h4 id="什么是路由">什么是路由</h4><p>广义上来讲，路由就是<strong>映射关系</strong>。</p><h4 id="Express中的路由">Express中的路由</h4><p>在 <code>Express</code> 中，路由指的是<strong>客户端的请求</strong>与<strong>服务器处理函数</strong>之间的<strong>映射关系</strong>。</p><p><code>Express</code> 中的路由分 <strong>3</strong> 部分组成，分别是<strong>请求的类型、请求的 URL 地址、处理函数</strong>，格式如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906134425528.png" alt="image-20220906134425528"></p><h4 id="Express中的路由的例子">Express中的路由的例子</h4><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906134446465.png" alt="image-20220906134446465"></p><h4 id="路由的匹配过程">路由的匹配过程</h4><p>每当一个请求到达服务器之后，<strong>需要先经过路由的匹配</strong>，只有匹配成功之后，才会调用对应的处理函数。</p><p>在匹配时，会按照路由的顺序进行匹配，如果<strong>请求类型</strong>和<strong>请求的 URL</strong> 同时匹配成功，则 <code>Express</code> 会将这次请求，转交给对应的 <code>function 函数</code>进行处理。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906134540314.png" alt="image-20220906134540314"></p><blockquote><p>路由匹配的<strong>注意点</strong>：</p><p>① 按照定义的<strong>先后顺序</strong>进行匹配</p><p>② <strong>请求类型</strong>和<strong>请求的URL</strong>同时匹配成功，才会调用对应的处理函数</p></blockquote><h4 id="路由的使用">路由的使用</h4><p>**最简单的用法：**在 Express 中使用路由最简单的方式，就是把路由挂载到 app 上。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;res.<span class="title function_">send</span>(<span class="string">&#x27;Hello World.&#x27;</span>)&#125;)</span><br></pre></td></tr></table></figure><h5 id="模块化路由">模块化路由</h5><p>为了方便对路由进行模块化的管理，Express <strong>不建议</strong>将路由直接挂载到 app 上，而是<strong>推荐将路由抽离为单独的模块。</strong></p><p><strong>将路由抽离为单独模块的步骤如下：</strong></p><p>① 创建路由模块对应的 <code>.js</code> 文件</p><p>② 调用 <code>express.Router()</code> 函数创建路由对象</p><p>③ 向路由对象上挂载具体的路由</p><p>④ 使用 <code>module.exports</code> 向外共享路由对象</p><p>⑤ 使用 <code>app.use()</code> 函数注册路由模块</p><p><strong>创建路由模块：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入router.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载获取用户列表的路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user/list&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Get user list.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 挂载添加用户的路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/user/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Add new user.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外导出路由对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><p>注册路由模块：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册路由模块，添加访问前缀 // app.use() 函数的作用，就是来注册全局中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, router)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Express-中间件">Express 中间件</h2><ul><li>中间件（Middleware）是指<strong>业务流程</strong>的<strong>中间处理环节</strong></li><li>当一个请求到达 <code>Express</code> 的服务器之后，可以连续调用多个中间件，从而对这次请求进行预处理。</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906135857522.png" alt="image-20220906135857522"></p><ul><li>中间件本质是一个<code>funciton处理函数</code>，Express中间件的格式如下：</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906135933713.png" alt="image-20220906135933713"></p><blockquote><p><strong>注意</strong>：中间件函数的形参列表中，必须包含 <code>next</code> 参数。而路由处理函数中只包含 <code>req</code> 和 <code>res</code>。</p></blockquote><ul><li><strong>next</strong> <strong>函数</strong>是实现<strong>多个中间件连续调用</strong>的关键，它表示把流转关系<strong>转交</strong>给下一个<strong>中间件</strong>或<strong>路由</strong>。</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906140849659.png" alt="image-20220906140849659"></p><blockquote><p>中间件<strong>注意事项</strong>；</p><p>① 一定要在<strong>路由之前</strong>注册中间件</p><p>② 客户端发送过来的请求，<strong>可以连续调用多个</strong>中间件进行处理</p><p>③ 执行完中间件的业务代码之后，<strong>不要忘记调用 next() 函数</strong></p><p>④ 为了<strong>防止代码逻辑混乱</strong>，调用 <code>next()</code> 函数后不要再写额外的代码</p><p>连续调用多个中间件时，多个中间件之间，<strong>共享</strong> <code>req</code> 和 <code>res</code> 对象</p></blockquote><h3 id="中间件的作用">中间件的作用</h3><p>多个中间件之间，<strong>共享同一份</strong> <strong><code>req</code></strong> <strong>和</strong> <strong><code>res</code></strong>。基于这样的特性，我们可以在上游的中间件中，<strong>统一</strong>为 <code>req</code> 或 <code>res</code> 对象添加自定义的属性或方法，供下游的中间件或路由进行使用。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906141435373.png" alt="image-20220906141435373"></p><h3 id="定义中间件函数">定义中间件函数</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906141051034.png" alt="image-20220906141051034"></p><h3 id="全局中间件">全局中间件</h3><ul><li>客户端发起的任何请求，到达服务器之后，都会触发的中间件，叫做全局生效的中间件。</li><li>通过调用 <code>app.use()</code>(中间件函数)，即可定义一个全局生效的中间件。</li><li>可以使用 <code>app.use()</code> 连续定义多个全局中间件。客户端请求到达服务器之后，会按照中间件定义的先后顺序依次进行调用。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义第一个全局中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;调用了第1个全局中间件&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 定义第二个全局中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;调用了第2个全局中间件&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;User page.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="局部中间件">局部中间件</h3><ul><li><strong>不使用</strong> <code>app.use()</code> 定义的中间件，叫做局部生效的中间件。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义中间件函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mw1</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;调用了第一个局部生效的中间件&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mw2</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;调用了第二个局部生效的中间件&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两种定义多个局部中间件的方式</span></span><br><span class="line"><span class="comment">// mw1,mw2只在“当前路由中生效”，这种用法属于“局部生效的中间件”</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/hello&#x27;</span>, mw2, mw1, <span class="function">(<span class="params">req, res</span>) =&gt;</span> res.<span class="title function_">send</span>(<span class="string">&#x27;hello page.&#x27;</span>))</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/about&#x27;</span>, [mw1, mw2], <span class="function">(<span class="params">req, res</span>) =&gt;</span> res.<span class="title function_">send</span>(<span class="string">&#x27;about page.&#x27;</span>))</span><br><span class="line"><span class="comment">// mw1,mw2不会影响下面这个路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> res.<span class="title function_">send</span>(<span class="string">&#x27;User page.&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="中间件分类">中间件分类</h3><p>Express 官方把<strong>常见的中间件用法</strong>，分成了 <strong>5 大类</strong>，分别是：</p><p>① <strong>应用级别</strong>的中间件</p><p>② <strong>路由级别</strong>的中间件</p><p>③ <strong>错误级别</strong>的中间件</p><p>④ <strong>Express 内置</strong>的中间件</p><p>⑤ <strong>第三方</strong>的中间件</p><p><strong>详细信息：</strong></p><ol><li><p><strong>应用级别</strong>的中间件：通过 <code>app.use()</code> 或 <code>app.get()</code> 或 <code>app.post()</code> ，绑定到 <code>app</code> 实例上的中间件。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906142716941.png" alt="image-20220906142716941"></p></li><li><p><strong>路由级别</strong>的中间件：绑定到 <code>express.Router()</code> 实例上的中间件，叫做路由级别的中间件。用法和应用级别中间件没有区别，应用级别中间件是绑定到 <code>app</code> 实例上，路由级别中间件绑定到 <code>router</code> 实例上。</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, router)</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>错误级别</strong>的中间件</li></ol><ul><li><strong>作用</strong>：用来捕获整个项目中发生的异常错误，从而防止项目异常崩溃的问题。</li><li><strong>格式</strong>：错误级别中间件的处理函数中，必须有 <strong>4</strong> 个形参，形参顺序从前到后分别是 <code>(err, req, res, next)</code> 。</li><li><strong>注意</strong>：错误级别的中间件必须注册在所有路由之后。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;服务器内部发生了错误！&#x27;</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Home page.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义错误级别的中间件，捕获整个项目的异常错误，从而防止程序的崩溃</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发生了错误！&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Error：&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>Express <strong>内置中间件</strong></li></ol><p>自 Express 4.16.0 版本开始，Express 内置了 <strong>3</strong> 个常用的中间件，极大的提高了 <code>Express</code> 项目的开发效率和体验：</p><ul><li><code>express.static</code> 快速托管静态资源的内置中间件，例如： HTML 文件、图片、CSS 样式等（无兼容性）</li><li><code>express.json</code> 解析 JSON 格式的请求体数据（<strong>有兼容性</strong>，仅在 4.16.0+ 版本中可用）</li><li><code>express.urlencoded</code> 解析 URL-encoded 格式的请求体数据（有兼容性，仅在 4.16.0+ 版本中可用）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置解析application/json格式数据的内置中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>())</span><br><span class="line"><span class="comment">// 配置解析application/x-www-form-urlencoded格式数据的内置中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>第三方中间件</strong></li></ol><p>非 Express 官方内置的，而是由第三方开发出来的中间件，叫做第三方中间件。</p><p>例如：在 <code>express@4.16.0</code> 之前的版本中，经常使用 <code>body-parser</code> 这个第三方中间件，来解析请求体数据。</p><p>使用步骤如下：</p><p>① 运行 <code>npm install body-parser</code> 安装中间件</p><p>② 使用 <code>require</code> 导入中间件</p><p>③ 调用 <code>app.use()</code> 注册并使用中间件</p><blockquote><p><strong>注意：</strong></p><p><code>Express</code> 内置的 <code>express.urlencoded</code> 中间件，就是基于 <code>body-parser</code> 这个第三方中间件进一步封装出来的。</p></blockquote><h3 id="自定义中间件">自定义中间件</h3><ol><li><p><strong>需求描述</strong>与实现步骤</p><p>手动模拟一个类似于 <code>express.urlencoded</code> 这样的中间件，来解析 <code>POST</code> 提交到服务器的表单数据。</p><p><strong>实现步骤：</strong></p><p>① 定义中间件</p><p>② 监听 <code>req</code> 的 <code>data</code> 事件</p><p>③ 监听 <code>req</code> 的 <code>end</code> 事件</p><p>④ 使用 <code>querystring</code> 模块解析请求体数据</p><p>⑤ 将解析出来的数据对象挂载为 <code>req.body</code></p><p>⑥ 将自定义中间件封装为模块</p></li><li><p><strong>定义</strong>中间件</p><p>使用 <code>app.use()</code> 来定义全局生效的中间件，代码如下：</p></li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906150421909.png" alt="image-20220906150421909"></p><ol start="3"><li><p>监听 <strong>req</strong> 的 <strong>data</strong> 事件</p><p>在中间件中，需要监听 req 对象的 data 事件，来获取客户端发送到服务器的数据。</p><p>如果数据量比较大，无法一次性发送完毕，则客户端会<strong>把数据切割后，分批发送到服务器</strong>。所以 data 事件可能会触发多次，每一次触发 data 事件时，<strong>获取到数据只是完整数据的一部分</strong>，需要手动对接收到的数据进行拼接。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906150519601.png" alt="image-20220906150519601"></p></li><li><p>监听<strong>req</strong>的<strong>end</strong>事件</p><p>当请求体数据<strong>接收完毕</strong>之后，会自动触发 req 的 end 事件。</p><p>因此，我们可以在 req 的 end 事件中，<strong>拿到并处理完整的请求体数据</strong>。示例代码如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906150650805.png" alt="image-20220906150650805"></p></li><li><p>使用<strong>querystring</strong>模块解析请求体数据</p><p>Node.js 内置了一个 <strong>querystring</strong> 模块，<strong>专门用来处理查询字符串</strong>。通过这个模块提供的 <strong>parse()</strong> 函数，可以轻松把查询字符串，解析成对象的格式。示例代码如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906150744982.png" alt="image-20220906150744982"></p></li><li><p>将解析出来的数据对象挂载为 <strong>req.body</strong></p><p>上游的中间件和下游的中间件及路由之间，<strong>共享同一份</strong> <strong>req</strong> <strong>和</strong> <strong>res</strong>。因此，我们可以将解析出来的数据，挂载为 req 的自定义属性，命名为 req.body，供下游使用。示例代码如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906151130422.png" alt="image-20220906151130422"></p></li><li><p>将自定义中间件封装为模块</p><p>为了优化代码的结构，我们可以把自定义的中间件函数，封装为独立的模块，示例代码如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906151206420.png" alt="image-20220906151206420"></p></li></ol><h3 id="使用Express写接口">使用Express写接口</h3><ol><li><p>创建基本的服务器</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906153054509.png" alt="image-20220906153054509"></p></li><li><p>创建API路由模块</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906153128520.png" alt="image-20220906153128520"></p></li><li><p>编写GET接口</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906153215106.png" alt="image-20220906153215106"></p></li><li><p>编写POST接口</p><blockquote><p>**注意：**如果要获取 URL-encoded 格式的请求体数据，必须配置中间件</p><p><strong>app.use(express.urlencoded({ extended: false }))</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906153244806.png" alt="image-20220906153244806"></p></li></ol><h2 id="CORS-跨域资源共享">CORS 跨域资源共享</h2><h3 id="接口的跨域问题">接口的跨域问题</h3><p>解决接口跨域问题的方案主要有两种：</p><p>① <code>CORS</code>（主流的解决方案，推荐使用）</p><p>② <code>JSONP</code>（有缺陷的解决方案：只支持 GET 请求）</p><h3 id="cors-中间件解决跨域">cors 中间件解决跨域</h3><ul><li>安装中间件：<code>npm install cors</code></li><li>导入中间件：<code>const cors = require('cors')</code></li><li>配置中间件：<code>app.use(cors())</code></li></ul><h3 id="CORS">CORS</h3><ul><li><p>CORS（Cross-Origin Resource Sharing，跨域资源共享）由一系列 HTTP 响应头组成，<strong>这些</strong> <strong>HTTP</strong> <strong>响应头决定浏览器是否阻止前端</strong> <strong>JS</strong> <strong>代码跨域获取资源</strong>。</p></li><li><p>浏览器的<strong>同源安全策略</strong>默认会阻止网页“跨域”获取资源。但如果接口服务器配置了 <strong>CORS 相关的 HTTP 响应头</strong>，就可<strong>解除浏览器端的跨域访问限制</strong>。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906154410181.png" alt="image-20220906154410181"><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906154426471.png" alt="image-20220906154426471"></p><p><strong>注意事项：</strong></p></li><li><p>CORS 主要在<strong>服务器端</strong>进行配置。客户端浏览器<strong>无须做任何额外的配置</strong>，即可请求开启了 CORS 的接口。</p></li><li><p>CORS 在浏览器中<strong>有兼容性</strong>。只有支持 XMLHttpRequest Level2 的浏览器，才能正常访问开启了 CORS 的服务端接口（例如：IE10+、Chrome4+、FireFox3.5+）。</p></li></ul><h3 id="CORS-常见响应头">CORS 常见响应头</h3><ol><li><p><code>Access-Control-Allow-Origin</code>：制定了允许访问资源的外域 URL。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只允许来自 http://itcast.cn 的请求</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://bruceblog.io&#x27;</span>) </span><br><span class="line"><span class="comment">// 允许来自任何域的请求</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>Access-Control-Allow-Headers</code></p></li></ol><ul><li><p>默认情况下，CORS 仅支持客户端向服务器发送如下的 9 个请求头：<code>Accept、Accept-Language、Content-Language、DPR、Downlink、Save-Data、Viewport-Width、Width 、Content-Type （值仅限于 text/plain、multipart/form-data、application/x-www-form-urlencoded 三者之一）</code></p></li><li><p>如果客户端向服务器发送了额外的请求头信息，则需要在服务器端，通过 <code>Access-Control-Allow-Headers</code> 对额外的请求头进行声明，否则这次请求会失败！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;Content-Type, X-Custom-Header&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><ol start="3"><li><code>Access-Control-Allow-Methods</code></li></ol><ul><li><p>默认情况下，<code>CORS</code> 仅支持客户端发起 <code>GET、POST、HEAD</code> 请求。如果客户端希望通过 <code>PUT、DELETE</code> 等方式请求服务器的资源，则需要在服务器端，通过 <code>Access-Control-Alow-Methods</code> 来<strong>指明实际请求所允许使用的 HTTP 方法</strong>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;POST, GET, DELETE, HEAD&#x27;</span>)</span><br><span class="line">res.<span class="title function_">setHEader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="CORS-请求分类">CORS 请求分类</h3><h4 id="简单请求">简单请求</h4><ul><li><strong>请求方式</strong>：GET、POST、HEAD 三者之一</li><li><strong>HTTP 头部信息</strong>不超过以下几种字段：<strong>无自定义头部字段</strong>、Accept、Accept-Language、Content-Language、DPR、Downlink、Save-Data、Viewport-Width、Width 、Content-Type（只有三个值 application/x-www-formurlencoded、multipart/form-data、text/plain）</li></ul><h4 id="预检请求">预检请求</h4><ul><li>请求方式为 <strong>GET、POST、HEAD 之外的请求 Method 类型</strong></li><li>请求头中<strong>包含自定义头部字段</strong></li><li>向服务器发送了 <strong>application/json 格式的数据</strong></li></ul><p>在浏览器与服务器正式通信之前，浏览器会<strong>先发送 OPTION 请求进行预检，以获知服务器是否允许该实际请求</strong>，所以这一次的 OPTION 请求称为“预检请求”。<strong>服务器成功响应预检请求后，才会发送真正的请求，并且携带真实数据</strong>。</p><h4 id="简单请求和预检请求的区别">简单请求和预检请求的区别</h4><p><strong>简单请求的特点</strong>：客户端与服务器之间只会发生一次请求。</p><p><strong>预检请求的特点</strong>：客户端与服务器之间会发生两次请求，OPTION 预检请求成功之后，才会发起真正的请求。</p><h3 id="JSONP接口">JSONP接口</h3><p><strong>概念</strong>：浏览器端通过 <code>&lt;script&gt;</code> 标签的 <code>src</code> 属性，请求服务器上的数据，同时，服务器返回一个函数的调用。这种请求数据的方式叫做 <strong>JSONP</strong>。</p><p><strong>特点</strong>：</p><p>① <code>JSONP</code> 不属于真正的 Ajax 请求，因为它没有使用 <code>XMLHttpRequest</code> 这个对象。</p><p>② <code>JSONP</code> 仅支持 GET 请求，不支持 POST、PUT、DELETE 等请求。</p><h4 id="创建JSONP接口的注意事项">创建JSONP接口的注意事项</h4><p>如果项目中<code>已经配置了 CORS</code> 跨域资源共享，为了<strong>防止冲突</strong>，<code>必须在配置 CORS 中间件之前声明 JSONP 的接口</code>。否则 JSONP 接口会被处理成开启了 CORS 的接口。示例代码如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906160915000.png" alt="image-20220906160915000"></p><h4 id="实现JSONP接口">实现JSONP接口</h4><p><strong>步骤</strong>：</p><p>① <strong>获取</strong>客户端发送过来的<strong>回调函数的名字</strong></p><p>② <strong>得到</strong>要通过 JSONP 形式<strong>发送给客户端的数据</strong></p><p>③ 根据前两步得到的数据，<strong>拼接出一个函数调用的字符串</strong></p><p>④ 把上一步拼接得到的字符串，响应给客户端的 <code>&lt;script&gt;</code> 标签进行解析执行</p><p><strong>具体代码</strong>：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906162211835.png" alt="image-20220906162211835"></p><h5 id="在网页中使用jQuary发起JSONP请求"><strong>在网页中使用jQuary发起JSONP请求</strong></h5><p>调用 <code>$.ajax()</code> 函数，提供 <code>JSONP 的配置选项</code>，从而发起 <code>JSONP 请求</code>，示例代码如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220906162322481.png" alt="image-20220906162322481"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Express&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.expressjs.com.cn/&quot;&gt;官网传送门&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;基于 Node.js 平台，快速、开放、极简的 Web 开发框架&lt;/p&gt;
&lt;/blockquote&gt;</summary>
      
    
    
    
    <category term="后端🍟" scheme="https://blog.cilicili.xyz/categories/%E5%90%8E%E7%AB%AF%F0%9F%8D%9F/"/>
    
    
    <category term="Node" scheme="https://blog.cilicili.xyz/tags/Node/"/>
    
    <category term="Express" scheme="https://blog.cilicili.xyz/tags/Express/"/>
    
  </entry>
  
  <entry>
    <title>【后端】Node.js快速入门</title>
    <link href="https://blog.cilicili.xyz/posts/f9892742.html"/>
    <id>https://blog.cilicili.xyz/posts/f9892742.html</id>
    <published>2022-09-05T02:09:44.000Z</published>
    <updated>2022-09-09T09:35:03.733Z</updated>
    
    <content type="html"><![CDATA[<h1>Nodejs 基础</h1><p><a href="https://nodejs.org/en/">官网传送门</a></p><h2 id="初识-Nodejs">初识 Nodejs</h2><blockquote><p>Node.js 是一个基于 Chrome V8 引擎 的 JavaScript 运行时环境</p></blockquote><ul><li>基于 <a href="http://www.expressjs.com.cn/">Express 框架 </a>，可以快速构建 Web 应用</li><li>基于 <a href="https://electronjs.org/">Electron 框架</a>，可以构建跨平台的桌面应用</li><li>基于 <a href="http://restify.com/">restify 框架</a>，可以快速构建 API 接口项目</li><li>读写和操作数据库、创建实用的命令行工具辅助前端开发、etc…</li></ul><h2 id="Buffer-缓冲区">Buffer 缓冲区</h2><blockquote><p><a href="http://nodejs.cn/api/buffer.html">Buffer 缓冲区文档</a></p></blockquote><ul><li>Buffer 的结构与数组类似，操作方法也与数组类似</li><li>数组不能存储二进制文件，Buffer 是专门存储二进制数据的</li><li>Buffer 存储的是二进制数据，显示时以 16 进制的形式显示</li><li>Buffer 每一个元素范围是 00~ff，即 0<sub>255、00000000</sub>11111111</li><li>每一个元素占用一个字节内存</li><li>Buffer 是对底层内存的直接操作，因此大小一旦确定就不能修改</li></ul><p>Buffer 常用方法：</p><ul><li><code>Buffer.from(str[, encoding])</code>：将一个字符串转换为 Buffer</li><li><code>Buffer.alloc(size)</code>：创建指定大小的 Buffer</li><li><code>Buffer.alloUnsafe(size)</code>：创建指定大小的 Buffer，可能包含敏感数据（分配内存时不会清除内存残留的数据）</li><li><code>buf.toString()</code>：将 Buffer 数据转为字符串</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;Hello前端&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(str)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 占用内存的大小，一个汉字3字节 13</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="property">length</span>)</span><br><span class="line"><span class="comment">// 字符串的长度 7</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="property">length</span>)</span><br><span class="line"><span class="comment">// 8进制输出第一个元素 145</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf[<span class="number">1</span>].<span class="title function_">toString</span>(<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个10个字节的buffer</span></span><br><span class="line"><span class="keyword">var</span> buf2 = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>)</span><br><span class="line"><span class="comment">//通过索引，来操作buf中的元素</span></span><br><span class="line">buf2[<span class="number">0</span>] = <span class="number">88</span></span><br><span class="line">buf2[<span class="number">1</span>] = <span class="number">255</span></span><br><span class="line">buf2[<span class="number">2</span>] = <span class="number">0xaa</span></span><br><span class="line">buf2[<span class="number">3</span>] = <span class="number">255</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buf3 = <span class="title class_">Buffer</span>.<span class="title function_">allocUnsafe</span>(<span class="number">10</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf3)</span><br></pre></td></tr></table></figure><h2 id="fs-文件系统模块">fs 文件系统模块</h2><ul><li>fs 模块中所有的操作都有两种形式可供选择:同步和异步</li><li>同步文件系统会阻塞程序的执行，也就是除非操作完毕，否则不会向下执行代码</li><li>异步文件系统不会阻塞程序的执行，而是在操作完成时，通过回调函数将结果返回</li><li>实际开发很少用同步方式，因此只介绍异步方式</li></ul><p>打开模式：</p><table><thead><tr><th>模式</th><th>说明</th></tr></thead><tbody><tr><td>r</td><td>读取文件，文件不存在抛异常</td></tr><tr><td>r+</td><td>读写文件，文件不存在抛异常</td></tr><tr><td>rs</td><td>同步模式下打开文件用于读取</td></tr><tr><td>rs+</td><td>同步模式下打开文件用于读写</td></tr><tr><td>w</td><td>写文件，不存在则创建，存在则覆盖原有内容</td></tr><tr><td>wx</td><td>写文件，文件存在打开失败</td></tr><tr><td>w+</td><td>读写文件，不存在创建，存在截断</td></tr><tr><td>wx+</td><td>读写，存在打开失败</td></tr><tr><td>a</td><td>追加，不存在创建</td></tr><tr><td>ax</td><td>追加，存在失败</td></tr><tr><td>a+</td><td>追加和读取，不存在创建</td></tr><tr><td>ax+</td><td>追加和读取，存在失败</td></tr></tbody></table><h3 id="读取文件">读取文件</h3><h4 id="简单文件读取">简单文件读取</h4><p>语法格式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(path[, options], callback)</span><br></pre></td></tr></table></figure><ul><li><p><code>path</code>：文件路径</p></li><li><p><code>options</code>：配置选项，若是字符串则指定编码格式</p><ul><li><code>encoding</code>：编码格式</li><li><code>flag</code>：打开方式</li></ul></li><li><p><code>callback</code>：回调函数</p><ul><li><code>err</code>：错误信息</li><li><code>data</code>：读取的数据，如果未指定编码格式则返回一个 Buffer</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./files/1.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span>(err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;failed!&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;content:&#x27;</span> + data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制文件内容</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;C:/Users/笔记.mp3&quot;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(!err) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line"><span class="comment">// 将data写入到文件中</span></span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&quot;C:/Users/hello.jpg&quot;</span>, data, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!err)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件写入成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; );</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="流式文件读取">流式文件读取</h4><ul><li>简单文件读取的方式会一次性读取文件内容到内存中，若文件较大，会占用过多内存影响系统性能，且读取速度慢</li><li>大文件适合用流式文件读取，它会分多次将文件读取到内存中</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可读流</span></span><br><span class="line"><span class="keyword">var</span> rs = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;C:/Users/笔记.mp3&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建一个可写流</span></span><br><span class="line"><span class="keyword">var</span> ws = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;a.mp3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听流的开启和关闭</span></span><br><span class="line"><span class="comment">// 这几个监听不是必须的</span></span><br><span class="line">rs.<span class="title function_">once</span>(<span class="string">&#x27;open&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可读流打开了~~&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">rs.<span class="title function_">once</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可读流关闭了~~&#x27;</span>)</span><br><span class="line">  <span class="comment">//数据读取完毕，关闭可写流</span></span><br><span class="line">  ws.<span class="title function_">end</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ws.<span class="title function_">once</span>(<span class="string">&#x27;open&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可写流打开了~~&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ws.<span class="title function_">once</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可写流关闭了~~&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//要读取一个可读流中的数据，要为可读流绑定一个data事件，data事件绑定完毕自动开始读取数据</span></span><br><span class="line">rs.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">  <span class="comment">//将读取到的数据写入到可写流中</span></span><br><span class="line">  ws.<span class="title function_">write</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>简便方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rs = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;C:/Users/lilichao/Desktop/笔记.mp3&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> ws = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;b.mp3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// pipe()可以将可读流中的内容，直接输出到可写流中</span></span><br><span class="line">rs.<span class="title function_">pipe</span>(ws)</span><br></pre></td></tr></table></figure><h3 id="写入文件">写入文件</h3><blockquote><p><strong>两个注意点：</strong></p><p>① fs.writeFile()方法只能用来创建文件，不能用来创建路径。</p><p>② 重复调用fs.writeFile()写入同一个文件，新写入的内容会覆盖之前的旧内容。</p></blockquote><h4 id="简单文件写入">简单文件写入</h4><p>语法格式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">writeFile</span>(file, data[, options], callback)</span><br></pre></td></tr></table></figure><ul><li><code>file</code>：文件路径</li><li><code>data</code>：写入内容</li><li><code>options</code>：配置选项，包含 <code>encoding, mode, flag</code>；若是字符串则指定编码格式</li><li><code>callback</code>：回调函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;./files/2.txt&#x27;</span>, <span class="string">&#x27;Hello Nodejs&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;failed!&#x27;</span> + err.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;success!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;C:/Users/hello.txt&#x27;</span>, <span class="string">&#x27;通过 writeFile 写入的内容&#x27;</span>, &#123; <span class="attr">flag</span>: <span class="string">&#x27;w&#x27;</span> &#125;, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;写入成功！&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="流式文件写入">流式文件写入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步、异步、简单文件的写入都不适合大文件的写入，性能较差，容易导致内存溢出</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可写流</span></span><br><span class="line"><span class="keyword">var</span> ws = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;hello3.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ws.<span class="title function_">once</span>(<span class="string">&#x27;open&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;流打开了~~&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ws.<span class="title function_">once</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;流关闭了~~&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过ws向文件中输出内容</span></span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;通过可写流写入文件的内容&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭流</span></span><br><span class="line">ws.<span class="title function_">end</span>()</span><br></pre></td></tr></table></figure><h3 id="路径动态拼接问题-dirname">路径动态拼接问题 <code>__dirname</code></h3><ul><li>在使用 fs 模块操作文件时，如果提供的操作路径是以 <code>./</code> 或 <code>../</code> 开头的相对路径时，容易出现路径动态拼接错误的问题</li><li>原因：代码在运行的时候，会以执行 node 命令时所处的目录，动态拼接出被操作文件的完整路径</li><li>解决方案：在使用 fs 模块操作文件时，直接提供完整的路径，从而防止路径动态拼接的问题</li><li><code>__dirname</code> 获取文件所处的绝对路径</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(__dirname + <span class="string">&#x27;/files/1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="其它操作">其它操作</h3><p>验证路径是否存在：</p><ul><li><code>fs.exists(path, callback)</code></li><li><code>fs.existsSync(path)</code></li></ul><p>获取文件信息：</p><ul><li><code>fs.stat(path, callback)</code></li><li><code>fs.stat(path)</code></li></ul><p>删除文件：</p><ul><li><code>fs.unlink(path, callback)</code></li><li><code>fs.unlinkSync(path)</code></li></ul><p>列出文件：</p><ul><li><code>fs.readdir(path[,options], callback)</code></li><li><code>fs.readdirSync(path[, options])</code></li></ul><p>截断文件：</p><ul><li><code>fs.truncate(path, len, callback)</code></li><li><code>fs.truncateSync(path, len)</code></li></ul><p>建立目录：</p><ul><li><code>fs.mkdir(path[, mode], callback)</code></li><li><code>fs.mkdirSync(path[, mode])</code></li></ul><p>删除目录：</p><ul><li><code>fs.rmdir(path, callback)</code></li><li><code>fs.rmdirSync(path)</code></li></ul><p>重命名文件和目录：</p><ul><li><code>fs.rename(oldPath, newPath, callback)</code></li><li><code>fs.renameSync(oldPath, newPath)</code></li></ul><p>监视文件更改：</p><ul><li><code>fs.watchFile(filename[, options], listener)</code></li></ul><h2 id="path-路径模块">path 路径模块</h2><p>path 模块是 Node.js 官方提供的、用来处理路径的模块。它提供了一系列的方法和属性，用来满足用户对路径的处理需求。</p><h3 id="路径拼接-path-join">路径拼接 <code>path.join()</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意 ../ 会抵消前面的路径</span></span><br><span class="line"><span class="comment">// ./ 会被忽略</span></span><br><span class="line"><span class="keyword">const</span> pathStr = path.<span class="title function_">join</span>(<span class="string">&#x27;/a&#x27;</span>, <span class="string">&#x27;/b/c&#x27;</span>, <span class="string">&#x27;../../&#x27;</span>, <span class="string">&#x27;./d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pathStr) <span class="comment">// \a\d\e</span></span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./files/1.txt&#x27;</span>), <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, dataStr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(dataStr)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="获取路径中文件名-path-basename">获取路径中文件名 <code>path.basename()</code></h3><p>使用 <code>path.basename()</code> 方法，可以获取路径中的最后一部分，常通过该方法获取路径中的文件名</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">basename</span>(path[, ext])</span><br></pre></td></tr></table></figure><ul><li>path: 文件路径</li><li>ext: 文件扩展名</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义文件的存放路径</span></span><br><span class="line"><span class="keyword">const</span> fpath = <span class="string">&#x27;/a/b/c/index.html&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fullName = path.<span class="title function_">basename</span>(fpath)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fullName) <span class="comment">// index.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nameWithoutExt = path.<span class="title function_">basename</span>(fpath, <span class="string">&#x27;.html&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(nameWithoutExt) <span class="comment">// index</span></span><br></pre></td></tr></table></figure><h3 id="获取路径中文件扩展名-path-extname">获取路径中文件扩展名 <code>path.extname()</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fpath = <span class="string">&#x27;/a/b/c/index.html&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fext = path.<span class="title function_">extname</span>(fpath)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fext) <span class="comment">// .html</span></span><br></pre></td></tr></table></figure><h2 id="http-模块">http 模块</h2><p><strong>http 模块</strong>是 Node.js 官方提供的、用来<strong>创建 web 服务器</strong>的模块。通过http模块提供的<code>http.createServer()</code>方法，就能方便的把一台普通的电脑，变成一台Web服务器，从而对外提供Web资源服务。</p><blockquote><p>在网络节点中，负责消费资源的电脑，叫做<strong>客户端;</strong></p><p>负责对外提供网络资源的电脑，叫做<strong>服务器</strong>。</p></blockquote><p><strong>req请求对象</strong>：只要服务器接收到了客户端的请求，就会调用通过server.on()为服务器绑定的request事件处理函数。如果想在事件处理函数中，访问与客户端相关的数据或属性，可以使用如下的方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// req是请求对象，它包含了与客户端相关的数据和属性，例如：</span></span><br><span class="line"><span class="comment">// req.url 是客户端请求的URL地址</span></span><br><span class="line"><span class="comment">// req.method 是客户端的method请求类型</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;Your request url is $&#123;req.url&#125;, and request method is $&#123;req.method&#125;&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>res请求对象</strong>：在服务器的request事件处理函数中，如果想访问与服务器相关的数据或属性，可以使用如下的方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// res是响应对象，它包含了与服务器相关的数据和属性，例如</span></span><br><span class="line">    <span class="comment">// 要发送到客户端的字符串</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;Your request url is $&#123;req.url&#125;, and request method is $&#123;req.method&#125;&#x27;</span></span><br><span class="line">    <span class="comment">// res.end() 方法的作用：向客户端发送指定的内容，并结束这次请求的处理过程</span></span><br><span class="line">res.<span class="title function_">end</span>(str)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>解决中文乱码问题</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 发送的内容包含中文</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;Your request url is $&#123;req.url&#125;, and request method is $&#123;req.method&#125;&#x27;</span></span><br><span class="line"><span class="comment">// 为了防止中文显示乱码的问题，需要设置响应头 Content-Type 的值为 text/html; charset=utf-8</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment">// 把包含中文的内容，响应给客户端</span></span><br><span class="line">res.<span class="title function_">end</span>(str)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>根据不同的url响应不同的html内容</strong></p><p>核心实现步骤：</p><p>① 获取<code>请求的 url 地址</code></p><p>② 设置<code>默认的响应内容</code>为 404 Not found</p><p>③ 判断用户请求的是否为 <code>/</code> 或 <code>/index.html</code> 首页</p><p>④ 判断用户请求的是否为 <code>/about.html</code> 关于页面</p><p>⑤ 设置 <code>Content-Type 响应头</code>，防止中文乱码</p><p>⑥ 使用 <code>res.end()</code> 把内容响应给客户端</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905161706551.png" alt="image-20220905161706551"></p><p><strong>核心思路</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905165145827.png" alt="image-20220905165145827"></p><p><strong>优化资源的请求路径</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905170350670.png" alt="image-20220905170350670"></p><h3 id="创建基本-Web-服务器">创建基本 Web 服务器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 web 服务器实例</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为服务器实例绑定 request 事件，监听客户端的请求</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> url = req.<span class="property">url</span></span><br><span class="line">  <span class="keyword">const</span> method = req.<span class="property">method</span></span><br><span class="line">  <span class="keyword">const</span> str = <span class="string">`Your request url is <span class="subst">$&#123;url&#125;</span>, and request method is <span class="subst">$&#123;method&#125;</span>`</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置 Content-Type 响应头，解决中文乱码的问题</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>)</span><br><span class="line">  <span class="comment">// 向客户端响应内容</span></span><br><span class="line">  res.<span class="title function_">end</span>(str)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;server running at http://127.0.0.1:8080&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="实现简陋路由效果">实现简陋路由效果</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = req.<span class="property">url</span></span><br><span class="line">  <span class="comment">// 设置默认的响应内容为 404 Not found</span></span><br><span class="line">  <span class="keyword">let</span> content = <span class="string">&#x27;&lt;h1&gt;404 Not found!&lt;/h1&gt;&#x27;</span></span><br><span class="line">  <span class="comment">// 判断用户请求的是否为 / 或 /index.html 首页</span></span><br><span class="line">  <span class="comment">// 判断用户请求的是否为 /about.html 关于页面</span></span><br><span class="line">  <span class="keyword">if</span> (url === <span class="string">&#x27;/&#x27;</span> || url === <span class="string">&#x27;/index.html&#x27;</span>) &#123;</span><br><span class="line">    content = <span class="string">&#x27;&lt;h1&gt;首页&lt;/h1&gt;&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">&#x27;/about.html&#x27;</span>) &#123;</span><br><span class="line">    content = <span class="string">&#x27;&lt;h1&gt;关于页面&lt;/h1&gt;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>)</span><br><span class="line">  res.<span class="title function_">end</span>(content)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;server running at http://127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="模块化">模块化</h2><h3 id="模块化概念">模块化概念</h3><ul><li>模块化是指解决一个复杂问题时，自顶向下逐层把系统划分为若干模块的过程，模块是可组合、分解和更换的单元。</li><li>模块化可提高代码的复用性和可维护性，实现按需加载。</li><li>模块化规范是对代码进行模块化拆分和组合时需要遵守的规则，如使用何种语法格式引用模块和向外暴露成员。</li></ul><p>**代码模块化拆分的好处：**提高代码的复用性、可维护性，可以实现按需加载</p><h3 id="Node-js-中模块的分类">Node.js 中模块的分类</h3><ul><li>内置模块（内置模块是由 Node.js 官方提供的，例如 fs、path、http 等）</li><li>自定义模块（用户创建的每个 .js 文件，都是自定义模块）</li><li>第三方模块（由第三方开发出来的模块，并非官方提供的内置模块，也不是用户创建的自定义模块，使用前需要先下载）</li></ul><h3 id="Node-js-中的模块作用域">Node.js 中的模块作用域</h3><ul><li>和函数作用域类似，在自定义模块中定义的变量、方法等成员，只能在当前模块内被访问，这种模块级别的访问限制，叫做模块作用域</li><li><strong>好处</strong>：防止全局变量污染</li></ul><h3 id="模块作用域的成员">模块作用域的成员</h3><ul><li>自定义模块中都有一个 <code>module</code> 对象，存储了和当前模块有关的信息</li><li>在自定义模块中，可以使用 <code>module.exports</code> 对象，将模块内的成员共享出去，供外界使用。导入自定义模块时，得到的就是 <code>module.exports</code> 指向的对象。</li><li>默认情况下，<code>exports</code> 和 <code>module.exports</code> 指向同一个对象。最终共享的结果，以 <code>module.exports</code> 指向的对象为准。</li></ul><blockquote><p>**注意点：**使用 require() 方法导入模块时，导入的结果，<strong>永远以</strong> <strong>module.exports</strong> <strong>指向的对象为准</strong>。</p></blockquote><h3 id="CommonJS-模块化规范">CommonJS 模块化规范</h3><ul><li>每个模块内部，<code>module</code> 变量代表当前模块</li><li><code>module</code> 变量是一个对象，<code>module.exports</code> 是对外的接口</li><li>加载某个模块即加载该模块的 <code>module.exports</code> 属性</li></ul><h3 id="模块加载机制">模块加载机制</h3><p>模块第一次加载后会被缓存，即多次调用 <code>require()</code> 不会导致模块的代码被执行多次，提高模块加载效率。</p><h4 id="内置模块加载">内置模块加载</h4><p>内置模块加载优先级最高。</p><h4 id="自定义模块加载">自定义模块加载</h4><p>加载自定义模块时，路径要以 <code>./</code> 或 <code>../</code> 开头，否则会作为内置模块或第三方模块加载。</p><p>导入自定义模块时，若省略文件扩展名，则 Node.js 会按顺序尝试加载文件：</p><ul><li>按确切的文件名加载</li><li>补全 <code>.js</code> 扩展名加载</li><li>补全 <code>.json</code> 扩展名加载</li><li>补全 <code>.node</code> 扩展名加载</li><li>报错</li></ul><h4 id="第三方模块加载">第三方模块加载</h4><ul><li>若导入第三方模块， Node.js 会从<strong>当前模块的父目录</strong>开始，尝试从 <code>/node_modules</code> 文件夹中加载第三方模块。</li><li>如果没有找到对应的第三方模块，则移动到再<strong>上一层父目录</strong>中，进行加载，直到<strong>文件系统的根目录</strong>。</li></ul><p>例如，假设在 <code>C:\Users\bruce\project\foo.js</code> 文件里调用了 <code>require('tools')</code>，则 Node.js 会按以下顺序查找：</p><ul><li><code>C:\Users\bruce\project\node_modules\tools</code></li><li><code>C:\Users\bruce\node_modules\tools</code></li><li><code>C:\Users\node_modules\tools</code></li><li><code>C:\node_modules\tools</code></li></ul><h4 id="目录作为模块加载">目录作为模块加载</h4><p>当把目录作为模块标识符进行加载的时候，有三种加载方式：</p><ul><li>在被加载的目录下查找 <code>package.json</code> 的文件，并寻找 <code>main</code> 属性，作为 <code>require()</code> 加载的入口</li><li>如果没有 <code>package.json</code> 文件，或者 <code>main</code> 入口不存在或无法解析，则 Node.js 将会试图加载目录下的 <code>index.js</code> 文件。</li><li>若失败则报错</li></ul><h3 id="npm初体验">npm初体验</h3><p>Node.js 中的第三方模块又叫做包。</p><blockquote><p>从 <a href="https://www.npmjs.com/">https://www.npmjs.com/</a> 网站上搜索自己所需要的包</p><p>从 <a href="https://registry.npmjs.org/">https://registry.npmjs.org/</a> 服务器上下载自己需要的包</p></blockquote><h4 id="格式化时间的传统做法">格式化时间的传统做法</h4><p><strong>步骤：</strong></p><p>① 创建格式化时间的自定义模块</p><p>② 定义格式化时间的方法</p><p>③ 创建补零函数</p><p>④ 从自定义模块中导出格式化时间的函数</p><p>⑤ 导入格式化时间的自定义模块</p><p>⑥ 调用格式化时间的函数</p><p><strong>方法函数：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dateFormat</span>(<span class="params">dtStr</span>)&#123;</span><br><span class="line"><span class="keyword">const</span> dt = <span class="keyword">new</span> <span class="title class_">Date</span>(dtStr)</span><br><span class="line"><span class="keyword">const</span> y = <span class="title function_">padZero</span>(dt.<span class="title function_">getFullYear</span>())</span><br><span class="line"><span class="keyword">const</span> m = <span class="title function_">padZero</span>(dt.<span class="title function_">getMonth</span>() + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> d = <span class="title function_">padZero</span>(dt.<span class="title function_">getDate</span>())</span><br><span class="line"><span class="keyword">const</span> hh = <span class="title function_">padZero</span>(dt.<span class="title function_">getHours</span>())</span><br><span class="line"><span class="keyword">const</span> mm = <span class="title function_">padZero</span>(dt.<span class="title function_">getMinutes</span>())</span><br><span class="line"><span class="keyword">const</span> ss = <span class="title function_">padZero</span>(dt.<span class="title function_">getSeconds</span>())</span><br><span class="line"><span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;y&#125;</span>-<span class="subst">$&#123;m&#125;</span>-<span class="subst">$&#123;d&#125;</span> <span class="subst">$&#123;hh&#125;</span>:<span class="subst">$&#123;mm&#125;</span>:<span class="subst">$&#123;ss&#125;</span>`</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">padZero</span>(<span class="params">n</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> n&gt;<span class="number">9</span> ? n : <span class="string">&#x27;0&#x27;</span> + n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>调用过程：</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905202551268.png" alt="image-20220905202551268"></p><h4 id="格式化时间的高级做法">格式化时间的高级做法</h4><p><strong>步骤：</strong></p><p>①使用 npm 包管理工具，在项目中安装格式化时间的包 moment</p><p>②使用 require() 导入格式化时间的包</p><p>③参考 moment 的官方 API 文档对时间进行格式化</p><p><strong>使用过程：</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905203517226.png" alt="image-20220905203517226"></p><h4 id="初次装包后多了哪些文件">初次装包后多了哪些文件</h4><p>初次装包完成后，在项目文件夹下多一个叫做 <code>node_modules</code> 的文件夹和 <code>package-lock.json</code> 的配置文件。</p><blockquote><p><code>node_modules</code> 文件夹用来存放所有已安装到项目中的包。require() 导入第三方包时，就是从这个目录中查找并加载包。</p><p><code>package-lock.json</code> 配置文件用来记录 node_modules 目录下的每一个包的下载信息，例如包的名字、版本号、下载地址等。</p></blockquote><h4 id="包的语义化版本规范"><strong>包的</strong>语义化版本规范</h4><p>包的版本号是以“点分十进制”形式进行定义的，总共有三位数字，例如 <strong>2.24.0</strong></p><p>其中每一位数字所代表的的含义如下：</p><p>第1位数字：大版本</p><p>第2位数字：功能版本</p><p>第3位数字：Bug修复版本</p><h4 id="包管理配置文件">包管理配置文件</h4><p>npm 规定，在项目根目录中，<strong>必须</strong>提供一个叫做 <code>package.json</code> 的包管理配置文件。用来记录与项目有关的一些配置信息。例如：</p><ul><li><p>项目的名称、版本号、描述等</p></li><li><p>项目中都用到了哪些包</p></li><li><p>哪些包只在开发期间会用到</p></li><li><p>那些包在开发和部署时都需要用到</p></li></ul><h5 id="多人协作问题">多人协作问题</h5><p>**问题1：**第三方包的体积过大，不方便团队成员之间共享项目源代码。</p><p>**解决方案：**共享时剔除<code>node_modules</code></p><h5 id="如何记录项目中安装了哪些包">如何记录项目中安装了哪些包</h5><p>在项目根目录中，创建一个叫做 <code>package.json</code> 的配置文件，即可用来记录项目中安装了哪些包。从而方便剔除 <code>node_modules</code> 目录之后，在团队成员之间共享项目的源代码。</p><blockquote><p><strong>注意</strong>：今后在项目开发中，一定要把 <code>node_modules</code> 文件夹，添加到 <code>.gitignore</code> 忽略文件中。</p></blockquote><h5 id="快速创建package-json">快速创建package.json</h5><p>npm 包管理工具提供了一个快捷命令，可以在执行命令时所处的目录中，快速创建 <code>package.json</code> 这个包管理配置文件：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905204251436.png" alt="image-20220905204251436"></p><blockquote><p><strong>注意：</strong></p><p>①上述命令只能在英文的目录下成功运行！所以，项目文件夹的名称<strong>一定要使用英文命名</strong>，<strong>不要使用中文</strong>，不能出现空格。</p><p>②运行 <code>npm install</code> 命令安装包的时候，npm 包管理工具会自动把包的名称和版本号，记录到 <code>package.json</code> 中。</p></blockquote><h5 id="dependencies节点"><strong>dependencies节点</strong></h5><p><code>package.json</code> 文件中，有一个 <code>dependencies</code> 节点，专门用来记录您使用 <code>npm install</code> 命令安装了哪些包。</p><h5 id="一次性安装所有的包">一次性安装所有的包</h5><p>当我们拿到一个剔除了 <code>node_modules</code> 的项目之后，需要先把所有的包下载到项目中，才能将项目运行起来。</p><p>否则会报类似于下面的错误：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905204506172.png" alt="image-20220905204506172"></p><p>可以运行 <code>npm install</code> 命令（或 <code>npm i</code>）一次性安装所有的依赖包：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905204528159.png" alt="image-20220905204528159"></p><h5 id="卸载包">卸载包</h5><p>可以运行 <code>npm uninstall</code> 命令，来卸载指定的包。</p><blockquote><p><strong>注意：</strong><code>npm uninstall</code> 命令执行成功后，会把卸载的包，自动从 <code>package.json</code> 的 <code>dependencies</code> 中移除掉。</p></blockquote><h5 id="devDependencies-节点"><strong>devDependencies</strong> 节点</h5><p>如果某些包<strong>只在项目开发阶段</strong>会用到，在<strong>项目上线之后不会用到</strong>，则建议把这些包记录到 <code>devDependencies</code> 节点中。</p><p>与之对应的，如果某些包在开发和项目上线之后都需要用到，则建议把这些包记录到 <code>dependencies</code> 节点中。</p><p>您可以使用如下的命令，将包记录到 <code>devDependencies</code> 节点中：</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905204737437.png" alt="image-20220905204737437"></p><h5 id="解决下包速度慢的问题">解决下包速度慢的问题</h5><ul><li><strong>使用淘宝NPM镜像服务器</strong></li></ul><p>淘宝在国内搭建了一个服务器，专门把国外官方服务器上的包同步到国内的服务器，然后在国内提供下包的服务。从而极大的提高了下包的速度。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905204855070.png" alt="image-20220905204855070"></p><p><strong>镜像</strong>（Mirroring）是一种文件存储形式，一个磁盘上的数据在另一个磁盘上存在一个完全相同的副本即为镜像。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905204929588.png" alt="image-20220905204929588"></p><ul><li><strong>切换 npm 的下包镜像源</strong></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905205012326.png" alt="image-20220905205012326"></p><ul><li><strong>nrm</strong></li></ul><p>利用 <code>nrm</code> 提供的终端命令，可以快速查看和切换下包的镜像源。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905205032699.png" alt="image-20220905205032699"></p><h4 id="包的分类">包的分类</h4><p>使用 npm 包管理工具下载的包，共分为两大类，分别是：<strong>项目包、全局包</strong></p><h5 id="项目包"><strong>项目包</strong></h5><p>那些被安装到项目的 <code>node_modules</code> 目录中的包，都是<strong>项目包</strong>。</p><p>项目包又分为<strong>两类</strong>，分别是：</p><ul><li><p><strong>开发依赖包</strong>（被记录到 <code>devDependencies</code> 节点中的包，只在开发期间会用到）</p></li><li><p><strong>核心依赖包</strong>（被记录到 <code>dependencies</code> 节点中的包，在开发期间和项目上线之后都会用到）</p></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905205321893.png" alt="image-20220905205321893"></p><h5 id="全局包">全局包</h5><p>在执行 <code>npm install</code> 命令时，如果提供了 <code>-g</code> 参数，则会把包安装为全局包。</p><p>全局包会被安装到 <code>C:\Users\用户目录\AppData\Roaming\npm\node_modules</code> 目录下。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905205513613.png" alt="image-20220905205513613"></p><blockquote><p><strong>注意：</strong></p><p>①只有<strong>工具性质</strong>的包，才有全局安装的必要性，因为它们提供了好用的终端命令。</p><p>②判断某个包是否需要全局安装后才能使用，可以参考官方提供的使用说明即可。</p></blockquote><h4 id="规范的包结构">规范的包结构</h4><p>一个规范的包，它的组成结构，必须符合以下 3 点要求：</p><p>① 包必须以<strong>单独的目录</strong>而存在</p><p>② 包的顶级目录下要必须包含 <code>package.json</code> 这个包管理配置文件</p><p>③ <code>package.json</code> 中必须包含 <code>name，version，main</code> 这三个属性，分别代表包的<strong>名字</strong>、<strong>版本号</strong>、<strong>包的入口</strong>。</p><h6 id="开发属于自己的包（小案例）："><strong>开发属于自己的包（小案例）</strong>：</h6><p>需要实现的功能：</p><p>① 格式化日期</p><p>② 转义 HTML 中的特殊字符</p><p>③ 还原 HTML 中的特殊字符</p><p><strong>步骤</strong>：</p><ol><li>初始化包的基本结构</li></ol><p>① 新建 itheima-tools（自定义） 文件夹，作为包的根目录</p><p>② 在 itheima-tools 文件夹中，新建如下三个文件：</p><ul><li><p>package.json （包管理配置文件）</p></li><li><p>index.js     （包的入口文件）</p></li><li><p><a href="http://lREADME.md">lREADME.md</a> （包的说明文档）</p></li></ul><ol start="2"><li>初始化package.json</li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905211405936.png" alt="image-20220905211405936"></p><ol start="3"><li>在<code>index.js</code>中定义格式化时间的方法</li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905212033670.png" alt="image-20220905212033670"></p><ol start="4"><li>在<code>index.js</code>中定义转义<code>HTML</code>的方法</li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905212146769.png" alt="image-20220905212146769"></p><ol start="5"><li>在<code>index.js</code>中定义还原<code>HTML</code>的方法</li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905212214871.png" alt="image-20220905212214871"></p><ol start="6"><li>将不同的功能进行模块化拆分</li></ol><p>① 将格式化时间的功能，拆分到 <code>src -&gt; dateFormat.js</code> 中</p><p>② 将处理 HTML 字符串的功能，拆分到 <code>src -&gt; htmlEscape.js</code> 中</p><p>③ 在 <code>index.js</code> 中，导入两个模块，得到需要向外共享的方法</p><p>④ 在 <code>index.js</code> 中，使用 <code>module.exports</code> 把对应的方法共享出去</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> date = <span class="built_in">require</span>(<span class="string">&#x27;./src/dateFormat&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">escape</span> = <span class="built_in">require</span>(<span class="string">&#x27;./src/htmlEscape&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">...date,   <span class="comment">// 展开对象(实际为封装的函数)</span></span><br><span class="line">...<span class="built_in">escape</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="8"><li>编写包的说明文档</li></ol><p>包根目录中的 <code>README.md</code> 文件，是包的使用说明文档。通过它，我们可以事先把包的使用说明，以 <code>markdown</code> 的格式写出来，方便用户参考。</p><p><code>README</code> 文件中具体写什么内容，没有强制性的要求；只要能够清晰地把包的作用、用法、注意事项等描述清楚即可。</p><p>我们所创建的这个包的 <code>README.md</code> 文档中，会包含以下 6 项内容：</p><p>安装方式、导入方式、格式化时间、转义 HTML 中的特殊字符、还原 HTML 中的特殊字符、开源协议</p><ol start="9"><li>发布包</li></ol><p>① 访问 <a href="https://www.npmjs.com/">https://www.npmjs.com/</a> 网站，点击 <code>sign up</code> 按钮，进入注册用户界面</p><p>② 填写账号相关的信息：<code>Full Name、Public Email、Username、Password</code></p><p>③ 点击 <code>Create an Account</code> 按钮，注册账号</p><p>④ 登录邮箱，点击验证链接，进行账号的验证</p><ol start="10"><li>登录npm账号</li></ol><p><code>npm</code> 账号注册完成后，可以在终端中执行 <code>npm login</code> 命令，依次输入用户名、密码、邮箱后，即可登录成功。</p><blockquote><p>注意在登录时要将服务器切换到npm官方服务器：</p><ul><li><code>nrm ls</code> 检查自己的服务器</li><li><code>nrm use npm</code>切换到npm官方服务器</li></ul></blockquote><ol start="11"><li>把包发布到npm上</li></ol><p>将终端切换到包的根目录之后，运行 <code>npm publish</code> 命令，即可将包发布到 npm 上（注意：包名不能雷同）</p><ol start="12"><li>删除已发布的包</li></ol><p>运行 <code>npm unpublish</code> 包名 <code>--force</code> 命令，即可从 npm 删除已发布的包。</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/songzhenjin/image/raw/master/img/image-20220905213001664.png" alt="image-20220905213001664"></p><blockquote><p><strong>注意：</strong></p><p>① <code>npm unpublish</code> 命令只能删除 <strong>72</strong> 小时以内发布的包</p><p>② <code>npm unpublish</code> 删除的包，在 <strong>24</strong> 小时内不允许重复发布</p><p>③ 发布包的时候要慎重，尽量不要往 npm 上发布没有意义的包！</p></blockquote><h4 id="模块的加载机制">模块的加载机制</h4><h5 id="优先从缓存中加载">优先从缓存中加载</h5><p><strong>模块在第一次加载后会被缓存</strong>。 这也意味着多次调用 require() 不会导致模块的代码被执行多次。</p><p>**注意：**不论是内置模块、用户自定义模块、还是第三方模块，它们都会优先从缓存中加载，从而提高模块的加载效率。</p><h5 id="内置模块的加载机制">内置模块的加载机制</h5><p>内置模块是由 Node.js 官方提供的模块，<strong>内置模块的加载优先级最高</strong>。</p><p>例如，<code>require('fs')</code> 始终返回内置的 fs 模块，即使在 node_modules 目录下有名字相同的包也叫做 fs。</p><h5 id="自定义模块的加载机制">自定义模块的加载机制</h5><p>使用 <code>require()</code> 加载自定义模块时，必须指定以 <code>./</code> 或 <code>../</code> 开头的路径标识符。在加载自定义模块时，如果没有指定 <code>./</code> 或 <code>../</code> 这样的路径标识符，则 node 会把它当作内置模块或第三方模块进行加载。</p><p>同时，在使用 <code>require()</code> 导入自定义模块时，如果省略了文件的扩展名，则 <code>Node.js</code> 会按顺序分别尝试加载以下的文件：</p><p>① 按照确切的文件名进行加载</p><p>② 补全 <strong>.js</strong> 扩展名进行加载</p><p>③ 补全 <strong>.json</strong> 扩展名进行加载</p><p>④ 补全 <strong>.node</strong> 扩展名进行加载</p><p>⑤ 加载失败，终端报错</p><h5 id="第三方模块的加载机制">第三方模块的加载机制</h5><p>如果传递给 <code>require()</code> 的模块标识符不是一个内置模块，也没有以 <code>./</code>或 <code>../</code>开头，则 <code>Node.js</code> 会从当前模块的父目录开始，尝试从 <code>/node_modules</code> 文件夹中加载第三方模块。</p><p><strong>如果没有找到对应的第三方模块，则移动到再上一层父目录中，进行加载，直到文件系统的根目录。</strong></p><p>例如，假设在 <code>C:\Users\itheima\project\foo.js</code>文件里调用了 <code>require('tools')</code>，则 <code>Node.js</code> 会按以下顺序查找：</p><p>① C:\Users\itheima\project\node_modules\tools</p><p>② C:\Users\itheima\node_modules\tools</p><p>③ C:\Users\node_modules\tools</p><p>④ C:\node_modules\tools</p><h5 id="目录作为模块">目录作为模块</h5><p>当把目录作为模块标识符，传递给 <code>require()</code> 进行加载的时候，有三种加载方式：</p><p>① 在被加载的目录下查找一个叫做 <code>package.json</code> 的文件，并寻找 <code>main</code> 属性，作为 <code>require()</code> 加载的入口</p><p>② 如果目录里没有 <code>package.json</code> 文件，或者 <code>main</code> 入口不存在或无法解析，则 <code>Node.js</code> 将会试图加载目录下的 <code>index.js</code> 文件。</p><p>③ 如果以上两步都失败了，则 <code>Node.js</code> 会在终端打印错误消息，报告模块的缺失：<code>Error: Cannot find module 'xxx'</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Nodejs 基础&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://nodejs.org/en/&quot;&gt;官网传送门&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;初识-Nodejs&quot;&gt;初识 Nodejs&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Node.js 是一个基于 Chrome </summary>
      
    
    
    
    <category term="后端🍟" scheme="https://blog.cilicili.xyz/categories/%E5%90%8E%E7%AB%AF%F0%9F%8D%9F/"/>
    
    
    <category term="Node" scheme="https://blog.cilicili.xyz/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>【Python】FastApi快速入门</title>
    <link href="https://blog.cilicili.xyz/posts/bae2c202.html"/>
    <id>https://blog.cilicili.xyz/posts/bae2c202.html</id>
    <published>2022-08-10T02:58:05.796Z</published>
    <updated>2022-09-09T09:36:05.440Z</updated>
    
    <content type="html"><![CDATA[<h1>FastApi快速入门</h1><h3 id="开启服务和访问接口">开启服务和访问接口</h3><p>1.首先在<code>Terminal终端</code>中进入<code>/venv/scripts/activate.bat</code>，安装<code>pip install fastapi[all]</code></p><blockquote><p><code>[all]</code>相当于安装了主要的<code>fastapi</code>+服务器<code>uvicorn</code>+其它</p></blockquote><p>2.配置<code>python</code>解释器</p><p>3.导入<code>fastapi</code>，<code>from fastapi import FastAPI</code></p><p>4.初始化app对象，<code>app = FastAPI()</code></p><p>5.运行文件</p><p>①填入下方代码，并输入<code>python test.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">uvicorn.run(app)</span><br></pre></td></tr></table></figure><p>②<code>uvicorn test:app --reload</code>  <strong>常用命令</strong></p><p>6.添加首页接口，当页面中打开<code>&quot;/&quot;</code>页面时，运行<code>index()</code>函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span><span class="comment"># Python装饰器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;This is Home Page.&quot;</span></span><br></pre></td></tr></table></figure><h3 id="返回json数据和文档自动生成">返回json数据和文档自动生成</h3><p>1.填入下方代码，即可生成对应的<code>json</code>数据（推荐使用<code>FireFox</code>浏览器，更方便查看json数据结构）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">users</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Get all users&quot;</span>, <span class="string">&quot;code&quot;</span>:<span class="number">2001</span>&#125;</span><br></pre></td></tr></table></figure><p>2.填入下方代码，返回<code>链表</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/projects&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">projects</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;项目1&quot;</span>,<span class="string">&quot;项目2&quot;</span>,<span class="string">&quot;项目3&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="调试面板">调试面板</h4><p>在<code>url地址</code>中输入<code>127.0.0.1:8000/docs</code>，就可以看到所有的<code>API</code>接口并提供测试功能。</p><blockquote><p>接口下方——&gt;<code>Try it out</code>——&gt;<code>Execute</code></p><p>得到：<code>Curl命令行</code>相关参数、<code>URL</code>地址、<code>响应结果</code></p></blockquote><h3 id="发送POST请求">发送POST请求</h3><p>1.<code>post</code>请求</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;login success&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>在<code>浏览器F12</code>的<code>网络</code>中发现报了<code>405错误</code>，是因为传递的是<code>GET</code>请求</p><p>此时，使用<code>Postman</code>测试工具进行测试</p><p>2.同时支持<code>GET</code>、<code>POST</code>、<code>PUT</code>请求</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.api_route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=(<span class="params"><span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;PUT&quot;</span></span>)</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;login success&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="获取URL参数">获取URL参数</h3><p>1.使用<code>&#123;&#125;</code>动态获得参数，如果报错，请重新启动服务</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/user/&#123;id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;id&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>2.在<code>url</code>中添加<code>?id=8</code>，同样可以得到<code>id</code>的参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/user&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;id&quot;</span>: <span class="built_in">id</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="获取请求头和请求体的参数">获取请求头和请求体的参数</h3><p>1.例如接受<strong>请求头</strong>中的<code>token</code>字段来传递<code>token</code>参数（必须保持一致）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Header <span class="comment"># 引入请求头</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用python默认参数机制</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/user&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params"><span class="built_in">id</span>, token = Header(<span class="params"><span class="literal">None</span></span>)</span>):  <span class="comment"># 接收的变量必须相同</span></span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;id&quot;</span>: <span class="built_in">id</span>, <span class="string">&quot;token&quot;</span>: token&#125;</span><br></pre></td></tr></table></figure><p>2.使用<strong>请求体Body</strong>方法传递参数</p><p>①传递<code>json</code>数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;song&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;song&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body <span class="comment"># 引入请求体</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/user&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params">data=Body(<span class="params"><span class="literal">None</span></span>)</span>): <span class="comment"># 接收的变量可以不同</span></span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;data&quot;</span>: data&#125;</span><br></pre></td></tr></table></figure><p>②传递<code>form表单</code>形式数据</p><table><thead><tr><th style="text-align:center">username</th><th style="text-align:center">song</th></tr></thead><tbody><tr><td style="text-align:center">password</td><td style="text-align:center">song</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Form <span class="comment"># 引入Form表单类</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span><span class="title function_">login</span>(<span class="params">username=Form(<span class="params"><span class="literal">None</span></span>),password=Form(<span class="params"><span class="literal">None</span></span>)</span>): <span class="comment"># 接收的变量必须相同</span></span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;data&quot;</span>: &#123;<span class="string">&quot;username&quot;</span>: username,<span class="string">&quot;password&quot;</span>: password&#125;&#125;</span><br></pre></td></tr></table></figure><p>运行之前，首先安装<code>pip install python-multipart</code>，再重新启动服务</p><h3 id="修改响应状态码">修改响应状态码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse, HTMLResponse, FileResponse   </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/user&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>():</span><br><span class="line"><span class="keyword">return</span> JSONResponse(content=&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;get user&quot;</span>&#125;,</span><br><span class="line">                       status_code=<span class="number">202</span>,</span><br><span class="line">                       headers=&#123;<span class="string">&quot;a&quot;</span>:<span class="string">&quot;b&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>():</span><br><span class="line">    html_content = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;p style=&quot;color:red&quot;&gt;</span></span><br><span class="line"><span class="string">    Hello World</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">return</span> HTMLResponse(content=html_content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装pip install aiofiles</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/avatar&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>():</span><br><span class="line">    avatar = <span class="string">&#x27;static/mage.jpg&#x27;</span> <span class="comment"># 新建static文件夹存放图片</span></span><br><span class="line"><span class="keyword">return</span> FileResponse(avatar, filename=<span class="string">&quot;mage.jpg&quot;</span>) <span class="comment"># 添加filename可以直接下载</span></span><br></pre></td></tr></table></figure><h3 id="jinja2模板返回HTML页面">jinja2模板返回HTML页面</h3><p>新建<code>pages/index.html</code>，初始化<code>html</code>页面</p><p>安装<code>pip install jinja2</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Request</span><br><span class="line"><span class="keyword">from</span> fastapi.templating <span class="keyword">import</span> jinja2Templates <span class="comment"># 引入模板引擎</span></span><br><span class="line"></span><br><span class="line">template = Jinja2Templates(<span class="string">&quot;pages&quot;</span>)  <span class="comment"># 初始化pages对象，pages表示html页面存放位置</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params">username, req: Request</span>): <span class="comment"># req可以改变，但必须传入Request</span></span><br><span class="line"><span class="keyword">return</span> template.TemplateResponse(<span class="string">&quot;index.html&quot;</span>, context=&#123;<span class="string">&quot;request&quot;</span>: req, <span class="string">&quot;name&quot;</span>: username&#125;) <span class="comment"># &quot;request&quot;也不允许改变</span></span><br></pre></td></tr></table></figure><p>在前端页面中,<code>&quot;name&quot;</code>可以通过<code>&#123;&#123; &#125;&#125;</code>进行接收，例如<code>url</code>输入<code>localhost:8000/?username=helloworld</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> 用户名: &#123;&#123; name &#125;&#125; <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>实战小应用：</strong></p><p>添加数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Request, Form</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> RedirectResponse <span class="comment"># 引入重定向</span></span><br><span class="line"><span class="keyword">from</span> fastapi.templating <span class="keyword">import</span> jinja2Templates </span><br><span class="line"></span><br><span class="line">template = Jinja2Templates(<span class="string">&quot;pages&quot;</span>)  </span><br><span class="line"></span><br><span class="line">todos = [<span class="string">&quot;写日记&quot;</span>, <span class="string">&quot;看电影&quot;</span>, <span class="string">&quot;玩游戏&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">req: Request</span>):    </span><br><span class="line"><span class="keyword">return</span> template.TemplateResponse(<span class="string">&quot;index.html&quot;</span>, context=&#123;<span class="string">&quot;request&quot;</span>: req, <span class="string">&quot;todos&quot;</span>: todos&#125;) </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/todo&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">todo</span>(<span class="params">todo=Form(<span class="params"><span class="literal">None</span></span>)</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot;处理用户发送过来的 todolist 数据&quot;&quot;&quot;</span></span><br><span class="line">todos.insert(<span class="number">0</span>, todo)</span><br><span class="line"><span class="keyword">return</span> RedirectResponse(<span class="string">&quot;/&quot;</span>, status_code=<span class="number">302</span>) <span class="comment"># 由于post请求和get请求不同，所以修改状态码</span></span><br></pre></td></tr></table></figure><p>前端页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/todo&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>  # action表示传递的位置</span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;todo&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请添加待办事项...&quot;</span>&gt;</span> # 通过的name属性的字段接收数据</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> 待办事项 <span class="tag">&lt;/<span class="name">h</span>&gt;</span></span><br><span class="line">&#123;% for todo in todos %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; todo &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h3 id="配置数据库">配置数据库</h3><blockquote><p>使用<code>ORM模型</code>，将<code>SQL</code>语句转化成<code>Python</code>中的函数，<strong>编写</strong>、<strong>查询</strong>和<strong>操作数据库</strong>时的可读性和安全性较高。</p></blockquote><p>1.安装<code>pip install tortoise-orm</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tortoise.contrib.fastapi <span class="keyword">import</span> register_tortoise <span class="comment"># 引入</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库绑定</span></span><br><span class="line">register_tortoise(app,</span><br><span class="line">                db_url=<span class="string">&quot;mysql://root:123456@localhost:3306/fastapi&quot;</span>, <span class="comment"># 连接数据库的地址,最后是库名</span></span><br><span class="line">                modules=&#123;<span class="string">&quot;models&quot;</span>:[]&#125;,  <span class="comment"># 将数据库中的表定义为对象</span></span><br><span class="line">                add_exceptionn_handlers=<span class="literal">True</span>,   <span class="comment"># 生成结构</span></span><br><span class="line">                generate_schemas=<span class="literal">True</span> <span class="comment"># 错误处理</span></span><br><span class="line">                 )</span><br></pre></td></tr></table></figure><h3 id="数据库查询">数据库查询</h3><p>新建<code>python package</code>，命名为<code>dao</code>(数据库操作缩写)，再新建<code>dao/models.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tortoise <span class="keyword">import</span> Model, fields</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Todo</span>(<span class="title class_ inherited__">Model</span>):  <span class="comment"># 代表数据库中的表 todo ,继承Model类</span></span><br><span class="line">    <span class="built_in">id</span> = fields.IntField(pk=<span class="literal">True</span>)  <span class="comment"># 定义为Int类型，pk表示主键</span></span><br><span class="line">    content = fields.CharField(max_length=<span class="number">500</span>)  <span class="comment"># 内容</span></span><br><span class="line">    created_at = fields.DatetimeField(auto_now_add=<span class="literal">True</span>)  <span class="comment"># 创建时间</span></span><br><span class="line">    updated_at = fields.DatetimeField(auto_now=<span class="literal">True</span>)<span class="comment"># 更新时间</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>实战小应用进阶</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Request, Form</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> RedirectResponse </span><br><span class="line"><span class="keyword">from</span> fastapi.templating <span class="keyword">import</span> jinja2Templates </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dao.models <span class="keyword">import</span> Todo <span class="comment"># 导入类</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line">template = Jinja2Templates(<span class="string">&quot;pages&quot;</span>)  </span><br><span class="line"></span><br><span class="line">register_tortoise(app,</span><br><span class="line">               db_url=<span class="string">&quot;mysql://root:123456@localhost:3306/fastapi&quot;</span>, </span><br><span class="line">               modules=&#123;<span class="string">&quot;models&quot;</span>:[<span class="string">&#x27;dao.models&#x27;</span>]&#125;,  </span><br><span class="line">             add_exceptionn_handlers=<span class="literal">True</span>,   </span><br><span class="line">             generate_schemas=<span class="literal">True</span>) </span><br><span class="line"></span><br><span class="line">todos = [<span class="string">&quot;写日记&quot;</span>, <span class="string">&quot;看电影&quot;</span>, <span class="string">&quot;玩游戏&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">req: Request</span>):  <span class="comment"># 添加异步async</span></span><br><span class="line"><span class="comment"># ORM ,获取所有的 todos</span></span><br><span class="line">todos = <span class="keyword">await</span> Todo.<span class="built_in">all</span>()<span class="comment"># 添加await  # todos本质是一个对象</span></span><br><span class="line"><span class="keyword">return</span> template.TemplateResponse(<span class="string">&quot;index.html&quot;</span>, context=&#123;<span class="string">&quot;request&quot;</span>: req, <span class="string">&quot;todos&quot;</span>: todos&#125;) </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/todo&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">todo</span>(<span class="params">content=Form(<span class="params"><span class="literal">None</span></span>)</span>):   <span class="comment"># 由于todo参数和函数名重复，将todo参数改成content，前端name也要更改</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;处理用户发送过来的 todolist 数据&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 把新的事项存储到数据库当中</span></span><br><span class="line"><span class="keyword">await</span> Todo(content=content).save()</span><br><span class="line"><span class="keyword">return</span> RedirectResponse(<span class="string">&quot;/&quot;</span>, status_code=<span class="number">302</span>) </span><br></pre></td></tr></table></figure><p>在前端页面中修改代码，就可以看到效果啦~</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for todo in todos %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; todo.content &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h3 id="数据库过滤查询">数据库过滤查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/search&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">req: Request, keyword=Form(<span class="params"><span class="literal">None</span></span>)</span>):</span><br><span class="line"><span class="comment"># 查询包含keyword的所有纪律</span></span><br><span class="line">search_results =<span class="keyword">await</span> Todo.<span class="built_in">filter</span>(content__icontains=keyword).<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">return</span> template.TemplateResponse(<span class="string">&quot;search_result.html&quot;</span>,context=&#123;<span class="string">&quot;request&quot;</span>: req,<span class="string">&quot;search_results&quot;</span>: search_&#125;)</span><br></pre></td></tr></table></figure><hr><blockquote><p>教程来源于B站<a href="https://www.bilibili.com/video/BV1RS4y1U7GZ?p=1&amp;vd_source=f5b24b9dd30b3acd2bf669dccabe17d6">雨泽老师</a>，本文章用于记录。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;FastApi快速入门&lt;/h1&gt;
&lt;h3 id=&quot;开启服务和访问接口&quot;&gt;开启服务和访问接口&lt;/h3&gt;
&lt;p&gt;1.首先在&lt;code&gt;Terminal终端&lt;/code&gt;中进入&lt;code&gt;/venv/scripts/activate.bat&lt;/code&gt;，安装&lt;code&gt;pip</summary>
      
    
    
    
    <category term="后端🍟" scheme="https://blog.cilicili.xyz/categories/%E5%90%8E%E7%AB%AF%F0%9F%8D%9F/"/>
    
    
    <category term="FastApi" scheme="https://blog.cilicili.xyz/tags/FastApi/"/>
    
    <category term="Python" scheme="https://blog.cilicili.xyz/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>【前端】Vue3.2实现后台管理系统（一）</title>
    <link href="https://blog.cilicili.xyz/posts/5b0e50ed.html"/>
    <id>https://blog.cilicili.xyz/posts/5b0e50ed.html</id>
    <published>2022-08-01T06:52:38.000Z</published>
    <updated>2022-09-19T02:58:55.146Z</updated>
    
    <content type="html"><![CDATA[<h3 id="登录功能">登录功能</h3><h3 id="创建Vite项目">创建Vite项目</h3><p>官方文档：<a href="https://cn.vitejs.dev/">Vite</a></p><p>Vite是一个web开发构建工具，由于其原生ES模块导入方式，可以实现闪电般的冷服务器启动，</p><p>通过在终端中运行以下命令，可以使用Vite快速构建Vue项目。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm 7+</span></span><br><span class="line">npm init vite@latest &lt;project-name&gt; -- --template vue</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> &lt;project-name&gt;</span><br><span class="line"></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h3 id="引入element-plus组件库">引入element-plus组件库</h3><p>官方文档：<a href="https://element-plus.org">element-plus</a></p><p>1.在vscode中打开命令行终端输入<code>npm install element-plus --save</code>引入组件库</p><p>2.在<code>src</code>文件下的<code>main.js</code>中引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br></pre></td></tr></table></figure><p>引入后结果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">// element-plus</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="comment">// element-plus的样式库</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span>  </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>在App.vue中进行进行试验是否引入成功。</p><h3 id="引入Windi-CSS工具库">引入Windi CSS工具库</h3><p>官方文档：<a href="https://cn.windicss.org/">Windi CSS</a></p><p>1.在vscode中输入安装命令<code>npm i -D vite-plugin-windicss windicss</code></p><p>2.在<code>vite.config.js</code>中引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">WindiCSS</span> <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-windicss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title class_">WindiCSS</span>(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.在<code>main.js</code>中引入<code>import 'virtual:windi.css'</code></p><h3 id="引入vue-router-4">引入vue-router@4</h3><p>官方文档：<a href="https://router.vuejs.org/">Vue-router@4</a></p><p>1.在vscode中输入安装命令<code>npm install vue-router@4</code></p><p>2.在<code>src</code>文件夹下创建<code>router</code>文件夹，再在其下面创建<code>index.js</code>文件，文件中填写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入路由组件</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createRouter,</span><br><span class="line">  createWebHashHistory</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 定义一些路由</span></span><br><span class="line"><span class="comment">// 每个路由都需要映射到一个组件。</span></span><br><span class="line"><span class="keyword">const</span> routes = []</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建路由实例并传递 `routes` 配置</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(), <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见我们采用hash模式</span></span><br><span class="line">  routes <span class="comment">// `routes: routes` 的缩写</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将其暴露出来</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p>在<code>main.js</code>中进行引入<code>import router from './router'</code> ，然后挂载根实例后在文件中加入<code>app.use(router)</code>。</p><h3 id="路由配置和404页面捕获">路由配置和404页面捕获</h3><p>1.配置<code>src</code>别名，方便后期使用（采用vite官网配置中的<code>resolve.alias</code>方法）</p><p>在<code>vite.config.js</code>中引入<code>path</code>模块<code>import path from &quot;path&quot;</code>（主要是为了处理路径相关问题）</p><p>最后在配置中将<code>~</code>指定到<code>src</code>路径下</p><blockquote><p><code>__dirname</code>可以拿到当前目录的路径</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">WindiCSS</span> <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-windicss&#x27;</span></span><br><span class="line"></span><br><span class="line">+ <span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">+  <span class="attr">resolve</span>: &#123;</span><br><span class="line">+    <span class="attr">alias</span>: &#123;</span><br><span class="line">+      <span class="string">&quot;~&quot;</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;src&quot;</span>)</span><br><span class="line">+    &#125;</span><br><span class="line">+  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>(),<span class="title class_">WindiCSS</span>()]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>2.在<code>src</code>下面新建<code>pages</code>文件夹，同时新建<code>index.vue</code>作为后台首页</p><p>3.在<code>index.js</code>中配置路由</p><p>① 将后台首页引入<code>import Index from '~/pages/index.vue'</code></p><p>② 在<code>routes</code>的数组中指定<code>path</code>路径</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Index</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>③ 在<code>App.vue</code>中加入<code>&lt;router-view&gt;&lt;/router-view&gt;</code>组件</p><p>④以相同方法加入<code>about页面</code>和<code>404页面</code></p><p><strong>最终<code>index.js</code>中代码如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  createRouter,</span><br><span class="line">  createWebHashHistory</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Index</span> <span class="keyword">from</span> <span class="string">&#x27;~/pages/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;~/pages/about.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound</span> <span class="keyword">from</span> <span class="string">&#x27;~/pages/404.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Index</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">About</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/:pathMatch(.*)*&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;NotFound&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">NotFound</span></span><br><span class="line">  &#125;,]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span></span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  routes, <span class="comment">// `routes: routes` 的缩写</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p><strong><code>404.vue</code>页面的配置信息：</strong></p><p>采用<code>element-plus</code>中的<code>result组件</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-result icon=&quot;warning&quot; title=&quot;404提示&quot; sub-title=&quot;你找的页面走丢了&quot;&gt;</span><br><span class="line">      &lt;template #extra&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;$router.push(&#x27;/&#x27;)&quot;&gt;回到首页&lt;/el-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-result&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><blockquote><p><strong>报错信息处理：</strong></p><p><code>404.vue</code>页面中的<code>@click=&quot;$router.push('/')</code>出现**$类型错误**</p></blockquote><p><strong>解决方案：</strong></p><p>在src目录下中新增xxx.d.ts文件，重启vscode</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span>, &#123; <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;vue/types/vue&#x27;</span> &#123;</span><br><span class="line">interface <span class="title class_">Vue</span> &#123;</span><br><span class="line"><span class="attr">$api</span>: any</span><br><span class="line"><span class="attr">$http</span>: any</span><br><span class="line"><span class="attr">$router</span>: <span class="title class_">VueRouter</span></span><br><span class="line"><span class="attr">$route</span>: <span class="title class_">Route</span></span><br><span class="line"><span class="attr">$Message</span>: any</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="登录页开发">登录页开发</h3><p>1.在<code>pages</code>文件夹下新建<code>login.vue</code>文件作为登录页面。</p><p>登录页面采用<code>element-plus</code>组件库中的<a href="https://element-plus.org/zh-CN/component/layout.html">Layout布局</a></p><blockquote><p><strong>Layout布局</strong></p><p>通过基础的 24 分栏，迅速简便地创建布局。</p><p>组件默认使用 Flex 布局，不需要手动设置 <code>type=&quot;flex&quot;</code>。</p><p>请注意父容器避免使用 <code>inline</code> 相关样式，会导致组件宽度不能撑满。</p></blockquote><p>2.<code>login.vue</code>文件完整代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-row class=&quot;min-h-screen min-w-screen bg-indigo-500&quot;&gt;</span><br><span class="line">    &lt;el-col :lg=&quot;16&quot; :md=&quot;12&quot; class=&quot;flex items-center justify-center&quot;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;font-bold text-5xl text-light-50 mb-4&quot;&gt;欢迎光临&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;text-gray-200 text-sm&quot;&gt;此站点是《vue3 + vite实战碳生产率系统》的演示地址&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">    &lt;el-col :lg=&quot;8&quot; :md=&quot;12&quot; class=&quot;bg-light-50 flex items-center justify-center flex-col&quot;&gt;</span><br><span class="line">      &lt;h2 class=&quot;font-bold text-3xl text-gray-800&quot;&gt;欢迎回来&lt;/h2&gt;</span><br><span class="line">      &lt;div class=&quot;flex items-center justify-center my-5 text-gray-300 space-x-2&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;h-[1px] w-16 bg-gray-200&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;账号密码登录&lt;/span&gt;</span><br><span class="line">        &lt;span class=&quot;h-[1px] w-16 bg-gray-200&quot;&gt;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;el-form :model=&quot;form&quot; class=&quot;w-[250px]&quot;&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;form.username&quot; placeholder=&quot;请输入用户名&quot;&gt;</span><br><span class="line">            &lt;template #prefix&gt;</span><br><span class="line">              &lt;el-icon&gt;</span><br><span class="line">                &lt;user /&gt;</span><br><span class="line">              &lt;/el-icon&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;form.password&quot; placeholder=&quot;请输入密码&quot;&gt;</span><br><span class="line">            &lt;template #prefix&gt;</span><br><span class="line">              &lt;el-icon&gt;</span><br><span class="line">                &lt;lock /&gt;</span><br><span class="line">              &lt;/el-icon&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-button round color=&quot;#626aef&quot; class=&quot;w-[250px]&quot; type=&quot;primary&quot; @click=&quot;onSubmit&quot;&gt;登 录&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;</span><br><span class="line">// do not use same name with ref</span><br><span class="line">const form = reactive(&#123;</span><br><span class="line">  username: &quot;&quot;,</span><br><span class="line">  password: &quot;&quot;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const onSubmit = () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;submit!&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="全局引入图标">全局引入图标</h3><p>1.使用包管理器引入 <code>npm install @element-plus/icons-vue</code></p><p>2.在<code>main.js</code>中进行全局注册</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ElementPlusIconsVue</span> <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, component] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="title class_">ElementPlusIconsVue</span>)) &#123;</span><br><span class="line">  app.<span class="title function_">component</span>(key, component)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.在<code>login.vue</code>中加入插槽并填入图标</p><p>使用插槽填入图标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-input v-model=&quot;form.username&quot; placeholder=&quot;请输入用户名&quot;&gt;</span><br><span class="line">+    &lt;template #prefix&gt;  </span><br><span class="line">+       &lt;el-icon&gt;</span><br><span class="line">+          &lt;user /&gt;</span><br><span class="line">+       &lt;/el-icon&gt;</span><br><span class="line">+    &lt;/template&gt;</span><br><span class="line">&lt;/el-input&gt;</span><br><span class="line"> &lt;el-input v-model=&quot;form.password&quot; placeholder=&quot;请输入密码&quot;&gt;</span><br><span class="line">+     &lt;template #prefix&gt;</span><br><span class="line">+        &lt;el-icon&gt;</span><br><span class="line">+           &lt;lock /&gt;</span><br><span class="line">+        &lt;/el-icon&gt;</span><br><span class="line">+     &lt;/template&gt;</span><br><span class="line">&lt;/el-input&gt;</span><br></pre></td></tr></table></figure><h3 id="结合Windi-CSS中的-apply实现样式抽离">结合Windi CSS中的@apply实现样式抽离</h3><p>1.在<code>login.vue</code>下方创建<code>&lt;style&gt;&lt;/style&gt;</code></p><p>2.将上方<code>class</code>中的样式<code>ctrl+x</code>剪切，并重命名</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">class</span>=<span class="string">&quot;min-h-screen min-w-screen bg-indigo-500&quot;</span>&gt;</span></span><br><span class="line">+ <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">class</span>=<span class="string">&quot;login-container&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.在<code>&lt;style&gt;</code>标签中进行重写(选择)</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.login-container</span>&#123;</span><br><span class="line">    <span class="keyword">@apply</span> min-h-screen min-w-screen bg-indigo-<span class="number">500</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Setup语法糖">Setup语法糖</h3><p>里面的代码会被编译成组件 <code>setup()</code> 函数的内容。这意味着与普通的 <code>&lt;script&gt;</code> 只在组件被首次引入的时候执行一次不同，<code>&lt;script setup&gt;</code> 中的代码会在<strong>每次组件实例被创建的时候执行</strong>。</p><p><a href="https://cn.vuejs.org/api/sfc-script-setup.html">官方教学</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;button&gt;&#123;&#123; count &#125;&#125; &lt;button&gt; &lt;!-- 不需要.value --&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">function addCount()&#123;</span><br><span class="line">conut.value++;  // 对象中的value值才是应该操作的值</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="登录表单验证">登录表单验证</h3><p>1.定义<code>el-form</code>组件中的<code>:rules=&quot;rules&quot;</code>属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form ref=&quot;formRef&quot; :rules=&quot;rules&quot; :model=&quot;form&quot; class=&quot;w-[250px]&quot;&gt;</span><br></pre></td></tr></table></figure><p>2.在<code>script</code>标签定义<code>rules</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rules = &#123;</span><br><span class="line">  <span class="attr">username</span>: [],</span><br><span class="line">  <span class="attr">password</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.在<code>el-form-item</code>中指定<code>prop</code>对应的<code>keys</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item prop=&quot;username&quot;&gt;</span><br><span class="line">    &lt;el-input v-model=&quot;form.username&quot; placeholder=&quot;请输入用户名&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line">&lt;el-form-item prop=&quot;password&quot;&gt;</span><br><span class="line">     &lt;el-input v-model=&quot;form.password&quot; placeholder=&quot;请输入密码&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure><p>4.在<code>&lt;script&gt;</code>中填写验证规则</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rules = &#123;</span><br><span class="line">  <span class="attr">username</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,  <span class="comment">// 是否必填</span></span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;用户名不能为空&#x27;</span>,</span><br><span class="line">      <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>  <span class="comment">// 失去焦点</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">password</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,  <span class="comment">// 是否必填</span></span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;密码不能为空&#x27;</span>,</span><br><span class="line">      <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>  <span class="comment">// 失去焦点</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.触发表单验证</p><p>① 在<code>el-form</code>处加入响应式组件<code>ref=&quot;formRef&quot;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form ref=&quot;formRef&quot; :rules=&quot;rules&quot; :model=&quot;form&quot; class=&quot;w-[250px]&quot;&gt;</span><br></pre></td></tr></table></figure><p>②要拿到<code>el-form</code>节点，就需要在<code>&lt;script&gt;</code>中进行定义</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formRef = <span class="title function_">ref</span>(<span class="literal">null</span>) <span class="comment">// 主要是为了让formRef变为响应式</span></span><br></pre></td></tr></table></figure><p>③使用<code>ref</code>的<code>validate</code>方法，并传一个<strong>回调函数</strong>，函数接受一个<strong>valid参数</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  formRef.<span class="property">value</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!valid) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;验证通过&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>④要记得在<code>&lt;script&gt;</code>中将<code>ref</code>引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure><p>⑤此时网页端就可得到<code>false</code> or <code>true</code>的验证结果</p><blockquote><p>在<code>el-input</code>中加入<code>type=&quot;password&quot;</code>，此时密码输入变为 <code>···</code></p><p>加入<code>show-password</code>后出现小眼睛，控制是否隐藏密码</p></blockquote><h3 id="引入axios请求库和登录接口">引入axios请求库和登录接口</h3><blockquote><p><a href="http://dishaxy.dishait.cn/shopadminapi#7f8ce15f-7b6a-4d3d-ab72-1c45fee9bf92">接口文档地址</a></p></blockquote><p>1.在<code>src</code>文件夹下新建<code>axios.js</code>，并通过<code>import axios from &quot;axios&quot;</code>进行引入。</p><p>2.通过<strong>创建实例</strong>的方法<strong>自定义配置</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>  <span class="comment">// 引入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>:<span class="string">&quot;http://ceshi13.dishait.cn&quot;</span> <span class="comment">// 根域名</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service  <span class="comment">// 导出</span></span><br></pre></td></tr></table></figure><p>3.在<code>src</code>文件夹下新增<code>api</code>文件夹，用来存放接口及方法。</p><p>①新建<code>manager.js</code>模块（因为登录接口属于管理员模块的一部分）</p><p>②从刚新建的<code>manager.js</code>中的自定义实例中引入<code>import axios from '~/axios'</code></p><p>③定义登录方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;~/axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">username,password</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">post</span>(<span class="string">&quot;/admin/login&quot;</span>, &#123;</span><br><span class="line">    username,</span><br><span class="line">    password</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>④在<code>login.vue</code>文件中进行引入<code>import &#123; login &#125; from '~/api/manger'</code></p><p>⑤在下方<code>onSubmit</code>中调用<code>login</code>方法，同时传入<code>form</code>中得到的<code>username</code>和<code>password</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  formRef.<span class="property">value</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!valid) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">login</span>(form.<span class="property">username</span>,form.<span class="property">password</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>⑥而由于<code>manager.js</code>中得到的是<code>promise</code>，因此我们可以使用<code>.then</code>得到请求成功后得到的结果，<code>.catch</code>捕获请求失败后得到的结果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">login</span>(form.<span class="property">usernamem</span>, form.<span class="property">password</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>跨域问题：</strong></p><p>采用vite官网的<a href="https://cn.vitejs.dev/config/server-options.html#server-proxy">解决方法</a>，即：</p><p>在<code>vite.config.js</code>中定义一个<code>server</code>，然后定义代理<code>proxy</code>，最后使用<code>/api</code>进行代替</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server</span>: &#123;</span><br><span class="line">  <span class="attr">proxy</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">target</span>: <span class="string">&#x27;http://ceshi13.dishait.cn&#x27;</span>,</span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>别忘了将<code>axios.js</code>中的<code>baseURL</code>改为<code>/api</code>哟！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="attr">baseURL</span>:<span class="string">&quot;/api&quot;</span>  <span class="comment">// 根域名</span></span><br></pre></td></tr></table></figure></blockquote><p>⑦在<code>login.vue</code>引入<code>element-plus</code>中的<code>error</code>通知<code>import &#123; ElNotification &#125; from 'element-plus'</code></p><p>⑧当请求失败时，在<code>.catch</code>方法中调用<code>error通知</code>；请求成功时，同理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 提示成功</span></span><br><span class="line">   <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;登录成功！&quot;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">   &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: err.<span class="property">response</span>.<span class="property">data</span>.<span class="property">msg</span> || <span class="string">&quot;请求失败！&quot;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>⑨跳转时，需要引入<code>vue-router</code>提供的<code>userRouter</code>方法<code>import &#123; useRouter &#125; from 'vue-router'</code>，</p><p>然后需要定义一个变量<code>const router = useRouter()</code>，最后才可以调用<code>router</code>方法的<code>push</code>功能进行跳转。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 提示成功</span></span><br><span class="line">    <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;登录成功！&quot;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;sucess&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 跳转到后台首页</span></span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>⑩此时就可以跳转成功啦！</p><h3 id="引入cookie存储用户token">引入cookie存储用户token</h3><blockquote><p><a href="https://vueuse.org/">VueUse</a>是为Vue 2和3服务的一套Vue Composition API的常用工具集，可以将不支持响应式的JS API变得支持响应式，是世界上Star最高的同类型库之一。</p></blockquote><p>1.在使用<code>vueuse</code>中的<code>useCookies</code>方法时，首先需要安装<code>npm i @vueuse/integrations</code>，再安装<code>npm i universal-cookie</code></p><p>2.在<code>index.vue</code>中引入<code>useCookies</code>方法<code>import &#123; useCookies &#125; from '@vueuse/integrations/useCookies'</code>，再用一个<code>cookie常量</code>来接收该方法<code>const cookie = useCookies()</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCookies &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/integrations/useCookies&#x27;</span></span><br><span class="line"><span class="keyword">const</span> cookie = <span class="title function_">useCookies</span>()</span><br></pre></td></tr></table></figure><p>在<code>&lt;template&gt;</code>中设置三个按钮来使用<strong>设置</strong>、<strong>读取</strong>和<strong>删除cookie</strong>的方法</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span>&gt;</span>设置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span>&gt;</span>读取<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在<code>&lt;script&gt;</code>定义三个cookie方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">set</span>(<span class="params"></span>) &#123;</span><br><span class="line">cookie.<span class="title function_">set</span>(<span class="string">&quot;admin-token&quot;</span>,<span class="string">&quot;123456&quot;</span>)  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">cookie.<span class="title function_">get</span>(<span class="string">&quot;admin-token&quot;</span>)  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params"></span>) &#123;</span><br><span class="line">cookie.<span class="title function_">remove</span>(<span class="string">&quot;admin-token&quot;</span>)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<strong>控制台</strong>中可以观察三个方法的作用。</p><p>3.同理，为了取到<code>token</code>，也需要在<code>login.vue</code>中引入<code>useCookies</code>方法，然后在<code>.then</code>方法中<strong>存储token和用户相关信息</strong>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 提示成功</span></span><br><span class="line">  <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&quot;登录成功！&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;sucess&#x27;</span>,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="comment">// 存储token和用户相关信息</span></span><br><span class="line">+   <span class="keyword">const</span> cookie = <span class="title function_">useCookies</span>()</span><br><span class="line">+   cookie.<span class="title function_">set</span>(<span class="string">&quot;admin-token&quot;</span>, res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">token</span>)</span><br><span class="line">   <span class="comment">// 跳转到后台首页</span></span><br><span class="line">   router.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="请求拦截器和响应拦截器">请求拦截器和响应拦截器</h3><blockquote><p><a href="http://www.axios-js.com/zh-cn/docs/#%E6%8B%A6%E6%88%AA%E5%99%A8">相关方法</a></p></blockquote><p>我们在获取<code>token</code>时，发现需要从<code>res.data.data</code>中进行获取，比较冗长。因此本项目采用<code>axios工具库</code>中的<code>拦截器</code>进行拦截（将响应拦截器的返回数据进行修改）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">return</span> response;</span><br><span class="line">+ <span class="keyword">return</span> response.<span class="property">data</span>.<span class="property">data</span>;</span><br></pre></td></tr></table></figure><p>1.在axios.js中添加如下代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">  <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">  <span class="keyword">return</span> response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>2.将<code>login.vue</code>中存储<code>token</code>的语句改为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- cookie.<span class="title function_">set</span>(<span class="string">&quot;admin-token&quot;</span>, res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">token</span>)</span><br><span class="line">+ cookie.<span class="title function_">set</span>(<span class="string">&quot;admin-token&quot;</span>, res.<span class="property">token</span>)</span><br></pre></td></tr></table></figure><p>3.错误处理</p><p>①在<code>axios.js</code>中引入<code>import &#123; ElNotification &#125; from 'element-plus'</code></p><p>②将<code>login.vue</code>中的<code>ElNotification</code>方法移到<code>axios.js</code>中响应拦截器对应的响应错误下，并删除<code>.catch</code>方法。注意<code>funciton</code>传入的参数为<code>error</code>，要将<code>message</code>中的<code>err</code>改为<code>error</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">  <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">  <span class="keyword">return</span> response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">  <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">    <span class="attr">message</span>: error.<span class="property">response</span>.<span class="property">data</span>.<span class="property">msg</span> || <span class="string">&quot;请求失败！&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>4.请求拦截器（往<code>header</code>头自动添加<code>token</code>）</p><p>①由于<code>token</code>存在<code>cookie</code>中，所以首先引入包<code>import &#123; useCookies &#125; from '@vueuse/integrations/useCookies'</code>，再调用<code>useCookies</code>包拿到<code>cookie</code>实例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 往header头自动添加token</span></span><br><span class="line"><span class="keyword">const</span> cookie = <span class="title function_">useCookies</span>()</span><br></pre></td></tr></table></figure><p>②调用<code>get</code>方法拿到<code>keys</code>为<code>admin-token</code>的<code>cookie</code>值，再加入判断若登录，则传<code>token</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> token = cookie.<span class="title function_">get</span>(<span class="string">&quot;admin-token&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (token) &#123;</span><br><span class="line">  config.<span class="property">headers</span>[<span class="string">&quot;token&quot;</span>] = token</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.获取当前用户登录信息的接口</p><p>在<code>manager.js</code>中加入以下代码调取接口</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getinfo</span> () &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">post</span>(<span class="string">&quot;/admin/getinfo&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6.在<code>login.vue</code>中获取用户相关信息</p><p>①加入<code>getinfo</code>方法<code>import &#123; login,getinfo &#125; from '~/api/manager'</code></p><p>②获取用户相关信息</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户相关信息</span></span><br><span class="line"><span class="title function_">getinfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res2</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res2);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>为了<strong>防止响应过快</strong>，用户重复点击登录按钮：需要给登录按钮添加<code>loading</code>状态。</p><p>1.定义loading<code>const loading = ref(false)</code></p><p>2.在登录按钮处添加默认的<code>loading</code>属性</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">round</span> <span class="attr">color</span>=<span class="string">&quot;#626aef&quot;</span> <span class="attr">class</span>=<span class="string">&quot;w-[250px]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSubmit&quot;</span> <span class="attr">:loading</span>=<span class="string">&quot;loading&quot;</span>&gt;</span>登 录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.在请求之前，将<code>loading</code>的状态设为<code>true</code>；请求结束，再将<code>loading</code>状态设为<code>false</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">formRef.<span class="property">value</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!valid) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">+    loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"> <span class="title function_">login</span>(form.<span class="property">username</span>, form.<span class="property">password</span>)</span><br><span class="line">   .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">...</span><br><span class="line">     <span class="comment">// 跳转到后台首页</span></span><br><span class="line">     router.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">   &#125;)</span><br><span class="line">+      .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">+           loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="常用工具库封装">常用工具库封装</h3><p>在<code>src</code>文件夹下新建<code>composables</code>的目录，再在里面新建<code>auth.js</code></p><p><strong>封装<code>cookie</code>：</strong></p><p>1.以封装<code>cookie</code>为例，首先导入<code>useCookies</code>包，<code>import &#123; useCookies &#125; from '@vueuse/integrations/useCookies'</code></p><p>2.定义<code>token</code>统一的值<code>const TokenKey = &quot;admin-token&quot;</code></p><p>3.使用<code>useCookies</code>实例，<code>const cookie = useCookies()</code></p><p>4.定义获取、设置和清除<code>token</code>方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取token</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getToken</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> cookie.<span class="title function_">get</span>(<span class="title class_">TokenKey</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置token</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setToken</span>(<span class="params">token</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> cookie.<span class="title function_">set</span>(<span class="title class_">TokenKey</span>,token)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除token</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">removeToken</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> cookie.<span class="title function_">remove</span>(<span class="title class_">TokenKey</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.定义好之后，<code>login.vue</code>页面就不需要再重复引用<code>useCookies</code>了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">import</span> &#123; useCookies &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/integrations/useCookies&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> &#123; setToken &#125; <span class="keyword">from</span> <span class="string">&#x27;~/composables/auth&#x27;</span> <span class="comment">// 使用setToken方法</span></span><br></pre></td></tr></table></figure><p>同时，存储token方法也可以改变</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存储token</span></span><br><span class="line"> - <span class="keyword">const</span> cookie = <span class="title function_">useCookies</span>()</span><br><span class="line"> - cookie.<span class="title function_">set</span>(<span class="string">&quot;admin-token&quot;</span>, res.<span class="property">token</span>)</span><br><span class="line"> + <span class="title function_">setToken</span>(res.<span class="property">token</span>)</span><br></pre></td></tr></table></figure><p>同理，<code>axios.js</code>中以同样方式使用<code>getToken()</code>方法</p><p><strong>封装消息提示：</strong></p><p>新建文件<code>/composables/util.js</code>，填入下方代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElNotification</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 消息提示</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">toast</span>(<span class="params">message,type = <span class="string">&quot;success&quot;</span>,dangerouslyUseHTMLString = <span class="literal">false</span></span>)&#123;</span><br><span class="line">    <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">        message,</span><br><span class="line">        type,</span><br><span class="line">        dangerouslyUseHTMLString,  <span class="comment">// 是否将message属性作为HTML片段处理</span></span><br><span class="line">        <span class="attr">duration</span>:<span class="number">3000</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后将<code>axios.js</code>中代码进行修改，<code>login.vue</code>页面同理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">import</span> &#123; <span class="title class_">ElNotification</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> &#123; toast &#125; <span class="keyword">from</span> <span class="string">&#x27;~/composables/util&#x27;</span></span><br><span class="line"></span><br><span class="line">- <span class="title class_">ElNotification</span>(&#123;</span><br><span class="line">-     <span class="attr">message</span>: error.<span class="property">response</span>.<span class="property">data</span>.<span class="property">msg</span> || <span class="string">&quot;请求失败！&quot;</span>,</span><br><span class="line">-     <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">-    <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">-  &#125;)</span><br><span class="line">+ <span class="title function_">toast</span>(error.<span class="property">response</span>.<span class="property">data</span>.<span class="property">msg</span> || <span class="string">&quot;请求失败&quot;</span>,<span class="string">&quot;error&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="引入vuex状态管理用户信息">引入vuex状态管理用户信息</h3><p>安装<a href="https://vuex.vuejs.org/zh/installation.html">VueX</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex@next --save</span><br></pre></td></tr></table></figure><p>1.新建<code>/src/store/index.js</code>，创建<code>store</code>并提供初始<code>state</code>对象和一些mutations：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="comment">// 存储用户相关信息</span></span><br><span class="line">    <span class="title function_">state</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// 用户信息</span></span><br><span class="line">            <span class="attr">user</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">   <span class="comment">// 修改用户相关信息</span></span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="comment">// 记录用户信息</span></span><br><span class="line">        <span class="title function_">SET_USERINFO</span>(<span class="params">state,user</span>)&#123;</span><br><span class="line">            state.<span class="property">user</span> = user</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><p>2.在<code>main.js</code>中引入<code>store</code>，<code>import store from './store'</code></p><p>3.直接调用<code>app.use(strore)</code>就完成啦！</p><p>使用方法：</p><p>4.在<code>login.vue</code>页面中导入<code>useStore</code>方法，<code>import &#123; useStore &#125; from 'vuex'</code></p><p>然后就可以拿到<code>store</code>实例，<code>const store = useStore()</code></p><p>5.在下方获取用户相关信息并赋值给<code>vuex</code>中的<code>user</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户相关信息</span></span><br><span class="line">   <span class="title function_">getinfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res2</span> =&gt;</span> &#123;</span><br><span class="line">+     store.<span class="title function_">commit</span>(<span class="string">&quot;SET_USERINFO&quot;</span>, res2)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res2);</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>测试效果：</strong></p><p>1.打开<code>pages</code>目录下的<code>index.vue</code>，清空内容</p><p>2.在<code>&lt;template&gt;</code>填入<code>&#123;&#123; $store.state.user &#125;&#125;</code>，若调用成功则正确。</p></blockquote><h3 id="全局路由拦截实现登录判断">全局路由拦截实现登录判断</h3><p>1.新建<code>/src/permission.js</code></p><p>2.引入<code>router</code>实例，<code>import router from &quot;~/router&quot;</code></p><p>3.使用 <code>router.beforeEach</code> 注册一个全局前置守卫：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局前置守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;全局前置守卫&quot;</span>);</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>4.在<code>main.js</code>中引入<code>permission</code>，<code>import &quot;./permission&quot;</code></p><p>5.在<code>permission.js</code>中引入<code>getToken</code>方法以及<code>toast</code>方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&quot;~/composables/auth&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; toast &#125; <span class="keyword">from</span> <span class="string">&quot;~/composables/util&quot;</span></span><br></pre></td></tr></table></figure><p>完整代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;~/router&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&quot;~/composables/auth&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; toast &#125; <span class="keyword">from</span> <span class="string">&quot;~/composables/util&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局前置守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> token = <span class="title function_">getToken</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有登录，强制跳转回登录页</span></span><br><span class="line">    <span class="keyword">if</span>(!token &amp;&amp; to.<span class="property">path</span> != <span class="string">&quot;/login&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">toast</span>(<span class="string">&quot;请先登录&quot;</span>,<span class="string">&quot;error&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">next</span>(&#123; <span class="attr">path</span>:<span class="string">&quot;/login&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 防止重复登录</span></span><br><span class="line">    <span class="keyword">if</span>(token &amp;&amp; to.<span class="property">path</span> == <span class="string">&quot;/login&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">toast</span>(<span class="string">&quot;请勿重复登录&quot;</span>,<span class="string">&quot;error&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">next</span>(&#123; <span class="attr">path</span>:<span class="keyword">from</span>.<span class="property">path</span> ? <span class="keyword">from</span>.<span class="property">path</span> : <span class="string">&quot;/&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="登录功能完善">登录功能完善</h3><blockquote><p><strong>解决刷新后用户信息消失问题</strong></p></blockquote><p>1.将登录界面的<code>getinfo()</code>方法封装到<code>vuex</code>中的<code>actions</code>里面，再在action里面定义一个<code>getinfo()</code>方法，传一个结构后的<code>commit</code>（不要忘了导入<code>getinfo</code>方法哦，<code>import &#123; login,getinfo &#125; from '~/api/manager'</code>）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前登录用户信息</span></span><br><span class="line">  <span class="title function_">getinfo</span>(<span class="params">&#123; commit &#125;</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">getinfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&quot;SET_USERINFO&quot;</span>,res)</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">         &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span><span class="title function_">reject</span>(err))</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>action函数可以接收一个与store实例具有相同方法的属性context，这个属性中包括下面几部分：</p><p>context:{<br>state,   等同于store.$state，若在模块中则为局部状态<br>rootState,   等同于store.$state,只存在模块中<br>commit,   等同于store.$commit<br>dispatch,   等同于store.$dispatch<br>getters   等同于store.$getters<br>}</p><p>常规写法调用的时候会使用context.commit，但更多的是使用es6的变量解构赋值，也就是直接在参数的 位置写自己想要的属性，如：{commit} = context.commit</p></blockquote><p>之后就可以去掉<code>login.vue</code>中导入包里的<code>getinfo</code>方法了，也没必要在<code>login.vue</code>中获取用户相关信息了。</p><p>因此，本系统将获取用户信息放到<code>permission.js</code>中全局前置守卫里：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+    <span class="comment">// 如果用户登录了，自动获取用户信息，并存储在vuex当中</span></span><br><span class="line">+    <span class="keyword">if</span>(token)&#123;</span><br><span class="line">+      <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&quot;getinfo&quot;</span>)</span><br><span class="line">+    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">next</span>()</span><br></pre></td></tr></table></figure><blockquote><p>使用<code>store</code>方法要记得在顶部导入包：<code>import store from &quot;./store&quot;</code></p><p>同时，由于<code>actions</code>是一个异步操作，就需要在<code>store.dispatch()</code>前面加<code>await</code>，还要在<code>***</code>处加入<code>async</code> ，即<code>router.beforeEach(***(to,from,next)</code></p></blockquote><p>2.实现回车登录</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, onMounted, onBeforeUnmount &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听回车事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onKeyUp</span> (e) &#123;</span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">key</span> == <span class="string">&quot;Enter&quot;</span>) <span class="title function_">onSubmit</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加键盘监听</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keyup&quot;</span>, onKeyUp)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 移除键盘监听</span></span><br><span class="line"><span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;keyup&quot;</span>, onKeyUp)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><hr><blockquote><p>登录功能已实现，后续模块未完待续…</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;登录功能&quot;&gt;登录功能&lt;/h3&gt;
&lt;h3 id=&quot;创建Vite项目&quot;&gt;创建Vite项目&lt;/h3&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://cn.vitejs.dev/&quot;&gt;Vite&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Vite是一个web开发构建工具，由于其原生ES模块导</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="Vue" scheme="https://blog.cilicili.xyz/tags/Vue/"/>
    
    <category term="系统设计" scheme="https://blog.cilicili.xyz/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>【前端】实用的JavaScript开发技巧</title>
    <link href="https://blog.cilicili.xyz/posts/3701181b.html"/>
    <id>https://blog.cilicili.xyz/posts/3701181b.html</id>
    <published>2022-07-31T07:18:57.000Z</published>
    <updated>2022-09-09T09:35:25.689Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Number使用技巧">Number使用技巧</h2><h3 id="取整">取整</h3><blockquote><p>代替正数的<code>Math.floor()</code>，代替负数的<code>Math.ceil()</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num1 = ~~<span class="number">3.14</span>;</span><br><span class="line"><span class="keyword">const</span> num2 = <span class="number">3.14</span> | <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> num3 = <span class="number">3.14</span> &gt;&gt; <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num1, num2, num3); <span class="comment">// 3 3 3</span></span><br></pre></td></tr></table></figure><h3 id="补零">补零</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">FillZero</span> = (<span class="params">num, len</span>) =&gt; num.<span class="title function_">toString</span>().<span class="title function_">padStart</span>(len, <span class="string">&quot;0&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> num = <span class="title class_">FillZero</span>(<span class="number">688</span>, <span class="number">5</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// 00688</span></span><br></pre></td></tr></table></figure><h3 id="转数值">转数值</h3><blockquote><p>只对<code>null、&quot;&quot;、false、数值字符串</code>有效</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num1 = +<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> num2 = +<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> num3 = +<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">const</span> num4 = +<span class="string">&quot;688&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num1, num2, num3, num4); <span class="comment">// 0 0 0 688</span></span><br></pre></td></tr></table></figure><h3 id="时间戳">时间戳</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timestamp = +<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2022-06-08&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(timestamp); <span class="comment">// 1654646400000</span></span><br></pre></td></tr></table></figure><h3 id="精确小数">精确小数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">RoundNum</span> = (<span class="params">num, decimal</span>) =&gt;</span><br><span class="line">  <span class="title class_">Math</span>.<span class="title function_">round</span>(num * <span class="number">10</span> ** decimal) / <span class="number">10</span> ** decimal;</span><br><span class="line"><span class="keyword">const</span> num = <span class="title class_">RoundNum</span>(<span class="number">3.14</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// 3.1</span></span><br></pre></td></tr></table></figure><h3 id="判断奇偶">判断奇偶</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">OddEven</span> = (<span class="params">num</span>) =&gt; (!!(num &amp; <span class="number">1</span>) ? <span class="string">&quot;odd&quot;</span> : <span class="string">&quot;even&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> num = <span class="title class_">OddEven</span>(<span class="number">18</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// even</span></span><br></pre></td></tr></table></figure><h3 id="取最小最大值">取最小最大值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>];</span><br><span class="line"><span class="keyword">const</span> min = <span class="title class_">Math</span>.<span class="title function_">min</span>(...arr);</span><br><span class="line"><span class="keyword">const</span> max = <span class="title class_">Math</span>.<span class="title function_">max</span>(...arr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(min, max); <span class="comment">// 11 13</span></span><br></pre></td></tr></table></figure><h3 id="生成范围随机数">生成范围随机数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">RandomNum</span> = (<span class="params">min, max</span>) =&gt;</span><br><span class="line">  <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max - min + <span class="number">1</span>)) + min;</span><br><span class="line"><span class="keyword">const</span> num = <span class="title class_">RandomNum</span>(<span class="number">2</span>, <span class="number">16</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure><h2 id="Boolean-实用技巧">Boolean 实用技巧</h2><h3 id="短路运算符">短路运算符</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 满足条件赋值：取假运算，从左到右依次判断，遇到假值返回假值，后面不再执行，否则返回最后一个真值</span></span><br><span class="line"><span class="keyword">const</span> a = m &amp;&amp; <span class="number">5</span>;</span><br><span class="line"><span class="comment">// 默认赋值：取真运算，从左到右依次判断，遇到真值返回真值，后面不再执行，否则返回最后一个假值</span></span><br><span class="line"><span class="keyword">const</span> b = m || <span class="number">6</span>;</span><br><span class="line"><span class="comment">// 取假赋值：单个表达式转换为true则返回false，否则返回true</span></span><br><span class="line"><span class="keyword">const</span> c = !m;</span><br></pre></td></tr></table></figure><h3 id="判断数据类型">判断数据类型</h3><blockquote><p>**可判断类型：**undefined、null、string、number、boolean、array、object、symbol、date、regexp、function、asyncfunction、arguments、set、map、weakset、weakmap</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">DataType</span>(<span class="params">tgt, type</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dataType = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line">    .<span class="title function_">call</span>(tgt)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/\[object (\w+)\]/</span>, <span class="string">&quot;$1&quot;</span>)</span><br><span class="line">    .<span class="title function_">toLowerCase</span>();</span><br><span class="line">  <span class="keyword">return</span> type ? dataType === type : dataType;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">DataType</span>(<span class="string">&quot;翠花&quot;</span>); <span class="comment">// &quot;string&quot;</span></span><br><span class="line"><span class="title class_">DataType</span>(<span class="number">20220608</span>); <span class="comment">// &quot;number&quot;</span></span><br><span class="line"><span class="title class_">DataType</span>(<span class="literal">true</span>); <span class="comment">// &quot;boolean&quot;</span></span><br><span class="line"><span class="title class_">DataType</span>([], <span class="string">&quot;array&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title class_">DataType</span>(&#123;&#125;, <span class="string">&quot;array&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="是否为空数组">是否为空数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"><span class="keyword">const</span> flag = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr) &amp;&amp; !arr.<span class="property">length</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(flag); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="是否为空对象">是否为空对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> flag = <span class="title class_">DataType</span>(obj, <span class="string">&quot;object&quot;</span>) &amp;&amp; !<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="property">length</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(flag); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="满足条件时执行">满足条件时执行</h3><blockquote><p>如下：Func() 为自己定义的函数</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flagA = <span class="literal">true</span>; <span class="comment">// 条件A</span></span><br><span class="line"><span class="keyword">const</span> flagB = <span class="literal">false</span>; <span class="comment">// 条件B</span></span><br><span class="line">(flagA || flagB) &amp;&amp; <span class="title class_">Func</span>(); <span class="comment">// 满足A或B时执行</span></span><br><span class="line">(flagA || !flagB) &amp;&amp; <span class="title class_">Func</span>(); <span class="comment">// 满足A或不满足B时执行</span></span><br><span class="line">flagA &amp;&amp; flagB &amp;&amp; <span class="title class_">Func</span>(); <span class="comment">// 同时满足A和B时执行</span></span><br><span class="line">flagA &amp;&amp; !flagB &amp;&amp; <span class="title class_">Func</span>(); <span class="comment">// 满足A且不满足B时执行</span></span><br></pre></td></tr></table></figure><h3 id="为非假值时执行">为非假值时执行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flag = <span class="literal">false</span>; <span class="comment">// undefined、null、&quot;&quot;、0、false、NaN</span></span><br><span class="line">!flag &amp;&amp; <span class="title class_">Func</span>();</span><br></pre></td></tr></table></figure><h3 id="数组不为空时执行">数组不为空时执行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line">arr.<span class="property">length</span> &amp;&amp; <span class="title class_">Func</span>();</span><br></pre></td></tr></table></figure><h3 id="对象不为空时执行">对象不为空时执行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">3</span>, <span class="attr">b</span>: <span class="number">5</span>, <span class="attr">c</span>: <span class="number">6</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="property">length</span> &amp;&amp; <span class="title class_">Func</span>();</span><br></pre></td></tr></table></figure><h3 id="函数退出代替条件分支退出">函数退出代替条件分支退出</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">  <span class="title class_">Func</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 换成</span></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Func</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="switch-case-使用区间">switch/case 使用区间</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> age = <span class="number">36</span>;</span><br><span class="line"><span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="built_in">isNaN</span>(age):</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;不是数字类型&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> age &lt; <span class="number">18</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;未成年人&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> age &gt;= <span class="number">18</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;成年人了&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="attr">default</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请输入您的年龄&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="String-实用技巧">String 实用技巧</h2><h3 id="对比时间">对比时间</h3><blockquote><p>时间个位数形式需补 0</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> time1 = <span class="string">&quot;2022-05-01 18:00:01&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> time2 = <span class="string">&quot;2022-09-01 06:23:00&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> overtime = time1 &gt; time2;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(overtime); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="格式化-money-货币">格式化 money 货币</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ThousandNum</span> = (<span class="params">num</span>) =&gt;</span><br><span class="line">  num.<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="regexp">/\B(?=(\d&#123;3&#125;)+(?!\d))/g</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> money = <span class="title class_">ThousandNum</span>(<span class="number">685258980</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(money); <span class="comment">// 685,258,980</span></span><br></pre></td></tr></table></figure><h3 id="生成随机-ID">生成随机 ID</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">RandomId</span> = (<span class="params">len</span>) =&gt; <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">3</span>, len);</span><br><span class="line"><span class="keyword">const</span> id = <span class="title class_">RandomId</span>(<span class="number">11</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(id); <span class="comment">// 输出随机ID way9w9lv2t</span></span><br></pre></td></tr></table></figure><h3 id="生成随机-HEX-色值">生成随机 HEX 色值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">RandomColor</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="string">&quot;&quot;</span> +</span><br><span class="line">  <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">0xffffff</span>)</span><br><span class="line">    .<span class="title function_">toString</span>(<span class="number">16</span>)</span><br><span class="line">    .<span class="title function_">padEnd</span>(<span class="number">6</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> color = <span class="title class_">RandomColor</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(color); <span class="comment">// 输出随机HEX色值 5b73e0</span></span><br></pre></td></tr></table></figure><h3 id="生成星级评分">生成星级评分</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">StartScore</span> = (<span class="params">rate</span>) =&gt; <span class="string">&quot;★★★★★☆☆☆☆☆&quot;</span>.<span class="title function_">slice</span>(<span class="number">5</span> - rate, <span class="number">10</span> - rate);</span><br><span class="line"><span class="keyword">const</span> start = <span class="title class_">StartScore</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> start2 = <span class="title class_">StartScore</span>(<span class="number">5</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(start); <span class="comment">// ★★★☆☆</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(start2); <span class="comment">// ★★★★★</span></span><br></pre></td></tr></table></figure><h3 id="操作-URL-查询参数">操作 URL 查询参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(location.<span class="property">search</span>.<span class="title function_">replace</span>(<span class="regexp">/\?/gi</span>, <span class="string">&quot;&quot;</span>)); <span class="comment">// location.search = &quot;?name=cuihua&amp;sex=male&quot;</span></span><br><span class="line">params.<span class="title function_">has</span>(<span class="string">&quot;cuihua&quot;</span>); <span class="comment">// true</span></span><br><span class="line">params.<span class="title function_">get</span>(<span class="string">&quot;sex&quot;</span>); <span class="comment">// &quot;male&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Object（对象）实用技巧">Object（对象）实用技巧</h2><h3 id="克隆对象">克隆对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _obj = &#123; <span class="attr">a</span>: <span class="number">0</span>, <span class="attr">b</span>: <span class="number">1</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;; <span class="comment">// 以下方法任选一种</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; ..._obj &#125;; <span class="comment">// 方法一</span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(_obj)); <span class="comment">// 方法二</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// &#123;a: 0, b: 1, c: 2&#125;</span></span><br></pre></td></tr></table></figure><h3 id="合并对象">合并对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">0</span>, <span class="attr">b</span>: <span class="number">1</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">d</span>: <span class="number">4</span>, <span class="attr">e</span>: <span class="number">5</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> obj = &#123; ...obj1, ...obj2 &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// &#123;a: 0, b: 1, c: 3, d: 4, e: 5&#125;</span></span><br></pre></td></tr></table></figure><h3 id="对象字面量-（获取环境变量时必用此方法）">对象字面量 （获取环境变量时必用此方法）</h3><blockquote><p>获取环境变量时必用此方法，用它一直爽，一直用它一直爽</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> env = <span class="string">&quot;prod&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> link = &#123;</span><br><span class="line">  <span class="attr">dev</span>: <span class="string">&quot;开发环境地址 ......&quot;</span>,</span><br><span class="line">  <span class="attr">test</span>: <span class="string">&quot;测试环境地址 ......&quot;</span>,</span><br><span class="line">  <span class="attr">prod</span>: <span class="string">&quot;生产环境地址 ......&quot;</span>,</span><br><span class="line">&#125;[env];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(link); <span class="comment">// 输出 生产环境地址 ......</span></span><br></pre></td></tr></table></figure><h3 id="获取对象变量属性">获取对象变量属性</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">  [flag ? <span class="string">&quot;c&quot;</span> : <span class="string">&quot;d&quot;</span>]: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// &#123;a: 0, b: 1, d: 2&#125;</span></span><br></pre></td></tr></table></figure><h3 id="创建纯空对象">创建纯空对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="删除对象无用属性">删除对象无用属性</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">0</span>, <span class="attr">b</span>: <span class="number">1</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;; <span class="comment">// 只想拿b和c</span></span><br><span class="line"><span class="keyword">const</span> &#123; a, ...rest &#125; = obj;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rest); <span class="comment">// &#123;b: 1, c: 2&#125;</span></span><br></pre></td></tr></table></figure><h3 id="解构对象属性嵌套">解构对象属性嵌套</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">0</span>, <span class="attr">b</span>: <span class="number">1</span>, <span class="attr">c</span>: &#123; <span class="attr">d</span>: <span class="number">2</span>, <span class="attr">e</span>: <span class="number">3</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="attr">c</span>: &#123; d, e &#125;,</span><br><span class="line">&#125; = obj;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d, e); <span class="comment">// 2 3</span></span><br></pre></td></tr></table></figure><h3 id="解构对象属性别名">解构对象属性别名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">0</span>, <span class="attr">b</span>: <span class="number">1</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> &#123; a, <span class="attr">b</span>: d, <span class="attr">c</span>: e &#125; = obj;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, d, e); <span class="comment">// 0 1 2</span></span><br></pre></td></tr></table></figure><h3 id="解构对象属性默认值">解构对象属性默认值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">0</span>, <span class="attr">b</span>: <span class="number">1</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> &#123; a, b = <span class="number">2</span>, d = <span class="number">3</span> &#125; = obj;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, d); <span class="comment">// 0 1 3</span></span><br></pre></td></tr></table></figure><h2 id="Function（函数）实用技巧">Function（函数）实用技巧</h2><h3 id="函数自执行（立即执行函数）">函数自执行（立即执行函数）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Func</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)(); <span class="comment">// 常用</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)(); <span class="comment">// 常用</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)(); <span class="comment">// 常用</span></span><br><span class="line">[(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)()];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下方式，我们平时开发时写的少，在一些开源项目中和格式化插件中经常看到，要能理解和知道</span></span><br><span class="line">+(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line">-(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line">~(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line">!(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"><span class="keyword">new</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"><span class="keyword">void</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"><span class="keyword">typeof</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"><span class="keyword">delete</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>, (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"><span class="number">1</span> ^ (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br><span class="line"><span class="number">1</span> &gt; (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)();</span><br></pre></td></tr></table></figure><h3 id="隐式返回值">隐式返回值</h3><blockquote><p>只能用于 <strong>单语句返回值箭头函数</strong> ，如果返回值是对象必须使用 <strong><code>()</code></strong> 包住</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Func</span> = <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 换成</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Func</span> = (<span class="params">name</span>) =&gt; <span class="string">&quot;Hello &quot;</span> + name;</span><br><span class="line"><span class="title class_">Func</span>(<span class="string">&quot;arry老师&quot;</span>); <span class="comment">// &#x27;Hello arry老师&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="一次性函数">一次性函数</h3><blockquote><p>适用于运行一些只需执行一次的初始化代码</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">  <span class="title class_">Func</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="惰性载入函数">惰性载入函数</h3><blockquote><p>函数内判断分支较多较复杂时可大大节约资源开销</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (a === b) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 换成</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (a === b) &#123;</span><br><span class="line">    <span class="title class_">Func</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title class_">Func</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Func</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="检测非空参数">检测非空参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">IsRequired</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;必须要传入参数 ！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params">name = IsRequired()</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello &quot;</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Func</span>(); <span class="comment">// &quot;必须要传入参数 ！&quot;</span></span><br><span class="line"><span class="title class_">Func</span>(<span class="string">&quot;arry老师&quot;</span>); <span class="comment">// Hello arry老师</span></span><br></pre></td></tr></table></figure><h3 id="字符串创建函数">字符串创建函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Func</span> = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&#x27;console.log(&quot;Hello &quot; + name)&#x27;</span>);</span><br><span class="line"><span class="title class_">Func</span>(<span class="string">&quot;arry老师&quot;</span>); <span class="comment">// Hello arry老师</span></span><br></pre></td></tr></table></figure><h3 id="优雅处理错误信息">优雅处理错误信息</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="title class_">Func</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  location.<span class="property">href</span> = <span class="string">&quot;https://stackoverflow.com/search?q=[js]+&quot;</span> + e.<span class="property">message</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="优雅处理-Async-Await-参数">优雅处理 Async/Await 参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AsyncTo</span>(<span class="params">promise</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> promise.<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> [<span class="literal">null</span>, data]).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> [err]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [err, res] = <span class="keyword">await</span> <span class="title class_">AsyncTo</span>(<span class="title class_">Func</span>());</span><br></pre></td></tr></table></figure><h3 id="优雅处理多个函数返回值">优雅处理多个函数返回值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">fetch</span>(<span class="string">&quot;/user&quot;</span>), <span class="title function_">fetch</span>(<span class="string">&quot;/comment&quot;</span>)]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [user, comment] = <span class="keyword">await</span> <span class="title class_">Func</span>(); <span class="comment">// 需在async包围下使用</span></span><br></pre></td></tr></table></figure><h2 id="Array（数组）实用技巧">Array（数组）实用技巧</h2><h3 id="克隆数组">克隆数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [..._arr];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 1, 2]</span></span><br></pre></td></tr></table></figure><h3 id="合并数组">合并数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> arr = [...arr1, ...arr2];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 1, 2, 3, 4, 5];</span></span><br></pre></td></tr></table></figure><h3 id="去重数组">去重数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [...<span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="literal">null</span>, <span class="literal">null</span>])];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 1, null]</span></span><br></pre></td></tr></table></figure><h3 id="混淆数组">混淆数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].<span class="title function_">slice</span>().<span class="title function_">sort</span>(<span class="function">() =&gt;</span> <span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [3, 4, 0, 5, 1, 2]</span></span><br></pre></td></tr></table></figure><h3 id="清空数组">清空数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="property">length</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// []</span></span><br></pre></td></tr></table></figure><h3 id="截断数组">截断数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="property">length</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 1]</span></span><br></pre></td></tr></table></figure><h3 id="交换赋值">交换赋值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">1</span>;</span><br><span class="line">[a, b] = [b, a];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b); <span class="comment">// 1 0</span></span><br></pre></td></tr></table></figure><h3 id="过滤空值">过滤空值</h3><blockquote><p>空值：undefined、null、“”、0、false、NaN</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="literal">undefined</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>, <span class="number">0</span>, <span class="literal">false</span>, <span class="title class_">NaN</span>, <span class="number">1</span>, <span class="number">2</span>].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure><h3 id="异步累计">异步累计</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params">deps</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> deps.<span class="title function_">reduce</span>(<span class="keyword">async</span> (t, v) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> dep = <span class="keyword">await</span> t;</span><br><span class="line">    <span class="keyword">const</span> version = <span class="keyword">await</span> <span class="title class_">Todo</span>(v);</span><br><span class="line">    dep[v] = version;</span><br><span class="line">    <span class="keyword">return</span> dep;</span><br><span class="line">  &#125;, <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;&#125;));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title class_">Func</span>(); <span class="comment">// 需在async包围下使用</span></span><br></pre></td></tr></table></figure><h3 id="数组首部插入成员">数组首部插入成员</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>]; <span class="comment">// 以下方法任选一种</span></span><br><span class="line">arr.<span class="title function_">unshift</span>(<span class="number">0</span>); <span class="comment">// [0, 1, 2]</span></span><br><span class="line">arr = [<span class="number">0</span>].<span class="title function_">concat</span>(arr); <span class="comment">// [0, 1, 2]</span></span><br><span class="line">arr = [<span class="number">0</span>, ...arr]; <span class="comment">// [0, 1, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 1, 2]</span></span><br></pre></td></tr></table></figure><h3 id="数组尾部插入成员">数组尾部插入成员</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">0</span>, <span class="number">1</span>]; <span class="comment">// 以下方法任选一种</span></span><br><span class="line">arr.<span class="title function_">push</span>(<span class="number">2</span>);</span><br><span class="line">arr.<span class="title function_">concat</span>(<span class="number">2</span>);</span><br><span class="line">arr[arr.<span class="property">length</span>] = <span class="number">2</span>;</span><br><span class="line">arr = [...arr, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 1, 2]</span></span><br></pre></td></tr></table></figure><h3 id="统计数组成员个数">统计数组成员个数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> count = arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">t, v</span>) =&gt;</span> &#123;</span><br><span class="line">  t[v] = t[v] ? ++t[v] : <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">&#125;, &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">// &#123; 0: 1, 1: 2, 2: 3 &#125;</span></span><br></pre></td></tr></table></figure><h3 id="解构数组成员嵌套">解构数组成员嵌套</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>]]];</span><br><span class="line"><span class="keyword">const</span> [a, b, [c, d, [e, f]]] = arr;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c, d, e, f); <span class="comment">// 0 1 2 3 4 5</span></span><br></pre></td></tr></table></figure><h3 id="解构数组成员别名">解构数组成员别名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="number">0</span>: a, <span class="number">1</span>: b, <span class="number">2</span>: c &#125; = arr;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c); <span class="comment">// 0 1 2</span></span><br></pre></td></tr></table></figure><h3 id="解构数组成员默认值">解构数组成员默认值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> [a, b, c = <span class="number">3</span>, d = <span class="number">4</span>] = arr;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c, d); <span class="comment">// 0 1 2 4</span></span><br></pre></td></tr></table></figure><h3 id="获取随机数组成员">获取随机数组成员</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> randomItem = arr[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * arr.<span class="property">length</span>)];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(randomItem); <span class="comment">// 输出随机数</span></span><br></pre></td></tr></table></figure><h3 id="创建指定长度数组">创建指定长度数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [...<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">3</span>).<span class="title function_">keys</span>()];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 1, 2]</span></span><br></pre></td></tr></table></figure><h3 id="创建指定长度且值相等的数组">创建指定长度且值相等的数组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">3</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// [0, 0, 0]</span></span><br></pre></td></tr></table></figure><h3 id="reduce-代替-map-和-filter">reduce 代替 map 和 filter</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// map</span></span><br><span class="line"><span class="keyword">const</span> arr = _arr.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v * <span class="number">2</span>); <span class="comment">// [0, 2, 4]</span></span><br><span class="line"><span class="keyword">const</span> arr = _arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">t, v</span>) =&gt;</span> &#123;</span><br><span class="line">  t.<span class="title function_">push</span>(v * <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">&#125;, []);</span><br><span class="line"><span class="comment">// [0, 2, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// filter</span></span><br><span class="line"><span class="keyword">const</span> arr = _arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v &gt; <span class="number">0</span>); <span class="comment">// [1, 2]</span></span><br><span class="line"><span class="keyword">const</span> arr = _arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">t, v</span>) =&gt;</span> &#123;</span><br><span class="line">  v &gt; <span class="number">0</span> &amp;&amp; t.<span class="title function_">push</span>(v);</span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">&#125;, []);</span><br><span class="line"><span class="comment">// [1, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// map 和 filter</span></span><br><span class="line"><span class="keyword">const</span> arr = _arr.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v * <span class="number">2</span>).<span class="title function_">filter</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v &gt; <span class="number">2</span>); <span class="comment">// [4]</span></span><br><span class="line"><span class="keyword">const</span> arr = _arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">t, v</span>) =&gt;</span> &#123;</span><br><span class="line">  v = v * <span class="number">2</span>;</span><br><span class="line">  v &gt; <span class="number">2</span> &amp;&amp; t.<span class="title function_">push</span>(v);</span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">&#125;, []);</span><br><span class="line"><span class="comment">// [4]</span></span><br></pre></td></tr></table></figure><h2 id="DOM-实用技巧">DOM 实用技巧</h2><h3 id="显示全部-DOM-边框">显示全部 DOM 边框</h3><blockquote><p>调试页面元素边界时使用</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[].<span class="property">forEach</span>.<span class="title function_">call</span>($$(<span class="string">&quot;*&quot;</span>), <span class="function">(<span class="params">dom</span>) =&gt;</span> &#123;</span><br><span class="line">  dom.<span class="property">style</span>.<span class="property">outline</span> =</span><br><span class="line">    <span class="string">&quot;1px solid &quot;</span> + (~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (<span class="number">1</span> &lt;&lt; <span class="number">24</span>))).<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="自适应页面">自适应页面</h3><blockquote><p>页面基于一张设计图但需做多款机型自适应，元素尺寸使用<code>rem</code>进行设置</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AutoResponse</span>(<span class="params">width = <span class="number">750</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> target = <span class="variable language_">document</span>.<span class="property">documentElement</span>;</span><br><span class="line">  target.<span class="property">clientWidth</span> &gt;= <span class="number">600</span></span><br><span class="line">    ? (target.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&quot;80px&quot;</span>)</span><br><span class="line">    : (target.<span class="property">style</span>.<span class="property">fontSize</span> = (target.<span class="property">clientWidth</span> / width) * <span class="number">100</span> + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤-XSS">过滤 XSS</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">FilterXss</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> elem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  elem.<span class="property">innerText</span> = content;</span><br><span class="line">  <span class="keyword">const</span> result = elem.<span class="property">innerHTML</span>;</span><br><span class="line">  elem = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="存取-LocalStorage">存取 LocalStorage</h3><blockquote><p>反序列化取，序列化存</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> love = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;icoding&quot;</span>));</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;icoding&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&quot;I&#x27;m writing code&quot;</span>));</span><br></pre></td></tr></table></figure><hr><blockquote><p>本篇文章均转载自arry老师的<a href="https://www.arryblog.com/interview/htmlcss/html-html5.html#%E9%AB%98%E9%A2%91%E9%87%8D%E7%82%B9">教程</a>，仅供本人学习使用。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Number使用技巧&quot;&gt;Number使用技巧&lt;/h2&gt;
&lt;h3 id=&quot;取整&quot;&gt;取整&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;代替正数的&lt;code&gt;Math.floor()&lt;/code&gt;，代替负数的&lt;code&gt;Math.ceil()&lt;/code&gt;&lt;/p&gt;
&lt;/b</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="JavaScript" scheme="https://blog.cilicili.xyz/tags/JavaScript/"/>
    
    <category term="技巧" scheme="https://blog.cilicili.xyz/tags/%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>【前端】JavaScript核心基础和常用方法</title>
    <link href="https://blog.cilicili.xyz/posts/ab522f5f.html"/>
    <id>https://blog.cilicili.xyz/posts/ab522f5f.html</id>
    <published>2022-07-31T06:44:07.000Z</published>
    <updated>2022-09-09T09:35:36.193Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Js核心基础">Js核心基础</h2><h3 id="字符串的常用方法">字符串的常用方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">charAt()</td><td style="text-align:left">获取指定位置的字符</td></tr><tr><td style="text-align:left">substring()</td><td style="text-align:left">提取字符串中，介于两个指定下标之间的字符</td></tr><tr><td style="text-align:left">substr()</td><td style="text-align:left">在字符串中指定的位置处，提取指定数目的字符</td></tr><tr><td style="text-align:left">slice()</td><td style="text-align:left"><strong>提取字符串的某个部分，类似于 substring() ，不同之处：</strong> 1、substring() 可以自动交换参数的位置，而 slice()不行 2、slice()的第一个参数可以是负数，而 substring()不行</td></tr><tr><td style="text-align:left">toUpperCase()</td><td style="text-align:left">把字符串转换为大写</td></tr><tr><td style="text-align:left">toLowerCase()</td><td style="text-align:left">把字符串转换为小写</td></tr><tr><td style="text-align:left">indexOf</td><td style="text-align:left">返回字符串中指定字符首次出现的索引</td></tr></tbody></table><h3 id="数据类型转换">数据类型转换</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">Number()</td><td style="text-align:left">将其他类型的值转换为数字</td></tr><tr><td style="text-align:left">parseInt()</td><td style="text-align:left">可以将参数转成整数</td></tr><tr><td style="text-align:left">parseFloat()</td><td style="text-align:left">可以将参数转成浮点数</td></tr><tr><td style="text-align:left">String()</td><td style="text-align:left">将其他类型的值转换成字符串 例如：String(123)</td></tr><tr><td style="text-align:left">toString()</td><td style="text-align:left"><strong>将其他类型的值转换成字符串 ，例如：(5).toString() 和 String()的区别：</strong> 1、toString()无法转换 null 和 undefined，String()可以转换 null 和 undefined 2、toString()可增加进制参数，将字符串进行进制转换，String()不能转换进制 3、写法不同，可参考上述例子</td></tr><tr><td style="text-align:left">Boolean()</td><td style="text-align:left">将其他类型的值转换为布尔值</td></tr></tbody></table><h3 id="Window下的方法">Window下的方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">prompt()</td><td style="text-align:left">弹出输入框</td></tr></tbody></table><h3 id="Number下的方法">Number下的方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">toFixed()</td><td style="text-align:left">指定小数点后面的位数</td></tr></tbody></table><h3 id="Math方法">Math方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">Math.pow(x,y)</td><td style="text-align:left">返回 x 的 y 次幂（不常用，了解即可）</td></tr><tr><td style="text-align:left">Math.sqrt()</td><td style="text-align:left">返回一个数的平方根（不常用，了解即可）</td></tr><tr><td style="text-align:left">Math.ceil()</td><td style="text-align:left">向上取整</td></tr><tr><td style="text-align:left">Math.floor()</td><td style="text-align:left">向下取整</td></tr></tbody></table><h3 id="数组的定义">数组的定义</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">Array</td><td style="text-align:left">数组， 用来存储一组值</td></tr><tr><td style="text-align:left">new</td><td style="text-align:left"><strong>与 Array 结合使用，创建数组</strong>，示例：new Array()</td></tr></tbody></table><h3 id="数组的常用方法">数组的常用方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">push()</td><td style="text-align:left">在尾部插入新项</td></tr><tr><td style="text-align:left">pop()</td><td style="text-align:left">删除数组的最后一项</td></tr><tr><td style="text-align:left">unshift()</td><td style="text-align:left">在头部插入新项</td></tr><tr><td style="text-align:left">shift()</td><td style="text-align:left">删除数组的第一项</td></tr><tr><td style="text-align:left">splice()</td><td style="text-align:left">用于添加或删除数组的元素</td></tr><tr><td style="text-align:left">slice()</td><td style="text-align:left">从已有的数组中返回选定的元素</td></tr><tr><td style="text-align:left">concat()</td><td style="text-align:left">合并多个数组</td></tr><tr><td style="text-align:left">reverse()</td><td style="text-align:left">颠倒数组中元素的顺序</td></tr><tr><td style="text-align:left">indexOf()</td><td style="text-align:left">返回指定元素的索引值，如果不存在返回-1</td></tr><tr><td style="text-align:left">includes()</td><td style="text-align:left">判断一个数组是否包含指定的值，返回布尔值</td></tr><tr><td style="text-align:left">sort()</td><td style="text-align:left">用于数组排序（涉及到函数知识，在函数一节再进行详细的讲解）</td></tr><tr><td style="text-align:left">join()</td><td style="text-align:left">将数组转成字符串</td></tr></tbody></table><h3 id="字符串的常用方法-v2">字符串的常用方法</h3><table><thead><tr><th style="text-align:left">方法名</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">split()</td><td style="text-align:left">将字符串转成数组</td></tr></tbody></table><h2 id="JavaScript函数、BOM-and-DOM">JavaScript函数、BOM and DOM</h2><h3 id="函数的定义、参数和返回值">函数的定义、参数和返回值</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">function</td><td style="text-align:left"><strong>定义函数。有如下两种方式：</strong> 1、function 函数名() {}; 这种声明方式，预解析阶段函数会提升 2、var 函数名 = function() {}; 这种声明方式，预解析阶段只会提升函数名，后面的函数体 function() {}不会提升 3、函数调用是在函数名后面添加括号， 示例： fn()表示调用函数 fn</td></tr><tr><td style="text-align:left">arguments</td><td style="text-align:left">接收传入函数的实参列表，是一个类数组对象（与数组类似，拥有 length 属性，可以通过下标访问某个值，但是不可以使用数组的方法） 1、形参：定义函数时设置的参数 2、实参：调用函数时传入的参数</td></tr><tr><td style="text-align:left">return</td><td style="text-align:left">设置函数的返回值，调用函数时，遇到 return 语句会立即退出函数，并设置函数的返回值</td></tr></tbody></table><h3 id="闭包和立即执行函数">闭包和立即执行函数</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">closure</td><td style="text-align:left"><strong>函数本身和该函数声明时所处的环境状态的组合，简单理解就是闭包可以在一个内层函数中访问到其外层函数的作用域。</strong> 示例：下面这段代码中的 f2 函数，就是闭包，可以访问到外层函数 f1 作用域的中变量 n 的值 function f1() { var n = 888; function f2() { alert(n); } return f2; } var result = f1(); result(); // 888</td></tr><tr><td style="text-align:left">IIFE</td><td style="text-align:left">Immediately Invoked Function Expression 的首字母缩写，立即调用函数表达式，是一种特殊的 JavaScript 函数写法，一旦被定义，就立即被调用。示例： (function () { //函数体 })();</td></tr></tbody></table><h3 id="DOM的基本概念">DOM的基本概念</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">DOM</td><td style="text-align:left">文档对象模型(Document Object Model)，是 JavaScript 操作 HTML 文档的接口，它最大的特点就是将文档表示为节点树。</td></tr><tr><td style="text-align:left">document</td><td style="text-align:left">document 对象表示整个 HTML 文档，它是 DOM 节点树的根</td></tr></tbody></table><h3 id="节点类型">节点类型</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">nodeType</td><td style="text-align:left">返回节点的类型（不常用，了解即可） 常见的返回值如下： ①nodeType 属性返回 1，表示节点是一个元素节点  ②nodeType 属性返回 3，表示节点是一个文本节点  ③nodeType 属性返回 8，表示节点是一个注释节点 ④nodeType 属性返回 9，表示节点是 document 节点 ⑤nodeType 属性返回 10，表示节点是 DTD 节点</td></tr></tbody></table><h3 id="节点的关系">节点的关系</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">firstChild</td><td style="text-align:left">返回第一个子节点，包括文本节点、注释节点和元素节点等所有类型的节点</td></tr><tr><td style="text-align:left">firstElementChild</td><td style="text-align:left">返回第一个子元素节点</td></tr><tr><td style="text-align:left">lastChild</td><td style="text-align:left">返回最后一个子节点，包括文本节点、注释节点和元素节点等所有类型的节点</td></tr><tr><td style="text-align:left">lastElementChild</td><td style="text-align:left">返回最后一个子元素节点</td></tr><tr><td style="text-align:left">childNodes</td><td style="text-align:left">返回所有的子节点， 包括文本节点、注释节点和元素节点等所有类型的节点（不常用，了解即可）</td></tr><tr><td style="text-align:left">children</td><td style="text-align:left">返回所有的子元素节点</td></tr><tr><td style="text-align:left">parentNode</td><td style="text-align:left">返回父元素节点</td></tr><tr><td style="text-align:left">previousSibling</td><td style="text-align:left">返回前一个兄弟节点，包括文本节点、注释节点和元素节点等所有类型的节点（不常用，了解即可）</td></tr><tr><td style="text-align:left">previousElementSibling</td><td style="text-align:left">返回前一个兄弟元素节点（不常用，了解即可）</td></tr><tr><td style="text-align:left">nextSibling</td><td style="text-align:left">返回同级的后一个节点，包括文本节点、注释节点和元素节点等所有类型的节点（不常用，了解即可）</td></tr><tr><td style="text-align:left">nextElementSibling</td><td style="text-align:left">返回同级的后一个元素节点（不常用，了解即可）</td></tr></tbody></table><h3 id="访问元素节点常用的方法">访问元素节点常用的方法</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">document.getElementById()</td><td style="text-align:left">通过 id 获取元素，返回一个 dom 对象 例如：document.getElementById(““demo””);获取 id 属性值为 demo 的元素</td></tr><tr><td style="text-align:left">document.getElementsByTagName()</td><td style="text-align:left">通过标签名获取元素，以集合的形式返回 例如：document.getElementsByTagName(““p””); 获取所有的 p 标签元素</td></tr><tr><td style="text-align:left">document.getElementsByClassName()</td><td style="text-align:left">通过类名获取元素，以集合的形式返回 例如：document.getElementsByClassName(““box””);获取所有类名为 box 的元素</td></tr><tr><td style="text-align:left">document.querySelector()</td><td style="text-align:left">通过 css 选择器获取第一个符合条件的元素，返回一个 DOM 元素 例如：document.querySelector(“”.item&quot;&quot;) 获取类名为 item 的第一个元素</td></tr><tr><td style="text-align:left">document.querySelectorAll()</td><td style="text-align:left">通过 css 选择器获取所有的元素，以集合的形式返回 例如：document.querySelectorAll(“”.item&quot;&quot;) 获取类名为 item 所有的元素</td></tr></tbody></table><h3 id="节点的创建、添加、移出和克隆">节点的创建、添加、移出和克隆</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">document.createElement()</td><td style="text-align:left">创建一个指定标签名的 HTML 元素</td></tr><tr><td style="text-align:left">appendChild()</td><td style="text-align:left">将一个节点作为最后一个子节点添加到指定的父节点</td></tr><tr><td style="text-align:left">removeChild()</td><td style="text-align:left">删除指定的子节点</td></tr><tr><td style="text-align:left">insertBefore()</td><td style="text-align:left">在已有的子节点前插入一个新的子节点</td></tr><tr><td style="text-align:left">cloneNode()</td><td style="text-align:left">克隆节点 如果传递给它的参数是 true，则该节点的所有后代节点也都会被克隆。如果为 false，则只克隆节点本身</td></tr></tbody></table><h3 id="节点的操作">节点的操作</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">innerText</td><td style="text-align:left">以纯文本的形式设置或者获取元素的文本内容（不常用，了解即可）</td></tr><tr><td style="text-align:left">className</td><td style="text-align:left">元素节点的一个属性，用来设置或返回元素的 class 属性值 示例：oBox.className = “active”</td></tr><tr><td style="text-align:left">style</td><td style="text-align:left">元素节点的一个属性，用来设置元素节点的 css 样式 例如：box.style.color=““red”” 改变 box 元素节点的字体为红色</td></tr><tr><td style="text-align:left">src</td><td style="text-align:left">元素节点的一个属性，用来设置元素节点 src 属性值 例如： oImg.src=“./images/2.jpg”</td></tr><tr><td style="text-align:left">href</td><td style="text-align:left">元素节点的一个属性，用来设置元素节点 href 属性值 例如： oLink.href=“<a href="http://www.baidu.com">http://www.baidu.com</a>”</td></tr><tr><td style="text-align:left">setAttribute()</td><td style="text-align:left">给元素节点设置指定的属性，并为其赋指定的值 例如：oBox.setArrtibute(‘data-n’, 10)</td></tr><tr><td style="text-align:left">getAttribute()</td><td style="text-align:left">获取元素节点指定的属性值 例如：oBox.getArrtibute(‘data-n’)</td></tr><tr><td style="text-align:left">dataset</td><td style="text-align:left">元素节点的一个属性，用来设置或返回元素以 data-*方式自定义的属性</td></tr></tbody></table><h3 id="常见的鼠标事件">常见的鼠标事件</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">onclick</td><td style="text-align:left">监听鼠标单击事件</td></tr><tr><td style="text-align:left">ondblclick</td><td style="text-align:left">监听鼠标双击事件</td></tr><tr><td style="text-align:left">onmousedown</td><td style="text-align:left">监听鼠标按下事件</td></tr><tr><td style="text-align:left">onmouseup</td><td style="text-align:left">监听鼠标松开事件</td></tr><tr><td style="text-align:left">onmousemove</td><td style="text-align:left">监听鼠标移动事件</td></tr><tr><td style="text-align:left">onmouseenter</td><td style="text-align:left">监听鼠标移入事件，不存在事件冒泡</td></tr><tr><td style="text-align:left">onmouseleave</td><td style="text-align:left">监听鼠标离开事件，不存在事件冒泡</td></tr><tr><td style="text-align:left">onmouseover</td><td style="text-align:left">监听鼠标移入事件，存在事件冒泡</td></tr><tr><td style="text-align:left">onmouseout</td><td style="text-align:left">监听鼠标离开事件，存在事件冒泡</td></tr><tr><td style="text-align:left">onmousewheel</td><td style="text-align:left">监听鼠标滚轮事件（不常用，了解即可）</td></tr></tbody></table><h3 id="常见的键盘事件">常见的键盘事件</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">onkeydown</td><td style="text-align:left">监听某个键盘按键被按下，可以监听上下左右箭头等系统按键</td></tr><tr><td style="text-align:left">onkeypress</td><td style="text-align:left">监听某个键盘按键被按下，无法监听到系统按键</td></tr><tr><td style="text-align:left">onkeyup</td><td style="text-align:left">监听某个键盘按键被松开，可以监听上下左右箭头等系统按键</td></tr></tbody></table><h3 id="常见的表单事件">常见的表单事件</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">onchange</td><td style="text-align:left">当表单元素的内容发生变化所触发的事件</td></tr><tr><td style="text-align:left">onfocus</td><td style="text-align:left">当元素获得焦点时触发的事件，例如：tab 键或者点击鼠标</td></tr><tr><td style="text-align:left">onblur</td><td style="text-align:left">当元素失去焦点时触发的事件</td></tr><tr><td style="text-align:left">onsubmit</td><td style="text-align:left">当提交表单时触发的事件</td></tr><tr><td style="text-align:left">onreset</td><td style="text-align:left">当重置表单时触发的事件</td></tr></tbody></table><h3 id="常见的页面监听事件">常见的页面监听事件</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">onload</td><td style="text-align:left">监听页面或图像加载完成事件</td></tr><tr><td style="text-align:left">onunload</td><td style="text-align:left">监听用户退出页面事件（不常用，了解即可）</td></tr></tbody></table><h3 id="DOM-2-级事件监听">DOM 2 级事件监听</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">addEventListener()</td><td style="text-align:left">监听事件并添加到指定的元素 1、方法中接收三个参数如下： （1）第一个参数是字符串，表示要监听的事件名，必须传入 （2）第二个参数是函数，指定事件触发时要执行的函数，必须传入 （3）第二个参数是布尔值，指定事件是否在捕获或冒泡阶段执行，可选 2、示例：oBox.addEventListener(‘click’, function() {}, true) 在捕获阶段监听 oBox 的点击事件</td></tr></tbody></table><h3 id="事件的传播">事件的传播</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">capturing phase</td><td style="text-align:left">捕获阶段，由外向内传播的，也就是当前事件触发时，先触发当前元素的最外层的祖先元素的同类型事件，然后再向内传播给后代元素</td></tr><tr><td style="text-align:left">Bubbling phase</td><td style="text-align:left">冒泡阶段，由内向外传播，也就是当事件触发时，先触发当前元素上的事件，然后再向当前元素的祖先元素上传播，触发祖先元素的同类型事件</td></tr></tbody></table><h3 id="事件对象">事件对象</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">event</td><td style="text-align:left">返回事件的状态</td></tr></tbody></table><h3 id="事件对象常用的属性">事件对象常用的属性</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">target</td><td style="text-align:left">返回当前触发事件的元素</td></tr><tr><td style="text-align:left">currentTarget</td><td style="text-align:left">返回监听事件的元素</td></tr><tr><td style="text-align:left">clientX</td><td style="text-align:left">返回鼠标指针相对于浏览器的水平坐标</td></tr><tr><td style="text-align:left">clientY</td><td style="text-align:left">返回鼠标指针相对于浏览器的垂直坐标</td></tr><tr><td style="text-align:left">pageX</td><td style="text-align:left">返回鼠标指针相对于整个网页的水平坐标</td></tr><tr><td style="text-align:left">pageY</td><td style="text-align:left">返回鼠标指针相对于整个网页的垂直坐标</td></tr><tr><td style="text-align:left">offsetX</td><td style="text-align:left">返回鼠标指针相对于事件源元素的水平坐标</td></tr><tr><td style="text-align:left">offsetY</td><td style="text-align:left">返回鼠标指针相对于事件源元素的垂直坐标</td></tr><tr><td style="text-align:left">charCode</td><td style="text-align:left">通常用于 onkeypress 事件，返回用户按下按键对应的码值，区分大小写 示例：按下键盘 a，对应的值是 97， 按下键盘 A，对应的值是 65</td></tr><tr><td style="text-align:left">keyCode</td><td style="text-align:left">通常用于 onkeydown 和 onkeyup 事件，返回用户按下按键的码值，不区分大小写。 示例：按下键盘 a 或 A， 对应的值是 65</td></tr><tr><td style="text-align:left">deltaY</td><td style="text-align:left">返回 onmousewheel 事件触发时，滚轮滚动的方向，向下滚动时返回正值，向上滚动时，返回负值（不常用，了解即可）</td></tr></tbody></table><h3 id="事件对象常用的方法">事件对象常用的方法</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">preventDefault()</td><td style="text-align:left">阻止浏览器默认行为</td></tr><tr><td style="text-align:left">stopPropagation()</td><td style="text-align:left">阻止事件传播</td></tr></tbody></table><h3 id="定时器和延时器">定时器和延时器</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">setInterval()</td><td style="text-align:left">定时器，重复调用一个函数，在每次调用之间具有固定的时间间隔</td></tr><tr><td style="text-align:left">clearInterval()</td><td style="text-align:left">清除定时器</td></tr><tr><td style="text-align:left">setTimeout()</td><td style="text-align:left">延时器，当指定时间到了之后，会执行一次函数，不再重复执行</td></tr><tr><td style="text-align:left">clearTimeout()</td><td style="text-align:left">清除延时器</td></tr></tbody></table><h3 id="BOM-相关的基本概念">BOM 相关的基本概念</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">BOM</td><td style="text-align:left">浏览器对象模型（Browser Object Model），是 js 与浏览器窗口交互的接口</td></tr><tr><td style="text-align:left">window</td><td style="text-align:left">window 对象表示浏览器中打开的窗口，注意事项： 1、这个窗口中包含 DOM 结构，window.document 属性就表示 document 对象 2、全局变量会成为 window 对象的属性 3、内置函数普遍是 window 的方法，如：alert()等方法</td></tr><tr><td style="text-align:left">navigator</td><td style="text-align:left">navigator 对象含有关浏览器的信息，是 window 对象的一部分，可通过 window.history 属性对其进行访问</td></tr><tr><td style="text-align:left">history</td><td style="text-align:left">history 对象包含用户（在浏览器窗口中）访问过的 URL，是 window 对象的一部分，可通过 window.history 属性对其进行访问</td></tr><tr><td style="text-align:left">location</td><td style="text-align:left">location 对象包含有关当前 URL 的信息，是 Window 对象的一个部分，可通过 window.location 属性来访问</td></tr></tbody></table><h3 id="Window-对象的常用属性">Window 对象的常用属性</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">innerHeight</td><td style="text-align:left">返回浏览器窗口的内容区域的高度，包含水平滚动条的高度</td></tr><tr><td style="text-align:left">innerWidth</td><td style="text-align:left">返回浏览器窗口的内容区域的宽度，包含垂直滚动条的宽度</td></tr><tr><td style="text-align:left">document.documentElement.clientWidth</td><td style="text-align:left">返回浏览器窗口的内容区域的宽度，不包含滚动条</td></tr><tr><td style="text-align:left">outerHeight</td><td style="text-align:left">返回浏览器窗口的外部高度，包含水平滚动条的高度和浏览器窗口上下边框的高度（不常用，了解即可）</td></tr><tr><td style="text-align:left">outerWidth</td><td style="text-align:left">返回浏览器窗口的内容高度，包含垂直滚动条的宽度和浏览器窗口左右边框的宽度（不常用，了解即可）</td></tr><tr><td style="text-align:left">scrollY</td><td style="text-align:left">返回文档当前垂直滚动的距离</td></tr><tr><td style="text-align:left">document.documentElement.scrollTop</td><td style="text-align:left">要获取当前页面的滚动条纵坐标位置</td></tr></tbody></table><h3 id="Window-对象的常用事件">Window 对象的常用事件</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">onresize</td><td style="text-align:left">监听窗口改变大小事件</td></tr><tr><td style="text-align:left">onscroll</td><td style="text-align:left">监听窗口滚动事件</td></tr></tbody></table><h3 id="navigator-对象的常用属性">navigator 对象的常用属性</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">appName</td><td style="text-align:left">返回浏览器官网名称</td></tr><tr><td style="text-align:left">appVersion</td><td style="text-align:left">返回浏览器版本</td></tr><tr><td style="text-align:left">userAgent</td><td style="text-align:left">返回浏览器的用户代理信息</td></tr><tr><td style="text-align:left">platform</td><td style="text-align:left">返回用户操作系统</td></tr></tbody></table><h3 id="history-对象的常用方法">history 对象的常用方法</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">back()</td><td style="text-align:left">表示回退到浏览器历史记录里的上一页，等同于点击浏览器回退按钮</td></tr><tr><td style="text-align:left">go(-1)</td><td style="text-align:left">与 history()方法的作用一样</td></tr></tbody></table><h3 id="location-对象的常用属性和方法">location 对象的常用属性和方法</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">href</td><td style="text-align:left">设置或返回完整的 URL 地址</td></tr><tr><td style="text-align:left">search</td><td style="text-align:left">设置或返回从问号 (?) 开始的 URL（查询部分）</td></tr><tr><td style="text-align:left">reload()</td><td style="text-align:left">重新加载当前页面</td></tr></tbody></table><h2 id="JavaScript-常用内置对象和正则表达式">JavaScript 常用内置对象和正则表达式</h2><h3 id="对象的基本操作">对象的基本操作</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">delete</td><td style="text-align:left">**操作符。**删除对象的属性</td></tr><tr><td style="text-align:left">for…in</td><td style="text-align:left">**对象的遍历。**for…in 循环用来遍历对象，例如： for (var k in obj) { console.log(“对象 obj 的属性” + k + “的值是” + obj[k]); }</td></tr><tr><td style="text-align:left">call/apply</td><td style="text-align:left">**指定函数的上下文。**call/apply 可以指定函数的上下文，两者区别：传参形式不同，例如： fn.call(xiaoming,1,2) fn.apply(xiaoming,[1,2])</td></tr><tr><td style="text-align:left">prototype</td><td style="text-align:left">**原型。**prototype 是原型的意思，它是函数自带的属性</td></tr><tr><td style="text-align:left">hasOwnProperty()</td><td style="text-align:left">**对象上的方法。**检测某个属性是否为对象自身的属性（不包含继承）</td></tr><tr><td style="text-align:left">in</td><td style="text-align:left">**运算符。**某个属性或方法是否可以被对象调用</td></tr></tbody></table><h3 id="Math-对象的常用方法">Math 对象的常用方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">Math.round()</td><td style="text-align:left">可以将一个数字四舍五入为整数</td></tr><tr><td style="text-align:left">Math.max()</td><td style="text-align:left">取一组数中的最大值</td></tr><tr><td style="text-align:left">Math.min()</td><td style="text-align:left">取一组数中的最小值</td></tr><tr><td style="text-align:left">Math.random()</td><td style="text-align:left">0-1 之间的随机数（包含 0，不包含 1）</td></tr></tbody></table><h3 id="Date-对象的常用方法">Date 对象的常用方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">new Date()</td><td style="text-align:left">当前时间的日期对象</td></tr><tr><td style="text-align:left">getDate()</td><td style="text-align:left">返回一个月中的某一天 (1 ~ 31)</td></tr><tr><td style="text-align:left">getDay()</td><td style="text-align:left">返回一周中的某一天 (0 ~ 6)</td></tr><tr><td style="text-align:left">getMonth()</td><td style="text-align:left">返回月份 (0 ~ 11)</td></tr><tr><td style="text-align:left">getFullYear()</td><td style="text-align:left">返回年份</td></tr><tr><td style="text-align:left">getHours()</td><td style="text-align:left">返回小时 (0 ~ 23)</td></tr><tr><td style="text-align:left">getMinutes()</td><td style="text-align:left">返回分钟数（0-59）</td></tr><tr><td style="text-align:left">getSeconds()</td><td style="text-align:left">返回秒数（0-59）</td></tr><tr><td style="text-align:left">getTime()</td><td style="text-align:left">将日期对象变为时间戳（返回 1970 年 1 月 1 日至今的毫秒数）</td></tr><tr><td style="text-align:left">parse()</td><td style="text-align:left">将日期对象变为时间戳（返回 1970 年 1 月 1 日至今的毫秒数），最后三位是 000</td></tr></tbody></table><h3 id="正则表达式的创建">正则表达式的创建</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">//</td><td style="text-align:left">创建正则表达式的第一种方式</td></tr><tr><td style="text-align:left">new RegExp()</td><td style="text-align:left">创建正则表达式的第二种方式</td></tr></tbody></table><h3 id="元字符">元字符</h3><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">d</td><td style="text-align:left">匹配一个数字字符</td></tr><tr><td style="text-align:left">D</td><td style="text-align:left">匹配一个非数字字符</td></tr><tr><td style="text-align:left">w</td><td style="text-align:left">匹配字母、数字或者下划线，类似于<code>[A-Za-z0-9_]</code></td></tr><tr><td style="text-align:left">W</td><td style="text-align:left">匹配除字母、数字或者下划线以外的字符。等价于<code>[^A-Za-z0-9_]</code></td></tr><tr><td style="text-align:left">s</td><td style="text-align:left">匹配一个空白字符（空格、制表符和换行符）</td></tr><tr><td style="text-align:left">.</td><td style="text-align:left">匹配任意一个字符</td></tr><tr><td style="text-align:left">^</td><td style="text-align:left">匹配开头</td></tr><tr><td style="text-align:left">$</td><td style="text-align:left">匹配结尾</td></tr></tbody></table><h3 id="转义字符">转义字符</h3><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">转义符</td><td style="text-align:left">在特殊字符前加，表示下一个字符不是特殊字符，应该按照字面意理解 例如：/<sup>.$/表示匹配任意字符。/</sup>.$/表示匹配点</td></tr></tbody></table><h3 id="方括号表示法">方括号表示法</h3><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">[]</td><td style="text-align:left">可以创建字符集合，表示匹配方括号中的任意字符。 1、[ab]匹配 a 或者是 b 2、使用短横线-来指定一个字符范围，如：[a-z]匹配 a 到 z 之间的任意一个字符 3、^表示否定，如： [^a] 匹配除 a 之外的任意一个字符）</td></tr></tbody></table><h3 id="量词">量词</h3><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">*</td><td style="text-align:left">匹配前面的子表达式零次或多次，等价于: {0,}</td></tr><tr><td style="text-align:left">+</td><td style="text-align:left">匹配前面的子表达式一次或多次，等价于: {1,}</td></tr><tr><td style="text-align:left">?</td><td style="text-align:left">匹配前面的子表达式零次或一次，等价于: {0,1}</td></tr><tr><td style="text-align:left">{n}</td><td style="text-align:left">n 是一个正整数，表示匹配 n 次</td></tr><tr><td style="text-align:left">{n,}</td><td style="text-align:left">n 是一个正整数，表示至少匹配 n 次</td></tr><tr><td style="text-align:left">{n,m}</td><td style="text-align:left">n 和 m 是一个正整数，最少匹配 n 次且最多匹配 m 次</td></tr></tbody></table><h3 id="修饰符">修饰符</h3><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">i</td><td style="text-align:left">不区分大小写</td></tr><tr><td style="text-align:left">g</td><td style="text-align:left">全局搜索</td></tr></tbody></table><h3 id="正则表达式的相关方法">正则表达式的相关方法</h3><table><thead><tr><th style="text-align:left">方法</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">test()</td><td style="text-align:left">用于检测一个字符串是否匹配正则表达式。 返回值：如果字符串中有匹配的值返回 true ，否则返回 false。</td></tr><tr><td style="text-align:left">exec()</td><td style="text-align:left">根据正则表达式，在字符串中进行查找匹配。 返回值：返回一个数组，其中存放匹配的结果。如果没有匹配到，则返回值为 null。</td></tr></tbody></table><h3 id="字符串的相关正则方法">字符串的相关正则方法</h3><table><thead><tr><th style="text-align:left">方法名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">search()</td><td style="text-align:left">根据正则表达式，在字符串中进行查找匹配。 返回值：返回首次匹配到的位置索引，如果没有匹配到，返回-1</td></tr><tr><td style="text-align:left">match()</td><td style="text-align:left">根据正则表达式，在字符串中进行查找匹配。 返回值：存放匹配结果的数组，如果没有匹配到，则返回值为 null。</td></tr><tr><td style="text-align:left">replace()</td><td style="text-align:left">用一些字符替换一个与正则表达式匹配的子串。 返回值：替换之后的新字符串</td></tr><tr><td style="text-align:left">split()</td><td style="text-align:left">把一个字符串分割成数组。 返回值：分割之后形成的数组</td></tr></tbody></table><hr><blockquote><p>本篇文章均转载自arry老师的<a href="https://www.arryblog.com/interview/htmlcss/html-html5.html#%E9%AB%98%E9%A2%91%E9%87%8D%E7%82%B9">教程</a>，仅供本人学习使用。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Js核心基础&quot;&gt;Js核心基础&lt;/h2&gt;
&lt;h3 id=&quot;字符串的常用方法&quot;&gt;字符串的常用方法&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;方法名称&lt;/th&gt;
&lt;th style=&quot;text-align</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="JavaScript" scheme="https://blog.cilicili.xyz/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>【前端】CSS/CSS3样式基础知识</title>
    <link href="https://blog.cilicili.xyz/posts/c3f71fbb.html"/>
    <id>https://blog.cilicili.xyz/posts/c3f71fbb.html</id>
    <published>2022-07-29T07:35:45.000Z</published>
    <updated>2022-09-20T13:15:02.421Z</updated>
    
    <content type="html"><![CDATA[<h3 id="CSS-4种书写位置特点与区别">CSS 4种书写位置特点与区别</h3><table><thead><tr><th style="text-align:left">引入方式</th><th style="text-align:left">书写位置</th><th style="text-align:left">作用范围</th><th style="text-align:left">优先级</th><th style="text-align:left">使用场景</th></tr></thead><tbody><tr><td style="text-align:left">内嵌样式</td><td style="text-align:left">写在<code>&lt;style&gt;</code>标签中</td><td style="text-align:left">当前页面</td><td style="text-align:left">由书写位置和选择器优先级来共同决定</td><td style="text-align:left">小案例 对网站首页首次打开速度要求很高的网页需要  如：百度、腾讯首页</td></tr><tr><td style="text-align:left">行内样式</td><td style="text-align:left">css 样式写在标签的 style 属性中</td><td style="text-align:left">当前标签</td><td style="text-align:left">最高</td><td style="text-align:left">配合 JS 或特殊需求</td></tr><tr><td style="text-align:left">外链样式</td><td style="text-align:left">css 样式写在单独 css 文件中，通过 link 标签引入</td><td style="text-align:left">多个页面</td><td style="text-align:left">由书写位置和选择器优先级来共同决定</td><td style="text-align:left">项目开发中高频使用</td></tr><tr><td style="text-align:left">导入式样式</td><td style="text-align:left">把@import 放在<code>style</code>标签中或 CSS 文件中，用于导入外部 CSS 样式文件</td><td style="text-align:left">被导入的页面</td><td style="text-align:left">最低</td><td style="text-align:left">项目开发中几乎不用（用作了解即可）</td></tr></tbody></table><h3 id="CSS选择器的权重计算">CSS选择器的权重计算</h3><h4 id="层叠性">层叠性</h4><blockquote><p>TIP</p><ul><li>CSS 全名叫 <code>层叠式样式表</code> ，层叠性是它很重要的性质</li><li>层叠性：多个选择器可以同时作用于同一个标签，效果叠加</li></ul></blockquote><h4 id="层叠性的冲突处理">层叠性的冲突处理</h4><blockquote><p>TIP</p><ul><li>多个选择器定义同一元素的冲突问题</li><li>CSS 有严密的处理冲突的规则</li><li><code>id 权重 &gt; class权重 &gt; 标签权重 &gt; 通配符权重</code></li><li>复杂选择器可以通过（<code>id的个数，class的个数，标签的个数</code>）的形式，计算权重</li></ul></blockquote><h4 id="CSS-选择器分类汇总">CSS 选择器分类汇总</h4><table><thead><tr><th style="text-align:left">选择器</th><th style="text-align:left">示例</th><th style="text-align:left">示例说明</th><th style="text-align:left">CSS 版本</th></tr></thead><tbody><tr><td style="text-align:left">element</td><td style="text-align:left">p</td><td style="text-align:left">选择所有<code>&lt;p&gt;</code>元素</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">.class</td><td style="text-align:left">.intro</td><td style="text-align:left">选择所有<code>class=&quot;intro&quot;</code>的元素</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">#id</td><td style="text-align:left">#firstname</td><td style="text-align:left">选择所有<code>id=&quot;firstname&quot;</code>的元素</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">*</td><td style="text-align:left">*</td><td style="text-align:left">选择所有元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">element,element</td><td style="text-align:left">div,p</td><td style="text-align:left">选择所有<code>&lt;div&gt;</code>元素和<code>&lt;p&gt;</code>元素</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">element element</td><td style="text-align:left">div p</td><td style="text-align:left">选择<code>&lt;div&gt;</code>元素内的所有<code>&lt;p&gt;</code>元素</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">element &gt; element</td><td style="text-align:left">div&gt;p</td><td style="text-align:left">选择所有父级是 <code>&lt;div&gt;</code> 元素的 <code>&lt;p&gt;</code> 元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">element + element</td><td style="text-align:left">div+p</td><td style="text-align:left">选择所有紧跟在 <code>&lt;div&gt;</code>元素之后的第一个<code>&lt;p&gt;</code>元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">element1 ~ element2</td><td style="text-align:left">p~ul</td><td style="text-align:left">选择 p 元素之后的每一个 ul 元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:link</td><td style="text-align:left">a:link</td><td style="text-align:left">选择所有未访问链接</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">:visited</td><td style="text-align:left">a:visited</td><td style="text-align:left">选择所有访问过的链接</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">:active</td><td style="text-align:left">a:active</td><td style="text-align:left">选择活动链接</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">:hover</td><td style="text-align:left">a:hover</td><td style="text-align:left">选择鼠标在链接上面时</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">:first-letter</td><td style="text-align:left">p:first-letter</td><td style="text-align:left">选择每一个<code>&lt;p&gt;</code>元素的第一个字母</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">:first-line</td><td style="text-align:left">p:first-line</td><td style="text-align:left">选择每一个<code>&lt;p&gt;</code>元素的第一行</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">:first-child</td><td style="text-align:left">p:first-child</td><td style="text-align:left">指定只有当<code>&lt;p&gt;</code>元素是其父级的第一个子级的样式。</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">:before</td><td style="text-align:left">p:before</td><td style="text-align:left">在每个<code>&lt;p&gt;</code>元素之前插入内容</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">:after</td><td style="text-align:left">p:after</td><td style="text-align:left">在每个<code>&lt;p&gt;</code>元素之后插入内容</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">[attribute]</td><td style="text-align:left">[target]</td><td style="text-align:left">选择所有带有 target 属性元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">[attribute = value]</td><td style="text-align:left">[target=-blank]</td><td style="text-align:left">选择所有使用<code>target=&quot;-blank&quot;</code>的元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">[attribute ~= value]</td><td style="text-align:left">[title~=flower]</td><td style="text-align:left">选择标题属性包含单词&quot;flower&quot;的所有元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">[attribute |= language]</td><td style="text-align:left">[lang|=en]</td><td style="text-align:left">选择 lang 属性等于 <strong>en</strong>，或者以 <strong>en-</strong> 为开头的所有元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">[attribute ^= value]</td><td style="text-align:left">a[src^=“https”]</td><td style="text-align:left">选择每一个 src 属性的值以<code>&quot;https&quot;</code>开头的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">[attribute $= value]</td><td style="text-align:left">a[src$=“.pdf”]</td><td style="text-align:left">选择每一个 src 属性的值以<code>&quot;.pdf&quot;</code>结尾的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">[attribute *= value]</td><td style="text-align:left">a[src*=“icodingedu”]</td><td style="text-align:left">选择每一个 src 属性的值包含子字符串<code>&quot;icodingedu&quot;</code>的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:checked</td><td style="text-align:left">input:checked</td><td style="text-align:left">选择每个选中的输入元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:focus</td><td style="text-align:left">input:focus</td><td style="text-align:left">选择具有焦点的输入元素</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">:first-of-type</td><td style="text-align:left">p:first-of-type</td><td style="text-align:left">选择每个 p 元素是其父级的第一个 p 元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:last-of-type</td><td style="text-align:left">p:last-of-type</td><td style="text-align:left">选择每个 p 元素是其父级的最后一个 p 元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:only-of-type</td><td style="text-align:left">p:only-of-type</td><td style="text-align:left">选择每个 p 元素是其父级的唯一 p 元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:only-child</td><td style="text-align:left">p:only-child</td><td style="text-align:left">选择每个 p 元素是其父级的唯一子元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:nth-child(n)</td><td style="text-align:left">p:nth-child(2)</td><td style="text-align:left">选择每个 p 元素是其父级的第二个子元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:nth-last-child(n)</td><td style="text-align:left">p:nth-last-child(2)</td><td style="text-align:left">选择每个 p 元素的是其父级的第二个子元素，从最后一个子项计数</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:nth-of-type(n)</td><td style="text-align:left">p:nth-of-type(2)</td><td style="text-align:left">选择每个 p 元素是其父级的第二个 p 元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:nth-last-of-type(n)</td><td style="text-align:left">p:nth-last-of-type(2)</td><td style="text-align:left">选择每个 p 元素的是其父级的第二个 p 元素，从最后一个子项计数</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:last-child</td><td style="text-align:left">p:last-child</td><td style="text-align:left">选择每个 p 元素是其父级的最后一个子级。</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:root</td><td style="text-align:left">:root</td><td style="text-align:left">选择文档的根元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:empty</td><td style="text-align:left">p:empty</td><td style="text-align:left">选择每个没有任何子级的 p 元素（包括文本节点）</td><td style="text-align:left">3</td></tr></tbody></table><p>不常用选择器：</p><table><thead><tr><th style="text-align:left">选择器</th><th style="text-align:left">示例</th><th style="text-align:left">示例说明</th><th style="text-align:left">CSS 版本</th></tr></thead><tbody><tr><td style="text-align:left">:target</td><td style="text-align:left">#news:target</td><td style="text-align:left">选择当前活动的<code>#news</code>元素（包含该锚名称的点击的 URL）</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:enabled</td><td style="text-align:left">input:enabled</td><td style="text-align:left">选择每一个已启用的输入元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:disabled</td><td style="text-align:left">input:disabled</td><td style="text-align:left">选择每一个禁用的输入元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:not(selector)</td><td style="text-align:left">:not§</td><td style="text-align:left">选择每个并非 p 元素的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">::selection</td><td style="text-align:left">::selection</td><td style="text-align:left">匹配元素中被用户选中或处于高亮状态的部分</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:out-of-range</td><td style="text-align:left">:out-of-range</td><td style="text-align:left">匹配值在指定区间之外的 input 元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:in-range</td><td style="text-align:left">:in-range</td><td style="text-align:left">匹配值在指定区间之内的 input 元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:read-write</td><td style="text-align:left">:read-write</td><td style="text-align:left">用于匹配可读及可写的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:read-only</td><td style="text-align:left">:read-only</td><td style="text-align:left">用于匹配设置<code>&quot;readonly&quot;</code>（只读） 属性的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:optional</td><td style="text-align:left">:optional</td><td style="text-align:left">用于匹配可选的输入元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:required</td><td style="text-align:left">:required</td><td style="text-align:left">用于匹配设置了 <code>&quot;required&quot;</code> 属性的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:valid</td><td style="text-align:left">:valid</td><td style="text-align:left">用于匹配输入值为合法的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:invalid</td><td style="text-align:left">:invalid</td><td style="text-align:left">用于匹配输入值为非法的元素</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">:lang(language)</td><td style="text-align:left">p:lang(it)</td><td style="text-align:left">选择一个 lang 属性的起始值<code>=&quot;it&quot;</code>的所有<code>&lt;p&gt;</code>元素</td><td style="text-align:left">2</td></tr></tbody></table><h3 id="继承性">继承性</h3><ol><li><p><strong>祖先元素设置，后代元素即生效</strong></p><ul><li>文本相关的属性普遍具有继承性，只需要给 <strong>祖先标签</strong> 设置，即可在后代所有标签中生效。</li><li>因为文字相关属性有继承性，所以通常会设置 <code>&lt;body&gt;</code>标签的字号、颜色、行高等，这样就能当做整个网页的默认样式了</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-family</span>: <span class="string">&quot;宋体&quot;</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-decoration</span>: underline;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-style</span>: italic;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>继承性<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>我是列表项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>我是列表项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>我是列表项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>我是列表项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>我是列表项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20211127000019693.46547df3.png" alt=""></p></li><li><p><strong>就近原则</strong></p><ul><li><p>在不继承的情况下，选择器权重计算失效，而不是就近原则</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* （3,0,0） 注意：继承的选择器，权重可以看做是0，权重绝对没有选中的大*/</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#box1</span> <span class="selector-id">#box2</span> <span class="selector-id">#box3</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* （0,0,1）p标签是直接选中，权重最高，因此跟继承没关系 */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>在继承的情况下，选择器权重计算失效，而不是就近原则<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box2&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是段落标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在继承的情况下，选择器权重计算失效，而是就近原则</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* 就近原则，谁描述的近，听谁的 */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#box1</span> <span class="selector-id">#box2</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* .box3描述距离p标签更近，所以，当前生效 */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box1</span> <span class="selector-class">.box3</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>在继承的情况下，选择器权重计算失效，而是就近原则<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box2&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是段落标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="margin的塌陷">margin的塌陷</h3><p><strong>margin塌陷</strong>：是外间距重叠 或 外边距合并 或 外边距穿透。</p><p><strong>① 兄弟元素之间 ，垂直方向：上下外边距出现塌陷</strong></p><blockquote><p>TIP</p><ul><li>垂直方向的 margin 有塌陷现象，第一个元素的下外边距与第二个元素的上外边距会发生合并</li><li>小的 margin 会塌陷到大的 margin 中，从而 margin 不叠加，只以大值为准</li><li>以下两盒子之间间距为 100px ，垂直方向的 margin 不叠加，以大数为准</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAAE9CAYAAAAmpviRAAAQsklEQVR4nO3dP2ic9/3A8c/zSJ1aZ9FB3ZKtJNZQqH5pFiEoGUMrocF0KHRRJWpMoKagQWA6BRUNWtymmICMO3QrHoQ1ZPQibmiIPXiQCNlC60FenG6V7vkNp3t0p/9ydHcfxa8XhEg63aPvne33fe97z+lbVFVVBQDplMMeAADHE2iApAQaICmBBkhKoAGSEmiApAQaICmBBkhqdNgD4GQrT3eGPQRIa+n/GsMeQt+ZQQMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFICDZCUQAMkJdAASQk0QFJFVVXVsAcBwFFm0ABJCTRAUgJNX1WvXg17CHBlCTR9VX355bCHAFeWQAMkJdAASQk0QFICDZCUQNNX1VdfDXsIcGUJNP313/8OewRwZQk0QFICDZCUQAMkJdD01zffDHsEcGUJNH3lrd7w+gQaICmBBkhKoAGSEmiApASavqq2t4c9BLiyBJq+KrzVG16bQAMkJdAASQk0QFICTd/Z2Rtej0DTd97uDa9HoAGSEmiApAQaICmBBkhKoOk7O3vD6xFo+s/bveG1CDRAUgINkFTqQLfW1mJ3cvJbHaN69ix2JyejevbskkaVz97cXLQ2No79+u7kZOxOTsbe4mLPZZ37pfPfcdcHhit1oLNobWwceaBora3F7szMkEbUVj/4bG0duawT5NFmM0abzag2N6O1tnZw+e3bUc7Px2izGeX8fLSWl/s3UDt7w2tJHehyYSFGm81hDyOl1sZG7N2+fez9Uz17FtXmZpR37tRfK2dno9rcbF93ZSWK8fEoFxbaly0sRDQaPQG/TN7qDa9n9LQLd2dmopydjdaDBwdXaDZjb3Gx/sdezs5GubTUc53Y2YmIiGJqKkZWVyOiHYVqeztibKwdj/n5KBcWorWyEq319fb3j4+3DzI2FiOrq9FaW4vWgwd1hPbm5qK4cSOq7e161tg5zlmqr7+Ovdu368/Lu3ejnJ6uP9+bm+uZiXYu7x7f7uRke4z7t6H+WtftPOk4EQez2nj58mD8d+9GvHhR38fF+HiMPHx48P0vX9afdyunp3vG33NbP/88otGIYmLi4Is//WlU+7ej2t6O4saNnusUN27UY+peDunczu5xHb7NnftotNmM3cnJc/+ZAKc7cwbdCeRosxnRaNSRqp8ar6/X67t7i4sx8vHHMdpsxsj9++2n1V1rm9XW1sF1u+LcOX5x8+axT9d7xrO+HsXNm+1jHHrwOPV6n35a/5xydjZay8v1uHdnZiLGxg4u33/KXz17FuXSUjui0X5wGnn4MEZWV6Ocn49oNNpf2w/Vacep74PNzXr8xdRU+/KtrYP7bGurbzPZi6g2N+s/q9FmM6qtrTrc3X+21bNn0Vpfj5H794c8YvjuOTPQ5fz8wcdTUxGNRu9T42jPTiMiRlZX61lbMTER0WhEvHhxcLCu60ZEtPZn0vXxp6cPZtEnKKam6plj8eGH7Z9/jhcAy1u3Dj5eWopoNKL6/PP2A8jOTh3Zzu0qxsej+uyzM49b35ZzHqdn/B980P6+3/62/fnERPv27z8DGVldPXb2PAjdSyAR7b8Hnf0Fi4mJ9pLJo0fRuncvyvn5+s+98+ALfHunLnFcVPfSx3GKRqP3Czs7EdevX+hnHDlGtB8giomJnuWVaDRi9PHjg+u9/fbxB3zxov1ActjYWFSdY53HZR0ni7GxUy8ul5Zid2YmikMPusDlubQXCVsbG1FtbsbI/fs9SyJn6p5hf0ujjx/XP7s7zsfqPDhcv34Q9W4vXx77YHCiyzrOJSjefz9iZ6f3mcXz5/Wzk846frdqe/v0Zy87Oz23o7WyEkWjEdXOzplLMnb2htfTt7M4WmtrxwerSzE11bOG3FpbO3MN+rXHc+9e/fHe4mJ7uaXzQluj0fPCWGccnSWUjiNLKV237yLHOa+9xcXYm5u78PU6SyWtf/zjYCz7a/cR7aWhamurfn2gE9jumXD36weddeZiaqrn8/LOnShv3TrzdQA7e/eqnj6N6unTYQ+DK+DSljjK6emonjypz5Qo9terTzOyulq/maJznWJ8vC8zzmJqqudc5u7T00YfP47dmZkTLy+np6N69Cj2bt+uz2YoFxaitb7ec0bDWccZpJGHD3vGUs7PH6x9T0xEefdutJaX6/OfD4+zmJqK6tGj2N2/vJydjXJhIapnz9rnUM/Oth8IJiaievIkdicnD87iOHSGDL1aDx9G9epVjP7978MeCskVVVVVwx5Et86pfdY1h6c+W6PrBc/zaG1stM+W6Vpe6jxAOJ+9rXr6NPY++iiiqmLkT3+K4pe/HPaQSGyob1Rpraz0rF+2VlYidnbE+ap6/rx9pg8naj18GLE/J9p78MC7LDnVpZ7FcVHl0lJ7iePQG2G4mrrfsHRY9epVFG+9NcDR5FM9fdp+E1HHv/8drX/+M8rf/W54gyK1dEscfLfUa+CffBLlz38+5NEM194f/hDVv/7V+8Vr12L00aOIa9eGMyhSS/27OOC74sjsueObb2Lvr38d/IC4EgQaBqB77fmw6vHjiP/8Z8Aj4ioQaOizE2fPXfb+/OcBjYarZKgvEsKb4LTZsxfFOY1AMxDVV19FvKEvEo785S/1x7u/+EXE//43xNFwlVjiYDC83RsuTKBhkH7wg2GPgCtEoGGAip/8ZNhD4AoRaBgWs2nOINAMht85ccRZuweBQDMQdvaGixNogKQEGgbpRz8a9gjOrbW21rP5xFXR2tiI3cnJnv8Ob8t22mWZeKMKDFDxox/Fm/brI/fm5qK4cePUX0d7qV68qHc+Ok69KcjSUnuTieXlKN5/v96ZPhMzaOBY5cLC1Xwr+il7odb7b+4/WJTT01GMj0f12WcDGdpFmUEzEHb2vrjOTK91aEOLvcXFqDY3IyLqmWD3dTqB6uyVGdHeraja3o4YG4tqc7O9R+XCQntXo/X19vd3zioZG4uR1dVora1F68GDOtKdmXC1vV1v7tw5zom3YX+JpNraam80vL9fZWdvy1qjcWSrtM6+mR3dP2t3cvL0nz02duyXq62tKG7c6Pla9y73nfupuHGjvl+6x9a9B2nn+1vr6+39OGdmopyautRnCmbQDISdvV9PJ5CjzWZEo9EOxPh4jDabUc7PR2t9vd5tfm9xMUY+/jhGm80YuX+/Z2f2iP04da7bFefO8YubN+vwnjie/d3hR5vNIw8exxltNqMYH49ydrZ9nenpaG1stDcevnv34Gc3Gkd2sG8tL9eXl/Pz0XrwoOf2nKTa2Ylqc7NeY+7ssXlenfugvt8j6rF136+d3e1H7t+/0PEvQqAhsXJ+/uDjqamIRqOeNXb+X339dUS0N/ntrKMWExMRjUbEixcHB+u6bkREa38mXR9//+n+aYqpqYPd4T/8sP3z9x8gzqt68qTnOBER5Z07UW1t9RyrZ2wLC+2xPX8eEVE/yBxnZHW1jmsd1JWV8w+w0eiZBZe3btXRLiYmopydjerRo2jduxfl/Hx9n48+fnzp6+yWOGCAip/9rG/H7l76OPZnNxq9X9jZibh+/UI/48gxov0AUUxM9CyvHF6y6PHy5dFlhv3IdY4VERce27Hj7QT1Aktsx93GbuXSUuzOzERx6AGvHwQavgNaGxtRbW7GyP37deB2Z2bOvmL3DPtbOjHIh42NRXXohbzOzLl4++0Tr1bt7ETxLXeNL8bHD9aWO8fdX3M+0YsX7Wcj+1orK1E0GlHt7ERrba2vkbbEwcBUr14NewipFO+807djt9bWTj2bIaK9XNG9htxaWztzDfp1dQe5+OCDI+vjrXv3ohgf7znVrfXppwcfr6xE7Oz0vEh40vnLPevu++vEnbCXCwsR+2HtfG+1tdWzNFFtbfUcu/XgQXt5qet45Z07Ud66deYa/LdlBs3AVF9+GcUb+kv7j3WJO3mX09NRPXlSnxlR7K9Xn2ZkdTX25ubqMy2Kqal2JM+43kUVN29Ga3m5PjOjs/bcWl6uz9LoPjOivk2zsz1vlDn3i3HPn8fuCWd/dI6zd/t2HdfDxy3Gx6Pa2uq5X8qlpfrMk3J2NoqJiSgmJqJ68iR2JycPzuKYnb3UGXVRVSfsxQOXoPsfWPnJJ1G+4YGuvvgi9j76KCIiyt//PspDZy4MWz8i81rjOBTzQemcZnfSm1xO0on3ZZ83bokDBqhI9CtGWysrvU/lDy0jcH7V559/6/Xx41jigEF6992I730vxb6E5dJSe4nj0BthuLh+PagJNLzBLvpUflCG9UAxsN8Xck6WOBiY6quvhj0EuFIEmsHxdm+4EIEGSEqgYcDs7M15CTQMWqJT7chNoBkcO3v3EmrOINAMjJ29e1nq4CwCDZCUQAMkJdAwYMV77w17CFwRAg2QlEAzMHb2hosRaAbGzt5wMQINkJRfN8pA1TusvPdejP7tb8MdzJAUP/zhsIfAFSHQXLrdjz6K+OKLU7+nnJ8f0GgSun592CPgirDEwaUbuXPn9G94770onWoGZxJoLl3x7rsRp2z2+UbPnrsU77wz7CGQnEDTFyNzc1F9//tHLzB7PnDt2rBHQHICTV8UP/5xlL/5zZGvmz3D+Qk0fVP++te9s2iz54jYX9oYGRn2MLgCBJq+Kd56K0b++Mf6c7PnfdeuRZT+6XE2f0voq/JXv4rq+nWzZ3gNRVVV1bAHwXdba/+caIGGixFogKS8kzCzrWLYI4C8xr/7c0tr0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkJRAAyQl0ABJCTRAUgINkFRRVVU17EEAcJQZNEBSAg2QlEADJCXQAEkJNEBSAg2QlEADJPX/t0edvtUmBMIAAAAASUVORK5CYII=" alt=""></p><blockquote><p>​<strong>解决办法：</strong></p><ul><li>任何一个元素加上 display:inline-block;</li><li>把外边距只加在其中一个元素上</li><li>任意一个元素外边距换成对应的 padding</li></ul></blockquote><p><strong>② margin 在水平方向：不会塌陷</strong></p><blockquote><p>TIP</p><ul><li>margin 在水平方向 不会塌陷</li><li>margin 在垂直方向 出现塌陷</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20220714220940463.473aa969.png" alt=""></p><p><strong>③ 父子元素之间，垂直方向：上外边距塌陷</strong></p><blockquote><p>TIP</p><p>当一个元素包含在另一个元素中时，如果<strong>父元素没有设置内边距或边框把外边距分隔开</strong>，它们的上外边距也会发生塌陷（合并）</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: gold;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 父元素的上外边距 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 子元素的上外边距，此时父子元素的上边距发生塌陷（合并），最终上外边距的结果为 50px */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>TIP</p><p><strong><code>.item</code></strong> 的 <strong><code>margin-top:50px;</code></strong> 发生了穿透现象（塌陷）</p><ul><li>穿透了父元素，并与父元素上外边距发生合并，合并后以最大的值为主。</li><li>所以看到的间距并不 <strong><code>.item</code></strong> 与 <strong><code>.box</code></strong> 的间距，而是 <strong><code>.box</code></strong> 与浏览器上面产生了 <strong><code>50px</code></strong> 的间距</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20220714222036503.01e70600.png" alt=""></p><blockquote><p><strong>解决方案</strong></p><ul><li>给<strong>父</strong>元素加上 <strong><code>overflow: hidden;</code></strong></li><li>给<strong>父</strong>元素添加 <strong><code>border</code></strong> 边框</li><li>将<strong>子</strong>元素的 margin 改成 padding</li><li>可以给父元添加对应的子元大小的 padding 值</li></ul></blockquote><h3 id="去掉元素的默认样式">去掉元素的默认样式</h3><blockquote><p>TIP</p><p>网页中的元素为了展示元素本身的用途和结构，都会给元素添加默认的样式。</p><ul><li>一些元素都有默认的 margin，如下常见的默认样式</li><li>h、body、ul、p 标签，都添加了默认的 margin。</li><li>ul 添加了默认的 padding、list-style</li><li>a 标签添中了默认的颜色、下划线</li><li>等等 … （后续在项目开发中还会深入所有标签的默认样式）</li><li>我们在实际的网页开发中，要将这些默认的样式清除掉，也称之为 “CSS 样式的初始化”</li><li><code>*</code> 通配符选择器，表示选择所有元素 （通配符有效率问题，实际工作中不使用）</li></ul></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 通配符选择器，表示选择所有元素 */</span></span><br><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 通配符有效率问题，应该使用并集选择器 */</span></span><br><span class="line"><span class="selector-tag">body</span>,</span><br><span class="line"><span class="selector-tag">ul</span>,</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="comment">/* 去掉下划线 */</span></span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">  <span class="comment">/* 颜色为黑色 */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="comment">/* 去掉圆点 */</span></span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="盒子的水平居中">盒子的水平居中</h3><blockquote><p>TIP</p><p>将盒子的左右两边的 margin 都设置为 auto ，盒子将水平居中。共有两种方法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 方式一， margin: 上下0 ，左右自动 */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">方式二，margin: 上10px 水平居中 下0px </span></span><br><span class="line"><span class="comment">第二种方法的应用场景在于，需要当前盒子距离顶部 10px, 水平居中对齐，距离底部0px 类似这样的需求时使用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">margin</span>: <span class="number">10px</span> auto <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>盒子的垂直居中，需要使用绝对定位技术实现</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">section</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: salmon;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 盒子水平居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* margin: 0 auto; */</span></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* margin: 上150px 水平居中对齐 下0px */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">150px</span> auto <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 文本内容水平居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 文本内容垂直居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span>&gt;</span>我是文档区域标签<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20220714235749577.904c23de.png" alt=""></p><blockquote><p>TIP：</p><ul><li><code>margin: auto 20px;</code> 这样写，并不会垂直居中</li><li>文字水平、图片水平居中：<code>text-align: center;</code></li><li>div 块级元素水平居中，是给元素自身加上<code>margin: 0 auto;</code></li></ul></blockquote><h3 id="盒子模型占位计算">盒子模型占位计算</h3><p><strong>① 盒模型的内容区大小</strong></p><blockquote><p><strong>在标准盒子模型中</strong></p><p>content 内容区，也就是盒子里面能留给子元素的宽度和高度大小,也就意味着盒子里面的内容的最大面积就是 width 和 height 形成的矩形面积。</p><ul><li>如果只有一个子元素，子元素的宽度超过父元素，就会溢出</li><li>如果有多个子元素，子元素（行内元素，行内块元素）的宽度加起来超过了父元素，那么超过的那些子元就会换行显示</li></ul></blockquote><p><strong>② 盒模型可视宽高</strong></p><blockquote><p><strong>TIP</strong></p><ul><li>可视区宽 = 宽度 + 左右内边距 + 左右边框宽</li><li>可视区高 = 高度 + 上下内边距 + 上下边框宽</li></ul></blockquote><p><strong>③ 盒模型实际占位宽度</strong></p><blockquote><p><strong>TIP</strong></p><ul><li>实际占位宽 = 宽度 + 左右内边距 + 左右边框宽 + 左右外边距</li><li>实际占位高 = 高度 + 上下内边距 + 上下边框宽 + 上下外边距</li></ul></blockquote><blockquote><p><strong>TIP</strong></p><ul><li>盒模型的内容区大小：决定了父元中的子元素能占据的最大的宽和高度</li><li>可视区占位：我们看到的这个元素在页面层现的效果的区域</li><li>实际占位宽度：决定了这个元素在父元素中的占据面积（宽和高）</li></ul></blockquote><h3 id="box-sizing怪异盒模型">box-sizing怪异盒模型</h3><blockquote><p><strong>TIP</strong></p><p>在 CSS3 中新增了怪异盒子模型（IE 盒子模型）</p></blockquote><p><strong>① box-sizing是什么？</strong></p><blockquote><p><strong>TIP</strong></p><ul><li>将盒子添加 <code>box-sizing: border-box;</code>属性， 盒子的 width、height 数字就表示盒子实际占有的宽度 （不含 margin）</li><li>即 padding、border 变为 <strong>内缩</strong> 的，不再 <strong>外扩</strong></li><li>box-sizing 属性 <strong>大量应用于移动网页制作中</strong> ，因为它结合百分比布局、弹性布局等<strong>非常好用</strong>，在 PC 页面开发中使用较少</li><li>box-sizing 属性兼容到 IE9</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: <span class="number">10px</span> solid skyblue;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">        添加 box-sizing 之前，box是外扩的，总宽度=240px</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        添加 box-sizing 之后，变成内缩，总宽度=200px */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>添加 <code>box-sizing: border-box;</code> 之前</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20211128000749414.64b52537.png" alt=""></p><p><strong>添加 <code>box-sizing: border-box;</code> 之后</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20211128000824590.763a264e.png" alt=""></p><p><strong>②为什么 div 和 button 按钮的大小有差别 ？</strong></p><p><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQcAAABuCAYAAAAqJ9aBAAABvElEQVR4nO3dsW0CQRBA0TuLhALogRIpgRLpgQII14kj8x3iXeneCzeaAH2N9pB2H2OMDeCXr9kDAGsSByCJA5DEAUjiACRxAJI4AOmUp4/9n8dgSVd/gTkymwOQxAFI4gAkcQBSX0iG++v5yTmY7Ha+zB6BxdgcgCQOQBIHIIkDkMQBSOIAJHEAkjgASRyAJA5AEgcgiQOQxAFI4gAkcQCSOABJHIAkDkASByCJA5DEAUjiACRxAJI4AEkcgCQOQBIHIIkDkMQBSOIAJHEAkjgASRyAJA5AEgcgiQOQxAFI4gAkcQCSOABJHIAkDkASByCJA5DEAUjiACRxAJI4AEkcgLSPMcbb6WOfMArLub7/NDgOmwOQxAFI4gAkcQBSX0gCh2dzANIpT33KXItPikxgcwCSOABJHIAkDkDqC8lwfz0/OQc/bufL7BFg2zabA/AHcQCSOABJHIAkDkASByCJA5DEAUjiACRxAJI4AEkcgCQOQBIHIIkDkMQBSOIAJHEAkjgAqZ/D86jNWjxqwwQ2ByCJA5DEAUjiAKS+kAQOz+YAJHEAkjgASRyAJA5AEgcgiQOQxAFI4gCkb+SkIsyigD80AAAAAElFTkSuQmCC" alt=""></p><blockquote><p>原因：</p><ul><li>button 按钮默认是 怪异盒模型</li><li>即：自带<code>box-sizing: box-border;</code>属性</li><li>button 是 <strong><code>内缩</code></strong> 的 ，div 是 <strong><code>外扩</code></strong> 的</li></ul></blockquote><p><strong>③标准盒模型与怪异盒模型区别</strong></p><blockquote><p><strong>区别</strong></p><p><strong>标准盒模型</strong>和 <strong>IE 盒模型</strong>的区别在于设置 <strong><code>width</code></strong> 和 <strong><code>height</code></strong> 属性时，所对应的范围不同：</p><ul><li>标准盒模型的 width 和 height 属性的范围只包含了 <strong><code>content</code></strong> 内容区</li><li>IE 盒模型（怪异盒模型）的 width 和 height 属性的范围包含了 <strong><code>border、padding 和 content</code></strong></li><li>尺寸计算公式：</li><li>width = border + padding + 内容的宽度</li><li>height = border + padding + 内容的高度</li><li>button 标签，是典型的怪异盒模型</li></ul></blockquote><blockquote><p><strong>TIP</strong></p><p>我们通过 box-sizing 属性来切换标准盒子模型与怪异盒子模型</p><ul><li><code>box-sizing：content-box</code> 是默认值，盒子以标准盒子模型特性来渲染</li><li><code>box-sizing: border-box</code> 盒子以怪异盒子模型特性来渲染</li></ul></blockquote><table><thead><tr><th style="text-align:left">标准盒子模型</th><th style="text-align:left">怪异盒子模型（box-sizing:borde-box;)</th></tr></thead><tbody><tr><td style="text-align:left"><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVEAAAD/CAYAAABIF+VoAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFiUAABYlAUlSJPAAACDHSURBVHhe7Z1dzFxVuceJAqJFPlIBhSqmKg1FQCE1BbGIUqE05bNVRIItpZEPoaKlWAsNRbAHEKwVFMQaDdrkTQQ5B2JQQJoQNSqJJxpjYnK88IJEL0y88OJcnPT4X82zWF3v8+xZ8+6ZWc/e83+SX97Of69Zs2bvtX6zZtq+c9A+FovFYs25KFEWi8VqUZQoi8VitShKlMVisVoUJcpisVgtihJlsVisFqVK9KCDDor87yu79/3zl4/G24cdekjI/v7SN2J25JvfFLK//vRrMTtu/hEh+/Mz98fsxLfND9kfnrw3Zied+NaQ/XbPXTE77aS3h+zl722N2QfeuzBkL3x7c8w+dMaikD378OdjtvysU0L2owdvjtmqc98Xsh/uuD5mq5cvCdnu7etjdvXKs0P2yJeuidl1l58bsoc2fTJmN115fsi+csuamH3hmgtDtu36S2O29bpVIbt93cqY3X3T5SHb+KmPxez+Wz8Rss+sOS9mu26/OmRrLz4nZo9tWxeyKy9cGrPv37MhZJd+5MyYzdx/Y8hWnHNazJ7euTFk5y05OWbPfWtTyM46/d0x27t7S8jOOPnEmP3qiW0hW/yuE2L2u5m7Q7ZwwbEx+9PTO0J2wrFHx+wvP/lqyOYfdXjMXn3h6yGb98Y3xOwfL38zZAe//nUx+9evHw/IbRxDG7SV7PB/94EMfUqGx0KGx5YMY0KGMUqGsSPDc5EMzxEZnrNkOBfIcG4kwzlDhnMoGc4tMpxryXANkOGaSIZrhQzXTjJcU2S4xpLh2iPDXJAMcwQZ5oxkmEvIMLckw5xDhjkoGeYmMsxVyTCHkWFOS4a5jgxzXzKsCWRYI5Jh7SDDWpIMawwZ1pxkWIvIli89JWZYs8iwhiXD2kaGtS4ZHIAMTpAMrkAGd0gGpyCDYySDe5DBRZLBUcjgLMngMmRwm2RwHjK5DawyJYoOCCGE7JepVZQoIYQMYGiJap0QQsg0YxUlSgghBVjFt/OEEDIAfiZKCCEtoEQJIaQFQ0tU64QQQqYZqyhRQggpwCq+nSeEkAHwM1FCCGnBVEr01Rd37Vu4cOG+nVv2/39z4pPVK5aF65SCLG/3+yd3HNCG15VMkqElqnXSNSjRboBr9OLu/b9kwkIEip+S8dqSSWNVbyVK/CMvdKkcNbAzzYUJ8eK+6CPNCRkXVvX27TzxT4lEm9ogH7SLJWQUjPwzUewKsDuQt1mCTPTb1l8WM+3zLdlFpOSLRHYfex64ZVY/srDy+8tPaYfbuL/clnHLMYFvC+sg16xpN9m045Q5kueEjJqxSBQTG7LMM0zsdHegSSoVIhBRpgsFbbRFIgsvlaNkYJBEpZ1kWn9kMqTXTcivt8yNNBMw//L2hIyDoSWqdZIiMkqlJ7vDVKwAiyCXpgbum8pXJJq2Aeg/fwwgi61EovmuBnnJGMl40eYQJUq8YNWcJapJJ5cWsBaBtgtJ74v+tQWCdtrnYNLfIIlq40YbStQH+XW05g+gRMkksWrOb+fnKlHZbYB0R5jfV5Oo3HccEkXbPCd1SK+bfCaatwG4lun1JWRcjOUz0blKtPS+lOj0kl437bqm7bS5QMiocSfR/DNNWSjpfTWJNuXI8sWW92mNOx8jqYcmTVyzfF417VAJGTVDS1TrJMWSUS4tkAtKbueyy+9ryVIWT9pWMq3ftB0l6gtcj/R6yTuN/LrL9c2vLXehZJJYNXGJAtwfmYAsv68lUZBKE8hixJ+bPme1xk2J1kHOe4olxvyaU6Bk0lg1p7fzHpFFlkqUEEJGwcg/E/UIdpnavx8lhJC29EqieAuYv5WTt4XpZ2aEEDIqhpao1okX5LPPHK0tIYSMCqs6J1FCCKmBVZ17O08IIZOmV5+JEkLIpKFECSGkBUNLVOuEEEKmGasoUUIIKcAq12/nMQ5CyHSjuWHSYBxWuZfo//3P44SQKYUSbQklSsh001mJap3UgBIlZLrxIlFgFSVKCHFLZyXqZeCUKCHTjScXWUWJEkLcQom2hBIlZLrprES1TmpAiRIy3XiRKLCKEiWEuKWzEvUycEqUkOnGk4us6rRE//bKzvBb7ffObFGPT4qZRz4bxqEdI4TMHUq0JZTodLFr+1rzWv7x+XvDORbQVmtH+kVnJap1UgNKdHoQOWrXUgSKn5LhNkXaf7xIFFhFiY4ASnTurFm1LJw7QbuWaJMLE+3QHnMgzUm/6KxEvQycEu0/cv2sayl5ugsVPFx7Ml48uciq3khURCbgtnaffOeT73DSPjffeNmsNvlnc2hjSXTQmGSHJe1wOz0+TVgSxW3kOJ7mQNuhkn5BibakVKJYTKmgRHRpJm3zRSf3z9shsxZ0uitKRZm2xeOkmfSbjgmPQRHsR85Pfs7l/KaZgBcwnrt+01mJap3UoFSiWEz5sXzxoY3WLl+8cltbnMhTCQroN30skXj+FjQfk0g0bTOtUKJEw4tEgVW9kGi+8ICIDG1w22oH0t2g1WfeX0q+0HFbk2PeB3ehr2Gdd0p0uumsRL0MfFQSbWoH0sVotcVt6S/NQb7Q0RduW8gOlRJ9jUHnPc0EnD+ce+0Y6QeeXGRVbyWaS89qB0p2onl/KaU70RxK9DWs8y4vhvLCk6K1J/2CEm1JqUQ1EWF3CazbgvQhi9RazFYOIEMck9tNwk2hRF9j0PnNd5xyjtOM9I/OSlTrpAalEs0Xn+wM092L7GhyaSFL5dq0mHHfvF/JQNoWfeYZ7pc+PiX6Gk3nXYSZnnerLekXXiQKrOqFRLGYRFoCjmn3SduAfIfTtJhBKk1pl7+dF/Ix5W0o0dcYdN6Rp+fRakf6RWcl6mXggyRKCOk3nlxkFSVKCHELJdoSSpSQ6aazEtU6qQElSsh040WiwCpKlBDils5K1MvAKVFCphtPLrKKEiWEuIUSbQklSsh001mJap3UgBIlZLrxIlFgFSVaAMYhvPzfDwQOOfTgmP38NztCNm/eYTF77hdfDtlRR8+L2TMv3RWyY449MmZP/eyOkB2/YH7MZp79YsjeufC4mD3x1KaQvWfR8TH77sytIVt86jti9tgTN4fs9DMXxuzh3TeEbMnSk2L20KMbQnb2spNjdt+ua0N27kdPjdk9D14TsuUr3h+zbTuuCtlFlyyJ2ZbtHw/ZJauXxmzTHVeEbPVV58Rs4+ZLQnbV2g/H7IbPrQzZpzecH7PrbrogZPgpGY4jQ3vJ0A8y9CsZHg8ZHl8yjAsZxikZxo8Mz0cyPE9keN6S4Xwgw/mRDOcNGc6jZDi/yHC+JcN1QIbrIhmuFzJcP8lwXZHhOkuG648M80EyzBNkmDeSYT4hw/ySDPMOGeahZJifyDBfJcM8RgYkA9o6qAHGormhBlbx7XwBGIdMNEL6DiU6G4zDKkq0AIxDm2yE9BEv6w54cpFVlGgB2kQjpM9o66AGnZWo1kkNKFFC6qCtgxp4kSiwihIt4C3HHKFONEL6COa7tg5q0FmJehm4F4liHNpkI6SPeFl3wJOLrKJEC8A4tMlGSB/xsu6AJxdZRYkW8OPn71QnGyF9BPNdWwc16KxEtU5q4EWi2kQjpM9o66AGXiQKrKJEC1i0eIE60QjpI5jv2jqoQWcl6mXgXiSKcWiTrQZrN1wU0I7l4Avd7n1wvXqMEAsv6w54cpFVlGgBGIc22WrQRqIXXHR2IG1TG4wv/RbPTVuvVNvt+c8vFrUj7fGy7oAnF1lFiRbwnT0b1clWgz5JFCJMx/Ps3rtVQYpA8VMyinR8YL5r66AGnZWo1kkNvEhUm2i1aCNRb3zze7eoGcYNoUoG0ebC1NqR0aGtgxp4kSiwihIt4IPLFqsTrQZ9kqiG7DpFjrI7TXehAnJNxKQdmO/aOqhBZyXqZeBeJIpxaJMtRXZL+Wd3mvBkF5WiSSL/vBC3LYkiS9vKOFKJ5vdNd3Pp/a23/MilDdAeoy35DrNpx6ntUEl7vKw74MlFVlGiBWAc2mRLwYIGueAggDzLJSWyTEUBOSBL24notP60xwUlEgWpxLXHsDIwSoniMdLzI+cmbSOgLSU6erysO+DJRVZRogXct2udOtlSsPC1xS67NW2nmYI2kBr+3HQf5KnMLMlIHyUSlcfNc5H6MI/RBnmc9Hlbjw0o0fGA+a6tgxp0VqJaJzXwIlFtouVAotaChgRyUYmAUkRG+JnvVoVchE0iSfsE+X1zWQoyNsmHeYy5gsdAX6lAASVaB20d1MCLRIFVlGgBF1+x//t5miiVKMSE2yCVF26LjNBPqUQHPW4biYrQhnmMYUnPh3Zcxqgdw7hGIXByIJjv2jqoQWcl6mXgXiSKcWiTLcUSjUhCJGoJMpXRtEhUzk06ppx8LCnI5byS0eFl3QFPLrKKEi0A49AmWwpEo4kPgsFil9uQUS4NEYXIyJKbJh1LuNLHKCQ6zGMMQz4eCzx2/hjy2GlGRoOXdQc8ucgqSrSA2+7c/9W/TWChY1GnO7ZcjgB/TgUFcDtvJ/3J7TRLxaOJVbK8z1xapRId5jGGAffFGLRjKTLO/JyV3JcMD+a7tg5q0FmJap3UwItEtYmWA8FBoCJJQVvoaJe2QYafuYxEmgLElYsQpEIDuB9y/HkUEgVNjzEXmeX95aQvRkDGKlCg40VbBzXwIlFgFSVawLXXL1cnWopIVDvWV0SEFFq/wHzX1kENOitRLwP3IlGMQ5tsKdMoUdkdasdId/Gy7oAnF1lFiRaAcWiTLaXPEsXb+vy5yVv+uX4eSvziZd0BTy6yihItgG/n93/2mZN+Zkr6A9/Oz2ZoiWqd1MCLRLWJRkif0dZBDbxIFFhFiRZQ8k+cCOkL/CdOOlbx7XwBGIc22QjpI17WHfDkIqso0QIwDm2yEdJHvKw74MlFVlGiBZT8AhJC+gJ/Aclshpao1kkNvEhUm2iE9BltHdTAi0SBVZRoASW/lHlS4JyQ/qJd80nDX8qsYxXfzhfgZXIDjOWrP9lLeoiXeeZl3QGMRXPDpME4rKJEC8A4tMlWA4xFW4Ck+3iZZ17WHcBYNDdMGozDKkq0AE9fmYxzoi1A0n1wbbVrPmn4lcmzwTisUo9ondTAi0S1iVYLSrS/eJEo0NZBDbxIFFhFiRbwnT0b1YlWA0q0v3iRKOa7tg5q0FmJehm4F4l6mdwAY9EWIOk+XuaZl3UHMBbNDZMG47CKEi0A49AmWw0wFm0Bku7jZZ55WXcAY9HcMGkwDqso0QIWLV6gTrYa4JxoC5B0H1xb7ZpPGsx3bR3UwJOLrFKPaJ3UwItEtYlWC0q0v3iRKNDWQQ28SBRYRYkW8OPn71QnWg0o0f7iRaKY79o6qEFnJepl4F4k6mVyA4xFW4Ck+3iZZ17WHcBYNDdMGozDqpFIdPWKZbO+OgJZ3u73T+44oM3OLetmtUlpczH/9srOfWtWLVOPgc03XnbAWNBeawcwDm2yNYGvJk77t74Rs+QrllMwFm0BjpO7Z/5r3wfPv0A9BlZ+6tMHPAe019qlbZr6mytX3vyFfbc8+PCsHFn62ILWtvS5jIOmeSbfaSXIV1ZrlLazGGbdYY1Za2eYNWaBsWhuAOPyjgbGYdVIJIqBvbh7q3pMkCeCn5INekLDXMyUmUc+G/q2JIqLC+S2tLcu8luOOUKdbBb59y3Jt2LmghSBym1ZKE0ixTnRFuC4WH/nl8OYLOlBOkBuS/tcPshwTG7jPqMUKfoHmhjxuCWPVfpcxgWurXbNZf7gK6olwxzTBIl26ZcH4sV8WJFivmvrIOWPz98bz7m2boZdYxZNLkJ/4/COBsZhlXpE68Ti1Rd3zRqkBl4h8oHjBOC+6CPNhWElundmS+hP0CQqbfKLiba7tq89IBO0idaEJkFINZ3M1ne25+1yJiXRfPemSUja5JJBW+wK5Tb+nN8f98F9NekNA/pFP4LWHx4/laNG6XMZJ00SzTNt/mhzx5png9DWAcC6QX8p+VqayxqzsCQ6Tu9YWDURiTa1QW69mgwrUbzaiThxsTSJIk9fIYX0vjnaJBsW7A7SCY5JjeeetgGyG013HSmTkmi6e9MkKLkmp3znhz+nu1AB920rKJwrCLBJyiUSLX0u48SSqAWebypHzC/tK6yxGx32m2i1dQBkBwpBWrKcyxqzaCPRuXrHwqrWb+cxQAyoyepN5tdeKYRhJZpiSRSZ9mpoTQgw7OTWyHcJ1o5z0M4BY9EW4DixJIpMk2C6qxskt7RfaZsL18pTmh6nRNYlzyU/NmqGmWf5PGmaN4Pe3eSUrrthd5xNa8wCY9HcME7vaGAcVo1Moin54PY8sH/XlWbCbesvm6hEMQ68IuZ5+gqbH8M4tMk2DOg73Q1gdwDSNgLadkGiGKcmti2P/yAcg3jkz/iZt9N2ebkwSwQKBkkUx1JyKSIb9FzyY6NmmHkmn6fLOxZ5B4OfWttJShTZsGvMAmPR3DBO72hgHFa1lmiObKExSMmmXaLyN/V5Ronqb5VFiHhc6zFymiSaI/2mY7Iex6NERZjpW/dpk2jOKL2jgXFYpR7ROhkGeZXAT9zuukS1iVYK+gR5Tok2f94oUiwRKBhGogC70/Qz0JLnkh8bNbi22jVPkR1oKlAwSomCfA1oeJIoGJV3LKwai0QBBo8ngT/LZxN5G4DPJqRdzjgkiky7wDIh8hxok2wQkCD6s0SJt/baMflsS1sMwJNEkWnikc8R8WeRmyZR9Kv9ZY7cZ1w7UYA+0V5ulzyXcTNIohAhxqLNjaZ5Y821JrR1kGNJdC5rzGIYiYJwDlp6x8Kqkb+dF9Ink79C5O2svyUbh0Tzf78m4KJr7cGw/05UBJrvFlJkR5HnsqOQz7pyPEk0380JkFHaHs9HExTui77TTGQo7fPbFm0lWvpcxkmTREWg2jEBx7U5B4Gmn8cPouTfiQJLonNZYxZtJDpX72hgHFaNRaLa4DXzN71SAIxDO7ElWBK1Xg2tV0/QNLk10H+TQIG1cxi0a8BYtAU4TiyJWru0fFen7ThFeukO1RJmiUiHlWguzdLnMk6seWa94OZoc2fQOxuN0nVnSXQua8wCY9HcoDEq72hgHFa1lig+V0gHLR/w5p83yMDTtrjd9GpQejE1LIkC5Okr5aBXSIxDm2wag3aSKZj0aCu3S+6LsWgLcJxYEgXIUxlpOzdNgrhPvgttgyVR5LnA8bhoi2NpXvJcxok1z0p3kiLM9AV82F0oKF13lkTBsGvMAmPR3DBO72hgHFapR7ROLGB5DCrFGqA8oUHthNKLqdEkUYBjMo5BF3eY3+Ikb+Ut8r8wEpEKg+SLc6ItwHHSJFGAYzJ+q51IThilQIElUZA+Lmj7XMYFrq12zeWtvEb+F0YiUmFYgYLS3+LUJFEwzBqzsCQ6Tu9YWNVaouOkjURHiTbRalFDomQyWBKtgbYOamBJtAZWtX47P068SJS/2Z5MAi8S5W+2nw3GYRUlWoCXyQ0wFm0Bku7jZZ55WXcAY9HcMGkwDqso0QIwDm2y1QBj0RYg6T5e5pmXdQcwFs0NkwbjsEo9onVSAy8Xk987TyYBrq12zScNv3dexypKtABtotWCEu0vXiQKtHVQg85K1MvAvUj0g8sWqxOtBpRof/EiUcx3bR3UwJOLrKJEC/AyuQHGoi1A0n28zDMv6w5gLJobJg3GYRUlWgDGoU22GmAs2gIk3cfLPPOy7gDGorlh0mAcVqlHtE5q4OVi3rdrnTrZaoBzoi1A0n1wbbVrPmkw37V1UAMvEgVWUaIFaBOtFjgnpL9o17wG2jqoAc6J5oYaWMW38wVcfMVSdaIR0kcw37V1UANPLrKKEi0A49AmGyF9xMu6A55cZBUlWgDGoU02QvqIl3UHPLnIKvWI1kkNvFzM2+68Qp1shPQRzHdtHdTAi0SBVZRoAdpEI6TPaOugBp2VqJeBe5HotdcvVycaIX0E811bBzXw5CKrKNECMA5tshHSR7ysO+DJRVZRogVgHNpkI6SPeFl3wJOLrFKPaJ3UwMvF5Nt5Mk3w7byOVZRoAdpEI6TPaOugBp2VqJeBe5Eo/4nT+JDvVBesb6eUr5Me1I60h//EaTYYh1WUaAEYhzbZSDsgwvQrf+XrfnNBikDxUzKKdHx4WXfAk4usokQLwDi0yUbakX8Hv2QQZPr9+xBtLkytHRkNXtYd8OQiq9QjWic18HIx+QtIJofsOkWOsjtNd6ECck3EpB38BSQ6VlGiBWgTjYyHfIfZtOPUdqhkNGjroAadlaiXgXuR6H84+qXMfWfthosO+JxU/uIpbSOgLSU6ejDftXVQA08usooSLQDj0CYbGS0izPStOyU6ebysO+DJRVZRogVgHNpkI6MDQswFCijRyeNl3QFPLrJKPaJ1UgMvF9PTVyb3DfmLI0uU8pmodgxv+yFZ7RiZO/zKZB2rKNECtIlG2iMCxY5SOw7kb+v5t/OTRVsHNeisRL0M3ItEv7NnozrRSDsgzyaBCtqOs2mHStqB+a6tgxp4cpFVlGgBGIc22Ug7SneSIsx0N8pd6Pjwsu6AJxdZRYkWgHFok43MnfSzUA3rfygJFOj48LLugCcXWaUe0TqpgZeLuWjxAnWyEdJHMN+1dVADLxIFVlGiBWgTjZA+o62DGnRWol4G7kWiP37+TnWiEdJHMN+1dVADTy6yihItAOPQJhshfcTLugOeXGQVJVoAxqFNNkL6iJd1Bzy5yCr1iNZJDbxczLccc4Q62QjpI5jv2jqogReJAqso0QK0iUZIn9HWQQ06K1EvA6dECamDtg5q4MlFVlGiBWAc2kQjpI94WXfAk4usokQLwDi0yUZIH/Gy7oAnF1mlHtE6qYEniQoy0Q459OCY/fw3O0I2b95hMXvuF18O2VFHz4vZMy/dFbJjjj0yZk/97I6QHb9gfsxmnt3/f8TfufC4mD3x1KaQvWfR8TH77sytIVt86jti9tgTN4fs9DMXxuzh3TeEbMnSk2L20KMbQnb2spNjdt+ua0N27kdPjdk9D14TsuUr3h+zbTuuCtlFlyyJ2ZbtHw/ZJauXxmzTHfu/anr1VefEbOPmS0J21doPx+yGz60M2ac3nB+z6266IGT4KRmOI0N7ydAPMvQrGR4PGR5fMowLGcYpGcaPDM9HMjxPZHjekuF8IMP5kQznDRnOo2Q4v8hwviXDdUCG6yIZrhcyXD/JcF2R4TpLhuuPDPNBMswTZJg3kmE+IcP8kgzzDhnmoWSYn8gwXyXDPEYGJAPaOqgBxqK5oQZWUaKEELd0VqJeBk6JEjLdeHKRVZQoIcQtlGhLKFFCppvOSlTrpAaUKCHTjReJAqsoUUKIWzorUS8Dp0QJmW48ucgqSpQQ4hZKtCWUKCHTTWclqnVSA0qUkOnGi0SBVZQoIcQtnZWol4FTotPFru1r9+2d2aIe++Pz9x7wlcloq7Uj/cKTi6yiRIkLRI6aREWg+CkZRTodUKItoUT7z5pVy6JALYmiTS5MtEP7v72y84Cc9IvOSlTrpAaUaP8RcUKGmkQlT3ehgiVd0h+8SBRYRYkSF1gSbdpxajtU0i86K1EvA6dEpwdLojOPfDbkaSZsvvEySrTneHKRVZQocQElSjQo0ZZQotMDJUo0OitRrZMaUKLTw6DPRNNMwGeikKx2jPQDLxIFVlGixAWWRLV/Iypo7Um/6KxEvQycEp0eLIkCbcfZtEMl/cGTi6yiRIkLmiQqwsz/xxJ3of2HEm0JJTo9NEkUiEgFCnQ66KxEtU5qQIkSMt14kSiwihIlhLilsxL1MnBKlJDpxpOLrKJECSFuoURbQokSMt10VqJaJzWgRAmZbrxIFFhFiRJC3NJZiXoZOCVKyHTjyUVWUaKEELdQoi2hRAmZbjorUa2TGmDghJDpRnNDDaxyLVFCCPGCVa7fzhNCiAfgRKsoUUIIGQAlSgghLRhaolonhBAyzVhFiRJCSAFW8e08IYQMgJ+JEkJICyhRQghpwdAS1TohhJBpxipKlFRl9YplB3yLJ0CWt/v9kzsOaLNzy7pZbQgZJ1bx7TypCoT44u6t6jFBBIqfklGkZJLwM1Hikldf3DVLjhrYmebChHhxX/SR5oSMA0qUuKREok1tkA/axRIyCoaWqNYJIaNG3qY37SabdpzaDpWQcWEVJUqqIRJNyaW454FbQp5mwm3rL6NEycSwim/niRvkrTvkKBklSjzAz0RJZ5DdqXwGSokSD1CipFNAmpAn/iyfieZtAD4TlXaEjJOhJap1QsikSCWa70zzdvzbeTIprKJEiSs0aWo7zqYdKiHjwCq+nSfVwOeZqSzlL5byzzlFmGlb7kLJJOFnosQl8pdGKZYYRaSD2hEyDihRQghpwdAS1TohhJBpxipKlBBCCrCKb+cJIWQA/EyUEEJaQIkSQkgLhpao1gkhhEwzVlGihBBSgFV8O08IIQPgZ6KEENKCOUlUQAf//OWj8fZhhx4Ssr+/9I2YHfnmN4Xsrz/9WsyOm39EyP78zP0xO/Ft80P2hyfvjdlJJ741ZL/dc1fMTjvp7SF7+XtbY/aB9+7/ZRMvfHtzzD50xqKQPfvw52O2/KxTQvajB2+O2apz3xeyH+64Pmarly8J2e7t62N29cqzQ/bIl66J2XWXnxuyhzZ9MmY3XXl+yL5yy5qYfeGaC0O27fpLY7b1ulUhu33dypjdfdPlIdv4qY/F7P5bPxGyz6w5L2a7br86ZGsvPidmj23b/3/Kr7xwacy+f8+GkF36kTNjNnP/jSFbcc5pMXt658aQnbfk5Jg9961NITvr9HfHbO/uLSE74+QTY/arJ7aFbPG7TojZ72buDtnCBcfG7E9P7/+/7Scce3TM/vKTr4Zs/lGHx+zVF74esnlvfEPM/vHyN0N28OtfF7N//frxgNzGMbRBW8kO/3cfyNCnZHgsZHhsyTAmZBijZBg7MjwXyfAckeE5S4ZzgQznRjKcM2Q4h5Lh3CLDuZYM1wAZrolkuFbIcO0kwzVFhmssGa49MswFyTBHkGHOSIa5hAxzSzLMOWSYg5JhbiLDXJUMcxgZ5rRkmOvIMPclw5pAhjUiGdYOMqwlybDGkGHNSYa1iGz50lNihjWLDGtYMqxtZFjrksEByOAEyeAKZHCHZHAKMjhGMrgHGVwkGRyFDM6SDC5DBrdJBuchk9vAKvsIi8VisQYWJcpisVgtihJlsVisFkWJslgsVouiRFksFqtFUaIsFos159q37/8BR3w6ey3WMIMAAAAASUVORK5CYII=" alt="16549198837318-16549216262352"></td><td style="text-align:left"><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVUAAAEDCAYAAACF25fEAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFiUAABYlAUlSJPAAACDZSURBVHhe7Z1tzJxFuceJAqJFXlIBhSqmKg1FQCE1BbGIUqE05bVVRIItpZEXaUVLsRYaimAPIFgrIIg1GLTJkwhyDsSggDQhalQSTzTGxOT4wQ8k+sHED344H056/E9zDdPpNbM7z967c+3c/yv55en+d3Z27vue+e3stn32oL0sFovF6qwoVRaLxeqwKFUWi8XqsChVFovF6rAoVRaLxeqwKFUWi8XqsChVFovF6rAoVRaLxeqwBkr1oIMO8vzvq7v2/vOXj/rbhx16iMv+/vK3fHbkW9/isr/+9Bs+O27uES7787P3+ezEd8x12R+eusdnJ534dpf9dvedPjvtpHe67JUntvjsQ++f77IXv7PJZx85Y4HLnnvoiz5betYpLvvRAzf7bMW5H3DZD7df77OVSxe5bNe2tT67evnZLnv4K9f47LrLz3XZgxs/7bObrjzfZV9bv8pnX7rmQpdtvf5Sn225boXLbluz3Gd33XS5yzZ85hM+u++WT7nsc6vO89nO26522eqLz/HZY1vXuOzKCxf77Pt3r3PZpR8702cz993osmXnnOazZ3ZscNl5i0722fPf3uiys05/r8/27NrssjNOPtFnv3pyq8sWvucEn/1u5i6XzZ93rM/+9Mx2l51w7NE++8tPvu6yuUcd7rPXXvymy+a8+U0++8crj7js4De+wWf/+vXjDrmN+9AGbSU7/N99IEOfkuG5kOG5JcOYkGGMkmHsyHAskuEYkeGYJcO5QIZzIxnOGTKcQ8lwbpHhXEuGa4AM10QyXCtkuHaS4ZoiwzWWDNceGeaCZJgjyDBnJMNcQoa5JRnmHDLMQckwN5FhrkqGOYwMc1oyzHVkmPuSYU0gwxqRDGsHGdaSZFhjyLDmJMNaRLZ08Sk+w5pFhjUsGdY2Mqx1yeAAZHCCZHAFMrhDMjgFGRwjGdyDDC6SDI5CBmdJBpchg9skg/OQyW2Qq6Gkig4JIYTsk2uuKFVCCClgZKlqnRJCSJ/JFaVKCCGF5Ipv/wkhpAB+pkoIIR1CqRJCSIeMLFWtU0II6TO5olQJIaSQXPHtPyGEFMDPVAkhpEMo1X/z2ks7986fP3/vjs37/r88scnKZUvcdQpBFrf7/VPb92vD60omychS1TqdNijV6QDX6KVd+35pRgoRKn5KxmtLJk2ueiFVYh954QtlqYGdayxQiBiPRR9hTsi4yFUv3v4T+wwj1Vwb5IN2uYR0wdg/U8WuAbsHeVsmyMS/de1lPtM+H5NdRki8aGR3svv+9Qf0Iwstfrz8lHa4jcfLbRm33CfwbWQd5Jrldpu5HanMkTgnpGsmIlVMdMgzzjDRw92DJq1QkEDEGS4ctNEWjSzEUJaSgUFSlXaSaf2RyRBeNyG+3jI3wkzA/IvbEzIORpaq1mmIyCmUoOweQ9ECLIpYohp4bChjkWrYBqD/+DmALL5hpBrvepAPM0YyXrQ5RKkSK+SqE6lqEoolBlKLQtulhI9F/9qCQTvtczTpb5BUtXGjDaVqg/g6puYPoFTJJMlVJ2//ZytV2Y2AcMcYP1aTqjx2HFJF2zgndQivm3ymGrcBuJbh9SVkXEzkM9XZSnXYx1Kq/SW8btp1Ddtpc4GQrjEv1fgzUVk44WM1qeZyZPHii/tMjTseI6mHJlFcs3he5XawhHTNyFLVOg1JySmWGIiFJbdj+cWPTclTFlPYVjKt37AdpWoLXI/wesk7kfi6y/WNry13qWSS5KqqVAEej0xAFj82JVUQShTI4sSfc5/TpsZNqdZBzntISpTxNadQyaTJ1chv/y0iiy6UKiGEdMHYP1O1CHah2r9fJYSQUWlaqnjLGL/1k7eR4WduhBDSFSNLVevUCvLZaYzWlhBCuiJXUy1VQgipQa6m+u0/IYRMmqY/UyWEkElDqRJCSIeMLFWtU0II6TO5olQJIaSQXE3N23+MgxDSbzQ3TBqMI1dTJdX/+5/HCSE9hVLtGEqVkH7TjFS1TmtAqRLSb6xIFeSKUiWETAXNSNXKgVCqhPQbSy7KFaVKCJkKKNWOoVQJ6TfNSFXrtAaUKiH9xopUQa4oVULIVNCMVK0cCKVKSL+x5KJcNSPVv726w/3W/z0zm9X7J8XMw59349DuI4TMHkq1YyjVfrFz2+rktfzjC/e4cyygrdaOtEUzUtU6rQGl2h9Eltq1FKHip2S4TbG2jxWpglxRqh1Dqc6eVSuWuHMnaNcSbWKBoh3aYw6EOWmLZqRq5UAo1faR65e6lpKHu1TBwrUn48WSi3LVpFRFbAJua4+Jd0bxDijsc9ONlx3QJv5sD21SUh00JtmBSTvcDu/vEymp4jZy3B/mQNvBkragVDtmWKlicYXCEvGFmbSNF6E8Pm6HLLXAw11TKM6wLZ4nzKTfcEx4DophH3J+4nMu5zfMBLyg8dy1TTNS1TqtwbBSxeKK74sXI9po7eLFLLe1xYo8lKKAfsPnEqnHb1njMYlUwzZ9hVIlGlakCnLVnFTjhQhEbGiD26l2INwtpvqM+wuJFz5ua7KM++Au9XVS551S7TfNSNXKgXQl1Vw7EC7OVFvclv7CHMQLH33hdgrZwVKqrzPovIeZgPOHc6/dR9rAkoty1QupxhJMtQPD7FTj/kKG3anGUKqvkzrv8uIoL0QhWnvSFpRqxwwrVU1M2H2C1G1B+pBFm1rcqRxAjrhPbucEHEKpvs6g8xvvSOUchxlpj2akqnVag2GlGi9G2TmGuxvZ8cQSQxbKNre48di4X8lA2BZ9xhkeFz4/pfo6ufMuAg3Pe6otaQsrUgW5ak6qWFwiMQH3aY8J24B4B5Rb3CCUqLSL3/4L8ZjiNpTq6ww678jD85hqR9qiGalaOZBBUiWEtI0lF+WKUiWETAWUasdQqoT0m2akqnVaA0qVkH5jRaogV5QqIWQqaEaqVg6EUiWk31hyUa4oVULIVECpdgylSki/aUaqWqc1oFQJ6TdWpApyRakWgnEIr/z3/Y5DDj3YZz//zXaXzZlzmM+e/8VXXXbU0XN89uzLd7rsmGOP9NnTP7vdZcfPm+uzmee+7LJ3zz/OZ08+vdFl71twvM++N3OLyxae+i6fPfbkzS47/cz5Pnto1w0uW7T4JJ89+Og6l5295GSf3bvzWped+/FTfXb3A9e4bOmyD/ps6/arXHbRJYt8tnnbJ112ycrFPtt4+xUuW3nVOT7bsOkSl121+qM+u+ELy1322XXn++y6my5wGX5KhvuRob1k6AcZ+pUMz4cMzy8ZxoUM45QM40eG45EMx4kMxy0ZzgcynB/JcN6Q4TxKhvOLDOdbMlwHZLgukuF6IcP1kwzXFRmus2S4/sgwHyTDPEGGeSMZ5hMyzC/JMO+QYR5KhvmJDPNVMsxjZEAyoK2DGmAsmhtqkCu+/S8E45CJR0jrUKoHgnHkilItBOPQJh8hLWJl3QFLLsoVpVqINvEIaRltHdSgGalqndaAUiWkDto6qIEVqYJcUaqFvO2YI9SJR0iLYL5r66AGzUjVyoFYkSrGoU0+QlrEyroDllyUK0q1EIxDm3yEtIiVdQcsuShXlGohP37hDnXyEdIimO/aOqhBM1LVOq2BFalqE4+QltHWQQ2sSBXkilItZMHCeerEI6RFMN+1dVCDZqRq5UCsSBXj0CZfDVavu8ih3ReDL8i754G16n2EpLCy7oAlF+WKUi0E49AmXw1GkeoFF53tCNvUBuMLvyV145Yr1Xa7//PLQ7Ujo2Nl3QFLLsoVpVrId3dvUCdfDVqSKsQYjue5PXepwhSh4qdkFOv4wHzX1kENmpGq1mkNrEhVm3i1GEWq1njkifVqhnFDsJJBvLFAtXakO7R1UAMrUgW5olQL+fCSherEq0FLUtWQXanIUnav4S5VQK6JmYwG5ru2DmrQjFStHIgVqWIc2uQLkd1U/NmfJkDZZYVo0og/b8TtlFSRhW1lHKFU48eGu73w8amPCJBLG6A9x6jEO9DcjlTbwZLRsbLugCUX5YpSLQTj0CZfCBY4iIUHIcRZLC2RZygOyAJZ2E7Ep/WnPS8YRqoglLr2HKkMdClVPEd4fuTchG0EtKVUu8fKugOWXJQrSrWQe3euUSdfCESgLX7ZzWk70RC0geTw59xjkIdyS0lH+hhGqvK8cS6SL3mOUZDnCY879dyAUh0PmO/aOqhBM1LVOq2BFalqEy8GUk0tcEghFpcIKUTkhJ/xblaIxZgTS9gniB8by1OQsUle8hyzBc+BvkKhAkq1Dto6qIEVqYJcUaqFXHzFvu83yjGsVCEq3AahzHBb5IR+hpXqoOcdRaoiuJLnKCU8H9r9MkbtPoyrC6GT/cF819ZBDZqRqpUDsSJVjEObfCEp8Yg0RKopYYZy6otU5dyEY4qJxxKCXM4r6Q4r6w5YclGuKNVCMA5t8oVAPJoIIRwsfrkNOcUSEXGInFKy0ySUErD00YVUS56jhHg8KfDc8XPIc4cZ6QYr6w5YclGuKNVCbr1j31ct58DCxyIPd3SxLAH+HAoL4HbcTvqT22EWikgTrWRxn7HEhpVqyXOUgMdiDNp9ITLO+JwN81hSDua7tg5q0IxUtU5rYEWq2sSLgfAgVJGmoC18tAvbIMPPWE4iUQEii8UIQsEBPA45/tyFVEHuOWYjt7i/mPDFCchYBQp1vGjroAZWpApyRakWcu31S9WJFyJS1e5rFREjBdcWmO/aOqhBM1K1ciBWpIpxaJMvpI9Sld2jdh+ZXqysO2DJRbmiVAvBOLTJF9KyVPExQHxs8hHBbD9PJXaxsu6AJRflilIthG//9312GhN+5kragW//D2RkqWqd1sCKVLWJR0jLaOugBlakCnJFqRYyzD+pIqQV+E+qdHLFt/+FYBza5COkRaysO2DJRbmiVAvBOLTJR0iLWFl3wJKLckWpFjLML1QhpBX4C1UOZGSpap3WwIpUtYlHSMto66AGVqQKckWpFjLML6meFDgnpF20az5p+EuqdXLFt/+FWJnsAGP5+k/2kAaxMs+srDuAsWhumDQYR64o1UIwDm3y1QBj0RYkmX6szDMr6w5gLJobJg3GkStKtRBLX1GNc6ItSDL94Npq13zS8CuqDwTjyNVAqWqd1sCKVLWJVwtKtV2sSBVo66AGVqQKckWpFvLd3RvUiVcDSrVdrEgV811bBzVoRqpWDsSKVK1MdoCxaAuSTD9W5pmVdQcwFs0NkwbjyBWlWgjGoU2+GmAs2oIk04+VeWZl3QGMRXPDpME4ckWpFrJg4Tx18tUA50RbkGT6wbXVrvmkwXzX1kENLLkoVwOlqnVaAytS1SZeLSjVdrEiVaCtgxpYkSrIFaVayI9fuEOdeDWgVNvFilQx37V1UINmpGrlQKxI1cpkBxiLtiDJ9GNlnllZdwBj0dwwaTCOXHUu1ZXLlhzwVRvI4na/f2r7fm12bF5zQJuQUS7u317dsXfViiXqfWDTjZftNxa019oBjEObfDnwVdBh/6lvHB3mK61DMBZtQVoBx7D8M59N3id8+PwL1DalbH78B/v1m3rutXd8db926x94SG1Xk9w8k+8EE+QrwjWGbZeiZN1hjaXWTskaS4GxaG4A4/KOBsaRq86lioG+tGuLep8gB4afkg06wJKLGzLz8Odd3ymp4mIDuS3tUxf9bcccoU6+FPH3Vcm3jsbCFKHKbVk4ObHinGgL0gIiLk1syHG/3EabUcUKMaJfiFUy9Bk/v4xLbouIrYkV11a75jJ/8JXgkmGOacJEu/DLGPHiXipWzHdtHYT88YV73HMBbd2UrrEUORehv3F4RwPjyNVAqWqdpnjtpZ0HDFoDryDxgeCE4LHoI8yFUqnumdns+hM0qUqb+OKi7c5tq/fLBG3i5dCkCMmGkzv1nflxuxirUr1r5r/8eY+lduXNXzpAoNJ+FLGhz1DUQPoV0aaeRxtTbXJSjTNt/mhzJzXPBqGtA4B1g/5C4rU0mzWWIiXVcXonRa4mLtVcG+SpV5tSqeLVUESKi6dJFXn4CiqEj43RJl0p2D2EEx6THMcetgGyWw13JSFWpQpJAQg1lqomP4B2eEycD0Msz5Dw+WQ3G7eR3Sr6ie+rRUqqKTD+UJaYX9pXhmO3WvpNv9o6ALJDhTBT8pzNGksxilRn650Uuer07T8GjAHmrJ97ZdBeSYRSqYakpIpMe7VMTRBQOtk14l1Eakc6aGeBsWgLsiahoGKppnaKIN4tStvU7jPMJdOkGo4htSPNjasWJfMsnie5eTPo3U/MsOuudEeaW2MpMBbNDeP0jgbGkauxSDUkHuzu+/ftysJMuHXtZROVKsaBV8w4D1+B4/swDm3ylYC+w90Cdg8gbCOg7TRJFeMV4cVSFeFq8sNjYuHFAk2JFuRyGUM8nhC0m1apyufx8o5G3uHgp9Z2klJFVrrGUmAsmhvG6R0NjCNXnUo1RrbcGLRkfZeq/EuAOGtBqvKWX27HEiuVKhCRom/81MQJkMd947nRp4whHk8IHjuNUhWBhm/1+ybVmC69o4Fx5GqgVLVOS5BXEfzE7WmXqjbxhgV9gjhvQaryeSUkKFkssdlIFeR2qCEyBgG38fzyWW1rUpUdaihU0KVUQbwGNCxJFXTlnRS5GrtUAQ4GB4U/y2cbcRuAzzakXcw4pIpMu+AyQeIcaJNuEJAi+kuJEx8FaPfJZ2Pa4gBWpCrSi6UUS0zaaVKNd7nCsDvVFBC1PGbQc2jjqsUgqUKMGLM2N3LzJjXXcmjrICYl1dmssRQlUgXuHIzonRS5GuvbfyE8uPgVJG6X+lu4cUg1/vdzAiaB1h6U/jtVEWq8mwiRHUecy45DPiuLsSJVEV4OES7+rIkRspMdpRDvUOPbg4hlicfhdtxOdtBoH99Xi5xURajafQLu1+YchBp+nj+IYf6dKkhJdTZrLMUoUp2tdzQwjlyNXarawWivDLlXEoBxaCd6GFJSTb1apl5dQW6ya6D/nFBBamcxaFeBsWgL0grxThVou0Vtp5gSaIlY4+fSnkdrZ4HUPEu9AMdoc2fQOx+NYdddSqqzWWMpMBbNDRpdeUcD48hVp1LF5xLhQcgHxvHnFXIgYVvczr1aDHtxNVJSBcjDV9JBr6AYhzb5NAbtNEOwCNBWbg/zWIxFW5BW0KSqSRFt4l1qKegPfYe38TxhBvA8yOW2xV0qSM2zYXeaItDwBb10lwqGXXcpqYLSNZYCY9HcME7vaGAcuRooVa3TFHgVwCBDUgOWAxzUThj24mrkpApwn4xj0MUu+S1V8tY/RfwXUCJWYZCMcU60BWkFTapAxCqMKlQgEhVSf+kFRKyCNaECXFvtmstbf434L6BErEKpUMGwv6UqJ1VQssZSpKQ6Tu+kyFWnUh0no0i1S7SJVwvrUiWzJyXVGmjroAYpqdYgV52+/R8nVqTK3/xPJoEVqfI3/x8IxpErSrUQK5MdYCzagiTTj5V5ZmXdAYxFc8OkwThyRakWgnFok68GGIu2IMn0Y2WeWVl3AGPR3DBpMI5cDZSq1mkNrFxcfu8/mQS4tto1nzT83n+dXFGqhWgTrxaUartYkSrQ1kENmpGqlQOxItUPL1moTrwaUKrtYkWqmO/aOqiBJRflilItxMpkBxiLtiDJ9GNlnllZdwBj0dwwaTCOXFGqhWAc2uSrAcaiLUgy/ViZZ1bWHcBYNDdMGowjVwOlqnVaAysX996da9TJVwOcE21BkukH11a75pMG811bBzWwIlWQK0q1EG3i1QLnhLSLds1roK2DGuCcaG6oQa749r+Qi69YrE48QloE811bBzWw5KJcUaqFYBza5COkRaysO2DJRbmiVAvBOLTJR0iLWFl3wJKLcjVQqlqnNbBycW+94wp18hHSIpjv2jqogRWpglxRqoVoE4+QltHWQQ2akaqVA7Ei1WuvX6pOPEJaBPNdWwc1sOSiXFGqhWAc2uQjpEWsrDtgyUW5olQLwTi0yUdIi1hZd8CSi3I1UKpapzWwcnH59p/0Cb7918kVpVqINvEIaRltHdSgGalaORArUuU/qRof8p32QurbP+Xruwe1I6PDf1J1IBhHrijVQjAObfKR0YAYw69Ylq9XjoUpQsVPySjW8WFl3QFLLsoVpVoIxqFNPjIajzyxXs0gTAhWMog3FqjWjnSDlXUHLLkoVwOlqnVaAysXl79QZXLIrlRkKbvXcJcqINfETEaDv1BFJ1eUaiHaxCPjId6B5nak2g6WdIO2DmrQjFStHIgVqf6HoV9S3Tqr11203+es8hdZYRsBbSnV7sF819ZBDSy5KFeUaiEYhzb5SLeIQMO3+pTq5LGy7oAlF+WKUi0E49AmH+kOCDIWKqBUJ4+VdQcsuShXA6WqdVoDKxfX0ldUt4b8RVRKnPKZqnYfPiaAdLX7yOzhV1Tr5IpSLUSbeGR0RKjYcWr3A/nXAPzb/8mirYMaNCNVKwdiRarf3b1BnXhkNCDTnFAFbUea28GS0cB819ZBDSy5KFeUaiEYhzb5yGgMu9MUgYa7Ve5Sx4eVdQcsuShXlGohGIc2+cjsCT9L1Uj9DyqBQh0fVtYdsOSiXA2UqtZpDaxc3AUL56mTj5AWwXzX1kENrEgV5IpSLUSbeIS0jLYOatCMVK0ciBWp/viFO9SJR0iLYL5r66AGllyUK0q1EIxDm3yEtIiVdQcsuShXlGohGIc2+QhpESvrDlhyUa4GSlXrtAZWLu7bjjlCnXyEtAjmu7YOamBFqiBXlGoh2sQjpGW0dVCDZqRq5UAoVULqoK2DGlhyUa4o1UIwDm3iEdIiVtYdsOSiXFGqhWAc2uQjpEWsrDtgyUW5GihVrdMaWJKqIBPvkEMP9tnPf7PdZXPmHOaz53/xVZcddfQcnz378p0uO+bYI3329M9ud9nx8+b6bOa5ff/H/d3zj/PZk09vdNn7Fhzvs+/N3OKyhae+y2ePPXmzy04/c77PHtp1g8sWLT7JZw8+us5lZy852Wf37rzWZed+/FSf3f3ANS5buuyDPtu6/SqXXXTJIp9t3vZJl12ycrHPNt6+76u9V151js82bLrEZVet/qjPbvjCcpd9dt35Prvupgtchp+S4X5kaC8Z+kGGfiXD8yHD80uGcSHDOCXD+JHheCTDcSLDcUuG84EM50cynDdkOI+S4fwiw/mWDNcBGa6LZLheyHD9JMN1RYbrLBmuPzLMB8kwT5Bh3kiG+YQM80syzDtkmIeSYX4iw3yVDPMYGZAMaOugBhiL5oYa5IpSJYRMBc1I1cqBUKqE9BtLLsoVpUoImQoo1Y6hVAnpN81IVeu0BpQqIf3GilRBrihVQshU0IxUrRwIpUpIv7HkolxRqoSQqYBS7RhKlZB+04xUtU5rQKkS0m+sSBXkilIlhEwFzUjVyoFQqv1i57bVe/fMbFbv++ML9+z3FdVoq7UjbWHJRbmiVIk5RJaaVEWo+CkZxdoPKNWOoVTbZ9WKJV6oKamiTSxQtEP7v726Y7+ctEUzUtU6rQGl2j4iUshRk6rk4S5VSEmYtIMVqYJcUarEHCmp5nak2g6WtEUzUrVyIJRqf0hJdebhz7s8zIRNN15GqTaOJRflilIl5qBUiQal2jGUan+gVIlGM1LVOq0BpdofBn2mGmYCPlOFdLX7SBtYkSrIFaVKzJGSqvZvVAWtPWmLZqRq5UAo1f6QkirQdqS5HSxpB0suyhWlSsyRk6oINP4fVdyltg+l2jGUan/ISRWIWAUKtR80I1Wt0xpQqoT0GytSBbmiVAkhU0EzUrVyIJQqIf3GkotyRakSQqYCSrVjKFVC+k0zUtU6rQGlSki/sSJVkCtKlRAyFTQjVSsHQqkS0m8suShXlCohZCqgVDuGUiWk3zQjVa3TGuBACCH9RnNDDXI1NVIlhBAr5Gpq3v4TQogF4MRcUaqEEFIApUoIIR0yslS1TgkhpM/kilIlhJBCcsW3/4QQUgA/UyWEkA6hVAkhpENGlqrWKSGE9JlcUarEDCuXLdnvW1IBsrjd75/avl+bHZvXHNCGkHGSK779J2aAIF/atUW9TxCh4qdkFCuZJPxMlUwFr7208wBZamDnGgsUIsZj0UeYEzIOKFUyFQwj1Vwb5IN2uYR0wchS1TolpGvkbX1ut5nbkWo7WELGRa4oVWICkWpILMnd9693eZgJt669jFIlEyNXfPtPTCJv9SFLyShVYgF+pkqmFtm9ymeolCqxAKVKphpIFDLFn+Uz1bgNwGeq0o6QcTKyVLVOCZkUoVTjnWvcjn/7TyZFrihVYhZNotqONLeDJWQc5Ipv/4kJ8HloKE/5i6r4c1IRaNiWu1QySfiZKpkK5C+hQlKiFLEOakfIOKBUCSGkQ0aWqtYpIYT0mVxRqoQQUkiu+PafEEIK4GeqhBDSIZQqIYR0yMhS1TolhJA+kytKlRBCCskV3/4TQkgB/EyVEEI6pBOpCujwn7981N8+7NBDXPb3l7/lsyPf+haX/fWn3/DZcXOPcNmfn73PZye+Y67L/vDUPT476cS3u+y3u+/02WknvdNlrzyxxWcfev++X57x4nc2+ewjZyxw2XMPfdFnS886xWU/euBmn6049wMu++H26322cukil+3attZnVy8/22UPf+Uan113+bkue3Djp31205Xnu+xr61f57EvXXOiyrddf6rMt161w2W1rlvvsrpsud9mGz3zCZ/fd8imXfW7VeT7bedvVLlt98Tk+e2zrvv8Tf+WFi332/bvXuezSj53ps5n7bnTZsnNO89kzOza47LxFJ/vs+W9vdNlZp7/XZ3t2bXbZGSef6LNfPbnVZQvfc4LPfjdzl8vmzzvWZ396Zt//zT/h2KN99peffN1lc4863GevvfhNl81585t89o9XHnHZwW98g8/+9evHHXIb96EN2kp2+L/7QIY+JcNzIcNzS4YxIcMYJcPYkeFYJMMxIsMxS4ZzgQznRjKcM2Q4h5Lh3CLDuZYM1wAZrolkuFbIcO0kwzVFhmssGa49MswFyTBHkGHOSIa5hAxzSzLMOWSYg5JhbiLDXJUMcxgZ5rRkmOvIMPclw5pAhjUiGdYOMqwlybDGkGHNSYa1iGzp4lN8hjWLDGtYMqxtZFjrksEByOAEyeAKZHCHZHAKMjhGMrgHGVwkGRyFDM6SDC5DBrdJBuchk9sgVwOlymKxWKzhi1JlsVisDotSZbFYrA6LUmWxWKwOi1JlsVisDotSZbFYrA6LUmWxWKwOi1JlsViszmrv3v8Hd4aUYaGW5mYAAAAASUVORK5CYII=" alt="16549204799174"></td></tr><tr><td style="text-align:left">标准盒模型下的<code>width:100px;</code> <code>height:150px;</code> 只包含了 content 部分，所以 content 的宽高为 100px 和 150px;</td><td style="text-align:left">怪异盒子模型：<code>width:100px;</code> <code>height:150px;</code> 包含了 border、padding、content 三部分，则通过计算得出 content 内容区的 高为：<code>150px - 20px*2 - 10px*2 = 90px</code> 宽为：<code>100px - 20px*2 - 10px*2 = 40px</code></td></tr></tbody></table><blockquote><p>应用场景：</p><ul><li>如果我们期望不管<code>内容区</code>，<code>边框</code>、<code>内边距</code>大小如何变化，元素的可视宽高始终不变时，就可以给元素添加 box-sizing:border-box;属性，以怪异盒模型来渲染。</li><li>不管元素的占位宽如何变化，始终保持边框和内边距不变，希望通过改变内容区大小来达到目的。</li><li>常见的响应式开发中、栅格系统等。</li></ul></blockquote><h3 id="display-属性">display 属性</h3><p>三种元素类型对比</p><table><thead><tr><th style="text-align:left">元素类型</th><th style="text-align:left">排列方式</th><th style="text-align:left">盒模型属性</th><th style="text-align:left">内容</th></tr></thead><tbody><tr><td style="text-align:left">块级(block)</td><td style="text-align:left">独占一行</td><td style="text-align:left">width、height 有效</td><td style="text-align:left">任意元素</td></tr><tr><td style="text-align:left">行内块(inline-block)</td><td style="text-align:left">一行可显示多个</td><td style="text-align:left">width、height 有效</td><td style="text-align:left">行内或行内块元素</td></tr><tr><td style="text-align:left">内联（inline）</td><td style="text-align:left">一行可显示多个</td><td style="text-align:left">width、height 无效</td><td style="text-align:left">行内或文本元素</td></tr></tbody></table><p>隐藏元素方法</p><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">功能</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><strong><code>display:none;</code></strong></td><td style="text-align:left">隐藏元素</td><td style="text-align:left">可以将元素隐藏，子孙元素全部隐藏不可见。并且只要父元素隐藏，子孙没有任何办法可见。 元素隐藏后不会占空间。就好比页面当中就没有加过这个元素一样。</td></tr><tr><td style="text-align:left"><strong><code>visibility:hidden;</code></strong></td><td style="text-align:left">隐藏元素</td><td style="text-align:left">将元素隐藏，子孙元素全部不可见，但是给子孙加上 <code>visibility: visible;</code>时，子孙可见。 隐藏后仍占其位置，会留下空白的一块区域。基本不用。</td></tr></tbody></table><p>两者的区别：</p><table><thead><tr><th style="text-align:left">区别</th><th style="text-align:left">display: none</th><th style="text-align:left">visibility: hidden</th></tr></thead><tbody><tr><td style="text-align:left">空间占据性</td><td style="text-align:left">不占据空间</td><td style="text-align:left">占据原空间</td></tr><tr><td style="text-align:left">回流与渲染性</td><td style="text-align:left">会产生回流与重绘</td><td style="text-align:left">不会产生回流，只会产生重绘</td></tr><tr><td style="text-align:left">对子元素影响</td><td style="text-align:left">子孙元素全部隐藏不可见。并且只要父元素隐藏，子孙没有任何办法可见</td><td style="text-align:left">子孙元素全部不可见，但是给子孙加上 <code>visibility: visible;</code>时，子孙可见。</td></tr></tbody></table><h3 id="去掉行内块元素默认的空白间隙">去掉行内块元素默认的空白间隙</h3><blockquote><p><strong>产生间隙原因</strong></p><ul><li>元素被当成行内元素排版的时候，元素之间的空白符（空格、回车换行等）都会被浏览器处理</li><li>根据 white-space 的处理方式（默认是 normal，合并多余空白），原来 HTML 代码中的回车换行被转成一个空白符，所以元素之间就出现了空隙。</li><li>这些元素之间的间距会随着字体的大小而变化</li></ul><p><strong>解决办法：</strong></p><ul><li>给父元素添加 <code>font-size: 0px;</code> 同时子元素重写 font-size</li><li>给元素添加 float</li><li>图片间空隙，给图片添加 <code>display:block;</code></li></ul></blockquote><p><strong>① 给父元素添加 font-size:0; 同时子元素重写 font-size</strong></p><blockquote><p>TIP</p><p>font-size 属性有继承性，所以父元素 <code>font-size:0;</code> 会继承到子元素 span，则子元素需要重新设置 font-size 大小</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 去掉以下span行内块元素间空隙 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">      font-size属性有继承性，所以父元素 font-size:0;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">      会继承到子元素span，则子元素需要重新设置 font-size 大小</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>② 给元素本身添加 float</strong></p><blockquote><p><strong>TIP</strong></p><ul><li>元素添加 float 后，会脱离文档流</li><li>父元素未添加高度时，会出现高度塌陷问题，则需要清除浮动造成的问题。</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 元素全部左浮动后，空隙就消失了 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>③ 去掉图片下面的空隙，给图片添加 display: block;</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: <span class="number">2px</span> solid red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 把图片转成块级元素，就可以消除图片与父元素向下的间隙 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/flower.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>加了 display:block 之后，图片成为块级元素，独占一行</p></blockquote><h3 id="CSS精灵图">CSS精灵图</h3><blockquote><p><strong>TIP</strong></p><ul><li>将多个 <strong>小图标</strong> 合并制作到一张图片上</li><li>使用 <code>background-position</code>属性单独显示其中一个</li><li>这样的技术叫做 <strong>CSS 精灵技术</strong> ，也叫作<strong>CSS 雪碧图</strong></li><li>CSS 精灵可以减少 HTTP 请求数，加快网页显示速度，但缺点也很明显：不方便测量，后期改动麻烦</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20211201224156968.127aa74e.png" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">body</span>,</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">i</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">images/icons.png</span>);</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 文字和图标居中对齐 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">vertical-align</span>: middle;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 相对定位 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 向上移动 2px */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: -<span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.word</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">288px</span> -<span class="number">192px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.excel</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">312px</span> -<span class="number">192px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.ppt</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">336px</span> -<span class="number">192px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.pdf</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">360px</span> -<span class="number">192px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.bbd</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">168px</span> -<span class="number">192px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* 通过 ::after 伪元素，添加图标 */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.doctor</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">images/icons.png</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">144px</span> -<span class="number">192px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 上下居中，通过相对定位移动元素 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span>,</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>wordx<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;word&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>xxxx<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>excel文档 <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;excel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>PPT文档 <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ppt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>PDF文档 <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;pdf&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>太棒啦 <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bbd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;doctor&quot;</span>&gt;</span>严防严控<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgsAAAD7CAYAAADkUtf+AAAa3ElEQVR4nO3dW4g06X3f8V9t1iJocxA2K7r17iv3xooUnCBsK0jVkQNNgoluQpVtcKp8s7PExm8uhA8XpupCBimQKufCOSxLxoTg0Y2rYkLSRU7ri4QGH6psknUwJmQtKa5YkruInYNxZIWE7JOL6u6p7q5++jD9zrwz7/cDDdN1eKpmbp5fPfV/nnGMMUYAAAA7vHDXNwAAAJ5thAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFYv3vUN3KZXLr54o/O/cvWhM90JAAD3xz0PC41yf6hQmebTQIMDzji1w79p0AAA4L7iNQQAALAiLAAAAKt7/hriNJuvFL5y9SG99ZvSD/ytL66+89oBAIDW0SMLVerIcVJVnW1N7stxHKXrG+VvbFsed/1Zb6etQXDk+Lmq5bF+rub64mvnp+sn99+HKqWLdpa6dQtfufqQvvZ/zCooLP2Tz/0pSdInv/W9q+P3tf/re/Y3i7+Js3Hj7d/UV/7re/Y3AgDg9pljlYmRPJPNu5tkJBlvfaORElOuHXP9/Xpbt625yby2LSXdI42ZZ56RZLqbl9eVl5n52vn913302hdW5z567Qur72/87FdX35fbvu8n223lf/l/q+P3tb9/f8/vUSZr3/ftBwDgth0fFuaZ8daCQWkSyXie1+m0F53ksofb2eG1514Hg+3Otv+4je2d667d3+Ln5Wl9YaH+fbMWFJYB4dFrXzDf95NfXTt+X/sH7V/+jl5m5suf1xvYsx8AgNt1fIHjYKLAk4q6br83tSoliiJXKmq1WxvVleSNRpKkahZLSjRxNxtzNUkkVbXWRti9kUbd79VMsaRkq4GRRt7m/QW6zDwV4ZXSq1BFUirauu61H7/8HUnt64alv7MY7//RoGcy5r72915/oOAyk1eEukqvFBaJyvUG9uwHAOB2nTAbYqBJ4EnxTJWkZparSCZy3YkSxZq1G5UXnoJJp7PdDABdq5Bh42m0s4GNOwwiJYoVx/s72l/6j38oSfrbTz6wtu2T3/peuR/s//Psa3/v9QeBokSK41hJGWnriH37AQC4RSdNnRxMAnmqVDdSXReLJ/52lKBqN6rwAnWzgjUQ2ILEdQOq9ycKSVKTp4olSbHGm1WQPaK/8l59859Y39Y7qnBg+3uv3+RK2wMUjzeLPA/YDwDALTptnYXBSK4K1XWlWXz9xD8aeSrymfJZLLmj1YqK7iSRlqMOayrNYskLJvbVF0cjeVoEka5mprzYOLbJ9SQslJRGpkykeLw1a2LT6987XPtuG1XY2/7e6zfKn7SvJ4wplWwFin37AQC4ZacWO5SJjDzPeFvFhZ7xvB1Ffb2zIbrbusV9PddbKxbszJzYnA2xY3ZEX4Hjv37HbG1bzoDoWpsNsXP2xb79y9kO1zNANmc/7NsPAMBtOzksLGc4rE2X3DmbYXnKonPXZie/cX5PWNg+3zPZfP347amYZjUjQUm5FhaO9ei1L+xtf9/+vX+zE/6mAAA8bY4xxtzNmMbte+Xiizf6R1L810kAwPPouVvumWWcAQA4znM1sgAAAI7Hf50EAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABg9eJd38BtqFJHY5UykXur133fG6/c6Pz/+emvnOlOAAA43f0OC1UqZxwrKY1sOcC9yOQNx/JHc02DwZ5GG+X+UHW0o80qlZOONJ8G2teSdHqHf9OgAQDAuTwfryEGgS4zT0U+U3PkqVXqyM8tZzW5fD8/ul0AAO6L+z2y0LUYZbArNHTC3j27RifcaK7AH8qpe15jNLn8YSg3m1uv2jdK8M9e+7uSpO/+/I9s7eP1AwDgWfJwRhbcSMaY9jPP5ClRufy++Zln8tQGhOW2aJTLdxw5zlBhIcVjR47jyM+lYFoqicdKq+4FG+VPQrmlURQMrK8kfuzbf0jSegj47s//SG9QWB4LAMCz4vSw0Cw718WnMxTf5L4cx9noXCulG8e19QH9bey7htVgJFeV6l0H17UKJZp0BwoGgabGyJhSia6DRFvj4CoymyMPAwVTe63E0k9852f0HY8+ove98Yp11ODHvv2H9BPf+Zn9DQIAcItOCwuL4Xdl88WT+VyZQg0XnfkguFTmSfE41TIvVOlYsRKVy8LAJpfvDBW65fUT/6U0qw67hp2rSVIovKp691azWEom6u3nq5nWXmZU6XVYcZz2VUcRanhkiPm33/NvJGlnYCAoAACeWeZoc5N5MvIyM+9uLhMjeSZbbpxnxpOMl81XPyflnjaOvUaZGK21220iM1732H3bV03KSO3H23XQ5j3t+D3+5N9/1LttuX3582d/4XMHnQsAwF04fmShmSkvJC+YrL+nH43kqVBdL74vZyCEV0qvQhVJ2Rmyr1X3tXHsNWwGgaKt0YW2zkDZpfpnUFaaVYkST0rKuYJ8aJ8JcQPdEYaf+rWf1vveeGX1AQDgWXJyzUIRDteH54ehCklVp1BgEERKFCuOE5Xdl/tNrUqSO7KvVHDINWzcqC1MXHb4VTpUqEyXO9ZaaPJUVTDRqL17BdNS7gnTLXfZDAJ9ryT+5V/8V2e6GgAA53FyWOjOJOh+uoseNXm6eP8fa5xu1w/s6/QPuYadq2ieSYvQMa4yy2JKla5CV1EwWj//UnrSDSybn73TNVt/6Z/+5d7tm4HhM//5Rw/83QAAuB3Hh4XBRIEnxbP+4sGVJteTsGg7/DKRulMPF23sXCTp0Gsccb+SpCLXbFc+aWopu9guelzNktjxKZO9t/C5X/ybevur7+zc3w0MtuMAALgLJ4wsDBREbee/9j5/bSXDtjag8DJduJLci43ZEYs2ilDD7ohDkyuvDr3GflXarptQR23H3g4y7Ji9MAgUHTxicZyf+rWf3nsMtQoAgGfVaSs4upFMKTnjoVYLInrXQ/xVOlRYeMrmyyH/gYLLTHkRapxO2pUQ3UhmPpI/HMuJu20cdo2dFlMuC0leNpcx10cPgqlM0IaIdiVHT9l8uqPY8XxYkREAcJ85xhhz1zdxFqvlnhOVJupfQ2HTKlh0Q0P3H0m1P4fFnnZ2hJh9izDZ3ORcAADO6eH8bwg3kjHRcecMAk1NYDtAwdTIdkT7Xyh37+b1AgDgvns4IwsAAOCpeDj/SAoAADwVhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABg9eJd38CNVKmcsVSaSO4tXvZLf/0bb3T+t/yj/36mOwEA4Om732HBvVDmDTX2R5pPAw32HN7kvoZ1JBP1RYtKqZNqNJ8q2NeQTu/wbxo0AAC4bSe9hmhyX47jbH38vFk7rkq3j3EcR2m1akh+z/7eY3sNFFxm8opcs8Z2XI8qlePn2n1ao9z3ldva/V+/ddwHAIB76AYjC56y7lN4lcoZD+Vrrunao3my9pqgyX0Nx45UGkVuoKkJVkdWqaNxlW2MElRKnbHiPXdTDB2FfTuSsn8kwY00D3wNnbrnNUaj3B8qdDPN91z3Sz/8sd7tL33i4xp8/z/YczYAAM++8xU4upHKRCrCK9kGAwbBpTJPilPbU/1aw4qMkTFGxsyVeVJSLr9vftr9SsrrbdFIud+OUgzDQorH7aiFn0vBVGUSa7wxfNHkTxS6pUwUaHDAK4k+X/uVX1Xzs39D0u5AAQDAfXDW2RCjkXfAUQONTq5GbM+t6l0xo1ZdSMnEXTsnmLbBoUx0HSQWoxduZLZGHgbBdEddg923/L1/r0ef/uer71/7lV9dbQcA4L46a1io60LyRhpZj2pUV5Lc0d6CxD7uJNk9elHNFCvRpLefrzSL17+na/URY8UqFA672/bULByIkQUAwH12trDQ5L7GsZRE9lkJVTpUWHjKLk4cXnAvlHmx0q1evFGexvKyi/5plNWsrXuIx4vCxu7rjb5PqeTIW/vSD39MX33jr66+v/SJj0tiZAEAcL/dICysP4UPQymbG22P3scad57gx3Gi0hw2PbHfQEG0PbrQ5E8UKtPljoarWaUk8aSk1DzINbTOhLi5lz7xcb3v45+RxMgCAOB+O99siJ2S8y+a5EYqE+d6fYUqXYSVHaMaTa60ChQFuVS3NQll7WvWBDcILdt2jSAwsgAAuM/u7aJMbjRX5g81dELtCy7VVSg3MhrVeef8S9W+I6ewXcVTduR97RpFIDAAAO6rexsWpIEmgScVhaRC+axR0JsWGtXKdOFKqtfPD6ZGQc8ZrXZFx2MRCgAAD839DAtVKmccL6ZBTtuVIIdDOWHfCMNAQdRGgqdZo7DEyAIA4KG5R2FhsapiIcnLNDfmuj5hsFgJskrlLFZy9LLNlSSfjs0QQCgAADw0J4WFQTCV2T1+v9IueHR4u25kZLa2Xi/3nJRGZmptQMZEWgYLJ9wdGprcb1d0tNpTs/DHXt1zPgAA9989GFlo10M4InNofz3CIYHHXrPAf48EADwvHGPM9sM8AADAwlmXewYAAA8PYQEAAFgRFgAAgBVhAQAAWBEWAACAFWEBAABYERYAAIAVYQEAAFgRFgAAgBVhAQAAWBEWAACAFWEBAABYERYAAIAVYQEAAFgRFgAAgBVhAQAAWBEWAACAFWEBAABYERYAAIAVYQEAAFgRFgAAgBVhAQAAWBEWAACAFWEBAABYvXjXN3AOVeporFImcm/1uv/u5ZdvdP6f/93fPdOdAADw9DyIkQX3IpMXj+XnzQFHN8p9R2m1Y3eVyvFzHdLSLu9//XX92d/+bb3/9ddv0AoAAM+Gk8JCk/tyHGfrs9lZV+n2MY7jyNnRU+9qd2/nPQh0mXkq8tnRnXyVbt/3xk3JPyE8OO+8feQZAAA8m24wsuApmxsZs/iUiYpw2NPxJipN5zgzV1aN5Ti7nu432jVGZhpoUKX9QWLxGYaFVIQa7ti/ayTBjeYK8mF/gGly+cNQbjA5+q/zwjd9UP/j5//F0ecBAPCsOd9rCDdSmUhFeKVdI/ytgYJpGy7isa+D3hws2l+Fh3kmbyuEmI39UlJeb4tGuXzHkeMMFRZSPF6OhkjBtFQSjzcCRaP8SSi3NIqCgQZH/Cle+k/v6D2PH+v//g41CQCA+++sNQujkXf4we6FMq9Q+OSE+oDBSK4q1btOrGsVSjTp1jsOAk2NkTGlEl0HiWkwkOQqMkbr9ZFtqDmlZvJrf+YjkkTNAgDgQThrWKjrQvJGGh109ECTwJOKWvXRV3I1SQqFV/1jGNUslpKJevv5aqZ47fvG641xvP0648iahcGnP62vf/3revmznz3iLAAAnk1nCwtN7mscS0kUHDxkPxi50tYIQaFwaC+clJYzINLt1xhNrjT2lF30DwlUszYqxONFu93XG32fMjnwt2l9wwde1nseP9Zvuh/TH/m939NH36bQEQBwv90gLKx36sNQyuanDduv2y5wbF8VbBgEirZGF9o6A2WX6jtFqjSrEiWelJRtYeNh0y0P95HP/0P97//wS3rlm/+0/qAs9Z7Hj/Vt87k++vbb+ujbb+vVN9/Uq+O/cNZrAgDwNJ1vNoSZ7uigd2vqSpKr0ZHnLblRW5i47PCrdKhQmS533EiTp6qCyeI1yUDBtJR7wnTLXb7hAy/rj37bJ/Xin/uE3vuPc7304Uf6bz/3c/r97/le/UFZSpJe+vAjvfS5Hz/TFQEAePrucAXHRrO8kJKov7bgIK6ieSZ/OJQTSvIyzae7XoNUugpdRWakOu+cf1nLdxwVtst42UF3sxxVeOe1H9yeCVH+sqS26PH9339EISgAAHfszlZwbPInCovdtQUHG0wULPveItds1zBBU0vZxXYwWc2SOL1m4dU339Srb74p85Hv0G98l2+dMvlff+Zn9Bvf5R/ymwEA8Ey4g7DQLrfc1jgc/+qiq10hcqg6ajv2eaa2jqJv9sIgUHSTi+3w0bff1ksffqQ/Ph7rD/9acPb2AQC4a7cQFmKN11ZTHCoP5ifVOEhqV1Vcrso4mrcLLi2GCwbBVMYYle5y6uMRiz6d6IXhUC980wfVvPGGfmvxqgEAgIfEMcaYu76Jg1RpuwaCEpXmwDqHxXLNhbzOKEaj3G9HIyK3/Tm0FixoZy0E/3USAPA8uD//dXK1HsIRBZGreoRdoxiLpafPuM4CAAAPzf0ZWQAAAHfi/owsAACAO0FYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYEVYAAAAVoQFAABgRVgAAABWhAUAAGBFWAAAAFaEBQAAYHXWsFCljpy0OujYJvd3HNso9x0d2Mx6e36uZqOdQ+9nn8dvvavHb717lrYAALhPHvDIwkBBlEjxTDeNC4/feldf/tQD/lMBAGDxbPSAVSrHcRafocJCisdOZ5sjx0kXnX6ltLvdNnLgTpQoVpo3u48BAABWtx4WqrTt5IdtIpDjOEoVyRiz+MyVeVJSms42I2MiuatWPGVzo3nm7bmaq8gYTYPB0/2lAAB4wI4OC03ubzzxX3/GsVYBoO/j543cqO38y0RSUsoYo8hd1BdYRhb8naMDM6XL8FGEGjq+0rT/Hk8pX+AVBADgeXd0LzgIphtP/OsjAvIyzXv3d5/wK83itVYVTLdDRP+5myaKzGKUwcs0N1NFUf89Ru6OJnboCwrLQkeKHQEAz4sXz9ZSM1NeSFKuWRPIOvJfzVR5XjsKoVLzUdqODKyM5cQ95yWlTHTIveTyh7Wi5auLze8bdnX8m0GhLzgw6gAAeOjO19PVtQovU5lJ+cxeUFjNKrmupKRUqbGe6HI1MuFl8+vRgDJZH2XYNzSweA2RayRXsWaL1w7NLFfhjTSynPrlT72w6vi7PwMA8Lw7U4/YKE9jJVEgdxJI4dXu6YpNrrQKNFn03G7UvmJo8ifKg/ni58UaDG4kM5ntqTXo1CwsXkMEA1eTRKrqNrTUdSEvmIgyRwAAjneesFBdKVSmC1fSIFCU7J6uWF2FcqNg/Sm/SjWsXbnhcGumhDOOFY9tBY6dmoWO0chTUdeSGtWV5I6ICgAAnOLmYaHJ5Y/bUYVld+xGpdzwiXr799EiVKydL5VRpGjxumHezp1cK0681JOjVmMcjNx2QaZmprxINDmyuBEAALRuGBYqpcNQyua6qP3O07+rqHQVDtOt1xFuEKy/DhgEmu4oPFw/bNqpWSgUDp2NosjNC0UyJtLogHoFAACw2+lhocnlO2NVWVtnoEnQvkZYPv27keZZpbGzHRi2ra/KuPYaYvlZ+78P7aJMhxQ9Uq8AAMDNnBQWmtyXMwzlltfrHwwGgSJTKonHq4LEQTBdBAZbzYG0XGnRWF5DmOlyRMJVZKb9UzPdkQZrS0e3C0UVi1oI+z1cYy0FAACuHb3OQpU6GseJSjPteXXQdvpdg2AqM8nlD4dy6nL/9Mfjb0jOuF2UwcsuV68fjtUNBt1pk7bAwPRKAMDzwDFmo3cHAADo4NEYAABYERYAAIAVYQEAAFgRFgAAgBVhAQAAWBEWAACAFWEBAABYERYAAIAVYQEAAFgRFgAAgBVhAQAAWBEWAACAFWEBAABYERYAAIAVYQEAAFgRFgAAgBVhAQAAWBEWAACAFWEBAABYERYAAIAVYQEAAFgRFgAAgBVhAQAAWBEWAACA1Yt3fQMPweO33r3R+V/+FJkNAPDseiZ7qSp1lFZ3fRcAAEA6JSxUqRzHOenj542kSunmvo1k4F5kqsY7AsONr99qcn/ruos9yn3CCgAAS8eHBTeSMaUSJSqNkTFGpkykzvd55klJ2e4zRmUiJaXRNBgsGvGUza/3eZrJ73bsw1CFpHi80eH7uZqzXN9moOCyDSvdcHGKL3/qhbUPAAD30Yk9mKuLrNLYSbXvAbxKHY3jRKNRX8dbaRYniqJIU2NkzFxtP29WHf3aZxpocNbrLzR5b1gpwuFaWGG0AQDwPDr5cXcQTFUmsVLb03eVahwnKk2kYLD9VN/kqeJkIvcWr1+lbcc/DAspHrchYCZ1Rya2P6WSE+4RAICH4EazIdzIaCpp5+O9G8mYXWc3muVSdnlKVDj9+m5kZKK2ZmFYRzLR4vrB4q5yX090qWkwWDsm2v2LrLG9bujuu+kMCgAAbstpIwubRYbjWFKssbP91L6rwFCqVReF6lob23pqFTbPPcv1t34ppY6jYR4omrRbBsFUpca8ggAAPNduUHVnG7bv/6wXGLqKykTxeLPu4Lr40XTqGM5/fa0ChZ+m8p2xVLZ1EW7nlYkbGZl5pmrs64b1jgAA3Et3uyiTe6HMG2pWRXJdSU2tSq4mh0xaOFFb8Lj4kpSr1xCVYo3HjuJdJyalpk/xvgAAeFadPrLgjTS68eUHGrlSVS8e2etaxaHtnnh9N+pMr+zZbkw7kuBtjlxEh9VWPH7r3dXnmH0AADyr7njyf6O6ktzRYqbCLJbckfoe4JfHAACA23VSWKhmsbxg0tupH6q+8uU4Q4XKdOFKanKlsafsYvMJvi16PPf1AQDAYU6oWViMBtywsGB0MZWJrtvMn4Qq+uoCmlqVPAWj62PPcf3bwOsGAMBDcML/hrhSWCSanL48woZGud+OMMyXxYbp+mqKyi61mshww+s3ub+aXplMXPX+r4phqKIzFXPX/7AAAOB54Bhz4GpDC1XqaDYxOrDer68FpU6q0XyqYLCYnVBlmq+Wcn7a1z8//kU1AOAhOzosAACA5wuPtAAAwIqwAAAArAgLAADAirAAAACsCAsAAMCKsAAAAKwICwAAwIqwAAAArAgLAADAirAAAACsCAsAAMCKsAAAAKwICwAAwIqwAAAArAgLAADAirAAAACsCAsAAMCKsAAAAKwICwAAwOr/A/VOt3PIAJmZAAAAAElFTkSuQmCC" alt=""></p><h3 id="background-attachment-背景固定">background-attachment 背景固定</h3><table><thead><tr><th style="text-align:left">属性值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">scroll</td><td style="text-align:left">默认值。背景图片随着页面的滚动而滚动，相对于元素本身固定，而不是随着它的内容滚动</td></tr><tr><td style="text-align:left">fixed</td><td style="text-align:left">此关键属性值表示背景相对于视口固定。即使一个元素拥有滚动机制，背景也不会随着元素的内容滚动</td></tr><tr><td style="text-align:left">local</td><td style="text-align:left">背景相对于元素的内容固定。如果一个元素拥有滚动机制，背景将会随着元素的内容滚动，同时背景图图片随着页面的滚动而滚动</td></tr></tbody></table><h3 id="线性渐变">线性渐变</h3><blockquote><p><strong>TIP</strong></p><p>盒子的 background-image 属性可以用<code>linear-gradient()</code>形式创建线性渐变背景</p><p><strong>语法：</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(direction, color-stop1, color-stop2, ...);</span><br></pre></td></tr></table></figure></blockquote><table><thead><tr><th style="text-align:left">值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><strong><code>direction</code></strong></td><td style="text-align:left">用角度值指定渐变的方向（或角度）。 未设置角度，则默认为 180deg（从上到下） 设置了角度，则 0deg 为竖直向上，然后顺时针旋转 指定关键词 to right、to top、to bottom 、to bottom right 等</td></tr><tr><td style="text-align:left"><strong><code>color-stop1, color-stop2,...</code></strong></td><td style="text-align:left">用于指定渐变的起止颜色。</td></tr></tbody></table><h3 id="径向渐变">径向渐变</h3><blockquote><p><strong>TIP</strong></p><ul><li>盒子的 background-image 属性可以用 radial-gradient() 形式创建径向渐变背景图</li><li>径向渐变 (Radial gradients) 由其**中心点*、*边缘形状轮廓、两个或多个色值结束点（color stops）**定义而成。</li></ul><p><strong>语法</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-image</span>: <span class="built_in">radial-gradient</span>(</span><br><span class="line"> shape size at position,</span><br><span class="line"> start-color,</span><br><span class="line"> ...,</span><br><span class="line"> last-color</span><br><span class="line">);</span><br></pre></td></tr></table></figure></blockquote><table><thead><tr><th style="text-align:left">值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">shape</td><td style="text-align:left"><strong>确定圆的类型</strong> ellipse (默认)：指定椭圆形的径向渐变 circle ：指定圆形的径向渐变</td></tr><tr><td style="text-align:left">size</td><td style="text-align:left"><strong>定义渐变的大小</strong> ，可能值： farthest-corner (默认) : 指定径向渐变的半径长度为从圆心到离圆心最远的角 closest-side ：指定径向渐变的半径长度为从圆心到离圆心最近的边 closest-corner ： 指定径向渐变的半径长度为从圆心到离圆心最近的角 farthest-side ：指定径向渐变的半径长度为从圆心到离圆心最远的边</td></tr><tr><td style="text-align:left">position</td><td style="text-align:left"><strong>定义渐变的位置</strong> 可能值：<strong>center</strong>（默认）：设置中间为径向渐变圆心的纵坐标值。<strong>top</strong>：设置顶部为径向渐变圆心的纵坐标值。<strong>bottom</strong>：设置底部为径向渐变圆心的纵坐标值。</td></tr><tr><td style="text-align:left">start-color, …, last-color</td><td style="text-align:left">用于指定渐变的起止颜色</td></tr></tbody></table><p><strong>指定不同尺寸的大小size</strong></p><table><thead><tr><th style="text-align:left">值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">farthest-corner</td><td style="text-align:left">(默认) : 渐变的边缘形状与容器距离渐变中心点最远的一个角相交。</td></tr><tr><td style="text-align:left">closest-side</td><td style="text-align:left">（圆形）渐变的边缘形状与容器距离渐变中心点最近的一边相切 （椭圆）距离渐变中心点最近的垂直和水平边相切。</td></tr><tr><td style="text-align:left">closest-corner</td><td style="text-align:left">渐变的边缘形状与容器距离渐变中心点最近的一个角相交(水平与垂直边相交)。</td></tr><tr><td style="text-align:left">farthest-side</td><td style="text-align:left">与 closest-side 相反，边缘形状与容器距离渐变中心点最远的一边相切（或最远的垂直和水平边）。</td></tr></tbody></table><p><strong>使用径向渐变实现彩虹效果</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.container</span> <span class="selector-class">.layer</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">      径向渐变 </span></span><br><span class="line"><span class="comment">     50% 50% 表示的是圆的大小</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">radial-gradient</span>(</span><br><span class="line">      <span class="number">50%</span> <span class="number">50%</span>,</span><br><span class="line">      white <span class="number">40%</span>,</span><br><span class="line">      pink <span class="number">50%</span>,</span><br><span class="line">      pink <span class="number">55%</span>,</span><br><span class="line">      red <span class="number">60%</span>,</span><br><span class="line">      red <span class="number">65%</span>,</span><br><span class="line">      orange <span class="number">70%</span>,</span><br><span class="line">      orange <span class="number">75%</span>,</span><br><span class="line">      skyblue <span class="number">80%</span>,</span><br><span class="line">      skyblue <span class="number">85%</span>,</span><br><span class="line">      yellow <span class="number">90%</span>,</span><br><span class="line">      yellow <span class="number">95%</span>,</span><br><span class="line">      white <span class="number">95%</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;<span class="selector-tag">div</span> class=&quot;layer&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">  &lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">body</span>&gt;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20211202233912610.e5e71482.png" alt=""></p><h3 id="CSS选择器优先级">CSS选择器优先级</h3><table><thead><tr><th style="text-align:left">选择器的类型</th><th style="text-align:left">实例</th><th style="text-align:left">选择器权重</th><th style="text-align:left">等级</th></tr></thead><tbody><tr><td style="text-align:left">!important</td><td style="text-align:left">div{ color:red!important; }</td><td style="text-align:left">无穷大</td><td style="text-align:left">特级</td></tr><tr><td style="text-align:left">行内样式（style 属性中样式）</td><td style="text-align:left">style=‘color:red;’</td><td style="text-align:left">1000</td><td style="text-align:left">第一等级</td></tr><tr><td style="text-align:left">id 选择器</td><td style="text-align:left">#id</td><td style="text-align:left">0100</td><td style="text-align:left">第二等级</td></tr><tr><td style="text-align:left">class、伪类、属性选择器</td><td style="text-align:left">.box、:hover、[type=‘text’]</td><td style="text-align:left">0010</td><td style="text-align:left">第三等级</td></tr><tr><td style="text-align:left">标签选择器、伪元素选择器</td><td style="text-align:left">div、::after、::before</td><td style="text-align:left">0001</td><td style="text-align:left">第四等级</td></tr><tr><td style="text-align:left">通配符、子选择器、相邻选择器等</td><td style="text-align:left">*、&gt; 、+、~</td><td style="text-align:left">0000</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">继承的样式</td><td style="text-align:left"></td><td style="text-align:left">0000</td><td style="text-align:left"></td></tr></tbody></table><blockquote><p><strong>TIP</strong></p><p>首先要找到，有哪些选择器在控制标签元素的样式，然后按以下 5 步来分析，最终生效的 css 声明。</p><ul><li>第一步：找有没有带 important 关键词的 CSS 声明，有就一定以他为主，没有看第二步</li><li>第二步：找有没有行内样式，有则以行内样式为主，没有看第三步</li><li>第三步：看选择器的优先级，优先级高的为主，如果优先级相同，则看第四步</li><li>第四步：优先级相同，以写在后面的为主。如果没有选择器作用于当前标签，则看第五步</li><li>第五步：看此 CSS 属性是否具有继承性，如果有，则继承父元素的样式，如果没有，则以默认样式显示。</li></ul></blockquote><h3 id="元素浮动的特性">元素浮动的特性</h3><p>①元素添加浮动后，脱离文档流</p><p>②子元素在放不下的情况下会换行显示</p><p>③子盒子会按顺序进行贴靠，如果没有足够空间，则会寻找在前一个兄弟元素</p><p>④元素浮动后，具有行内块级元素特性</p><blockquote><p><strong>TIP</strong></p><ul><li>浮动的元素不再区分块级元素、行内元素，已经脱离了标准文档流</li><li>一律能够设置宽度和高度，即使它是 span 标签 或 a 标签 等等</li></ul></blockquote><p>⑤浮动的元素会造成父元素高度塌陷</p><blockquote><p><strong>TIP</strong></p><ul><li>当给子元素添加了浮动后，子元素相当于漂浮起来，不占据页面空间。</li><li>这样就造成父级元素在没有设置高度时，高度塌陷问题。 具体看如下案例：</li></ul></blockquote><table><thead><tr><th style="text-align:left">item 未设置浮动前效果</th><th style="text-align:left">item 设置浮动后效果</th></tr></thead><tbody><tr><td style="text-align:left"><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATsAAACnCAIAAADhbWwcAAACMklEQVR4nO3ZMQrCQBBAUVdyJHuvbu+h1jaBpBDF+OG9blJN8xnCjjnnBYi4nr0A8AbFQolioUSxUKJYKFk20xgnrQEc2L7muLFQolgoWfY/P56/XYNvu9/O3oDPHPyiurFQolgoUSyUKBZKFAslioUSxUKJYqFEsVCiWChRLJQoFkoUCyWKhRLFQolioUSxUKJYKFEslCgWShQLJYqFEsVCiWKhRLFQolgoUSyUKBZKFAslioUSxUKJYqFEsVCiWChRLJQoFkoUCyWKhRLFQolioUSxUKJYKFEslCgWShQLJYqFEsVCiWKhRLFQolgoUSyUKBZKFAslioUSxUKJYqFEsVCiWChRLJQoFkoUCyWKhRLFQolioUSxUKJYKFEslCgWShQLJYqFEsVCiWKhRLFQolgoUSyUKBZKFAslioUSxUKJYqFEsVCiWChRLJQoFkoUCyWKhRLFQolioUSxUKJYKFEslCgWShQLJYqFEsVCiWKhRLFQolgoUSyUKBZKFAslioUSxUKJYqFEsVCiWChRLJQoFkoUCyWKhRLFQolioUSxUKJYKFEslCgWShQLJYqFEsVCiWKhRLFQolgoUSyUKBZKFAslioUSxUKJYqFEsVCiWChRLJQoFkoUCyWKhRLFQolioUSxUKJYKFEslCgWShQLJYqFEsVCiWKhRLFQolgoUSyUKBZKFAslY865msZ5mwB71oW6sdCiWChZNtP2/gL/xo2FEsVCiWKhRLFQ8gKlZA9LkeBhSwAAAABJRU5ErkJggg==" alt="image-20220623120931297"></td><td style="text-align:left"><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT8AAACpCAIAAADSjK0WAAACPElEQVR4nO3bMQ6CQBBAUTFeyd6ja613WjsKDQ0RyDfvlVtN8zObDUxjjBMQdD56AGAl9UKVeqFKvVClXqhSL1SpF6rUC1WXz4NpOmIMYNnCJ1V2L1SpF6q+bs6z+3PHMdjA7Xr0BGzL7oUq9ULV1815ft16vHYehR/z7+e/s3uhSr1QpV6oUi9UqReq1AtV6oUq9UKVeqFKvVClXqhSL1SpF6rUC1XqhSr1QpV6oUq9UKVeqFIvVKkXqtQLVeqFKvVClXqhSr1QpV6oUi9UqReq1AtV6oUq9UKVeqFKvVClXqhSL1SpF6rUC1XqhSr1QpV6oUq9UKVeqFIvVKkXqtQLVeqFKvVClXqhSr1QpV6oUi9UqReq1AtV6oUq9UKVeqFKvVClXqhSL1SpF6rUC1XqhSr1QpV6oUq9UKVeqFIvVKkXqtQLVeqFKvVClXqhSr1QpV6oUi9UqReq1AtV6oUq9UKVeqFKvVClXqhSL1SpF6rUC1XqhSr1QpV6oUq9UKVeqFIvVKkXqtQLVeqFKvVClXqhSr1QpV6oUi9UqReq1AtV6oUq9UKVeqFKvVClXqhSL1SpF6rUC1XqhSr1QpV6oUq9UKVeqFIvVKkXqtQLVeqFKvVClXqhSr1QpV6oUi9UqReq1AtV6oUq9UKVeqFKvVClXqhSL1SpF6rUC1XqhSr1QpV6oUq9UKVeqFIvVKkXqtQLVeqFKvVClXqhSr1QNY0xjp4BWMPuhSr1QpV6oUq9UKVeqFIvVL0BtxUQ2uh16WkAAAAASUVORK5CYII=" alt="image-20220623120955518">&quot;</td></tr></tbody></table><p>⑥浮动对文字的影响</p><blockquote><p><strong>TIP</strong></p><ul><li>常见的图片文字环绕效果，其实现方式主要是将图片左浮动或右浮动</li><li>浮动后其相邻的文字，就会环绕图片排列</li></ul></blockquote><p>⑦使用浮动实现网页布局</p><blockquote><p><strong>TIP</strong></p><ul><li>垂直显示的盒子，不要设置浮动，只有并排显示的盒子才要设置浮动</li><li>每一个盒子都是独立存在，每个盒子中又是一个小天地，内部可以继续使用浮动</li></ul></blockquote><h3 id="BFC规范-和-浏览器差异">BFC规范 和 浏览器差异</h3><blockquote><p><strong>TIP</strong></p><ul><li>BFC （Box Formatting Context ，块级格式上下文）是页面上的一个隔离的独立容器</li><li>容器里的子元素不会影响到外面的元素，反之亦然</li></ul><p>如：一个盒子不设置 height，当内容子元素都浮动时，无法撑起自身</p><p><strong>原因是：这个盒子没有形成 BFC</strong></p></blockquote><p>①创建BFC</p><blockquote><p><strong>TIP</strong></p><ul><li>方法 1：float 的值不是 none</li><li>方法 2：position 的值不是 static 或者 relative</li><li>方法 3：display 的值是 inline-block、flex 或 inline-flex</li><li>方法 4：<code>overflow：hidden;</code></li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>创建BFC - arry老师<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">5px</span> solid red;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            方法1：float的值不是none </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            该方法可以实现效果，但没有意义，不可能随意给盒子设置浮动</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* float: left; */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            方法2：position的值不是static或者relative </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            该方法可以实现效果，但不靠谱</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* position: absolute; */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            方法3：display的值是 inline-block、flex 或 inline-flex </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            该方法可以实现效果，但，没有意义，可能随便改变盒子的为行内块，获取其他的</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* display: inline-block; */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* display: flex; */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* display: inline-flex; */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            方法4：overflow：hidden；</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            该方法可以实现效果，但是，不能满足所有的场景</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* overflow: hidden; */</span></span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.box</span> <span class="selector-class">.c1</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.box</span> <span class="selector-class">.c2</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>创建BFC<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      BFC （Box Formatting Context</span><br><span class="line">      ，块级格式上下文）是页面上的一个隔离的独立容器</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;c1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;c2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>溢出隐藏：overflow：hidden;</strong></p><ul><li>溢出盒子边框的内容将会被隐藏</li><li>overflow：hidden；是非常好用的让盒子形成 BFC 的方法</li></ul></blockquote><p>②BFC的其他作用</p><blockquote><p><strong>TIP</strong></p><ul><li>BFC 可以取消盒子 margin 塌陷</li><li>BFC 可以阻止元素被浮动元素覆盖</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 垂直方向上下margin会重合 距离依然是：50 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">    BFC作用一：可以取消盒子margin塌陷</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    添加overflow：hidden; 创建BFC</span></span></span><br><span class="line"><span class="comment"><span class="language-css">  */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">    BFC作用二：可以阻止元素被浮动元素覆盖</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    没有实际意义，实际开发不会这么用，只具有理论意义，要明白</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    需要并排显示的盒子，要么都浮动，要么都不写，以下的写法是不合法规范的</span></span></span><br><span class="line"><span class="comment"><span class="language-css">  */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box1</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box2</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: tomato;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* float: left; */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="浏览器差异">浏览器差异</h3><blockquote><p><strong>TIP</strong></p><ul><li>IE6、7 浏览器使用 haslayout 机制 和 BFC 规范略有差异</li><li>比如：IE 浏览器可以使用 zoom:1 属性，让盒子拥有 layout</li><li>如果要制作兼容到 IE6、7 的网页时，尽量让网页布局变得简单，内部有浮动的盒子要设置 height 属性，规范编程，就没有问题</li></ul></blockquote><h3 id="清除浮动">清除浮动</h3><blockquote><p>TIP</p><p>清除浮动：浮动一定要封闭到一个盒子中，否则就会对页面后续元素产生影响</p></blockquote><p><strong>清除浮动方法 1</strong></p><blockquote><p><strong>TIP</strong></p><ul><li>让内部有浮动的父盒子形成 BFC，它就能关闭住内部的浮动。</li><li>此时，最好的方法就是 <code>overflow: hidden;</code> 属性</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  * &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">        清除浮动方法1：</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        让内部有浮动的父盒子形成BFC，它就能关闭住内部的浮动</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        此时，最好的方法就是 overflow: hidden; 属性</span></span></span><br><span class="line"><span class="comment"><span class="language-css">      */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>清除浮动方法 2</strong></p><ul><li>给后面的父盒子设置 <code>clear: both;</code> 属性</li><li><code>clear</code> 表示清除浮动对自己的影响，<code>both</code> 表示左右浮动都清除</li></ul><p>该方法不推荐</p><p><strong>清除浮动方法 3</strong></p><ul><li>使用 <code>::after</code>伪元素 给盒子添加最后一个子元素</li><li>并且给 <code>::after</code> 设置 <code>clear:both;</code></li></ul><p><strong>强烈推荐使用，最佳实践（大厂都这么用）</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20211129230743346.ebc18298.png" alt=""></p><p><strong>清除浮动方法 4</strong></p><ul><li>在两个父盒子之间 “隔墙” 隔一个携带 <code>clear: both;</code>的盒子</li></ul><p><strong>不推荐</strong></p><p><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAzQAAADyCAYAAACbK4BDAAAF1klEQVR4nO3dQW7TUBRA0W/kndA9RSKbiBfVrgq6FTNADYIi4YaqP1ecM/oDD570RlffiZd93/cBAAAQsm3bOJ1O49PsQQAAAG4laAAAgKz167fn2TMAAADcZH14+Dx7BgAAgLe5XMYYXjkDAADC1uvpceIUvHY++Jy93ZejewMA4F24oQEAALLW8fIZmqdl7iT86ujngeztvvisEwDAx9i2MYYbGgAAIEzQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIGsdyzJ7Bv7kbC9J9gYA8DEulzGGGxoAACBsvZ72feIYAAAAB/z2hpkbGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMhar6dlmTgGAADA27mhAQAAsgQNAACQJWgAAICsn7+heZw4Ba+dDz5nb/fl6N4AAHgXbmgAAICsdez7j9OTfzm7Ky97+Rt7uy9H9wYAwL/ZtjGGGxoAACBM0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJAlaAAAgCxBAwAAZAkaAAAgS9AAAABZggYAAMgSNAAAQJagAQAAsgQNAACQJWgAAIAsQQMAAGQJGgAAIEvQAAAAWYIGAADIEjQAAECWoAEAALIEDQAAkCVoAACALEEDAABkCRoAACBrvZ6+7BPH4Gb2BgDAf8wNDQAAkCVoAACALEEDAABkCRoAACBL0AAAAFmCBgAAyBI0AABAlqABAACyBA0AAJD1HaLtJtCCSnzaAAAAAElFTkSuQmCC" alt="image-20211129231600890"></p><h3 id="定位类型值">定位类型值</h3><table><thead><tr><th style="text-align:left">属性值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">static</td><td style="text-align:left">没有定位，元素出现在正常的流中（默认值，可以忽略）</td></tr><tr><td style="text-align:left">relative</td><td style="text-align:left">相对定位，相对于自身正常位置进行位置的调整</td></tr><tr><td style="text-align:left">absolute</td><td style="text-align:left">绝对定位，相对于其最近的定位的父元素定位，进行位置调整</td></tr><tr><td style="text-align:left">fixed</td><td style="text-align:left">固定定位 相对于浏览器窗口进行位置调整</td></tr><tr><td style="text-align:left">sticky</td><td style="text-align:left">粘性定位 是基于用户的滚动位置来定位</td></tr></tbody></table><blockquote><p>static 相当于元素没有加定位效果，如果元素加了定位，后面需要去掉，可以添加 <code>position: static;</code></p></blockquote><p><strong>①相对定位</strong></p><blockquote><p><strong>TIP</strong></p><ul><li>相对定位的元素，会在 “老家留坑” ，本质上仍然是在原来的位置，即：元素的初始位置占据的空间会被保留</li><li>只不过渲染在新的地方而已，渲染的图形可以比喻成影子，不会对页面其他元素产生任何影响</li></ul><p>应用场景：</p><ul><li>用来微调元素自身的位置</li><li>可以当做绝对定位的参考盒子（绝对定位中会讲到）</li><li>用来提升自身的层级</li></ul></blockquote><p><strong>②绝对定位</strong></p><blockquote><p>盒子可以在浏览器中以坐标进行位置精准描述，拥有自己的绝对位置</p><ul><li>给需要添加绝对定位的元素，加上<code>position: absolute;</code></li><li>元素的位置通过（位置描述词）：<code>&quot;left&quot;</code>, <code>&quot;top&quot;</code>, <code>&quot;right&quot;</code> ,<code>&quot;bottom&quot;</code>属性进行调整位置</li><li>属性值可以是正数，也可以是负数</li></ul><table><thead><tr><th style="text-align:left">定位的位置属性</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">top</td><td style="text-align:left">到上边的距离</td></tr><tr><td style="text-align:left">bottom</td><td style="text-align:left">到下边的距离</td></tr><tr><td style="text-align:left">left</td><td style="text-align:left">到左边的距离</td></tr><tr><td style="text-align:left">right</td><td style="text-align:left">到右边的距离</td></tr></tbody></table><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 在不设置相对于谁定位时，默认相对浏览器的（0,0）坐标进行绝对定位 */</span></span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">100px</span>;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>绝对定位元素 8 大特性</strong></p><ul><li>绝对定位的元素，相对离自己<strong>最近</strong>的定位父元素进行位置调整</li><li>如果没有定位的父元素，则相对 body 进行位置调整</li><li>元素完全脱离文档流，释放其原本所占据的空间</li><li>元素的层级提升，会覆盖在其它元素上。</li><li>行内元素加上定位后，其具有行内块元素特性，支持宽高设置</li><li><code>margin: auto;</code> 水平居中失效</li><li>定位元素未设置宽高情况下，同时设置 top 和 bottom 会改变元素高，同时设置 left 和 right 会改变元素宽</li><li>在元素调置宽高情况下，同时设置 top 与 bottom ,会以 top 值为主 bottom 不生效，同时设置 left 与 right，则以 left 为主，right 不生效。</li></ul></blockquote><ul><li><strong>绝对定位脱离标准的文档流</strong></li></ul><blockquote><p><strong>TIP</strong></p><ul><li>绝对定位的元素脱离标准文档流，将释放自己的位置，对其他元素不会产生任何干扰，而是对他们进行压盖</li><li>脱离标准文档流的方法：<strong>浮动</strong>、<strong>绝对定位</strong>、<strong>固定定位</strong></li><li>使用绝对定位的元素将会是一种漂浮状态</li></ul></blockquote><ul><li><strong>脱离文档流，层级提升</strong></li></ul><blockquote><p><strong>TIP</strong></p><p>绝对定位元素完全脱离文档流,释放其原本所占据的空间，同时层级提升，会覆盖在其它元素上面</p></blockquote><ul><li><strong>相对于其最近的定位的父元素定位</strong></li></ul><blockquote><p><strong>TIP</strong></p><p>父元素未定位，祖先元素定位，绝对定位相对于定位的祖先元素定位</p></blockquote><ul><li><p><strong>父元素及祖先元素都未定位，则相对于 body 定位</strong></p></li><li><p><strong>行内元素绝对定位后，具有行内块元素特性</strong></p></li><li><p><strong>margin:0 auto 水平居中失效</strong></p></li><li><p><strong>top 与 bottom 及 left 与 right 同时设置，调节宽高</strong></p></li><li><p><strong>top 与 bottom 及 left 与 right 的优先级</strong></p></li></ul><blockquote><p><strong>TIP</strong></p><p>在元素设置宽高情况下，同时设置 top 与 bottom，会以 top 值为主 bottom 不生效，同时设置 left 与 right，则以 left 为主，right 不生效。</p></blockquote><ul><li><strong>绝对定位的盒子垂直、水平居中</strong></li></ul><blockquote><p>TIP</p><ul><li><p>绝对定位的盒子垂直居中是一个非常实用的技术</p></li><li><p>实现原理如下</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 垂直居中 */</span></span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line"><span class="attribute">margin-top</span>: -自己高度一半;</span><br><span class="line">              </span><br><span class="line"><span class="comment">/* 水平居中 */</span></span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line"><span class="attribute">margin-left</span>: -自己宽度一半;</span><br></pre></td></tr></table></figure></li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20220722182031178.58302297.png" alt=""></p><h4 id="绝对定位的应用场景">绝对定位的应用场景</h4><blockquote><p><strong>TIP</strong></p><ul><li>绝对定位用来制作 <strong>压盖</strong>、<strong>遮罩</strong> 效果</li><li>绝对定位用来结合 CSS 精灵使用</li><li>绝对定位可以结合 JS 实现动画</li><li>绝对定位应用非常多，灵活性也很高，靠经验累积</li></ul></blockquote><h3 id="固定定位">固定定位</h3><blockquote><p><strong>固定定位简介</strong></p><ul><li>给需要添加固定定位的元素，加上 <code>position: fixed;</code></li><li>元素的位置通过（位置描述词）：<code>&quot;left&quot;</code>, <code>&quot;top&quot;</code>, <code>&quot;right&quot;</code> ,<code>&quot;bottom&quot;</code>属性进行调整位置。属性值可以是正数，也可以是负数</li></ul><p><strong>语法：</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">position</span>: fixed;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">100px</span>;</span><br></pre></td></tr></table></figure><p><strong>应用场景：</strong></p><ul><li>不管浏览器的滚动条如何滚动，元素始终相对浏览器窗口的位置不变。</li></ul><p>比如：返回顶部、楼梯式导航、右侧悬浮菜单，顶部与底部通栏广告等</p></blockquote><blockquote><p><strong>注：</strong></p><ul><li>固定定位只能以页面为参考点，没有绝对定位的参考点，只能以浏览为参考点</li><li>固定定位脱离标准文档流</li><li>除其位置是相对于浏览器窗口而言外，其它与绝对定位的特性一致</li></ul></blockquote><h3 id="粘性定位">粘性定位</h3><blockquote><p><strong>粘性定位解读</strong></p><ul><li>给需要添加粘性定位的元素，加上<code>position:sticky;</code></li><li>粘性定位可以看做是<strong>相对定位</strong> 与 <strong>“固定定位”</strong> 的混合产物 <strong>（这里的固定定位，并不是我们上面说的<code>position:fixed;</code>只是具有相似点）</strong></li><li>当滚动高度小于元素所在位置时，元素以相对定位呈现</li><li>当滚动高度大于元素所在位置时，元素以<strong>固定</strong>定位呈现</li><li>当滚动高度大于（元素的父元素底部与浏览器高）时，元素相对于父元素定位，一起移走</li><li>粘性定位相对离他最近的一个拥有“滚动机制”的祖先元素（当该祖先的<code>overflow</code> 是 <code>hidden</code>, <code>scroll</code>, <code>auto</code>, 或 <code>overlay</code>时)定位 或 直接块级父元素定位</li></ul></blockquote><blockquote><p><strong>固定在离自己最近的拥有“滚动机制”的祖先上</strong></p><ul><li>body 为最近“<strong>滚动机制</strong>”的祖先，此时要看到元素相对浏览器固定效果，元素的直接父元素高度一定要大于元素本身。</li></ul><p><strong>元素的父级拥有“滚动机制”</strong></p><ul><li>当滚动父级元素的滚动条时，元素固定在父级元素的最顶部。</li></ul><p><strong>应用场景</strong></p><p>类似吸顶盒效果、需要元素吸附指定位置的需求，一般会用到</p></blockquote><h3 id="定位总结">定位总结</h3><table><thead><tr><th style="text-align:left">定位类型</th><th style="text-align:left">描述</th><th style="text-align:left">应用场景</th></tr></thead><tbody><tr><td style="text-align:left">相对定位 relative</td><td style="text-align:left">相对自身原来的位置定位，占着原来的位置</td><td style="text-align:left">微调元素的位置，但还占据原来空间 只想提元升素的层级，但还是占原来的空间</td></tr><tr><td style="text-align:left">绝对定位 absolute</td><td style="text-align:left">相对离自己最近的定位的父元素定位，原来的位置被释放，相当于悬浮在页面中，会覆盖在其它元素的上面显示</td><td style="text-align:left">一个元素想覆盖在另一个元素上面 配合 JS 来实现动画效果</td></tr><tr><td style="text-align:left">固定定位 fixed</td><td style="text-align:left">相对浏览器窗口进行定位</td><td style="text-align:left">你想让一个元素相对浏览器的位置一直不动</td></tr><tr><td style="text-align:left">粘性定位 sticky</td><td style="text-align:left">相对离自己最近的拥有滚动机制的父元素定位，或（直接父元素定位）</td><td style="text-align:left">吸附效，冻结效果</td></tr></tbody></table><h3 id="z-index-设置定位元素层叠顺序">z-index 设置定位元素层叠顺序</h3><blockquote><p><strong>TIP</strong></p><p>定位的元素脱离了正常文档流，他相当于漂浮在文档上面。那如果有很多个元素都用了定位，那如何确定这些元素的层叠顺序里。<code>z-index</code>就是用来指定 <strong>定位元素</strong> 的堆叠顺序。</p><p><strong>同一层叠上下文中 <code>z-index</code>值的特性</strong></p><ul><li>z-index 的默认值是 0</li><li>z-index 值可以是正，也可以是负</li><li>z-index 值相同的元素，写在后面的会覆盖前面的</li><li>z-index 值越大，元素越在上面显示</li><li>z-index 只针对定位元素有效，对其它元素效</li></ul></blockquote><p>以下图只列出了目前学到的相关元素，在<strong>同一层叠上下文</strong>中的层叠顺序。</p><p><img src= "/img/loading.gif" data-lazy-src="https://www.arryblog.com/assets/img/image-20220613174347406.89cc08ca.png" alt=""></p><blockquote><p><strong>同一层叠上下文，元素的层叠顺序，参考上图，由上到下分别</strong></p><ul><li>背景和边框：建立当前层叠上下文元素的背景和边框。</li><li>负的 z-index：当前层叠上下文中，z-index 属性值为负的元素。</li><li>块级盒：文档流内非行内级非定位后代元素。</li><li>浮动盒：非定位浮动元素。</li><li>行内盒：文档流内行内级非定位后代元素。</li><li><code>z-index:0;</code>层叠级数为 0 的定位元素。</li><li>正<code>z-index：z-index</code>属性值为正的定位元素。</li></ul></blockquote><h3 id="防御式编程-防御式-CSS">防御式编程 - 防御式 CSS</h3><p>场景1：单行文本过长</p><p>我们设计时的理想效果是标题文字不超过 8 个字，正好显示完整。但实际应用时，有可能标题内容过长造成换行显示。我们可以添加<strong>文字溢出显示…省略号</strong>来解决。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">body</span>,</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">h3</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">40px</span> auto;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span> <span class="selector-tag">h3</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">100</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/*以防万一，标题过长时，用...省略号显示*/</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">white-space</span>: nowrap;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-overflow</span>: ellipsis;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/flex-06.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&quot;以防万一&quot;标题过长产生的问题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>场景二：类别标签中文本过长</p><p>在这个效果中，我们并不希望标签延伸到最右侧，我们希望内容过长时，可以在一定的长度时就折行显示。我们可以通过添 <code>max-width</code>属性来避免这种“以防万一”的问题。</p><p>场景三：防止图片拉伸或挤压</p><p>我们预想的是用户按 1:1 的大小来上传头像图片，但实际用户上传的头像比例是五花八门，就会造成图片被拉伸或挤压变形。我们可以添加<code>Object-fit: cover</code>来等比例裁剪图片尺寸，这样图片就不会被拉伸或压缩，不过会有一部分图片被裁剪掉。</p><p>场景四：图片加载失败，文字显示问题</p><p>当图片上有文字时，如果图片加载失败，而外层容器的背景色和文字颜色接近，那么文字的展示效果就不理想；此时我们可以给图片加上对应的背景色。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">250px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">156px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.box</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover;</span><br><span class="line">    <span class="comment">/*&quot;以防万一&quot;图片加载失败，加上背景色，保证文字能正常显示*/</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#666</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.box</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;images/rotate3<span class="selector-class">.webp</span>&quot; alt=&quot;&quot; /&gt;</span><br><span class="line">    &lt;<span class="selector-tag">h3</span>&gt;美丽的风景图&lt;/<span class="selector-tag">h3</span>&gt;</span><br><span class="line">  &lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">body</span>&gt;</span><br></pre></td></tr></table></figure><p>场景五：必要时显示滚动条</p><p>在内容比较长的情况下，可以通过设置 overflow-y 控制滚动条是否展示。但是这里更推荐将<strong>overflow-y 的值设置为 auto</strong>。如果你将 overflow-y 显式设置为 scroll 时，不管容器内容长短，滚动条都会展示出来，这种体验是不好的</p><p>场景六：预留滚动条空间，避免重排</p><p>当内容不足时不会出现滚动条，文字占据的宽度要宽些。当内容溢出出现滚动条时，因为滚动条要占据一部分空间，则会造成文字占据的空间变窄，因而会造成重排。我们可以元素添加<code>scrollbar-gutter: stable;</code>来避免这个问题。</p><p>scrollbar-gutter 属性有三个值</p><table><thead><tr><th style="text-align:left">属性值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">auto</td><td style="text-align:left">就是默认表现。没有滚动条的时候，内容尽可能占据宽度，有了滚动条，可用宽度减小</td></tr><tr><td style="text-align:left">stable</td><td style="text-align:left">如果 overflow 属性计算值不是 visible，则提前预留好空白区域，这样滚动条出现的时候，整个结构和布局都是稳定的。</td></tr><tr><td style="text-align:left">both-edges</td><td style="text-align:left">让容器左右两侧同时预留好空白区域，目的是让局部绝对居中对称。</td></tr></tbody></table><p>场景七：锁定滚动链</p><p>我们会发现当子元素滚动到顶部或底部继续滚动滚轮时，会导致父元素的滚动，但这种行为有时会影响页面体验。在子元素上应用<code>overscroll-behavior: contain</code>就可以禁止掉这一行为。</p><p>场景八：flex 布局中，元素使用 space-between 最后一行两边分布的问题 ？</p><p>如果我们每一行显示的个数为 n，那我们可以最后一行子项的后面加上 n-2 个 span 元素，span 元素的宽度和其它子项元素宽度一样，但不用设置高度。</p><blockquote><p><strong>为什么是添加 n-2 个 span 元素呢？</strong></p><ul><li>当最后一行只有 1 个子元素时，他会默认靠左，不用处理</li><li>当最后一行子元素正好时，我们就不用关心这个问题。</li></ul><p>所以要去掉这两种情况，只需要加 n-2 个 span 元素就好</p></blockquote><table><thead><tr><th style="text-align:left">设计师设计效果</th><th style="text-align:left">实际效果</th><th style="text-align:left">处理后的效果</th></tr></thead><tbody><tr><td style="text-align:left"><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvcAAAFGCAIAAABhYyehAAAQm0lEQVR4nO3db4hV95nA8cdNUAO6mY4WJrokvcFiFBQmKEHdEJ0s3ckkMEWxZB03hXGX1Y4gXa2FVEtZJ4GIbpNujEJWF8poSySCbDK6BUezQd2g7NBITYeG3G6pOjQZM1llZxyQ2Rcxf4zX0THqnfvk8yEvPOdc4Xnxw3zPuefcM2pwcDAAANL5s3IPAABwS6gcACAnlQMA5KRyAICcVA4AkNOdl229cbxMYzDiPTJrqKNWDldj5XBjrBxuzOUrx7UcACAnlQMA5KRyAICcVA4AkJPKAQByuvPaHznfteu1D+Y8Oa9w66chg4Fz77z72zMXIiK+ds8D02rGjy33RFSE/rPFzv/5oC8iYuw990+ddvfock9EBRo41zsQEWOqxlk/RFyzcro7dyzbsLX97IojKodrutjTsfu5v9t2sPj5nZMXvPjj9S1Tx5drKEa+7rdeWPaztvZTl+0szF/76prFtePKNBMVqWfXs/VNhyLmbzjzk/qack/DSHC1yhnoPrlv08tbN3f23NZxqGDn2rc0Pb6np6Ywr+XhBXW1E/uLx1//9327igdX/sMHvS9t+9F0p1aUVuxqa+8rLHly8eO136iJnnc6Ozb/8mDx0MYH/3Thv19aWlvu8agU/cfbVh8q9xCMMCUqp/etrQ0/23H0VERMqKud0dF54rZPRSUa6D07qWX91tZHC1Uf76idt2Rhc9O2FY//8sS6F/cufGnxtPIOyEhVM+ulM02za+64tFn3UH1Lw+7Hn9rYfvKF7UcaX5zrQiDXo2vLjrbucg/BSFPi7uP+88Wjp6Lw0NKd/7b7wN//5e2fico0es7ybS9+mjiXjG9YtHRhRJw81vl+ecZi5CtM/yxxLrm3vqUxImLLu78vx0RUnuJrW9ecjIXzF5R7EEaWEpUz9r7FB37e8d5zq5YUnEJx/cYXakp9J/X1yQ9GRBwsqhyGYfzXJpR7BCpI9/41mw7H9FXrFj1Q7lEYWUpUTtWU2XX36htukoH+DyMiFhS+Xu5JqCQ9xfciIlqmfKPckzDynd61bf2emNG66ju1d1z703yl+L0cbq3+t4/sjIgpM6epHK5bb+crmw5FTF+xbJYzLq6h+Kvnmw7FnObvr57qEQe+6Dp+LwduWN+JzTvauiMavl3nSRmG0P9+15E//m9ExPnT7Yd27jxQjNqlr/+wudb/thjau21Nzx6M6Ss2L57hp7m4ksrhljl/4pn1P1h3Mmpq17Y+Manc0zCi9b69/dENBz/Zmr1k+Yp1TyyY5sdyGFrfiWf++YWjMaN15dI5d5V7GEYklcMt0du1e9k/bdxzKmrmrmpfv9iFHIY29p55m5bPjIjo/X3728d2bVu7a9ukhctbtz85o+paf5evqp49P/3BupMxp+WHfo6Lq1E53HTnOnevb9hyuDsm1D21fud3533xIWG4QtX0xtXTL/15dURvcW/L6tZd25rPXGzraJrqmwiuVDzwfMuvemq+tWHn4qnlnoWRy93H3FR9xe3PLn5wy+Hu6nmt/7L7QLPE4UZUFRq3P720JuLoy3s7zpd7Gkae3uNbmzbs77536fbmeV87f6730//OXYiIuHjhw483+8o9KOXmWg43T9+JZ57+wbrOnpq5q9qfXuoNRHwZY2fObYq2zdHReWptg3N1LtPd/tqOoxHxh7bHn2wrcfzN1ulvtkZENO8YfGrG7Z2NkUXlcLMMHP3Fc+s6e2q+teHI0/Xe7cpNMnGsy4Fcoerrs+tmlTrwf6c6Tp6O6kLd/RMjIryZ/CtP5XCTnNrX+vOuqF668/sSh5vg0i8txezae8s9CiNOTUPLSw0lj5zcMep7W2Nm807vJCci3JfDzdL9u+PtETFz6nTPczIsXbvXHOjqvXjZvt7i3mXPtnVHzGmpr3M2Dtwo13K4Oc68X4yIOLT+nvnrS39i/oYzzq640sVzmzcs3bylUPfQvIb7JkT0vPPW4dc7i90Rhcc2enwG+DJUDjdHf19XuUegMk2evenR/ZsOFDv2FTs+2VdTmLd66ap1X3zFPcDwjBocHPxs643j5ZuEke2Rknf6fcLK4Wquc+VcHOjtu/Bh9297xz1QGDemyk2j+DeHG3P5ynEtBxgB7hhdNW501ZTZ5Z4DSMXdxwBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOY0aHBws9wwAADefazkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJzuvGzrjeNlGoMR75FZQx21crgaK4cbY+VwYy5fOa7lAAA5qRwAICeVAwDkpHIAgJxUDgCQ050l9/afP9df8sDo8VWjb+U4pHFxoFj8dfFcRESMmfjglIKVQ2l953ovDv2JMVXjrB6uYOVwHUpVzsCxdU98b3OpTy9cv//VRyfc4pGodOc6972w5uW9HWc/v3PFkUPNc8o1ESPY0d11c3cM+Yn5G878pL7mNo1DxbByuB6lKuejnmJEVBfq7p/4hSOFu27DSFS003ueW7Fo3+mISQ2N9QtnzSrE6c7fnHj1zXLPxUg1dtzsuqv8MErfmWNHT0Xt/ZOrbu9IVAQrh+tRqnI+vgY4s3mnCmZ4Bjp3rlu073RMb369dUVD9aW9dQ83rl5e1rkYwWoXvnRgYakDfcfWNB07Wr24tXHG2Ns9FBXAyuF6lLr7+OzpPbd9DjJ495WWl09ELNj5488SB25M52tbN5+NOX/T2HB3uUeholg5fN7Vn7G6f7ILOQzHQMfBtqMRtcuXLbF0+JLe39+65URUL219Ymq5R6GiWDlcrkTldP+pePvnoOIN/Lp9Z0/E7JaH/ePClzRwdF/bnoiG5sV17gVkGKwcvqjkfTkXImJhjWepGI4/dHVERPWsBydHRPR/VOx874O++PPCNwsFD3MyLO93bNrRFdVLVz86qdyjUFGsHK5QonLOnD0dEXuebRz17Mc7Js2ZP6+pcVlLre7hqrr/2NUZETMn3dPXteW5tSsPnf70UGH+2lfXLK4dV77hqCidB9r2RNR+p97pOMNi5XClEt9Y9fd1Xb7j9NFDu1d+v/7+5w76Kour6Ru4EBFRfe71n65a+btCy1OrNi1ftenJBYWI4qGND67d0TlQ7hGpCB8d3LKtK6Jx3WO++mQ4rBxKKXEtZ85Txwaf+myz/6OuPW0vrN59rLhvbdNftHU0TfVsHlfq7j4YEXFo+zOzVpz818Zpn5xLrf72/qbvrd91cuu6A/WvP+YyMtdQPLJ3e0RN0197QIZhsXIo6drvsRp799QlLc/vaZ4REUdf3ttx/tYPReU6+8CPvvtZ4kRE1NSv+c7UiGg/cMy1QK6la8+rhyMmrJw329kUw2HlUNp1vq1z9JzGv10WEdHReepWjkPFKkxeEBExa0Hd5C8eqp1ZFxFxvKf7dg9FpTl5eNO7EVOWNkwv9yRUFiuHq7jud5LfPbEQEdET13g7Gl9RY++aGBFx15hyD0LlGug4/Ep3RO1fza4t9yhUFCuHq7ruyhno/zAiYupYDwVTStV9U+si4s2u4pV3GV/8+MbkcCWZoQz8umNfT8TUplnuHmU4rByu7norp/et/9gcEdXzau+9leNQuSbPXvJQROzbc/zc5QcGOv5rb0TUPDZjWjnmomK8e2L72YjqurlTyj0JlcXK4equrJxi+4Gu3su/lup+a+uin+6NiIbmxjrXciht0qLGxTXRs2XTxl2fuwGn9/j2dTt7ImasWeCuQIbS+ZuO7oh4eKoaZlisHIZw5ZPk5zs3ND++pVD30LyG+yZE9Lzznx3bT56OiDkLn3/xCU8Cc1VVc5dteezwon37m558e2djfd09UXz74KtHit0xYcn61tVOsxhKT/F3XRFR981CVblHoaJYOQzlysqZUHi0UHOg2LGv2PHJrppC/crm5paHrSGGNmHhD9uO3Ldx2Sv72/fuaI+IiJpC/aZ/XLt6xvgyj8ZId/qdX0VEzLnPqRTDYuUwlFGDg4Ofbb1x/NIfBs71Dgyc+cN7/dUPFMaNqfIeIh6ZNdTRT1fOxy4O9H506p2zY6bVTLR4vuqGtXLgU1YON+bylVPqbZ0RMXp81eiomu7FVdyQO0ZXVRfmVJd7DAC+2q77SXIAgIqicgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJCTygEAclI5AEBOKgcAyEnlAAA5qRwAICeVAwDkpHIAgJxUDgCQk8oBAHJSOQBATioHAMhJ5QAAOakcACAnlQMA5KRyAICcVA4AkJPKAQByUjkAQE4qBwDISeUAADmpHAAgJ5UDAOSkcgCAnFQOAJDTqMHBwXLPAABw87mWAwDkpHIAgJxUDgCQk8oBAHL6fycswr91cJqcAAAAAElFTkSuQmCC" alt="image-20220526202336016"></td><td style="text-align:left"><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvkAAAFJCAIAAACO/KXHAAAQdElEQVR4nO3dcWiXd37A8Y/roRZ0zUUPUh3t/YrDKiikKCW6Uo3jlqaFHIpHZ7IexI3pRZCbngc9PY6ZFlp0195qFTodHNEdlQqyNroDo11RV5SFq5y9cKW/23FquDY2XWSJAcn+qLZVo9U08Zd8+nrRP8zzRPj88Tz2/Xx/z/N7xg0MDAQAQFJ/UuoBAABGkNYBADLTOgBAZloHAMhM6wAAmWkdACCzr1274c2TpRiDseDReTfb68jhRhw5DI0jh6G57sixrgMAZKZ1AIDMtA4AkJnWAQAy0zoAQGbXPYc1qAsde17/sOrJhYURnoYk+nvefe835y5GRHz93gdnVUyeWOqJGBP6zhfb/+fD3oiIifc+MHPWPeNLPRFjUH9Pd39ETCib5Pjhsi9unc72XSs3b289v/qY1uELXepq2/vc3+44XPz8xumLX/rxpqaZk0s1FKNf59svrvxZS+uZqzYWFm14bf3yykklmokxqWvPszX1RyIWbT73k5qKUk/DKHGT1unvPH1gyyvbt7Z33blxGNt6WrfVP76vq6KwsOmRxdWVU/uKJ9/49wN7iofX/P2H3S/v+NFsl1kMrtjR0tpbWPHk8scrv1kRXe+2t239xeHikecf+uPF/365obLU4zFW9J1sWXek1EMw+gzeOt1vb6/92a7jZyJiSnXlnLb2U3d2Ksao/u7z05o2bW9eUij7ZEPlwhVLG+t3rH78F6c2vrR/6cvLZ5V2QEarinkvn6ufX3HX5R+rH65pqt37+FPPt55+ceexupcWWBTkVnRs29XSWeohGIUGvze570Lx+JkoPNyw+1/3Hvq7v7jDMzFmja9ateOlT0Pnssm1yxqWRsTpE+0flGYsRr/C7M9C57L7aprqIiK2vfe7UkzE2FN8ffv607F00eJSD8KoM3jrTLx/+aGft73/3NoVBZdT3LrJhYrBPqX6xvSHIiIOF7UOt2Hy16eUegTGkM6D67ccjdlrNy57sNSjMOoM3jplM+ZX36dyGCb9fR9FRCwufKPUkzCWdBXfj4homvHNUk/C6Hd2z45N+2JO89rvVN71xb/NV43v12HE9b1zbHdEzJg7S+twy7rbX91yJGL26pXzXHfxBYq/fKH+SFQ1fn/dTA9AMIhb+34dGLLeU1t3tXRG1H672tM03ETfBx3H/vC/EREXzrYe2b37UDEqG974YWOl/3lxc++11D97OGav3rp8jq/yYlBah5F04dQzm36w8XRUVG5ofmJaqadhVOt+Z+eSzYev/DR/xarVG59YPMuX63Bzvaee+acXj8ec5jUNVXeXehhGK63DSOnu2LvyH5/fdyYqFqxt3bTcog43N/HehVtWzY2I6P5d6zsn9uzYsGfHtKWrmnc+Oafsi/4uX1Vd+376g42no6rph76+i5vQOoyEnva9m2q3He2MKdVPbdr93YXXPk4M1ymbXbdu9uU/r4voLu5vWte8Z0fjuUstbfUzfTbB9YqHXmj6ZVfFtzbvXj6z1LMwqrk3meHWW9z57PKHth3tLF/Y/M97DzUKHYairFC38+mGiojjr+xvu1DqaRh9uk9ur998sPO+hp2NC79+oaf70/96LkZEXLr40Sc/9pZ6UEYB6zoMq95Tzzz9g43tXRUL1rY+3eBNRnwZE+cuqI+WrdHWfmZDret2rtLZ+vqu4xHx+5bHn2wZZP9bzbPfao6IaNw18NScOzsbo47WYRj1H/+35za2d1V8a/Oxp2u8KZZhMnWipUGuU/aN+dXzBtvxf2faTp+N8kL1A1MjIrztHK3DcDpzoPnnHVHesPv7QodhcPmbmWJ+5X2lHoVRp6K26eXaQfec3jXue9tjbuNu7znnCvfrMGw6f3uyNSLmzpztyU9uS8fe9Yc6ui9dta27uH/lsy2dEVVNNdWuzIEvwboOw+bcB8WIiCOb7l20afDfWLT5nCstrnepZ+vmhq3bCtUPL6y9f0pE17tvH32jvdgZUXjseY/YAF+S1mHY9PV2lHoExqbp87csObjlULHtQLHtyraKwsJ1DWs3Lin4ch3gSxo3MDBw1YY3T5ZoEka9Rwe9D/AKRw43cotHzqX+7t6LH3X+pnvSg4VJE8rcUop/cxia644c6zrA6HDX+LJJ48tmzC/1HEA27k0GADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhs3MDAQKlnAAAYKdZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZfe3aDW+eLMUYjAWPziv1BGOW04obcVoNmdOKG7nutLKuAwBkpnUAgMy0DgCQmdYBADLTOgBAZtc9h3VF34WevkF3jJ9cNn7ExoGviEv9xeKvij0RETFh6kMzCk4ruG29Pd2Xbv4bE8omObW4Uev0n9j4xPe2DrZn6aaDry2ZMpIjQW497QdeXP/K/rbzn9+4+tiRxqpSTQRj0/G91Qt23fQ3Fm0+95Oaijs0DqPXDVrn465iRJQXqh+Yes2ewt0jPRIkdnbfc6uXHTgbMa22rmbpvHmFONv+61OvvVXquWAMmjhpfvUNvp+o99yJ42ei8oHpZXd2JEanG7TOJ6uCcxt3K2IYNv3tuzcuO3A2Zje+0by6tvzy1upH6tatKulcMDZVLn350NLBdvSeWF9/4nj58ua6ORPv9FCMRje4N/n82X13dg7I771Xm145FbF4948/Cx1g2LW/vn3r+aj667rae0o9CqPDTZ/DemC6RR0YJv1th1uOR1SuWrnCeQUj54ODzdtORXlD8xMzSz0Ko8XgrdP5x+IdngOS6/9V6+6uiPlNj/j3F0ZO//EDLfsiahuXV7u7lCtudL/OxYhYWuF5Kxgmv+9oi4jyeQ9Nj4jo+7jY/v6HvfGnhT8vFDwTC8Plg7YtuzqivGHdkmmlHoVRZPDWOXf+bETse7Zu3LOfbJhWtWhhfd3Kpkr1A0PR+YeO9oiYO+3e3o5tz21Yc+Tsp7sKiza8tn555aTSDQdZtB9q2RdR+Z0aizp83uCfYfX1dly94ezxI3vXfL/mgecO+3ALhqC3/2JERHnPGz9du+a3haan1m5ZtXbLk4sLEcUjzz+0YVd7f6lHhLHu48PbdnRE1G18zCfFXGXwdZ2qp04MPPXZj30fd+xreXHd3hPFAxvq/6ylrX6mp/jgtnR2Ho6IOLLzmXmrT/9L3awrF53rvn2w/nub9pzevvFQzRuPWXWHoSse278zoqL+rzx+xTVu6X1YE++ZuaLphX2NcyLi+Cv72y6M8FCQ1fkHf/Tdz0InIqKiZv13ZkZE66ETFk3hS+jY99rRiClrFs53Nc41bv3dn+Or6v5mZUREW/uZERsHkipMXxwRMW9x9fRrd1XOrY6IONnVeaeHgkROH93yXsSMhtrZpZ6E0ed23nN+z9RCRERXfMG71oBrTbx7akTE3RNKPQik1N929NXOiMq/nF9Z6lEYhW6ndfr7PoqImDnRE7Jwm8run1kdEW91FK+/B/nSJ7cth4V3GKL+X7Ud6IqYWT/PXckM4jZap/vt/9gaEeULK+8bsXEgq+nzVzwcEQf2ney5ekd/23/tj4iKx+bMKsVckMF7p3aejyivXjCj1JMwKg3aOsXWQx3dV39Q1fn29mU/3R8RtY111dZ14LZNW1a3vCK6tm15fs/nbszpPrlz4+6uiDnrF7uhEoao/ddtnRHxyEwXDAxq0GfOL7Rvbnx8W6H64YW190+J6Hr3P9t2nj4bEVVLX3jpCY/FwlCULVi57bGjyw4crH/ynd11NdX3RvGdw68dK3bGlBWbmte5HoUh6ir+tiMiqv+8UFbqURidBm2dKYUlhYpDxbYDxbYrmyoKNWsaG5secSTBkE1Z+sOWY/c/v/LVg637d7VGRERFoWbLP2xYN2dyiUeDMezsu7+MiKi636U4gxs3MDBw1YY3T17+Q39Pd3//ud+/31f+YGHShDKv7OHReaWeYMz69LT6xKX+7o/PvHt+wqyKqc6srzqn1ZBdc1rBp647rW7w7s+IGD+5bHyUzfYCLBhud40vKy9UlZd6DICvhtt55hwAYKzROgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhM6wAAmWkdACAzrQMAZKZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJlpHQAgM60DAGSmdQCAzLQOAJCZ1gEAMtM6AEBmWgcAyEzrAACZaR0AIDOtAwBkpnUAgMy0DgCQmdYBADLTOgBAZloHAMhs3MDAQKlnAAAYKdZ1AIDMtA4AkJnWAQAy0zoAQGZaBwDITOsAAJn9PyxpZxLWcOo6AAAAAElFTkSuQmCC" alt="image-20220515110815717"></td><td style="text-align:left"><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvoAAAFKCAIAAADjX2xqAAAQdUlEQVR4nO3df2jX953A8ZfXoRb0mkUHqR7tvqUjVVBIUYp6pRqPXZoWMhRHz3gdxDtOF0F2OgedjnGmhYre2l2tQk8PRnSjUkGujd7AaK+oV5QLq8wurPS7G1PD2tj0IpcYkNwf1XatSfyV+E1efTzwj3w/n6/w+uNN8vx8vp/P9zOuv78/AADy+rNSDwAAMLLkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyX1lgG1vnrrjYzBGPDZnqL1WDoOxcrg1Vg635pqV4+wOAJCc3AEAkpM7AEBycgcASE7uAADJDXRn1oAutu99/cN5Ty0ojOQ05NHX/e57vzl/KSLiq/c+NKNi8sRST8SY0Huh2PY/H/ZEREy894HKGfeML/VEjEF93V19ETGhbJL1wxU3lDsdbbtXbt7RcmH1cbnDdV3ubN33/N/tPFL8043TF730o02NlZNLNRSjX8fbL678aXPL2c9tLCzc8Nr6ZVWTSjQTY1Ln3udq6o9GLNx8/sc1FaWehlFi6Nzp6zhzcOsrO7a1dd6hcRjzulu21z+xv7OisKDx0UXVVVN7i6fe+PeDe4tH1vzDh10v7/zhTAdbDKzY3tzSU1j+1LInqr5eEZ3vtrVu+8WR4tEtD//x0n+/vKKq1OMxVvSeal53tNRDMPoMmjtdb++o/enuE2cjYkp11azWttN3cCrGrr6uC9MaN+1oWlwo+2RD1YLlSxrqd65+4henN750YMnLy2aUdkBGq4o5L5+vn1tx15WX1Y/UNNbue+LpLS1nXtx1vO6l+U4NciPat+9u7ij1EIxCg16q3HuxeOJsFB5Zseff9h3++7+8kzMxlo2ft2rnS5+2zhWTa5euWBIRZ062fVCasRj9CjM/a50r7qtprIuI2P7e70oxEWNP8fUd68/EkoWLSj0Io86guTPx/mWHf9b6/vNrlxccVHHjJhcqBvq46mvTH46IOFKUO9yEyV+dUuoRGEM6Dq3feixmrt249KFSj8KoM2julD04t/o+ocMw6ev9KCJiUeFrpZ6EsaSz+H5EROODXy/1JIx+5/bu3LQ/ZjWt/XbVXdd/N182vneHO6H3neN7IuLB2TPkDjesq+3VrUcjZq5eOcehF9dR/OUL9UdjXsP31lW6H4IB3PD37sAt6zm9bXdzR0Ttt6rdX8MQej9oP/6H/42IuHiu5eiePYeLUbXijR80VPn7xdDea65/7kjMXL1t2Sxf8cWA5A4j7OLpZzd9f+OZqKja0PTktFJPw6jW9c6uxZuPXH01d/mq1RufXDTDl+4wtJ7Tz/7ziydiVtOaFfPuLvUwjFZyhxHU1b5v5T9t2X82Kuavbdm0zKkdhjbx3gVbV82OiOj6Xcs7J/fu3LB357Qlq5p2PTWr7Hr/ly+rzv0/+f7GMzGv8Qe+1oshyB1GSHfbvk212491xJTqpzft+c6CL95jDNcom1m3buaVn9dFdBUPNK5r2ruz4fzl5tb6Sh9ScK3i4Rcaf9lZ8c3Ne5ZVlnoWRjWXKjMCeoq7nlv28PZjHeULmv5l3+EGrcOtKCvU7XpmRUXEiVcOtF4s9TSMPl2ndtRvPtRx34pdDQu+erG769N/3ZciIi5f+uiTlz2lHpRRwNkdhlvP6Wef+f7Gts6K+WtbnlnhaUfcjomz59dH87ZobTu7odbRO5/T0fL67hMR8fvmJ55qHmD/W00z32qKiGjY3f/0rDs7G6OO3GF49Z34+fMb2zorvrn5+DM1HijLMJk60QlCrlH2tbnVcwba8X9nW8+ci/JC9QNTIyI8Fx25wzA7e7DpZ+1RvmLP97QOw+DKNzbF3Kr7Sj0Ko05FbePLtQPuObN73Hd3xOyGPZ6IzlWu3WE4dfz2VEtEzK6c6XZQbkr7vvWH27suf25bV/HAyueaOyLmNdZUOz4HboOzOwyn8x8UIyKObrp34aaB37Fw83nHW1zrcve2zSu2bS9UP7Kg9v4pEZ3vvn3sjbZiR0Th8S1uugFuk9xhOPX2tJd6BMam6XO3Lj609XCx9WCx9eq2isKCdSvWblxc8KU7wG0a19/f/8Vtb54qxSSMBY8NeFngVVYOg7nBlXO5r6vn0kcdv+ma9FBh0oQyV5jidw635pqV4+wOMGrcNb5s0viyB+eWeg4gG5cqAwDJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkN66/v7/UMwAAjCBndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyX1lgG1vnrrjYzBGPDZnqL1WDoOxcrg1Q68cuGHO7gAAyckdACA5uQMAJCd3AIDk5A4AkNxAd2Zd1Xuxu3fAHeMnl40fmXFI5nJfsfirYndEREyY+vCDBSuHgfV0d10e+h0TyiZZPcAtGjx3+k5ufPK72wbas2TTodcWTxmxkcihu+3gi+tfOdB64U83rj5+tGFeqSZiFDuxr3r+7iHfsXDz+R/XVNyhcYBsBs+djzuLEVFeqH5g6hf2FO4e0ZFI4Nz+51cvPXguYlptXc2SOXMKca7t16dfe6vUczFaTZw0t3qQL1jpOX/yxNmoemB62Z0dCchk8Nz55MTy7IY9jqi4OX1tezYuPXguZja80bS6tvzK1upH69atKulcjGJVS14+vGSgHT0n19efPFG+rKlu1sQ7PRSQx+CXKl84t/8OzkEe773a+MrpiEV7fvRZ68CtaXt9x7YLMe9v6mrvKfUowFh2vTuzHpju1A43o6/1SPOJiKpVK5dbOtymDw41bT8d5Suanqws9SjA2DZo7nT8sXgn5yCJvl+17OmMmNv4qL9P3Ka+Eweb90fUNiyrdr0gcHuGuHbnUkQsqXAHFjfj9+2tEVE+5+HpERG9Hxfb3v+wJ/688I1CwV3E3JQPWrfubo/yFesWTyv1KMCYN2junL9wLiL2P1c37rlPNkybt3BBfd3KxioBxKA6/tDeFhGzp93b0779+Q1rjp77dFdh4YbX1i+rmlS64RhT2g4374+o+naNUzvA7Rv0w6zenvbPbzh34ui+Nd+reeD5Iz7lYjA9fZciIsq73/jJ2jW/LTQ+vXbrqrVbn1pUiCge3fLwht1tfaUekTHh4yPbd7ZH1G183KeiwDAY9OzOvKdP9j/92cvej9v3N7+4bt/J4sEN9X/R3Fpf6aZQrtXRcSQi4uiuZ+esPvOvdTOuHpev+9ah+u9u2ntmx8bDNW887rMJrqN4/MCuiIr6v3ZDFjAsbvSZWRPvqVze+ML+hlkRceKVA60XR3IoxroLD/3wO5+1TkRERc36b1dGRMvhk84Ocj3t+187FjFlzYK5DquAYXFTjwgdP6/ub1dGRLS2nR2ZcRjjCtMXRUTMWVQ9/Yu7qmZXR0Sc6uy400Mx1pw5tvW9iAdX1M4s9SRAFjf5RPR7phYiIjrjOg/z40tq4t1TIyLunlDqQRi7+lqPvdoRUfVXc6tKPQqQxk3mTl/vRxERlRPdU8xAyu6vrI6It9qL116SfPmTq5jDxxMMpe9XrQc7Iyrr57hIGRg2N5c7XW//x7aIKF9Qdd/IjMNYN33u8kci4uD+U92f39HX+l8HIqLi8VkzSjEXY8Z7p3ddiCivnv9gqScBEhksd4oth9u7Pv+JVcfbO5b+5EBE1DbUVTu7w8CmLa1bVhGd27du2fsnF+l0ndq1cU9nxKz1i1x8ylDaft3aERGPVspiYBgNdiP6xbbNDU9sL1Q/sqD2/ikRne/+Z+uuM+ciYt6SF1560o3EDKps/srtjx9bevBQ/VPv7Kmrqb43iu8cee14sSOmLN/UtM4hO0PpLP62PSKqv1EoK/UoQCaD5c6UwuJCxeFi68Fi69VNFYWaNQ0NjY/6NcTQpiz5QfPx+7esfPVQy4HdLRERUVGo2fqPG9bNmlzi0Rjtzr37y4iIefc7pgKG07j+/v4vbnvz1JUf+rq7+vrO//793vKHCpMmlHnmEY/NGWrvpyvnE5f7uj4+++6FCTMqplo8X3Y3tXLgU0OvHLhhgz8iNCLGTy4bH2UzPSSLW3LX+LLywrzyUo8BwJfeTd6IDgAw1sgdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJCd3AIDk5A4AkJzcAQCSkzsAQHJyBwBITu4AAMnJHQAgObkDACQndwCA5OQOAJCc3AEAkpM7AEBycgcASE7uAADJyR0AIDm5AwAkJ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACA5uQMAJDeuv7+/1DMAAIwgZ3cAgOTkDgCQnNwBAJKTOwBAcnIHAEhO7gAAyckdACC5/weBCGcU7CJfRAAAAABJRU5ErkJggg==" alt="image-20220515111311217"></td></tr></tbody></table><p>场景九：grid 网格中的响应式断行效果的处理</p><p>当我们想尽可能多的在一行显示子项的个数时，有可能会出现子项个数不满一行的情况。那这个时候利用网格布局，使用 auto-fill 和 auto-fit 就会是两个完全不同的效果。</p><ul><li>auto-fill ：网格的最大重复次数（正整数），如果有剩余空间，则会保留剩余空间，而不改变网格项目的宽度。</li><li>auto-fit：网格的最大重复次数（正整数），如果有剩余空间，网格项平分剩余空间来扩展自己的宽度。</li></ul><p>以下情况只会出现在子项内容不能占满一行时。也就是说万一内容不能占满一行，则使用 auto-fill 就会出现空白问题。我们把 auto-fill 改成 auto-fit 就解决了这个问题</p><hr><blockquote><p>本篇文章均转载自arry老师的<a href="https://www.arryblog.com/interview/htmlcss/html-html5.html#%E9%AB%98%E9%A2%91%E9%87%8D%E7%82%B9">教程</a>，仅供本人学习使用。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;CSS-4种书写位置特点与区别&quot;&gt;CSS 4种书写位置特点与区别&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;引入方式&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;书写位置&lt;/t</summary>
      
    
    
    
    <category term="前端💥" scheme="https://blog.cilicili.xyz/categories/%E5%89%8D%E7%AB%AF%F0%9F%92%A5/"/>
    
    
    <category term="CSS" scheme="https://blog.cilicili.xyz/tags/CSS/"/>
    
  </entry>
  
</feed>
